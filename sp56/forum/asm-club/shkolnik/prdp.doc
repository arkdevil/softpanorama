        Еще одна программа переназначения принтера в файл? Вполне ес-
тественный вопрос. Только в Софтпанораме я в последнее время видел не
менее двух таких программ. К сожалению, некоторые недостатки в работе
этих программ, обусловленные, по мнению их авторов, особенностями стро-
ения MS DOS, постоянно вызывали у меня трудности в их использовании.
Поэтому я решил написать новую, более приспособленную к особенностям
MS DOS программу.
        Программа PRDP.COM написана на ассемблере, скомпилирована с по-
мощью TASM 2.51 фирмы Borland и представляет собой резидентный модуль.
Может обслуживать сразу 4 принтера, причем для каждого из них вывод пе-
реназначается в отдельный файл. Переназначение выполняется на как на
уровне INT 17h для каждого из принтеров так и на уровне функции DOS 40h
для устройств PRN и LPT1 - LPT4. Это дает возможность без проблем выво-
дить в файл функцией 0 INT 17h, функцией 5 DOS, PrintScreen-ом, коман-
дами Type file>prn, Copy files prn и из различных программ, выводящих
на принтер как в тексте, так и в графике. Программа также нормально со-
существует с программой фоновой печати PRINT.EXE. Отличительной особен-
ностью программы являетсяполное отсутствие буферизации вывода, что дало
возможность оптимизировать программу и в объеме и во времени. Единствен-
ное, что реализовать пока не удалось, это переназначение эхо-вывода кон-
соли на принтер по нажатию Ctrl-P. Надеюсь со временем это доделать.
Программа вызывается без параметров. Объем резидентной части 816 байт.
Функционирует в MS DOS версий от 3.0 и совместимых с ней ОС.
Системный интерфейс программы следующий:

        - открыть файл и переназначить в него принтер
Int 17h AH=0D1 BX=номер принтера (1-40) DS:DX=адрес ASCIIZ-имени файла,
возврат - аналогичен возврату функции DOS 3C;

        - закрыть файл и восстановить исходное состояние вывода
Int 17h AH=0D0 DX=номер принтера;

        - определить наличие программы PRDP.COM резидентно в памяти
Int 17h AH=0D7 DX=номер принтера
Возврат AH=0 если находится, иначе - без изменений.

        Для реализации данного интерфейса в практической работе исполь-
зуется утилита PRDPUT.EXE, работающая только при резидентном наличии в
памяти программы PRDP.COM. Программа PRDPUT.EXE написана на "пассембле-
ре", т.е. паскале с ассамблерными вставками. Вызывается следующим обра-
зом:
PRDPUT  /1=file_1   /2=file_2   /3=file_3   /4=file_4
где /1=file_1 обозначает переназначение LPT1 в file_1 и аналогично для
остальных принтеров. Естественно, все сразу переназначать не обязатель-
но. В командной строке указываютсятолько те принтеры, которые нужно пе-
реназначить. Например, PRDPUT /1=file_1  . Если данный принтер уже пере-
назначен в файл, то этот файл закрывается и открывается указанный в ко-
мандной строке. Чтобы закрыть файл и восстановить вывод на принтер нуж-
но указать номер принтера без имени файла, например PRDPUT /1   .

        Убедительная просьба не стирать файл переназначения до закрытия,
не корректировать его и не переназначать два принтера в один файл. DOS
и BIOS не контролируют этих ситуаций. Учет их в программе увеличил бы ее
в несколько раз. Поэтому чтобы хоть как-нибудь выделить файлы переназна-
чения, они открываются с атрибутами Archive, Hidden и System. После за-
крытия эти атрибуты можно снять и затем обращаться с файлами по усмотре-
нию пользователя.

        Естественно, в процессе работы у программы PRDP.COM могут обна-
различные недостатки. Некоторые из них сразу назову. О Ctrl-P выше уже
говорилось. Программа не работает в многозадачных системах типа Windows.
Не гарантируется также корректность переназначения удаленных сетевых
принтеров ( попробуйте !). Программа также бессильна если вывод на прин-
тер осуществляется через порт, минуя BIOS.
        С благодарностью приму все предложения и замечания.

                        Юрий Аркадьевич Школьников.
                        тел. /044/ 411-41-26 дом.
                             /044/ 225-13-11 раб., модем.
                        e-mail:    yushk@botan.kiev.ua


