		 ┌┐  ┬ ┌┬─┐ ┬ ┬┬──┐       ┌──┬┐    ┌┬──┐ ┌┐
		 ││  │ ││ │ │ ││  │          ││    ││  │ ││
		 ││  │ ││ │ │ │├──┘        ──┤│    ││  │ ││
		 ││  │ ││ │ │ ││             ││ ┌┐ ││  │ ││
		 └┴──┘ └┘ └─┘ └┘          └──┴┘ └┘ └┴──┘ └┘
		────────────────────────────────────────────

			     Ben Castricum

			    April 13, 1993


     This is the documentation belonging to and explaining the use of:

			       UNP V3.01
		 Compressed executable file expander


   TOPICS covered in this document:

	 DISCLAIMER
         PURPOSE OF UNP
	 REQUIREMENTS
	 HOW TO USE UNP
         WHAT UNP CAN HANDLE
	 MESSAGES
	 ERRORLEVEL VALUES
	 STILL LOOKING
	 THANKS
	 CONTACTING ME



DISCLAIMER:
-----------
Although UNP has been tested on several systems, I cannot guarantee that
UNP will be without bugs.  Therefore, I do not take responsibility for
any damage directly or indirectly caused by UNP as a result of known or
unknown errors in it.



PURPOSE OF UNP:
---------------
UNP tries to reverse the action which programs like PKLITE and LZEXE
perform.  In case you don't know, those programs use data compression on
executable files.  Yet they leave these compressed files in a state such
that they can still be normally executed.  This is great if want to save
disk space, but it has its disadvantages.  Anyone can now spread a virus;
just compress an infected file and the virus is invisible!  Debugging
also becomes a lot more difficult since the code has become unreadable.
These are the primary reasons behind my writing UNP.  I could make up
some story about loading/decompressing time, but we are probably talking
about a few 100ths of a second.  Well, at least I don't notice any delay
on my 66Mhz...



REQUIREMENTS:
-------------
To run UNP you need at least a 8086 microprocessor.  However if you want
to take full advantage of UNP, MS-DOS 5.0 (or higher) is recommended
since UNP tries to allocate UMBs.  Lower versions of DOS will work
without much difference since UNP only uses base memory and UMBs.  It
requires about 10k of memory, with the additional amount of memory
required depending on the program being processed.



HOW TO USE UNP:
---------------
To get help type UNP on the command line without parameters or use the
'-?' switch.  The first line of the help screen is a short line
describing how to pass information to UNP.  Let's analyze this step by
step.


usage: UNP command [options] [d:][/path]Infile [[d:][/path]Outfile]


* commands:
e = expand compressed file (default)
   This command expands the compressed file.  Since it is the default
   command, this command will also be executed when no command is
   specified.  It's here to avoid confusion.

c = convert to COM file
   Some .EXE files can be converted to .COM files.  You can do this by
   using this command.  You should only convert a file when you know
   exactly what you are doing.

i = info only
   If you just want to check if a file is compressed you can use this
   command.  UNP only tries to figure out what a file is compressed with.

l = load and save, no decompressing (only for EXE files).
   This command loads an .EXE file but does not expand it.  It will be
   written back just like a decompressed file would be written back.
   This is useful in case you want to remove an overlay or remove
   irrelevant header data.

x = convert to EXE file
   Some compressors can only compress .EXE files (like LZEXE).  With this
   command you can convert a .COM file to an .EXE file.  The resulting
   file will be written back with an .EXE extension by default.


* options:
-? = help (this screen)
   For a list of UNP commands or options use this switch.  Any other
   switch or command used on the same line will be ignored.

-a = automatic retry on decompressed files
   Some files have been compressed more than once.  This switch makes
   UNP try to decompress the file again when if it is still compressed.

-b = make backup .BAK file of original
   If you want to keep a backup of your original file (very wise) use
   this switch.  The original file will be renamed to a file with a .BAK
   extension.

-c = ask for confirmation before decompressing
   This will force UNP to ask you if you want to decompress the file each
   time it has found a new compressed file.

-h = remove irrelevant header data
   Most linkers add useless data to the .EXE header.  This switch
   removes all such useless information, thus shrinking the header size.

-i = do not intercept INT 21h calls
   By default UNP watches the DOS interrupt (21h) to check if the
   program is running as expected.  Any unexpected call to INT 21h
   will make UNP abort the process.  If you have any weird TSRs resident
   you might have to use this switch.  I had to use it while debugging
   with Turbo Debugger.

-o = overwrite output file if it exists
   If you want to have the destination file overwritten, you can avoid
   the question for permission by specifying this switch on the command
   line.

-p = align header data on a page
   It is said that .EXE files with a header size that is a multiple of
   512 bytes load faster (this could make sense since a sector is also
   512 bytes).  This switch will expand the header to the nearest
   multiple of 512 bytes.

-r = remove overlay data
   If something is appended to an .EXE it is called an overlay.  This
   switch will let the file size of the outfile be the same as the load
   image.  So anything that was appended to the file will be thrown away.
   An overlay can be used for all kinds of data, so removing this can
   result in throwing away something useful.

-u = update file time/date to current time/date
   By default UNP sets the time/date of the destination file to the same
   time/date as the original source file.  If you want to have it updated
   to the current time/date use this switch

-v = verbose
   When you use this switch UNP will give you some additional
   information.  I added this switch for debugging purposes.


*[d:][/path]Infile
   If you want to process files you must tell UNP which ones.  This is the
   location to specify them.  Starting with V3.00, UNP can now handle
   wildcards in the filename.  Filenames without an extension will select
   all files with a .COM or .EXE extension.


*[[d:][/path]Outfile]
   The destination file is optional. If you don't specify one, the source
   file will be overwritten.  You cannot use wildcards in this.  Also, you
   should not specify a destination file when you want to decompress more
   than one file.




WHAT UNP CAN HANDLE:
--------------------
Of course you would like to know what programs UNP can currently unpack.

Well, here is a list of decrunch routines that UNP V3.01 is known to unpack:

* routines found in .COM files
COMPACK V4.4
COMPACK V4.5
DIET V1.00
DIET V1.10a
DIET V1.20
ICE V1.00
PKLITE V1.00с
PKLITE V1.03
PKLITE V1.05
PKLITE V1.12
PKLITE V1.13
PKLITE V1.14
PKLITE V1.15
PRO-PACK V2.08, emphasis on packed size
PRO-PACK V2.08, emphasis on packed size, locked
PRO-PACK V2.08, emphasis on unpacking speed
PRO-PACK V2.08, emphasis on unpacking speed, locked
SCRNCH V1.00
SHRINK V1.00


* routines found in .EXE files
COMPACK V4.4
COMPACK V4.5
DIET V1.01
DIET V1.10a or V1.20			; small & large, with & without items
DIET V1.44				; same as above + .COM files
EXEPACK V4.00
EXEPACK V4.05 or V4.06
EXEPACK (DOS5)
EXEPACK patched with EXPAKFIX V1.0
LINK /EXEPACK V3.60 or V3.64
KVETCH V1.02с
LZEXE V0.90
LZEXE V0.91 or V1.00a
PKLITE V1.00с 0,1
PKLITE V1.03  0,1,2,3
PKLITE V1.05  0,1,2
PKLITE V1.12  0,1,2,3
PKLITE V1.13  0,1,2,3
PKLITE V1.14  0,2,3
PKLITE V1.15  0,1,2,3
PKLITE V1.20  1
PKLITE V1.20  1,3
PRO-PACK V2.08, emphasis on packed size
PRO-PACK V2.08, emphasis on packed size, locked
PRO-PACK V2.08, emphasis on unpacking speed
PRO-PACK V2.08, emphasis on unpacking speed, locked
PRO-PACK
TINYPROG V1.0
TINYPROG V3.3
TINYPROG V3.6

Decrunch routines that UNP V3.01 recognizes but cannot (yet) handle:
* routines found in .EXE files
PKLITE V1.00с 2
PGMPAK V0.14

In total there are 19+55=74 routines in 11 different compressors (not
counting different versions) recognized.
There are 2 routines UNP recognizes but cannot unpack.



MESSAGES:
---------
UNP has 5 kinds of messages it can display:

* Questions.  Although I tried to make this program as smart as possible,
  it still can't read minds and things like that.  So sometimes it will
  ask you for something it wants to know.

Add 'pk'/'PK' signature to fake PKLITE decompression (y/n)?
   PKLITE V1.14 and up (according to the documentation) add the 'PK'
   signature with extra compressed files to let the program check if it
   is still compressed with PKLITE.  Answering 'Y' to this question will
   add a piece of code that fakes PKLITE decompression.  It will display
   and use automatically the correct signature ('pk' for V1.20 and others
   'PK').

Decompress this file (y/n)?
   You have specified the -c switch and UNP has found a file it can unpack.
   Now it wants to know if you want to unpack the file it has just found.

File FILENAME.EXT already exists.  Overwrite (y/n)?
   The filename that UNP wants to write the resulting file to already
   exists.  If you haven't specified the -o switch it will ask if it can
   overwrite it.  Answering 'N' will proceed to the next file.

Program is protected, please enter password:
   This question will appear when you are trying to decompress a program
   which is compressed with TINYPROG with the password option.  You are
   asked to type the password used.  This is not to verify whether you are
   the rightful owner or not, but I just couldn't find a way around it.


* INFO messages, these messages are only displayed when you have specified
   the -V switch.  I've added them for debugging purposes.

INFO - command line = " ... "
   This message shows how UNP has interpreted the things you typed on the
   command line.  Great for debugging purposes!

INFO - First 64K of base memory has been fully allocated.
   Some compressors use the segment below their own code.  Since it is
   possible to load the operating system in upper/high memory there
   might not be a complete segment available.  This message tells you
   there has been memory allocated to ensure there is a complete segment
   below.  Note that this is the same thing that the program LOADFIX.COM
   supplied with MS-DOS 5 does.

INFO - Program loaded at XXXXh, largest free memory block: X bytes.
   Pretty obvious.  The address where UNP is loaded is displayed along with
   the largest block it can allocate.

INFO - Using FILENAME.EXT as temp file.
   UNP tells you what it will be using as temporary file.  This name is
   composed of the TEMP variable and the default temporary name.

INFO - Wildcard matches X filename(s), stored at XXXXh.
   This tells you how many filenames UNP has found that match the
   wildcard and where it has stored the names found.


* WARNING messages.  UNP sometimes takes actions the user should be
   notified of.  In those cases a warning message is displayed.

WARNING - File already has .BAK extension, no backup created.
   UNP has just unpacked a .BAK file and you have specified the -B switch.
   Creating a .BAK file of a file which already has a .BAK extension is
   impossible so the source file will be overwritten and there will be
   no backup created.

WARNING - File is immunized with Central Point Anti-Virus.
   Central Point Anti-Virus offers the user a protection scheme against
   viruses.  This protection appends a piece of code to the file which
   checks the program for certain things.  When UNP detects a immunized file
   it will jump around the check and continue.  Note that decompression also
   means that this anti-virus routine will be removed.

WARNING - Infile and Outfile are same, Outfile ignored.
   You have specified the file twice on the command line, meaning that the
   destination file is the same as the source file.  Since this is the
   default situation the second name is ignored.

WARNING - Invalid or missing stored header information.
   Normally the compressor used on the program you are trying to
   decompress stores a part of the original header.  UNP has compared
   this information with the data it thinks it should be and has come to
   the conclusion that these mismatch.  If this happens the default UNP
   header will be used.

WARNING - Missing last byte, unable to completely restore file.
   The SHRINK compressor does not correctly compresses files containing
   all 256 characters.  When this has happened the last byte of the
   program is thrown away.  It's not possible to get that byte
   back so the decompressed file is mismatching in 1 or more bytes at
   the end with the original file.

WARNING - Outfile specified, -B option ignored.
   You have specified a destination file and the -B switch.  Because I
   see no sense in this, the -B option will then be ignored.


* ERROR messages.  In some cases the desired action cannot be performed
  or has failed.  These messages tell you why this is so and what has
  happened.  UNP will continue with the next file.

ERROR - Cannot handle this decompression routine.
   UNP has recognized the way your program has been compressed but is not
   (yet) able to decompress it.

ERROR - File already is a .COM file.
   You are trying to convert a .COM file to a .COM file.

ERROR - File already is an .EXE file.
   You are trying to convert a .EXE file to a .EXE file.

ERROR - File contains overlay.
   One thing you can't have with .COM files is overlays.  If you want to
   convert anyway first remove the overlay.

ERROR - File has invalid entrypoint (CS:IP <> FFF0h:0100h)
   To have a converted .EXE file start at the right place in the programs
   initial CS:IP should point to FFF0:0100h.  If this is not true you get
   this error message.

ERROR - File has relocation items.
   You tried to convert an .EXE file with relocation items to a .COM file.
   A .COM file cannot handle relocation items.

ERROR - File is too large for .COM file.
   The maximum size for a .COM file is much shorter than the one for an .EXE
   file.  So it can happen that the .EXE file is too large to be converted
   to a .COM file.

ERROR - Unexpected call to INT 21h, decompression failed.
   When decompressing, UNP passes control to the program.  When it does
   not get control back it is very likely that an interrupt 21h will take
   place sooner or later (INT 21h is the most important interrupt).
   UNP checks for unexpected calls to this interrupt to ensure it's still
   in control.  To disable this checking use the -i switch.


* FATAL ERROR messages.  When one of those messages appear something is
  really wrong and UNP cannot continue its work.  It will quit and
  probably have an exitcode for the situation occurred.

FATAL ERROR - Decompressing many files into one.
   You have specified a destination file, but there is more than one
   source file.

FATAL ERROR - Divide overflow (INT 00h) generated by CPU.
   This means that an invalid DIV instruction has been executed.  Normally
   this will cause DOS to terminate the program.  UNP hooks this so it can
   set the interrupt's pointers back before the program quits.

FATAL ERROR - No files found matching FILENAME.EXT
   UNP could not find any files to decompress.

FATAL ERROR - Not enough memory ...
   UNP tried to allocated some memory but it got an error back.  This
   message tells you what it needed the memory for.

FATAL ERROR - Output path/file must not contain '*' or '?'.
   You have used wildcards in the destination file.  This is not allowed.

FATAL ERROR - User abort, ^C/^Break pressed (INT 23h).
   Interrupt 23h is called when DOS detects that Ctrl-C or Ctrl-Break is
   pressed.  UNP hooks this to be able to restore the interrupts it uses.



ERRORLEVEL VALUES:
------------------
  0  no error occurred
  1  help text is displayed
  2  no files found to process
  3  decompressing many files into 1 /  Outfile contains wildcards
  4  some I/O error occurred
  5  could not allocate enough memory
  6  CPU generated divide overflow
  7  user pressed ^C or ^Break



STILL LOOKING:
--------------
I am still trying to improve my program.  If you'd like to help me with
that and have a compressor which is not listed below, please mail me the
compressor.  If you cannot mail it to me for some reason (I can imagine
this for registered versions) then contact me anyway.  Maybe we can work
something out.

  Compressor I own a copy of or have access to:
COMPACK V4.4
COMPACK V4.5
CRUNCHER V1.0
DIET V1.10a
DIET V1.20
DIET V1.44
EXEPACK V4.00
EXEPACK V4.05
EXEPACK V4.06
ICE V1.00
KVETCH V1.02с
LINK V3.60
LINK V3.64
LZEXE V0.90
LZEXE V0.91
LZEXE V1.00a
PGMPAK V0.14
PKLITE V1.00с
PKLITE V1.03
PKLITE V1.05
PKLITE V1.12
PKLITE V1.12 Professional
PKLITE V1.13
PKLITE V1.14
PKLITE V1.15
PKLITE V1.15 Professional
PRO-PACK V2.08
SCRNCH V1.00
SHRINK V1.00
TINYPROG V1.0
TINYPROG V3.3
TINYPROG V3.6

I also have a copy of SYSPACK V0.1 and SLIM V1.10 but these programs do not
really fit into UNP.  I'm considering handling .SYS files too though.  But
don't count on it.



LATEST VERSION:
---------------
People have asked me how I make my programs available to the public.
Well, the first widespread version is V2.13 which I uploaded to Simtel
(a large Internet repository containing many MS-DOS files).  A previous UNP
version can be found on ftp.informatik.uni-hamburg.de.  I am unsure how
files are handled on Simtel but it seems that a file uploaded there is
made available on WSMR-SIMTEL20.Army.Mil and OAK.Oakland.Edu
automatically.  There are several additional anonymous FTP sites that
mirror Simtel including wuarchive.wustl.edu.

Since I don't have FTP access I don't know how to get it through FTP :(



THANKS:
-------
Although I did all the programming, many people have helped me improve
this program.  So thanks go to (in alphabetical order):

Vesselin Vladimirov Bontchev, Kemal Djakman, Zago Franck, Tjalve Godager,
Kai-Uwe Herbing, Hamish Hubbard, Yaron Keren, David Kirschbaum,
Michael D. Lawler, Onno van der Linden, Inbar Raz, Martin Saxer

And many others, including all those people who noticed the infamous LZEXE
bug in V2.13.



CONTACTING ME:
--------------
If you want to contact me, my address and E-mail address can be found
below this text.  I might not have access to E-mail after, let's say, May
1993.  After that I will probably be working as a trainee somewhere and
don't know if I will have the time to go to the school on a regular
basis. However, after my trainee period ends (August 1994) I should have
full access again for at least a year!

It's always nice to receive mail telling me that UNP is appreciated, but
if you want to express your gratitude in material things a donation is
very welcome.  Since I do not want to cripple my program I try to offer
people who have donated something such as better user support; the more
money, the nicer I am $-).
If you really want to support UNP then send $5 or more (no checks
please, they'll probably cost me more to cash/convert than they are worth)
to:

My address:                       E-Mail (see above):
  Ben Castricum                     benc@solist.htsa.aha.nl
  Van Loenenlaan 10
  1945 TX  Beverwijk
  The Netherlands



*** end of UNP V3.01 documentation ***
