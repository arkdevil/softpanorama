.toc
.com VPK drivers V3.13 Feb 1993

.ttl
VPK (c) Software

Комплекc программ для поддержки экрана и клавиатуры

Краткое руководство

V3.13
Февраль 1993
.hdr
Общие сведения
.lin 0
Состав:
.and
Драйвер клавиатуры VPKkbd;
.and
Драйвер шрифтов (экрана) VPKbfd;
.and
Загрузчик шрифтов VPKbfl;
.and
Средство для ввода специальных и графических символов VPKsci;
.and
Преобразователь перемещений "мыши" в коды клавиш VPKmkd;
.and
Шрифты *.BFN;
.and
Программа просмотра и редактирования битовых шрифтов BFE;
.and
Программа преобразования битовых шрифтов в ассемблерный текст BFN2ASM;
.and
Раскладки клавиатуры *.KBL;
.and
Описатели раскладок клавиатуры *.KBD;
.and
Транслятор описателей раскладок KBT.




.hdr +1
Драйвер клавиатуры VPKkbd
.lin 0
Используется для переключения в режим перекодировки кодов клавиатуры
в соответствии с национальным алфавитом.
.bln
Командная строка:
.swt
	>VPKkbd_S [File[.KBL]] [/sw]
 или
	>VPKkbd_F [File[.KBL]] [/sw]
.bln
VPKkbd_F является расширенной версией VPKkbd_S, добавлена возможность
вывода текстового индикатора режима в системах, в которых отсутствует
индикация режима с помощью бордюра (например, с монохромным
адаптером).
.dfn File
имя файла, содержащего описатель раскладки клавиатуры; если не указан,
используется внутренняя раскладка драйвера. Обычно раскладка влияет
только на интерпретацию символов цифровой клавиатуры. По умолчанию тип файла
".KBL", при поиске файла используется маршрут ("path"), по которому находится
драйвер VPKkbd_x.COM.

.bln
Ключи:
.dfn /N
сброс состояния клавиши NumLock и гашение соответствующего индикатора
на клавиатуре.
.dfn /B=n
установка цвета границы экрана ("бордюра") для индикации
режима национального алфавита (RUS), n = 0 - 15; при /B=0
индикация с помощью "бордюра" не используется.
.dfn /S
разрешает "звуковое сопровождение" нажатий клавиш в национальном
и альтернативном режиме,
ключ действует только при первой загрузке драйвера в память, так как
при отсутствии ключа соответствующая часть кодов не загружается (порядка 32
байт); "/-S" отключает звук.
.dfn /G
разрешает возможность ввода псевдографических символов с алфавитной
клавиатуры в режиме <Scroll Lock>, возврат в нормальный режим осуществляется
по повторному нажатию <Scroll Lock>.
Ключ действует только при первой загрузке драйвера в память, так как
при отсутствии ключа соответствующая часть кодов не загружается (порядка 96
байт). Соответствие алфавитных клавиш и вводимых при их нажатии
псевдографических символов приведено ниже (можно поменять в файле описания
раскладки):
.swt
                                         Shift
	 -------------------       -------------------
	 q w e r t y u i o p       q w e r t y u i o p
	 ╔ ╦ ╗ ╒ ╤ ╕ ═ █ ▀ █       ┌ ┬ ┐ ╓ ╥ ╖ ─ ░ ▒ ▓
 
	  a s d f g h j k l         a s d f g h j k l
	  ╠ ╬ ╣ ╞ ╪ ╡ ║ ▌ ▐         ├ ┼ ┤ ╟ ╫ ╢ │   ∙ 
 
	   z x c v b n m             z x c v b n m
	   ╚ ╩ ╝ ╘ ╧ ╛ ▄             └ ┴ ┘ ╙ ╨ ╜ °
 
.dfn /K=n
задает клавишу, используемую для переключения режимов RUS/LAT:
.df2 /K=1
правая клавиша SHIFT,
.df2 /K=2
левая клавиша SHIFT,
.df2 /K=4
правая клавиша CTRL,
.df2 /K=5
левая клавиша CTRL,
.df2 /K=8
правая клавиша ALT,
.df2 /K=9
левая клавиша ALT.
.dfn /Q
запрещает вывод идентифицирующего сообщения (с флагом), остальной
вывод можно переназначать (например, >NUL).
.dfn /R=n
задает интервал восстановления индикатора RUS (бордюр или текст)
в 1/18.2 сек., по умолчанию 18 (1 сек.); если /R=0, то восстановления
индикатора (при смене видеорежима) не происходит.
.dfn /T
разрешает использование текстового идикатора режима национального алфавита
(RUS), этот индикатор автоматически устанавливается для монохромных текстовых
режимов дисплея; "/-T" запрещает текстовый индикатор (для версии VPKkbd_F).
.dfn /X=n/Y=n
устанавливает новые координаты для текстового индикатора режима RUS
(по умолчанию X=0, Y=0) (для версии VPKkbd_F).
.dfn /U
выгружает драйвер из памяти, если обрабатываемые в нем прерывания
(09h и 1Ch) не перехвачены другими резидентными программами.
.bln
Примеры:
.swt
	AutoExec.BAT
	------------
		lh \DRIVERS\VPKkbd_S EXCIMER /N/S/G

	MTE.BAT
	-------
		rem поменять раскладку для замены
		rem русских "СсНУрР" на латинские
		rem "CcHYpP"
		C:\DRIVERS\VPKkbd_S EXC_BBS /S/G
		MTE
		rem восстановить раскладку
		C:\DRIVERS\VPKkbd_S EXC_EXCIMER /S/G
.bln
Размер занимаемой памяти для версии VPKkbd_S (в скобках для VPKkbd_F):
.and
при запуске с ключами /G/S 928 (1120) байт;
.and
при запуске с ключем /G 896 (1072) байт;
.and
при запуске с ключем /S 816 (992) байт;
.and
при запуске без ключей /G и /S 768 (960) байт.
.hdr
Драйвер шрифтов (экрана) VPKbfd
.lin 0
Драйвер экрана VPKbfd служит для замены шрифтов, зашитых в ПЗУ
видео-BIOS, на загружаемые в ОЗУ шрифты с национальным алфавитом.
Используемые шрифты должны после запуска драйвера загружаться (и перегружаться)
с помощью загрузчика шрифтов VPKbfl. Драйвер экрана поддерживает
загружаемые шрифты размером 8x8, 8x14, 8x16 и 8x19. В отличие от
большинства известных драйверов данный драйвер может использовать 
одновременно до 2-х шрифтов каждого размера на EGA/VGA
(вторым шрифтом выводятся символы повышенной яркости). Это позволяет
осуществить полную русификацию шрифтов для компьютеров типа
LapTop/NoteBook, в которых используются дополнительные "жирные" (BOLD) шрифты.
Отличительной чертой драйвера является также поддержка шрифтов,
загруженных в область HMA при наличии DOS V5 и драйвера HIMEM
или в UMB при использовании QRAM/286, LastByte, EMM386, QEMM (см. VPKbfl).
.lin
В командной строке для VPKbfd можно использовать ключи:
.dfn /Q
запрещает вывод идентифицирующего сообщения (с флагом), остальной
вывод можно переназначать (например, >NUL).
.dfn /U
производится выгрузка из памяти установленных шрифтов и, при условии,
что вектор 10h не перехвачен, самого драйвера.
.att
Шрифты, установленные в HMA, не могут быть выгружены.
.hdr
Загрузчик шрифтов VPKbfl
.lin 0
Загрузчик шрифтов предназначен для установки основных и дополнительных
(BOLD) шрифтов в памяти при наличии резидентного драйвера
шрифтов VPKbf, а также первой загрузки шрифтов в знакогенератор
адаптеров EGA/VGA. Кроме того, VPKbfl позволяет загружать шрифты
в знакогенератор и при отсутствии драйвера шрифтов, но эти шрифты
будут текущими только до следующей установки видеорежима.
.bln
Поддерживаемые размеры шрифтов: 8x8, 8x14, 8x16, 8x19. Шрифты
должны быть в формате BFN, т.е. иметь специальный заголовок
(см. раздел "Шрифты *.BFN").
.bln
Командная строка:
.swt
	>VPKbfl [drive:][path]font_file[.BFN] [/sw]
.bln
/sw     - ключи:
.dfn /B
устанавливает шрифт для использования драйвером VPKbfd в режиме BOLD,
т.е. этим шрифтом будут выводиться символы повышенной интенсивности;
такая возможность полезна на компьютерах с монохромным дисплеем и
адаптером EGA/VGA (например, классов LapTop или NoteBook).
.dfn /L=n
загружает указанный шрифт в знакогенератор EGA/VGA в блок #n,
но не устанавливает его резидентным в памяти, т.е. этот
шрифт просуществует до первой установки видеорежима; такая возможность
позволяет вообще не использовать драйвер шрифтов VPKbfd и не занимать
память под резидентный шрифт, если компьютер используется
только в текстовом режиме.
.dfn /E=n
матрицы символов указанного шрифта перед загрузкой расширяются до
высоты n (таким образом, можно использовать шрифт 8x14 в режиме
с матрицей 8x16 и т.п.).
.dfn /X
в DOS V5+ на компьютерах с процессором 286 и старше при наличии драйвера XMS
(HIMEM.SYS) и загрузке части DOS в HMA (DOS=HIGH в CONFIG.SYS) делается
попытка загрузить шрифт в HMA (размер свободной области HMA зависит
от значения параметра BUFFERS= в CONFIG.SYS). Примечание: не все
программы "спокойно" переносят расположение шрифтов в HMA (в частности,
игра "CATS").
.dfn /U
на компьютерах с процессором 286 и старше при наличии драйвера QRAM/QEMM
или EMM386 делается попытка загрузить шрифт в UMB.
.dfn /S
на компьютерах с отображением BIOS в "теневое" ОЗУ
("shadow" RAM) при возможности записи (!) в эту область
шрифт загружается на место соответствующего по размеру
"прошитого" шрифта; при этом драйвер шрифтов VPKbfd становится
не нужным (русификация BIOS при загрузке). Если уже используется
соответствующий шрифт, установленный в ОЗУ (например, с помощью
другого драйвера экрана), то по ключу /S происходит его замена.
.dfn /Q
запрещает вывод идентифицирующего сообщения (с флагом), остальной
вывод можно переназначать (например, >NUL).

.hdr
Средство для ввода специальных и графических символов VPKsci
.lin 0
Задача VPKsci после установки ее резидентной при активизации ее
по "горячей" клавише позволяет вводить в буфер клавиатуры
коды специальных и графических символов, выбранных из набора,
выведенного на экран. Выбор может производиться как с помощью
клавиш управления курсором, так и с помощью "мыши". Выбранные
символы заносятся во внутренний буфер задачи (до 15 символов),
что позволяет удалять последние введенные коды. Коды нажимаемых клавиш
на алфавитно-цифровой клавиатуре также заносятся во внутренний
буфер. После нажатия завершающей клавиши <Insert>
или указания левой кнопкой "мыши" на "Ins"
коды из внутреннего буфера переносятся в буфер клавиатуры и появляются
в том месте экрана, в котором вы находились до активизации задачи VPKsci.
.bln
Командная строка:
.swt
	>VPKsci [ /sw ] [ >nul ]
.bln
Ключи:
.dfn /C=n
установить для панели набор цветов #n (0-7);
.dfn /Q
запрещает вывод идентифицирующего сообщения (с флагом), остальной
вывод можно переназначать (например, >NUL);
.dfn /U
выгрузить задачу из памяти.
.bln
Для активизации задачи используется комбинация <RightShift + Enter>.
.bln
После активизации панели Вы можете использовать клавиши
.swt
	<--, -->, Up, Down
.bln
для выбора символа, который необходимо вставить в текст. Выбрать символ можно,
указав на него "мышью" и нажав левую кнопку. После выбора символа вы можете
занести его во внутренный буфер, нажав <Enter> или повторно нажав левую
кнопку "мыши". Удалить последний введенный символ из буфера можно
с помощью клавиши <BackSpace> ( <-- ) или указав мышью на "Del".
Содержимое внутреннего буфера отображается в нижней части панели.
Нажатие <Esc> или указание мышью на [■] в правом верхнем углу панели
приводит к выходу без занесения кодов в буфер.
.bln
С помощью клавиш <PageDown>, <PageUp> или указанием мыши на стрелку на левой
границе панели можно перемещать панель в нижнюю или верхнюю части экрана.


.hdr
Преобразователь перемещений "мыши" в коды клавиш VPKmkd
.lin 0
Программа VPKmkd является резидентным транслятором перемещений
"мыши" в коды клавиш управления курсором ("Вверх", "Вниз",
"Вправо", "Влево") и нажатий кнопок "мыши" (левой, правой
и средней, если присутствует) в коды клавиш "Enter", "Esc"
и "BackSpace" соответственно. Таким образом, Вы можете использовать
эти функции "мыши" при работе с программами, "мышь" не поддерживающими
(редакторами, электронным справочником HELP.EXE для *.H!-файлов и т.п.).
.lin
Программа VPKmkd должна быть загружена перед задачей,
в которой необходима поддержка описанных выше функций "мыши".
Если Вы вызываете задачу из оболочки, работающей с "мышью"
(например, из Norton Commander), то необходимо создать командный файл
в виде:
.swt
	VPKmkd.COM
	имя_запускаемой_задачи
.bln
и запускать его. При этом VPKmkd определяет присутствие в памяти
своей копии и производит инициализацию "мыши" без повторной загрузки
в память резидентной части.
.bln
Командная строка:
.swt
	>VPKmkd [/sw]
.bln
Ключи:
.dfn /Q
запрещает вывод идентифицирующего сообщения (с флагом), остальной
вывод можно переназначать (например, >NUL).
.dfn /U
выгружает VPKmkd из памяти.
.bln
Пример:
.swt
 Командый файл HLPM.BAT:

	VPKmkd >nul
	HELP
 Вызов:
	>HLPM
.lin
Размер резидентной части программы VPKmkd менее 400 байт.

.hdr
Дополнительные средства
.lin 0
.hdr +1
Шрифты *.BFN
.lin 0
Шрифты, представленные в комплекте, брались из разных источников,
и отличаются от них только форматом заголовка. Шрифты L8xNNt.BFN
не руссифицированы, шрифты R8xNNt.BFN руссифицированы.
Шрифты NU8xNN - из NU V6; шрифт A8x14 - в кодировке КОИ-8 (может пригодиться
при работе с удаленными ЭВМ с ОС UNIX, VMS, RSX);
шрифт R16_866 - кодировка 866 кодовой таблицы (можно использовать при просмотре
файлов, подготовленных в среде Windows 3.1 с руссифкаторами ParaGraph,
Steepler. Раскладка клавиатуры для таблицы 866 см. файл EX_866.KBL).
.hdr +1
Формат шрифтов
.lin 0
Шрифты в формате BFN представляют собой набор битовых масок символов
шириной 8 бит (1 байт), которому предшествует заголовок размером
16 байт. Структура заголовка следующая:
.dfn 8 байт
сигнатура для определения формата шрифта, содержит строку "VPK BFN ".
.dfn 1 байт
тип шрифта (0 - битовый шрифт).
.dfn 1 байт
ширина символьной ячейки (8).
.dfn 1 байт
блок знакогенератора для загрузки (0-7), игнорируется.
.dfn 1 байт
высота символов (8, 14, 16, 19).
.dfn 1 байт
код первого символа в шрифте (0).
.dfn 1 байт
код последнего символа в шрифте (255).
.dfn 1 байт
число символов в шрифте минус 1 (255 = код последнего - код первого).
.dfn 1 байт
резерв.
.hdr
Программа просмотра и редактирования битовых шрифтов BFE
.lin 0
Программа позволяет просмотреть как текущий (загруженный) шрифт,
так и шрифты из файлов *.BFN, и, при необходимости, отредактировать
шрифт. Кроме того, используя ключи /CH=n и /OFF=xxxx (см. BFE.HLP),
можно просматривать шрифты в произвольных файлах и сохранять их в формате
BFN.
.bln
Если файл шрифта не указан в командной строке, то выводится текущий
шрифт из знакогенератора.
.bln
Запуск программы:
.swt
	>BFE [имя_шрифта] [имя_выходного_шрифта]
.bln
Программа может быть добавлена к списку вьюеров NC.
Функции редактирования кратко описаны в файле BFE.HLP.
.hdr
Программа преобразования битовых шрифтов в ассемблерный текст BFN2ASM
.lin 0
Программа преобразует файл в формате BFN в ассемблерный модуль
*.ASM и 2 включаемых файла с младшей и старшей половинами шрифта;
описатели масок символов во включаемых файлах представлены в двоичном
виде в текстовой форме, что позволяет отредактировать маски любым
текстовым редактором,
оттранслировать файл *.ASM с помощью MASM (V6.00), построить EXE-модуль
с помощью компоновщика LINK и преобразовать в файл BFN задачей EXE2BIN:
.swt
	>ML /c file.ASM
	>LINK file.OBJ;
	>EXE2BIN file.EXE file.BFN
.bln
При трансляции используется файл макроопределений для заголовка
шрифта BFN_HDR.INC.
.lin
Кроме того, вы можете использовать ассемблерные модули для
вставки в ваши программы необходимых шрифтов.
.hdr -2
Раскладки клавиатуры *.KBL
.lin 0
Раскладки клавиатуры *.KBL представляют собой двоичные файлы,
загружаемые драйвером VPKkbd. С помощью этих файлов устанавливается
соответствие между клавишами клавиатуры
и возвращаемыми драйвером VPKkbd кодами для всех режимов клавиатуры.
.bln
Для изменения раскладки вы можете отредактировать файл *.KBL
любым двоичным редактором или отредактировать текстовый описатель
раскладки *.KBD, который затем необходимо оттранслировать и преобразовать
в двоичный файл *.KBL.
.bln
Обычно требуются изменения только для символов верхнего ряда клавиатуры
в режимах RUS и SHIFT_RUS.
.hdr +1
Описатели раскладок клавиатуры *.KBD
.lin 0
Описатели раскладок клавиатуры *.KBD представляют из себя символьный файлы,
в которых описывается соответствие между клавишами клавиатуры
и возвращаемыми драйвером VPKkbd кодами для всех режимов клавиатуры.
Файлы должны быть оформлены
в соответствии с требованиями транслятора MASM. Вы можете использовать
для трансляции задачу KBT, но при этом учесть, что KBT считает символ
";" началом комментария в любом случае, т.е. при необходимости его
заменяют кодом 59 (3Bh).
.hdr
Транслятор описателей раскладок KBT
.lin 0
С помощью задачи KBT можно оттранслировать описатель раскладки клавиатуры
*.KBD и получить загружаемый драйвером VPKkbd файл раскладки *.KBL.
.att
Задача KBT была разработана для трансляции более сложных структур
(со ссылками вперед), поэтому делает 2 прохода.
.bln
Тот же результат можно получить следующим образом:
.swt
	>ML /c /Fa:file.KBD
	>LINK file.OBJ;
	>EXE2BIN file.EXE file.KBL
.ski 3
.rit VPK Software (c) 1992-1993
.rit 249020, Обнинск Калужской обл., Россия.
.rit ул.Энгельса, 7-12
.rit р.т.(084-39)2-80-20
.lev 0
