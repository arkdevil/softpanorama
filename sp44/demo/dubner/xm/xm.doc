Функции слежения за правильностью работы с динамической памятью
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

      Описываемые здесь функции составляют модуль xm, который осущест-
вляет контроль за правильностью работы с динамической памятью -  памя-
тью, запрашиваемой у системы во время работы программы.

1. Область применения модуля

      Стандартная библиотека языка С содержит четыре функции, позволя-
ющие управлять динамической памятью: malloc, calloc, realloc и free.

      С использованием этих функций связаны многие ошибки в программах
на С, которые вызваны присвоением неверных значений пойнтерам и  рабо-
той вне памяти, выделенной  программе. В защищенных окружениях,  таких
как Unix или OS/2, это приводит к ошибке, называемой нарушением сегме-
нтации <segmentation violation>, и довольно легко отлавливается с  по-
мощью отладчика. Однако, в  слабо незащищенных окружениях, таких,  как
MS-DOS, ошибка адресации обходится дорого: минимум происходящего - си-
стема виснет; однажды я наблюдал, как ошибка привела к разрушению всей
файловой системы!

      Поскольку в большинстве  реализаций С нет  возможности проверять
правильность обращения к функциям malloc и calloc, в каждом конкретном
случае приходится изобретать  соответствующие средства отладки.  Здесь
описан модуль управления динамической памятью, который назван Xm. Этот
модуль отслеживает значения всех указателей на динамически размещаемую
память и помогает отлавливать следующие ошибки:

      1. Запись за пределы выделенного блока памяти.
         Типичный пример - вызов функции strcpy для строки с пропущен-
ным нулем в конце.
      2. Освобождение незапрошенной памяти.
      3. Освобождение уже однажды освобожденной памяти.
         В сложных структурах данных, таких, например, как  инвертиро-
ванные списки, часто приходится заводить ссылки "внутрь". Ошибка  воз-
никает при неаккуратной работе с такими структурами.
      4. Использование освобожденной памяти.

      Довольно далекий прототип  предлагаемого модуля описан  в статье
Extended Dynamic  Memory Control  Module, опубликованной  в Dr. Dobb's
Journal, #154 August 1989.

2. Обзор предлагаемых средств

      Предлагается пользоваться в разрабатываемых программах функциями
x_malloc, x_calloc и x_free, определенными в модуле Xm, вместо malloc,
calloc и free соответственно. Для включения проверок нужно  компилиро-
вать свои программы, употребив строку #define XM_USED перед включением
файла XM.H. Достаточно убрать  эту строку, чтобы x_malloc,  x_calloc и
x_free стали вызовами библиотечных функций malloc, calloc и free соот-
ветственно.  Поэтому  по  окончании  отладки  нужно лишь убрать строку
#define XM_USED и перекомпилировать программу. Если же эта строка при-
сутствует, то упомянутые функции являются соответственно вызовами фун-
кций xm_Xcalloc, xm_Xmalloc и xm_Xfree.

      Когда  проверка  включена,   с  помощью  глобальной   переменной
xm_Trace типа  int можно  задать используемую  степень отслеживания за
использованием динамической памяти. Если xm_Trace = 0, то почти  ника-
кая  проверка  не  производится  -  в  этом  случае функции xm_malloc,
xm_calloc и  xm_free просто  вызывают соответственно  malloc, calloc и
free, так что проверяется лишь освобождение с указателем, равным NULL.
Если xm_Trace равняется 1,  то производится отслеживание указателей  и
проверка ошибок типов 1, 2 и 3. Если же xm_Trace равняется 2, то допо-
лнительно производится контроль за использованием ранее  освобожденных
участков памяти - ошибка типа 4.

      В модуле Xm определены две глобальные переменные, которыми могут
пользоваться прикладные  программы, когда  значение xm_Trace  не равно
нулю. Переменная xm_userMemory содержит текущее количество  выделенной
пользователю динамической  памяти, переменная  xm_userAlloc -  текущее
количество  участков  хипа,  выделенных  пользователю. Любопытно также
значение переменной xm_totalMemory, в которой содержится суммарное ко-
личество  динамической  памяти,  запрошенной  модулем  у системы (т.е.
xm_totalMemory = xm_userMemory + память, нужная модулю для организации
отслеживания). Наконец, переменная xm_totalAlloc содержит текущее чис-
ло обращений к функциям x_malloc и x_calloc от момента начала  работы.
Это значение устанавливается в нуль в функции xm_XfreeMem. Кроме того,
оно может быть уменьшено в  функции xm_Xrelease (см. ниже). Все  пере-
менные - типа long int.

      Если xm_Trace не равняется нулю, то пользователь может  восполь-
зоваться также:
      - функцией xm_XcheckMem,  которая проверяет все  неосвобожденные
блоки памяти; уровень проверки соответствует xm_Trace == 2;  пользова-
тельским именем этой функции является x_checkMem, так что если она ис-
пользуется без директивы #define XM_USED, то компилятор предупредит  о
вызове функции с отсутствующим прототипом, а если программист отключит
соответствующие предупреждения, то  на ошибку укажет  линкер, который,
скорее всего, не найдет функцию с именем x_checkMem;

      -  функцией  xm_XfreeMem,  которая  действует  так  же,  как   и
xm_XcheckMem, но дополнительно освобождает все неосвобожденное;  поль-
зовательским именем этой функции является x_freeMem, так что если  она
используется без директивы #define XM_USED, то компилятор  предупредит
о вызове функции с отсутствующим прототипом, а если программист отклю-
чит соответствующие предупреждения, то на ошибку укажет линкер,  кото-
рый, скорее всего, не найдет функцию с именем x_freeMem;
      - парой функций с пользовательскими именами x_mark и  x_release:
вызов x_release приводит к освобождению всего запрошенного после вызо-
ва x_mark; если  такого вызова не  было, вызов x_release  эквивалентен
вызову  x_freeMem;  внутренним   именем  функции  x_release   является
xm_Xrelease, функция же x_mark  реализована как макрос, так  что можно
еще раз повторить только что сказанное о предыдущих функциях.

      По умолчанию все сообщения модуль выводит на устройство  stderr.
Имеется  возможность  установить  собственный  обработчик сообщений об
ошибках. Его прототип должен иметь вид

                void (*OwnWarns)(int warn_code, void *ptr);

здесь первый параметр является кодом сообщения (его текст доступен че-
рез массив xm_wngText), а второй - тем указателем, который вызвал соо-
бщение. Предусмотрен макрос  xm_setOwnWrn, используемый для  установки
собственного обработчика: единственный  его параметр должен  содержать
имя функции-обработчика.


3. Устройство модуля

      Модуль Xm поддерживает таблицу указателей на выделенную  память.
Когда происходит обращение к функции xm_malloc, выделяется чуть больше
памяти и конец выделенного блока используется для контроля. Это прост-
ранство заполняется  некоторым кодом  (FILLCHAR) и  проверяется, когда
блок освобождается. Таким образом проверяется наличие ошибки 1. Размер
выделенного блока и его адрес запоминаются в таблице.

      Таблица, отслеживающая выделение памяти, упрощает поиск указате-
лей с неверными значениями. Когда вызывается функция xm_free, произво-
дится поиск соответствующего указателя в таблице. Если он присутствует
в таблице, блок  освобождается и соответствующая  запись вычеркивается
из таблицы. Отсутствие указателя в таблице означает либо его  неверное
значение, либо то, что  соответствующий блок уже был  освобожден ранее
(ошибки 2 и 3).

      Если xm_Trace равняется 2, то производится проверка изменений  в
освобожденном блоке (ошибка 4). Вместо того, чтобы на самом деле осво-
бодить блок, xm_free проверяет,  вычислялась ли контрольная сумма  для
него: если она уже вычислялась, мы знаем, что блок уже был освобожден,
т.е. допущена ошибка 3. В этом случае контрольная сумма блока вычисля-
ется еще раз, после мы сравниваем вновь вычисленную контрольную  сумму
с результатом, полученным при освобождении блока: если они не совпада-
ют, была допущена ошибка 4. Подчеркнем, что когда xm_Trace = 2, память
не освобождается. Однако, и ошибки, которые при этом могут быть  обна-
ружены, наиболее сложны. Заметим, что для того чтобы установить  нали-
чие изменений в блоке, достаточно хранить его контрольную сумму. Одна-
ко, при этом  невозможно установить, что  именно изменено. Если  же мы
точно знаем  положение измененного  места, то  можем и  найти ту часть
программы,  которая  его  меняет.  Для  того же, чтобы определить, что
именно изменено, НЕдостаточно хранить его контрольную сумму -  необхо-
димо иметь копию блока. Пользователю предоставляется возможность ввес-
ти соответствующее изменение в предлагаемые ему коды - расходуя больше
памяти, он получит возможность отлавливать совсем тонкие ошибки!

      При работе с таблицей для отслеживания размещенной памяти  испо-
льзуется хеширование, причем ключом является значение указателя, пере-
веденное к формату long  int. Хеширование было выбрано  из-за скорости
доступа к нужному блоку памяти, что становится решающим в приложениях,
в которых работа с памятью особенно активна.

      Хеширующая таблица состоит из массива указателей на "емкости". В
букете содержится  информация об  указателе и  выделенной памяти. Поле
alloc в struct bucket -  это динамический массив, состоящий из  struct
alloc_entry; ограничение сверху на количество элементов этого  массива
задается переменной bucketsize. Каждый элемент массива содержит размер
выделенного блока и его адрес, также адрес копии этого блока, если  он
освобождается. Размер хеширующей таблицы содержится в глобальной пере-
менной hashsize типа int. Это значение должно быть нечетным  (предпоч-
тительно простым), иначе букеты с нечетными номерами не будут  исполь-
зоваться.

      Каждый указатель в хеширующей таблице содержит адрес начала  од-
носвязного списка; необходимость в списке вызвана тем, что  одинаковое
хеширующее значение могут иметь более buckesize указателей.

      В модуле Xm определены две локальные функции, которые использую-
тся при работе с хеширующей  таблицей и для выдачи сообщений  об ошиб-
ках. Функция  sto_ptr заносит  заданный указатель  и требуемый  размер
блока памяти в  таблицу. Кроме того,  когда ее вызывают  в первый раз,
она отводит необходимую память под саму таблицу. Функция del_ptr  уда-
ляет заданный указатель  из таблицы и  освобождает блок памяти,  адрес
которого содержится в этом указателе.

      Когда значение xm_Trace не равно нулю, функция xm_malloc вызыва-
ет malloc, запрашивая блок памяти, на OVHDSIZE больший, чем требуется.
Затем она обращается к функции sto_ptr, которая заносит адрес выделен-
ного блока и его размер в раблицу. При вызове функции xm_calloc снача-
ла производится обращение  к xm_malloc, а  затем memset -  стандартная
функция С - очищает выделенный блок.

      Функция xm_free проверяет, не равен ли нулю указатель, являющий-
ся ее аргументом (непонятно почему, но это не делается практически  ни
в одной реализации С), после чего, если значение xm_Trace не равно ну-
лю, она обращается к  del_pro, которая удаляет соответствующую  запись
из таблицы, а затем освобождает блок. Если же xm_Trace = 0, то функция
просто освобождает память.

      Функция xm_XcheckMem просматривает хеш-таблицу и сообщает о всех
неудаленных блоках. Функция xm_XfreeMem делает то же самое, но  допол-
нительно освобождает  их. Если  xm_Trace равняется  2, то  обе функции
проверяют изменения в  освобожденных блоках. Функция  xmXfreeMem также
освобождает память, занимаемую самой хеш-таблицей.

      В struct alloc_entry имеется поле alloc_no, в котором содержится
значение  xm_totalAlloc  на  момент  запоминания  в  таблице.  Функция
xm_Xrelease освобождает всю память, которая распределена после опреде-
ленного момента. Для этого ей задается номер блока - все блоки, у  ко-
торых значение поля alloc_no меньше заданного номера, были затребованы
раньше.

4. Возможные улучшения

      Из множества улучшений, которые можно внести в описанный модуль,
упомянем здесь лишь два.

      Во-первых, можно ввести описанную выше возможность расплачивать-
ся памятью за возможность поиска совсем тонких ошибок, связанных с ис-
пользованием блоков памяти после их освобождения.

      Во-вторых, можно добавить символьный аргумент в функции модуля и
передавать им еще имя переменной, содержащей требуемый адрес, или даже
имя переменной плюс имя  вызывающей функции. В этом  случае содержимое
хеш-таблицы дает полную информацию о процессе распределения динамичес-
кой памяти.


     Приложение: пользовательская информация о модуле
     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        xm-Переменные
        -------------
      Переменная unsigned int xm_Trace устанавливает уровень контроля
за использованием хипа. Возможные значения:
        NO_HEAPCTL - никакого контроля -
                     прямые обращения к стандартным функциям и подсчет
                     статистики; фиксируется только освобождение NULL;
        FREE_CTL - контроль за повторным освобождением и освобождением
                     нераспределявшейся памяти;
        FULL_CTL -   то же, что FREE_CTL, плюс контроль за записью
                     поверх границ распределенных участков и в уже
                     освобожденные участки.
  По умолчанию установлена в FULL_CTL.


      Переменная unsigned  long xm_userMemory  содержит количество  на
текущий момент памяти, выделенной пользователю при помощи функций это-
го модуля (без учета служебной памяти Си и этого модуля; освобождаемая
память из подсчета исключается).


      Переменная unsigned long  xm_totalMemory содержит количество  на
текущий момент памяти, используемой функциями этого модуля:
       xm_userMemory + память, необходимая для работы xm-модуля
(т.е. без учета служебной памяти  Си, но с учетом памяти,  необходимой
для работы самого модуля;  освобождаемая память из подсчета исключает-
ся).



      Переменная unsigned long xm_userAlloc содержит количество на те-
кущий момент выделенных пользователю участков хипа (освобождаемые уча-
стки из подсчета исключаются).


      Переменная unsigned long xm_totalAlloc содержит общее число  вы-
деленных модулем участков хипа  (освобождаемые участки из подсчета  НЕ
исключаются)
      Переменная устанавливается в нуль в функции xm_XfreeMem.
      Кроме того, может быть уменьшена в функции xm_Xrelease.

 Имя x_calloc -- Запросить участок памяти
 ----------------------------------------
 Обращение  ptr = x_calloc(size,num);

                void   *ptr     Указатель на выделенную память
                                или NULL, если памяти не хватило.
                size_t size     Размер запрашиваемого участка.
                size_t num      Количество нужных участков.

 Описание       Функция является вызовом библиотечной функции  calloc,
                если  перед  включением  XM.H  компилятор  не встретил
                строку #define XM_USED.
                В противном  случае функция  запрашивает память  через
                xm_Xcalloc, что дает возможность следить за работой  с
                динамической памятью (см. описание xm_Xcalloc).

 Примечание     Функция реализована как макрос

 Возвращает     ptr     Указатель на выделенную память
                        или NULL, если памяти не хватило.

 Имя x_checkMem -- Проверка состояния хипа
 -----------------------------------------
 Обращение  result = x_checkMem();

                int result      1, если все в порядке
                                0 в противном случае.

 Описание       Считается, что к моменту обращения к x_checkMem  все,
                что распределялось через этот модуль, должно быть  ос-
                вобождено. Возможен вызов xm_heapWng в следующих ситу-
                ациях:
                - участок не освобожден -
                        код сообщения UNFREED_WNG;
                - участок изменен после освобождения -
                        код сообщения CHANGED_FREE_WNG.
                Память НЕ освобождается.
                Функция возвращает 1, если в процессе ее работы были
                вызовы xm_heapWng. В противном случае возвращает 0.

 Примечание.    Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Примечание.    Функция реализована как макрос.

 Возвращает     result      1, если все в порядке
                            0 в противном случае.


 Имя x_free -- Освободить кусок памяти
 -------------------------------------
 Обращение   x_free(ptr);

                void *ptr       Адрес освобождаемой области

 Описание       Функция  является  вызовом  библиотечной функции free,
                если  перед  включением  XM.H  компилятор  не встретил
                строку #define XM_USED.
                В противном  случае функция  освобождает память  через
                xm_Xfree, что  дает возможность  следить за  работой с
                динамической памятью (см. описание xm_Xfree).

 Примечание     Функция реализована как макрос

 Возвращает     void            т.е. ничего

 Имя x_freeMem -- Проверить и освободить хип
 ---------------------------------------------
 Обращение  result = x_freeMem();

                int result      1, если все в порядке
                                0 в противном случае.

 Описание       Считается, что к моменту обращения к x_freeMem  все,
                что распределялось через этот модуль, должно быть  ос-
                вобождено.
                Возможен вызов xm_heapWng в следующих ситуациях:
                - участок не освобожден -
                        код сообщения UNFREED_MSG;
                - участок изменен после освобождения -
                        код сообщения CHANGED_FREE_WNG.
                После проверки блоки освобождаются.
                Освобождается также память, запрашиваемая модулем для
                "внутренних" нужд.
                Функция возвращает 1, если в процессе ее работы были
                вызовы xm_heapWng. В противном случае возвращает 0.

 Примечание.    Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Примечание.    Функция реализована как макрос.

 Возвращает     result      1, если все в порядке
                            0 в противном случае.


 Имя x_malloc -- Запросить кусок памяти
 --------------------------------------
 Обращение  ptr = x_malloc(size);

                void   *ptr     Указатель на выделенную память
                                или NULL, если памяти не хватило.
                size_t size     Размер запрашиваемого участка.

 Описание       Функция является вызовом библиотечной функции  malloc,
                если  перед  включением  XM.H  компилятор  не встретил
                строку #define XM_USED.
                В противном  случае функция  запрашивает память  через
                xm_Xmalloc, что дает возможность следить за работой  с
                динамической памятью (см. описание xm_Xmalloc).

 Примечание     Функция реализована как макрос

 Возвращает     ptr     Указатель на выделенную память
                        или NULL, если памяти не хватило.



 Имя x_mark -- Запомнить количество запросов памяти
 --------------------------------------------------
 Обращение   x_mark(p);

                unsigned long p         Номер последнего запрошенного
                                        участка

 Описание       В процессе  работы ведется  нумерация запросов  памяти
                (текущее количество запрошенных участков содержится  в
                переменной  xm_totalAlloc,  доступной   пользователю).
                Значение этой переменной запоминается в переменной  p,
                после чего  можно обратиться  к x_release,  задав ей в
                качестве параметра запомненное значение. В  результате
                все  участки,  запрошенные  после  момента обращения к
                x_mark, будут освобождены.

 Примечание     Функция реализована как макрос.
                Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Возвращает     void            т.е. ничего

 Имя x_release -- Освободить последнюю запрошенную память
 --------------------------------------------------------
 Обращение x_release(start);

                unsigned long start     Номер размещения, начиная
                                        с которого нужно освобождать.

 Описание       В процессе  работы ведется  нумерация запросов  памяти
                (текущее количество запрошенных участков содержится  в
                переменной xm_totalAlloc, доступной пользователю), что
                дает возможность освободить все блоки, размещенные по-
                сле определенного момента.
                Используется  в  паре с  x_mark, которая  используется
                для того, чтобы запомнить "место", начиная с  которого
                (и до конца) нужно освобождать. Вызов этой функцию без
                предварительного  вызова  x_mark  может привести к не-
                предсказуемым результатам.

 Примечание.    Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Примечание.    Реализована как макрос.

 Возвращает     void            т.е. ничего


 Имя x_strdup -- Получить копию строки
 -------------------------------------
 Обращение  new = x_strdup(old);

                char *new       Указатель на скопированную строку
                char *old       Указатель на копируемую строку

 Описание       Функция является вызовом библиотечной функции  strdup,
                если  перед  включением  XM.H  компилятор  не встретил
                строку #define XM_USED.
                В противном  случае функция  запрашивает память  через
                x_malloc, после чего копирует строку в отведенный уча-
                сток.

 Примечание     Функция реализована как макрос

 Возвращает     new       Указатель на скопированную строку


 Имя xm_heapWng -- Выдать сообщение об ошибке
 --------------------------------------------
 Обращение  xm_heapWng(code, ptr);

                unsigned int code       Код сообщения
                void *ptr               "Криминальный" указатель

 Описание       Функция реакции на ошибку в использовании хипа.
                Стандартный текст сообщения можно получить из  массива
                xm_wngText; индекс - код ошибки.
                Начальная установка xm_heapWng - стандартный  обработ-
                чик, который выдает сообщение и значения указателя  (в
                16-ричном виде) в файл stderr.
                Имеется возможность установить собственный  обработчик
                (см. функцию xm_SetOwnWarn).

 Примечание.    Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Возвращает     void            т.е. ничего


 Имя xm_setOwnWarn -- Установить собственный обработчик ошибок
 -------------------------------------------------------------
 Обращение  xm_setOwnWarn(OwnWrn)

                void (*OwnWrn)(unsigned int code,void *ptr)
                        OwnWrn - имя собственного обработчика

 Описание       Функция устанавливает OwnWrn в качестве текущего обра-
                ботчика ошибок.

 Примечание     Функция реализована как макрос.
                Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.


 Возвращает     void            т.е. ничего


 Имя xm_Xcalloc -- Запросить участок памяти
 ------------------------------------------
 Обращение  ptr = xm_Xcalloc(size,num);

                void   *ptr     Указатель на выделенную память
                                или NULL, если памяти не хватило.
                size_t size     Размер запрашиваемого участка.
                size_t num      Количество нужных участков.

 Описание       Функция моделирует библиотечную функцию calloc, доста-
                вляя, вместе с тем,  возможность следить за работой  с
                динамической памятью.

 Примечание.    Пользователю функция доступна через макроимя x_calloc,
                если перед включением  файла XM.H компилятор  встретил
                строку #define XM_USED. В противном случае функция не-
                доступна.

 Возвращает     ptr     Указатель на выделенную память
                        или NULL, если памяти не хватило.


 Имя xm_Xfree -- Освободить кусок памяти
 ---------------------------------------
 Обращение   xm_Xfree(ptr);

                void *ptr       Адрес освобождаемой области

 Описание       xm-аналог библиотечной функции free.
                Возможен вызов xm_heapWng в следующих ситуациях:
                  - освобождение NULL -
                        код сообщения FREEING_NULL_WNG,
                        выдается при любых значениях xm_Trace;
                  - освобождение некорректного указателя -
                        код сообщения FREEING_BAD_WNG,
                        выдается при xm_Trace == FREE_CTL ||
                                     xm_Trace == FULL_CTL;
                  - повторное освобождение участка -
                        код сообщения FREEING_FREE_WNG,
                        выдается при xm_Trace == FREE_CTL ||
                                     xm_Trace == FULL_CTL;
                  - производилась запись за границы освобождаемого участка
                        код сообщения OVERWRITE_WNG,
                        выдается при xm_Trace == FULL_CTL.

 Примечание.    Пользователю эта функция доступна через макроимя x_free,
                если перед включением  файла XM.H компилятор  встретил
                строку #define XM_USED. В противном случае функция не-
                доступна.

 Возвращает     void            т.е. ничего



 Имя xm_Xmalloc -- Запросить участок памяти
 ------------------------------------------
 Обращение  ptr = xm_Xmalloc(size);

                void   *ptr     Указатель на выделенную память
                                или NULL, если памяти не хватило.
                size_t size     Размер запрашиваемого участка.

 Описание       Функция моделирует библиотечную функцию malloc, доста-
                вляя, вместе с тем,  возможность следить за работой  с
                динамической памятью.

 Примечание.    Пользователю  эта  функция  доступна  через   макроимя
                x_malloc, если перед включением файла XM.H  компилятор
                встретил строку  #define XM_USED.  В противном  случае
                функция недоступна пользователю.

 Возвращает     ptr     Указатель на выделенную память
                        или NULL, если памяти не хватило.

 Имя xm_XMem -- Проверить и освободить хип
 -----------------------------------------
 Обращение  result = xm_XMem(freeing, start);

                int result      1, если все в порядке
                                0 в противном случае.
                int freeing     1 говорит о том, что нужно освобождать
                                всю память.
                                0 предлагает ограничиться проверкой.
                unsigned long start     Номер размещения, начиная
                                с которого нужно освобождать.

 Описание       Считается, что к моменту обращения к xm_Mem  все,
                что распределялось через этот модуль, должно быть  ос-
                вобождено.
                Возможен вызов xm_heapWng в следующих ситуациях:
                - участок не освобожден -
                        код сообщения UNFREED_WNG,
                        выдается при xm_Trace == FREE_CTL ||
                                     xm_Trace == FULL_CTL;
                - участок изменен после освобождения -
                        код сообщения CHANGED_FREE_WNG,
                        выдается при xm_Trace == FULL_CTL.
                Если параметр freeing не равен нулю, то после проверки
                освобождаются блоки, запрошенные после start.
                В этом случае освобождается также память, запрашиваемая
                модулем для внутренних" нужд.
                Функция возвращает 1, если в процессе ее работы были
                вызовы xm_heapWng. В противном случае возвращает 0.

 Примечание.    Пользователю функция доступна только при условии,  что
                перед включением файла XM.H компилятор встретил строку
                #define XM_USED. Если этом не так, функция недоступна.

 Возвращает     result      1, если все в порядке
                            0 в противном случае.

      Модуль является  составной  частью  разработанного  нами   пакета
InfoScope Turbo C Tools.  По вопросам поставки этого пакета следует об-
ращаться в СП ЛАНИТ в Москве по телефону 261-43-62 или  непосредственно
к разработчикам по телефону (095) 331-54-27.
    
                                                Павел Николаевич Дубнер
