{$MACRO LineDraw FROM EDIT TRANS;}
$MACRO GLinDraw FROM EDIT Trans;
{************************************************************************
GLINEDRAW -  –†–∏—Å–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ–∫—Å—Ç–µ —Å –ø–æ–º–æ—â—å—é —Å–∏–º–≤–æ–ª–æ–≤ –ø—Å–µ–≤–¥–æ–≥—Ä–∞—Ñ–∏–∫–∏
				 –†–∞–∑—Ä–∞–±–æ—Ç–∞–ª –°—Ç–µ—Ä–Ω–∏–∫ –ì.–ê. (Stern i K¬∞)
				 –¢–∞–≥–∞–Ω—Ä–æ–≥—Å–∫–∏–π –†–∞–¥–∏–æ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ò–Ω—Å—Ç–∏—Ç—É—Ç
				 –ù–ò–û –ü–û –í–°–ù–ü,  –¢–†–¢–ò –∏ –ò–ü–ò–ê–ù –°–°–°–†
				 –¢–∞–≥–∞–Ω—Ä–æ–≥, –ß–µ—Ö–æ–≤–∞ 22
				 —Ç–µ–ª. (863-44-) 6-17-61

                               –í–µ—Ä—Å–∏—è 5.22  04.02.92 09:46
**************************************************************************}

	Def_Int( X1,Y1,X2,Y2,Xx1,Yy1,Xx2,Yy2,x,y,dx,dy ,Mode_Insert,M_Dis,
			Lt,Ch,c1,linestyle, cy, Shft, fkey, Mous, Tab_Ex, Num_Lock,
			Blo,bl1,Bl2,Bc1,Bc2 );
	Def_Char( s,s1,s2,r1,r2,r3,r4 );
	Def_Str( m[35], me[40], ls[14],st[38] );
Def_Str(
	firm[30] := '–ü—Å–µ–≤–¥–æ–≥—Ä–∞—Ñ–∏–∫–∞  G.SterniK¬∞ ‚ïë',
	ol[14] := ' ‚îî‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îê ',
	dl[14] := ' ‚ïö‚ïê‚ïê‚ïê‚ï¨‚ïê‚ïê‚ïê‚ïó ',
	sl[10] := ' –°—Ç–∏—Ä–∞–Ω–∏–µ ',
	ar[35] := ' Shift +<><><><> - –†–∏—Å–æ–≤–∞–Ω–∏–µ  ',
	sv1[13]   := '‚ïò‚ïß‚ïõ‚îî‚î¥‚îò‚ïö‚ï©‚ïù‚ïô‚ï®‚ïú',
	sv2[13]   := '‚ïí‚ï§‚ïï‚îå‚î¨‚îê‚ïî‚ï¶‚ïó‚ïì‚ï•‚ïñ',
	sv3[13]   := '‚ïñ‚ï¢‚ïú‚îê‚î§‚îò‚ïó‚ï£‚ïù‚ïï‚ï°‚ïõ',
	sv4[13]   := '‚ïì‚ïü‚ïô‚îå‚îú‚îî‚ïî‚ï†‚ïö‚ïí‚ïû‚ïò',
	lev1[13]  := '‚îÄ‚îå‚îú‚îî‚î¨‚îº‚î¥‚ïì‚ïü‚ïô‚ï•‚ï´‚ï®',
	lev2[13]  := '‚ïê‚ïî‚ï†‚ïö‚ï¶‚ï¨‚ï©‚ïí‚ïû‚ïò‚ï§‚ï™‚ïß',
	prav1[13] := '‚îÄ‚î¨‚îº‚î¥‚îê‚î§‚îò‚ï•‚ï´‚ï®‚ïñ‚ï¢‚ïú',
	prav2[13] := '‚ïê‚ï¶‚ï¨‚ï©‚ïó‚ï£‚ïù‚ï§‚ï™‚ïß‚ïï‚ï°‚ïõ',
	verh1[13] := '‚îÇ‚îå‚î¨‚îê‚îú‚îº‚î§‚ïí‚ï§‚ïï‚ïû‚ï™‚ï°',
	niz1[13]  := '‚îÇ‚îî‚î¥‚îò‚îú‚îº‚î§‚ïò‚ïß‚ïõ‚ïû‚ï™‚ï°',
	verh2[13] := '‚ïë‚ïî‚ï¶‚ïó‚ï†‚ï¨‚ï£‚ïì‚ï•‚ïñ‚ïü‚ï´‚ï¢',
	niz2[13]  := '‚ïë‚ïö‚ï©‚ïù‚ï†‚ï¨‚ï£‚ïô‚ï®‚ïú‚ïü‚ï´‚ï¢',
	st1[39] := '‚îÇ‚îî‚îò‚îå‚îê‚îú‚î§‚î¥‚î¨‚îº‚ïò‚ïõ‚ïí‚ïï‚ïû‚ï°‚ïß‚ï§‚ï™‚îÄ‚îî‚îò‚îå‚îê‚îú‚î§‚î¥‚î¨‚îº‚ïô‚ïú‚ïì‚ïñ‚ïü‚ï¢‚ï®‚ï•‚ï´',
	st2[39] := '‚ïë‚ïô‚ïú‚ïì‚ïñ‚ïü‚ï¢‚ï®‚ï•‚ï´‚ïö‚ïù‚ïî‚ïó‚ï†‚ï£‚ï©‚ï¶‚ï¨‚ïê‚ïò‚ïõ‚ïí‚ïï‚ïû‚ï°‚ïß‚ï§‚ï™‚ïö‚ïù‚ïî‚ïó‚ï†‚ï£‚ï©‚ï¶‚ï¨',
	st3[39] := '     ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚ïê‚ïê‚ïê‚ïê‚ïê     ‚îÇ‚îÇ‚îÇ‚îÇ‚îÇ    ‚ïë‚ïë‚ïë‚ïë‚ïë',
	sb1[23] := '‚ïî ‚ï¶ ‚ïó ‚îå ‚î¨ ‚îê ‚ïì ‚ï• ‚ïñ ‚ïí ‚ï§ ‚ïï',
	sb2[23] := '‚ï† ‚ï¨ ‚ï£ ‚îú ‚îº ‚î§ ‚ïü ‚ï´ ‚ï¢ ‚ïû ‚ï™ ‚ï°',
	sb3[23] := '‚ïö ‚ï© ‚ïù ‚îî ‚î¥ ‚îò ‚ïô ‚ï® ‚ïú ‚ïò ‚ïß ‚ïõ',
	sb4[23] := '‚îÇ ‚ïë ‚îÄ ‚ïê ‚ñë ‚ñí ‚ñì ‚ñà ‚ñê ‚ñå ‚ñÄ ‚ñÑ',
	sb5[30] := 'Char ‚ñ† –Å ‚ñë ‚ñí ‚ñì ‚ñà ‚ñê ‚ñå ‚ñÄ ‚ñÑ ‚ñê‚ñÄ‚ñÑ‚ñå');

	if(global_int('GLindrawX') = 0 ) then
		Set_global_int('GLindrawX',14);
	end;
	if(global_int('GLindrawY') = 0 ) then
		Set_global_int('GLindrawY',8);
	end;
	IF ( Mou_Installed ) THEN
	Mous := Mouse_Mode;
		IF (Mouse_Mode = 0 ) THEN
			Mouse := 0;
			Mouse_Mode := 1 ;
			M_Dis := Mou_Disappear;
			Mou_Disappear := 0;
			Mou_Set_Pos ( WhereX, WhereY);
			Mouse := 1;
		END;
	END;
	Blo := Block_Stat;
	IF (Blo > 0) THEN
		Undo_stat := FALSE;
		bl1 := Block_Line1;
		Bl2 := Block_Line2;
		Bc1 := Block_Col1;
		Bc2 := Block_Col2;
		Block_Off;
		Undo_stat := TRUE;
	END;
	 { –ø–æ–≥–∞—Å–∏–º NumLock }
	Num_Lock := Peek(0,$417) AND $20;
	dx := Peek(0,$417) AND $DF;
	MEMB($417, dx);
	dx := 1;
	dy := 1;
	me := firm ;
	ls := ol;
	Lt := 1;
	ST := St1;
	m := ar;
    fkey := 61;
    Mode_Insert := Insert_mode;
	Insert_mode := FALSE;
	LineStyle := 1;
	Tab_Ex := Tab_Expand;
	Tab_Expand := False;
	push_labels;
	flabel('–î–≤–æ–π–Ω.', 2, $FF);
	flabel('–†–∏—Å–æ–≤' , 3, $FF);
	flabel('–ü—Ä,–õ–∏–Ω', 4, $FF);
	flabel('–í—ã–±–°–∏–º', 5, $FF);
	flabel('–®—Ç–∞–º–ø ', 6, $FF);
	flabel('–û–¥.–°–∏–º', 7, $FF);

Make_Message( me + m + ls );
OTKL:
	Read_key;
	R_AX := $0200;
	INTR($16);
	Shft := ((R_AX and $0003) > 0);
	if ((Key1 > 49) and (key1 < 57 )) then
		Key1 := 0; Shft := True;
	End;
	IF ( Key1 = 27) THEN
	Goto FINAL;
	END;
		if ( (Key1 = 45 ) Or (Key2 = 14) ) then
			Rm('Mesys^Undo');
			Make_Message( me + m + ls );
			goto OTKL;
		END;
		if (Key2 = 28) or (Key2 = 244) then
			Push_Key(13,28);
			goto RECT;
		END;
		if (Key1 > 0) then
			goto SOU;
		END;
		IF ((key2 > 239) ANd (key2 < 244 )) THEN
				PASS_KEY(Key1,Key2);
				goto OTKL;
		end;
SHIFT_RIS:
				IF ((Key2 > 70) AND (Key2 < 82 ))  THEN
			IF ( Shft = False ) THEN
				PASS_KEY(Key1,Key2);
				goto OTKL;
			Else
				Refresh := 0;
				push_undo;
				x := C_COL; y := C_Line;
				IF ( Key2 = 72 )  THEN    { Shift Up }
					if(LineStyle = 2)Then
						 text(r2); left; Up;
					else

						x1 := x;    y1 := y-1;
						x2 := x;    y2 := y;
						call Draw;
						Run_Macro('ScrollUP');
						Up;Up;
					end;
				goto OTK;
				END;
				IF ( Key2 = 80 )  THEN    { Shift Dn }
					if(LineStyle = 2)Then
						 text(r4); left; Down;
					else
				x1 := x;    y1 := y;
				x2 := x;    y2 := y+1;
				call Draw;
					end;
					goto OTK;
				END;
				IF   (Key2 = 75)  THEN    { Shift Left }
					IF   (x = 1)  THEN   goto OTK; END;
					if(LineStyle = 2)Then
						 text(r1); left; left;
					else
				x1 := x-1;  y1 := y;
				x2 := x;    y2 := y;
				call Draw;
					GoTo_Col(x-1);
					Goto_Line(y);
					END;
					goto OTK;
				END;
				IF ( Key2 = 77 )  THEN    { Shift Right }
					if(LineStyle = 2)Then
						 text(r3);
					else
					x1 := x;    y1 := y;
					x2 := x+1;  y2 := y;
					call Draw;
					end;
					goto OTK;
				END;
			END;
		end;
		if (key2 > 58) AND (key2 < 67) then
			Call FUNCKEY;
		Else
SOU:        Sound(1000);
			delay(5);
			Sound(0);

		END;
OTK:
Refresh := 1;
Redraw;
pop_undo;
goto OTKL;

ODIN:
x1 := global_int('GLindrawX');
y1 := global_int('GLindrawY');
MARK_POS;
push_undo;
Call Cursor_To;
	Put_Box( 2, 4, 30, 15, 2, M_B_COLOR, '–í—ã–±–µ—Ä–∏—Ç–µ –°–∏–º–≤–æ–ª', TRUE );
		{–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ}
	Write( sb1,4,6,2,15 );
	Write( sb2,4,8,2,15 );
	Write( sb3,4,10,2,15 );
	Write( sb4,4,12,2,15 );
		{–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è}
s := ' ';
Make_Message('–¢–µ–∫—É—â–∏–π —Å–∏–º–≤–æ–ª                     <ESC>-–æ—Ç–∫–∞–∑');
GOTO CUR_SIM;
Getc:
	Read_key;
	IF (( Key1 = 27) or ( Key2 = 245)) THEN
        Kill_Box;
        call Restor;
        Goto OK;
	END;
REAK:
		X1 := WhereX;
		Y1 := Wherey;
		IF (( Key1 <> 13) AND (Key2 < 244))
		THEN
		   IF (Key1 > 0) then goto Getc;
		   END;
		   if (key2 > 58) AND (key2 < 67) then
				GoTo  OK;
		   End;
		   IF ((Key2 = 72) OR (Key2 = 240) )THEN
				 IF ( y1 < 7 ) THEN GoTo Getc;
				 else up; up;
				 END;
		   ELSE
				 IF ((Key2 = 80) OR (Key2 = 241)) THEN
					   IF ( y1 > 11 ) THEN goto Getc;
					   Else Down; Down;
					   END;
				 ELSE
					   IF ((Key2 = 75) OR (Key2 = 242)) THEN
							 IF ( x1 < 5 ) THEN goto Getc;
							 Else Left; Left;
							 END;
					   ELSE
							 IF ((Key2 = 77) OR (Key2 = 243)) THEN
								   IF ( x1 > 25 ) THEN goto Getc;
								   Else Right; Right;
								   END;
							 ELSE goto Getc;
							 END;
					   END;
				 END;
			END;
			X1 := WhereX;
			Y1 := Wherey;
			Set_global_int('GLindrawX',x1);
			Set_global_int('GLindrawY',y1);
CUR_SIM:            X1 := x1-3;
			IF (( y1 <> 6 ) AND (Y1 <> 8) AND (Y1 <> 10) AND ( Y1 <> 12 )) THEN
            Make_Message('–¢–µ–∫—É—â–∏–π —Å–∏–º–≤–æ–ª                     <ESC>-–æ—Ç–∫–∞–∑');
			GoTo Getc;
			END;
	IF ( y1 = 6 ) THEN s := copy(sb1,x1,1);
			ELSE
				IF ( y1 = 8 ) THEN s := copy(sb2,x1,1);
				ELSE
					IF ( y1 = 10 ) THEN s := copy(sb3,x1,1);
					ELSE
					s := copy(sb4,x1,1);
					END;
				END;
			END;
			Write( s,17,Message_Row,12,15 );
			goto Getc;
			END;
	Kill_Box;
	call Restor;
Make_Message('–°–∏–º–≤–æ–ª  <'+ s + '> . –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –∫ –ù–£–ñ–ù–û–ú–£ –ú–ï–°–¢–£ –∏ –Ω–∞–∂–º–∏—Ç–µ <Enter>');
call OTKLI;
	Text(s);
	pop_undo;
	goto ODIN;
OK:
	pop_undo;
	Refresh := 1;
    Redraw;
	Key2 := FKey;
	Key1 := -1;
	Make_Message( me + m + ls );
	Call FUNCKEY;

{ –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∞—è –∫—É—Ä—Å–æ—Ä –≤ —Ç–æ—á–∫—É —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –¥–∏—Å–ø–ª–µ—è x1,y1 }
Cursor_To:
	X := C_Col;
	Y := C_Line;
	x2 := Wherex;
	GoTo_Col( C_col - x2 + x1 );
	cy := WhereY;
	RM('Mesys^TopWin');
	WHILE ( WhereY < y1 ) DO down;
	END;
Ret;

{--------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏—à --------------}
FUNCKEY:
			if (key2 = 59) then
			help('Glindraw.hlp^*');
			Make_Message( me + m + ls );
			Goto Vozvrat;
			end;
			Block_Off;
			if (( key2 <> 65)and(key2 <> 63)) then
			  { –∑–∞–ø–æ–º–Ω–∏–º —Ç–æ—á–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–ª—è  F7 –∏ F5 }
			fkey := Key2; end;
{***************** F2 –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ª–∏–Ω–∏–∏-—Å—Ç–∏—Ä–∞–Ω–∏–µ *****************}
			if (key2 = 60) then
				IF ( Key1 < 0 ) THEN
					 key1 := 0;
					 goto MM;
				END;
					IF ( Lt = 3 ) THEN
					flabel('–î–≤–æ–π–Ω.', 2, $FF);
					LineStyle := 1;
					st := st1;
					Lt := 1;
					ls := ol;
					ElsIF ( Lt = 1 ) THEN
						flabel(' –°—Ç–∏—Ä ', 2, $FF);
						LineStyle := 1;
						Lt := 2;
						st := st2;
						ls := dl;
						r3 := ' '; r2 := ' ';
						r1 := ' '; r4 := ' ';
					else
						flabel('–û–¥–∏–Ω–∞—Ä', 2, $FF);
						Lt := 3;
						st := st3;
						ls := sl;
					end;
MM: 		Make_Message( me + m + ls );
			end;
{************************** F3 Shift –†–∏—Å–æ–≤–∞–Ω–∏–µ ********************** }
			if (key2 = 61) then
				me := firm;
				m := ar;
				Make_Message( me + m + ls );
				GoTo OTKL;
			end;
{******************* F4 –õ–∏–Ω–∏–∏ –∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ **********************}
			if (key2 = 62) then     { F3 line & Rect. }
RECT:
				m := ' –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏   ';
			ZAPROS:
				call Coor;
				x := C_Col;
				y := C_Line;
				IF (LineStyle = 1 ) THEN
				   call Rect_Ris;
				else
				   call Ris;
				END;
				goto ZAPROS;
			end;
{****************** F6 –®—Ç–∞–º–ø–æ–≤–∫–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ ********************}
			if ((key2 = 64) and ( LineStyle > 0 )) then
				m := ' –®—Ç–∞–º–ø–æ–≤–∫–∞   ';
				Me := ' –£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–∫—É –ø—Ä–∏–≤—è–∑–∫–∏, <Enter>.  ESC - —Å–±—Ä–æ—Å ‚ïë ';
		 Vvod_t:
				Make_Message( me + m + ls );
				Call OTKLI;
				xx1 := C_Col;
				yy1 := C_Line;
				xx2 := dx + xx1;
				yy2 := dy + yy1;
				x := xx1;
				y := yy1;
				IF (LineStyle = 1 ) THEN
				   call Rect_Ris;
				   else
				   call Ris;
				END;
				goto Vvod_t;
			end;

	{************* F5 –í—ã–±–æ—Ä —Å–∏–º–≤–æ–ª–∞ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è **************}
			if (key2 = 63) then
				IF (Lt = 3) THEN
					Sound(1000);
					delay(9);
					Sound(0);
					Key1 := -1;
					goto Vozvrat;
				END;
				x1 := 7;
				y1 := 6;
				MARK_POS;
				Call Cursor_To;
				Put_Box( 2, 4, 35, 9, 2, M_B_COLOR, '–í—ã–±–µ—Ä–∏—Ç–µ –°–∏–º–≤–æ–ª', TRUE );
					{–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ}
				Write( sb5,4,6,0,M_T_COLOR );
					{–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏—è}
				Make_Message(' –î—Ä—É–≥–æ–π —Å–∏–º–≤–æ–ª  ');
Ge:
				Read_key;
				IF ( Key1 = 27) or (Key2 = 245) THEN
				Make_message(' ');
				Goto KB;
				END;

					IF (( Key1 <> 13) AND (Key1 <> 32) AND (Key2 <> 244))
						THEN
						IF (Key1 > 0) then goto Ge;
						END;
						if (key2 > 58) AND (key2 < 67) then
								GoTo_Col(x);
								Goto_Line(y);
								Refresh := 1;
								Redraw;
								Key2 := fkey ;
								Call FUNCKEY;
						End;
						X1 := WhereX-3;
						IF (( Key2 = 75) or (key2 = 242 ))  THEN
								IF ( x1 < 5 ) THEN goto Ge;
								Else Left; Left;
								END;
						ELSE
								IF (( Key2 = 77) or (key2 = 243 )) THEN
									IF ( x1 > 27 ) THEN goto Ge;
									Else Right; Right;
									END;
								ELSE goto Ge;
								END;
						END;
			   TEST_X:
							X1 := WhereX-3;
{sb5 := 'Char ‚ñ† –Å ‚ñë ‚ñí ‚ñì ‚ñà ‚ñê ‚ñå ‚ñÄ ‚ñÑ ‚ñê‚ñÄ‚ñÑ‚ñå';  }

						IF ( x1 < 5  )
						THEN
						Make_Message(' –î—Ä—É–≥–æ–π —Å–∏–º–≤–æ–ª  ');
						else
							IF ( x1 > 24  )
							THEN
							Make_Message(' –°–∏–º–≤–æ–ª—ã ‚ñê‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñå ');
							else
							s := Str_Char(Sb5,x1);
							if ( s = ' ') then  { –Ω–∞ –≤—Å—è–∫–∏–π ... }
								left; goto TEST_X;
							end;
							Make_Message('      –°–∏–º–≤–æ–ª  ');
							Write( s,17,Message_Row,12,15 );
							end;
						END;
						goto Ge;
					END;
OKey:
				if ( x1 < 25 ) then
					if( x1 < 5 )  then
					{** RM('SUPPort^ASCII');**}
Box1:                   Return_str := '' ;
Run_Macro('USERIN^Querybox  /N=0 /C=8 /W=1 /ML=1 /L=5 /P=    –í–≤–µ–¥–∏—Ç–µ –°–∏–º–≤–æ–ª: /NK=1 /H=Glindraw.hlp^*');
							IF ( Return_int = 0 ) THEN goto KB;
							else s := Char( Ascii(Return_Str));
							end;
					end;
					r1 := s;  r2 := s;
					r3 := s;  r4 := s;
				else
				r3 := '‚ñÄ';  r2 := '‚ñê';
				r1 := '‚ñÑ';  r4 := '‚ñå';
				end;
				LineStyle := 2;
				ls := r2 + r1 +r1 + r3 + r3 + R4 ;
	   KB:      Kill_Box;
				call Restor;
				Key2 := FKey;
				Key1 := -1;
				Make_Message( me + m + ls );
				goto FUNCKEY;
			end;
{******************* F7 –û–¥–∏–Ω–æ—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã **********************}
			if (key2 = 65) then
				goto ODIN;
			end;
Vozvrat:    Ret;

{--------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–≤–æ–¥–∏–º—ã—Ö –∫–ª–∞–≤–∏—à --------------}
OTKLI:
	Read_key;
	IF ( Key1 = 27) THEN
	Goto FINAL;
	END;
	IF (( Key1 <> 13) AND (Key1 <> 32) And ( Key2 < 244 ) )
		THEN
		if ( (Key1 = 45 ) Or (Key2 = 14) ) then
			Rm('Mesys^Undo');
			Make_Message( me + m + ls );
			goto OTKLI;
		END;
		R_AX := $0200;
		INTR($16);
		Shft := ((R_AX and $0003) > 0);
		IF (((Key2 > 70) AND (Key2 < 82 )) OR (Key2 > 239)) THEN
			IF Shft THEN
				Block_Off;
				Key1 := 0;
				me := firm;
				m := ar;
				Make_Message( me + m + ls );
				Goto SHIFT_RIS;
			END;
			IF (Key1 > 0)  then  goto PISK; END;
			PASS_KEY(Key1,Key2);
			goto OTKLI;
		ELSE
		IF (Key1 > 0)  then  goto PISK; END;
		END;
		if (key2 > 58) AND (key2 < 67) then
			Call FUNCKEY;
		else
PISK:       Sound(1000);
			delay(5);
			Sound(0);
		end;
		goto OTKLI;
	END;
	MARK_POS;
	Ret;

{-------------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–≤–æ–¥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç -----------------------}
Coor:
Me := '–£–∫–∞–∂–∏—Ç–µ –ü–ï–†–í–£–Æ —Ç–æ—á–∫—É, <Enter>. ESC - —Å–±—Ä. ‚ïë ';
Make_Message(me + m + ls);
 {WRITE('–ü–ï–†–í–£–Æ',9,Message_Row,0,Message_COLOR + 128);}
	Call OTKLI;
	GoTo_Mark;  { –ß—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ —Å—Ç–µ–∫–∞ }
	Xx1 := C_Col;
	Yy1 := C_Line;
	Col_Block_Begin;
Me := '–£–∫–∞–∂–∏—Ç–µ –í–¢–û–†–£–Æ —Ç–æ—á–∫—É, <Enter>. ESC - —Å–±—Ä. ‚ïë ';
Make_Message(me + m + ls );
 {Write('–í–¢–û–†–£–Æ',9,Message_Row,0,Message_COLOR + 128);}
	Call OTKLI;
	Xx2 := C_Col;
	Yy2 := C_Line;
	Ret;

{--------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤ --------------}
Rect_Ris:
	Make_message(' ');
	PUsh_UNDO;
	WORKING;
	Refresh := 0;
	GOto_col(Xx1);
	GoTo_Line(Yy1);
	IF ( ( xx1 = xx2 ) Or ( yy1 = yy2 ))
	THEN
		x1 := xx1;  y1 := yy1;
		x2 := xx2;  y2 := yy2;
			call Draw;
	ELSE
		x1 := xx1;  y1 := yy1;
		x2 := xx1;  y2 := yy2;
			call Draw;

		x1 := xx2;  y1 := yy1;
		x2 := xx2;  y2 := yy2;
			call Draw;

		x1 := xx1;  y1 := yy1;
		x2 := xx2;  y2 := yy1;
			call Draw;

		x1 := xx1;  y1 := yy2;
		x2 := xx2;  y2 := yy2;
			call Draw;
	END;
	call Restor;
	Pop_Undo;
	Ret;

{-------------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ª–∏–Ω–∏–π -----------------------}
DRAW:

	IF ((x1 = x2 )) THEN
		goto VERLIN;
	ELSE
		IF (y1 = y2 ) THEN
		goto HORLIN;
	END;
	End;

VERLIN:
	IF (y2 < y1 ) THEN
	ch := y2 ;
	y2 := y1;
	y1 := ch;
	END;
	dy := y2-y1;
	GoTo_Col(x1);
	Goto_Line(y1);
	s := Cur_Char;
	Ch := ASCII(s);
	if(C_Col > 1 ) then
		Left;
		s1 := Cur_Char;
		RIGHT;
	else
		s1 := ' ';
	end;
	RIGHT;
	s2 := Cur_Char;
	Left;
		IF ((Ch < 179) OR (Ch > 218) {OR ( Ch = 186)})
		THEN
		Text( Str_Char(St,1));  GoTo V_LIN_1;
		ELSE
			IF  (lt = 2)  then
				if ( XPOS( s,'‚ï†‚ï¨‚ï£‚ïü‚ï´‚ï¢',1) > 0 )
				THEN  Right; GoTo V_LIN_1;
				END;
			else
			IF  (lt = 1)  then
				if ( XPOS( s,'‚ïû‚ï™‚ï°‚îú‚îº‚î§',1) > 0 )
				THEN  Right; GoTo V_LIN_1;
				END;
			else
				c1 :=  XPOS( s,'‚ïû‚ï™‚ï°‚îú‚îº‚î§‚ï†‚ï¨‚ï£‚ïü‚ï´‚ï¢',1) ;
				if ( c1 > 0 )
				THEN  Text(Str_Char(sv1,c1));  GoTo V_LIN_1;
				END;
			end;
			End;
			IF ( s = Str_Char(St,2))
			THEN Text(Str_Char(St,6));   GoTo V_LIN_1;
			END;
			IF ( s = Str_Char(St,3))
			THEN Text(Str_Char(St,7));   GoTo V_LIN_1;
			END;
			IF ( s = Str_Char(St,11))
			THEN Text(Str_Char(St,15));  GoTo V_LIN_1;
			END;
			IF ( s = Str_Char(St,12))
			THEN Text(Str_Char(St,16));  GoTo V_LIN_1;
			END;
			IF(((XPOS(s1,lev1,1) > 0)  AND ( XPOS(s2,prav1,1) > 0 )) or (s = '‚ï•') or (s = '‚î¨')) then
				IF ( s = Str_Char(St,8))
				THEN Text(Str_Char(St,10));
				ELSE  Text(Str_Char(St,9));
				END;
				GoTo V_LIN_1;
			END;
			IF ( (  ( XPOS(s1,lev1,1) > 0)) OR (s = '‚îê') or (s = '‚ïñ'))
			THEN Text(Str_Char(St,5));   GoTo V_LIN_1;
			END;
			IF (  ( XPOS(s2,prav1,1) > 0 ) OR (s = '‚îå') or (s = '‚ïì'))
			THEN Text(Str_Char(St,4));   GoTo V_LIN_1;
			END;
			IF((( XPOS(s1,lev2,1) > 0 ) AND ( XPOS(s2,prav2,1) > 0 )) or (s = '‚ï§') or (s = '‚ï¶')) then
				IF ( s = Str_Char(St,17))
				THEN Text(Str_Char(St,19));
				ELSE  Text(Str_Char(St,18));
				END;
				GoTo V_LIN_1;
			END;
			IF ( (  ( XPOS(s1,lev2,1) > 0 )) OR (s = '‚ï¶') or (s = '‚ïï'))
			THEN Text(Str_Char(St,14));   GoTo V_LIN_1;
			END;
			IF ( (  ( XPOS(s2,prav2,1) > 0 ) ) OR (s = '‚ïì') or (s = '‚ïî'))
			THEN Text(Str_Char(St,13));   GoTo V_LIN_1;
			END;
			Text(Str_Char(St,1));
		END;
V_LIN_1:
	IF ( ( y2 - y1)  = 1 ) THEN
		GoTo V_LIN_2;
	End;
	Down;
	WHILE (C_Line < Y2) DO
	s2 := Cur_Char;
	Left;
	s := Cur_Char;
	Ch := ASCII(s);
	if(C_Col > 1 ) then
		Left;
		s1 := Cur_Char;
		RIGHT;
	else
		s1 := ' ';
	end;
		IF ((Ch < 179) OR (Ch > 218)  {OR ( s = '‚ïë')})
		THEN
		Text(Str_Char(St,1));  GoTo V_LIN_2;
		ELSE
IF ((XPOS(s1,lev1,1) > 0)  AND ( XPOS(s2,prav1,1) > 0 )) or ( XPOS(s,'‚îº‚î¨‚î¥‚ï•‚ï®‚ï¢',1) > 0 )
			THEN Text(Str_Char(St,10));   GoTo V_LIN_2;
			END;
IF (((XPOS(s1,lev1,1) > 0) ) OR ( XPOS(s,'‚î§‚ï¢‚îò‚ïú‚îê‚ïñ',1) > 0 ))
			THEN Text(Str_Char(St,7));   GoTo V_LIN_2;
			END;
IF ((( XPOS(s2,prav1,1) > 0 )) ) OR  ( XPOS(s,'‚îú‚ïü‚ïô‚îî‚ïì‚îå',1) > 0 )
			THEN Text(Str_Char(St,6));   GoTo V_LIN_2;
			END;
IF ((( XPOS(s1,lev2,1) > 0 ) AND ( XPOS(s2,prav2,1) > 0 )) or  ( XPOS(s,'‚ï™‚ïß‚ï§‚ï©‚ï¶‚ï¨',1) > 0 ))
			THEN Text(Str_Char(St,19));   GoTo V_LIN_2;
			END;
IF ((( XPOS(s1,lev2,1) > 0 ) ) OR (s = '‚ï°') or  ( XPOS(s,'‚ïõ‚ïï‚ïó‚ïù‚ï£',1) > 0 ))
			THEN Text(Str_Char(St,16));   GoTo V_LIN_2;
			END;
IF ((( XPOS(s2,prav2,1) > 0 )) OR ( XPOS(s,'‚ïò‚ïí‚ïû‚ïö‚ïî‚ï†',1) > 0 ))
			THEN Text(Str_Char(St,15));   GoTo V_LIN_2;
			END;
			Text(Str_Char(St,1));   GoTo V_LIN_2;
		END;
V_LIN_2:
	Down;
	END;
	s2 := Cur_Char;
	Left;
	s := Cur_Char;
	Ch := ASCII(s);
	if(C_Col > 1 ) then
		Left;
		s1 := Cur_Char;
		RIGHT;
	else
		s1 := ' ';
	end;
		IF ((Ch < 179) OR (Ch > 218) {OR ( s = '‚ïë')})
		THEN
		Text(Str_Char(St,1));  GoTo V_LIN_3;
		ELSE
			IF  (lt = 2)  then
				if ( XPOS( s,'‚ï†‚ï¨‚ï£‚ïü‚ï´‚ï¢',1) > 0 )
				THEN  Right; GoTo V_LIN_3;
				END;
			else
				IF  (lt = 1)  then
					if ( XPOS( s,'‚ïû‚ï™‚ï°‚îú‚îº‚î§',1) > 0 )
					THEN  Right; GoTo V_LIN_3;
					END;
				else
					c1 :=  XPOS( s,'‚ïû‚ï™‚ï°‚îú‚îº‚î§‚ï†‚ï¨‚ï£‚ïü‚ï´‚ï¢',1) ;
					if ( c1 > 0 )
					THEN  Text(Str_Char(sv2 ,c1));  GoTo V_LIN_3;
					END;
				end;
			End;
			IF ( s = Str_Char(St,4))
			THEN Text(Str_Char(St,6));   GoTo V_LIN_3;
			END;
			IF ( s = Str_Char(St,5))
			THEN Text(Str_Char(St,7));   GoTo V_LIN_3;
			END;
			IF ( s = Str_Char(St,13))
			THEN Text(Str_Char(St,15));  GoTo V_LIN_3;
			END;
			IF ( s = Str_Char(St,14))
			THEN Text(Str_Char(St,16));  GoTo V_LIN_3;
			END;

			IF (((XPOS(s1,lev1,1) > 0) AND  ( XPOS(s2,prav1,1) > 0 )) or (s = '‚ï®') or (s = '‚î¥'))then
				IF ( s = Str_Char(St,9))
				THEN Text(Str_Char(St,10));
				ELSE Text(Str_Char(St,8));
				END;
			GoTo V_LIN_3;
			END;
			IF ((XPOS(s1,lev1,1) > 0) OR (s = '‚îò') or (s = '‚ïú'))
			THEN Text(Str_Char(St,3));   GoTo V_LIN_3;
			END;
			IF (( XPOS(s2,prav1,1) > 0 ) OR (s = '‚ïô') or (s = '‚îî'))
			THEN Text(Str_Char(St,2));   GoTo V_LIN_3;
			END;
			IF ((( XPOS(s1,lev2,1) > 0 ) AND  ( XPOS(s2,prav2,1) > 0 ) ) or (s = '‚ïß') or (s = '‚ï©')) then
				IF ( s = Str_Char(St,18))
					THEN Text(Str_Char(St,19));
					ELSE Text(Str_Char(St,17));
				END;
				GoTo V_LIN_3;
			END;
			IF ( (  ( XPOS(s1,lev2,1) > 0 )) OR (s = '‚ïõ') or (s = '‚ïù'))
			THEN Text(Str_Char(St,12));   GoTo V_LIN_3;
			END;
			IF ( (   ( XPOS(s2,prav2,1) > 0 ) ) OR (s = '‚ïò') or (s = '‚ïö'))
			THEN Text(Str_Char(St,11));   GoTo V_LIN_3;
			END;
			Text( Str_Char(St,1) );   GoTo V_LIN_3;
		END;
V_LIN_3:
	Left;
goto END_MA;

HORLIN:
	IF (x2 < x1 ) THEN
	ch := x2 ;
	x2 := x1;
	x1 := ch;
	END;
	dx := x2-x1;
	Goto_Line(y1);
	GoTo_Col(x1);
	if(C_Line > 1) Then
		up;
		s1 := CUR_CHar;
		Down;
	Else
		s1 := ' ';
	end;
	s := Cur_Char;
	Ch := ASCII(s);
	Down;
	s2 := CUR_CHar;
	Up;
		IF ((Ch < 179) OR (Ch > 218){OR ( s = '‚ïê')})
		THEN
		Text( Str_Char(St,20) );  GoTo H_LIN_1;
		ELSE
			IF  (lt = 2)  then
				IF ( XPOS(s,'‚ï¶‚ï¨‚ï©‚ï§‚ï™‚ïß',1) )
				THEN  Right; GoTo H_LIN_1;
				END;
			else
				IF  (lt = 1)  then
				if ( XPOS( s,'‚ï•‚ï´‚ï®‚î¨‚îº‚î¥',1) > 0 )
				THEN  Right; GoTo H_LIN_1;
				END;
				else
					c1 :=  XPOS( s,'‚ï•‚ï´‚ï®‚î¨‚îº‚î¥‚ï¶‚ï¨‚ï©‚ï§‚ï™‚ïß',1) ;
					if ( c1 > 0 )
					THEN  Text(Str_Char(sv3 ,c1));  GoTo H_LIN_1;
					END;
				end;
			End;
			IF ( s = Str_Char(St,22))
			THEN Text(Str_Char(St,27));   GoTo H_LIN_1;
			END;
			IF ( s = Str_Char(St,24))
			THEN Text(Str_Char(St,28));   GoTo H_LIN_1;
			END;
			IF ( s = Str_Char(St,31))
			THEN Text(Str_Char(St,36));  GoTo H_LIN_1;
			END;
			IF ( s = Str_Char(St,33))
			THEN Text(Str_Char(St,37));  GoTo H_LIN_1;
			END;
			IF ((( XPOS(s1,verh1,1) > 0 )  AND ( XPOS(s2,niz1,1) > 0 ) ) or (s = '‚ïû') or (s = '‚îú') )then
				IF ( s = Str_Char(St,26))
					THEN Text(Str_Char(St,29));
					ELSE Text(Str_Char(St,25));
				END;
			GoTo H_LIN_1;
			END;
			IF ((( XPOS(s1,verh1,1) > 0 ) ) OR (s = '‚ïò') or (s = '‚îî'))
			THEN Text( Str_Char(St,21) );   GoTo H_LIN_1;
			END;
			IF ((( XPOS(s2,niz1,1) > 0 ) ) OR (s = '‚îå') or (s = '‚ïí'))
			THEN Text( Str_Char(St,23) );   GoTo H_LIN_1;
			END;
			IF ((( XPOS(s1,verh2,1) > 0 )  AND ( XPOS(s2,niz2,1) > 0 )  ) or (s = '‚ïü') or (s = '‚ï†') )then
				IF ( s = Str_Char(St,35))
					THEN Text(Str_Char(St,38));
					ELSE Text(Str_Char(St,34));
				END;
			GoTo H_LIN_1;
			END;
			IF ( (  ( XPOS(s1,verh2,1) > 0 ) ) OR (s = '‚ïô') or (s = '‚ïö'))
			THEN Text( Str_Char(St,30) );   GoTo H_LIN_1;
			END;
			IF ( (  ( XPOS(s2,niz2,1) > 0 ) ) OR (s = '‚ïì') or (s = '‚ïî'))
			THEN Text( Str_Char(St,32) );   GoTo H_LIN_1;
			END;
			Text( Str_Char(St,20) );
		END;
H_LIN_1:
	IF (  ( x2 - x1 ) = 1 ) THEN
		GoTo H_LIN_2;
	END;

	WHILE (C_col < x2) DO
	if(C_Line > 1) Then
		up;
		s1 := CUR_CHar;
		Down;
	Else
		s1 := ' ';
	end;
	s := Cur_Char;
	Ch := ASCII(s);
	Down;
	s2 := CUR_CHar;
	Up;
		IF ((Ch < 179) OR (Ch > 218) OR ( s = Str_Char(St,20)))
		THEN
		Text( Str_Char(St,20));  GoTo H_LIN_2;
				ELSE
IF ( (  ( XPOS(s1,verh1,1) > 0 )  AND ( XPOS(s2,niz1,1) > 0 ) ) or  ( XPOS(s,'‚ïû‚ï™‚ï°‚îú‚îº‚î§',1) > 0 ) )
			THEN Text( Str_Char(St,29) );   GoTo H_LIN_2;
			END;
IF ( (   ( XPOS(s1,verh1,1) > 0 ) ) OR ( XPOS(s,'‚îò‚ïõ‚îî‚ïò‚î¥‚ïß',1) > 0 ) )
			THEN Text( Str_Char(St,27) );   GoTo H_LIN_2;
			END;
IF ( (  ( XPOS(s2,niz1,1) > 0 ) ) OR ( XPOS(s,'‚îê‚îå‚ïï‚ïí‚î¨‚ï§',1) > 0 ) )
			THEN Text( Str_Char(St,28) );   GoTo H_LIN_2;
			END;
IF ( (  ( XPOS(s1,verh2,1) > 0 )  AND ( XPOS(s2,niz2,1) > 0 ) ) or  ( XPOS(s, '‚ïü‚ï´‚ï¢‚ï†‚ï¨‚ï£',1) > 0 ) )
			THEN Text( Str_Char(St,38) );   GoTo H_LIN_2;
			END;
IF ( (  ( XPOS(s1,verh2,1) > 0 ) ) OR  ( XPOS(s,'‚ï®‚ïô‚ïú‚ïù‚ïö‚ï©',1) > 0 ) )
			THEN Text( Str_Char(St,36) );   GoTo H_LIN_2;
			END;
IF ( (  ( XPOS(s2,niz2,1) > 0 ) ) OR  ( XPOS(s,'‚ï•‚ïñ‚ïì‚ïó‚ïî‚ï¶',1) > 0 ) )
			THEN Text( Str_Char(St,37));   GoTo H_LIN_2;
			END;
			Text( Str_Char(St,20));   GoTo H_LIN_2;
		END;
H_LIN_2:
	END;
	if(C_Line > 1) Then
		up;
		s1 := CUR_CHar;
		Down;
	Else
		s1 := ' ';
	end;
	s := Cur_Char;
	Ch := ASCII(s);
	Down;
	s2 := CUR_CHar;
	Up;
		IF ((Ch < 179) OR (Ch > 218) {OR ( s = '‚ïê')})
		THEN
		Text( Str_Char(St,20));  GoTo H_LIN_3;
		ELSE
			IF  (lt = 2)  then
				IF ( XPOS(s,'‚ï¶‚ï¨‚ï©‚ï§‚ï™‚ïß',1) )
				THEN  Right; GoTo H_LIN_3;
				END;
			else
				IF  (lt = 1)  then
				if ( XPOS( s,'‚ï•‚ï´‚ï®‚î¨‚îº‚î¥',1) > 0 )
				THEN  Right; GoTo H_LIN_3;
				END;
				else
					c1 :=  XPOS( s,'‚ï•‚ï´‚ï®‚î¨‚îº‚î¥‚ï¶‚ï¨‚ï©‚ï§‚ï™‚ïß',1) ;   { —Å—Ç–∏—Ä–∞–Ω–∏–µ }
					if ( c1 > 0 )
					THEN  Text(Str_Char( sv4 ,c1));  GoTo H_LIN_3;
					END;
				end;
			End;
			IF ( s = Str_Char(St,21))
			THEN Text(Str_Char(St,27));  GoTo H_LIN_3;
			END;
			IF ( s = Str_Char(St,23))
			THEN Text(Str_Char(St,28));  GoTo H_LIN_3;
			END;
			IF ( s = Str_Char(St,30))
			THEN Text(Str_Char(St,36));  GoTo H_LIN_3;
			END;
			IF ( s = Str_Char(St,32))
			THEN Text(Str_Char(St,37));  GoTo H_LIN_3;
			END;
			IF ((( XPOS(s1,verh2,1) > 0 )  AND ( XPOS(s2,niz2,1) > 0 ) ) or (s = '‚ï¢') or (s = '‚ï£'))then
				IF ( s = Str_Char(St,34))
					THEN Text(Str_Char(St,38));
					ELSE Text(Str_Char(St,35));
				END;
			GoTo H_LIN_3;
			END;
			IF ((( XPOS(s1,verh2,1) > 0 ) ) OR (s = '‚ïú') or (s = '‚ïù'))
			THEN Text( Str_Char(St,31));   GoTo H_LIN_3;
			END;
			IF ((( XPOS(s2,niz2,1) > 0 ) ) OR (s = '‚ïñ') or (s = '‚ïó'))
			THEN Text( Str_Char(St,33));   GoTo H_LIN_3;
			END;
			IF ((( XPOS(s1,verh1,1) > 0 )  AND ( XPOS(s2,niz1,1) > 0 ) ) or (s = '‚î§') or (s = '‚ï°'))then
				IF ( s = Str_Char(St,25))
					THEN Text(Str_Char(St,29));
					ELSE Text(Str_Char(St,26));
				END;
			GoTo H_LIN_3;
			END;
			IF ( (  ( XPOS(s1,verh1,1) > 0 ) ) OR (s = '‚îò') or (s = '‚ïõ'))
			THEN Text( Str_Char(St,22));   GoTo H_LIN_3;
			END;
			IF ( (  ( XPOS(s2,niz1,1) > 0 ) ) OR (s = '‚îê') or (s = '‚ïï'))
			THEN Text(Str_Char(St,24)); GoTo H_LIN_3;
			END;
			Text( Str_Char(St,20));   GoTo H_LIN_3;
		END;
H_LIN_3:
Left;
END_MA:
Ret;

{-------------- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–º --------------------}
Ris:
	WORKING;
	Refresh := 0;
	PUSH_Undo;

	IF (xx2 < xx1 ) THEN
	x1 := xx2;
	x2 := xx1;
	else
	x2 := xx2;
	x1 := xx1;
	END;

	IF (Yy2 < Yy1 ) THEN
	y1 := yy2;
	y2 := yy1;
	else
	y2 := yy2;
	y1 := yy1;
	END;

	dx := x2-x1;
	dy := y2-y1;

	GoTo_Col(x1);
	Goto_Line(y1);

	IF( x1 <> x2 ) THEN
		WHILE ( C_col <= x2) DO
			Text( r1 );
		END;
	Else Right;
	END;

	IF( y1 = y2 ) THEN goto CONE;
	END;

	IF( y1 <> y2 ) THEN
		WHILE (C_line < y2) DO
			Left; Down;
			Text( r2 );
		END;
	END;

	IF( x1 = x2 ) THEN goto CONE;
	END;

		GoTo_Col(x1);
		Goto_Line(y1+1);

	IF( y1 <> y2 ) THEN
		WHILE (C_line < y2) DO
			Text( r4 );
			Left; Down;
		END;
	END;


	IF( x1 <> x2 ) THEN
		WHILE (C_col <= x2) DO
		Text( r3 );
		END;
	END;
CONE:
	call Restor;
	Pop_Undo;
Ret;


{-- –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ --}
Restor:
	GoTo_Mark;
	GoTo_Col(x);
	Goto_Line(y);
	Refresh := 1;
	Block_Off;
	Redraw ;
Ret;
{------------------------- –∫–æ–Ω–µ—Ü –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º ----------------------------}
FINAL:
	{ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ }
Insert_mode := Mode_Insert ;
Tab_Expand := Tab_Ex;
Pop_Labels;
IF ( Mou_Installed ) THEN
	Mouse := 0;
	Mouse_Mode := Mous ;
	Mou_Disappear := M_Dis;
	Mouse := 1;
	Mou_Set_Limits(1,1, Screen_Width, Screen_Length);
END;
	{ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –±–ª–æ–∫ –µ—Å–ª–∏ –æ–Ω –±—ã–ª }
Refresh := 0;
IF ( Blo > 0 ) THEN
	Undo_stat := FALSE;
	Mark_Pos;
	GoTo_Line( Bl1 );
	GoTo_Col( Bc1 );
		if (Blo = 1) then
		Block_Begin;
		elsif(Blo = 2) then
			Col_Block_Begin;
			else
			Str_Block_Begin;
		end;
	GoTo_Line( Bl2 );
	GoTo_Col ( Bc2 );
	Block_End;
	GoTo_Mark;
	Undo_stat := TRUE;
END;
IF (Num_Lock) THEN
	{ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ Num Lock }
	dx := Peek(0,$417) OR $20;
	MEMB($417,Num_Lock);
END;
New_Screen;
Refresh := 1;
Make_message('SterniK¬∞ ‚ïë   –†–µ–∂–∏–º —Ä–∏—Å–æ–≤–∞–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω');
END_MACRO;