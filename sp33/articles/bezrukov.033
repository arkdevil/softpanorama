                                                            Н.Н.Безруков

         PIE COMMANDER - ПЕРВАЯ УДАЧНАЯ ОТЕЧЕСТВЕННАЯ ОБОЛОЧКА DOS

                   Редакции была любезно предоставлена возможность озна-
             комления  с   новой  советской   командной  оболочкой   PIE
             Commander 1.9, разработанной В.Черняком. Следует  отметить,
             что В.Черняк является одним из немногих представителей эли-
             ты системных  програмистов, работавших  на ЕС  ЭВМ, которые
             успешно переключились на IBM PC. Ниже следуют  субъективные
             заметки автора, основанные на недельном опыте  эксплуатации
             данного программного продукта в процессе подготовки данного
             выпуска Софтпанорамы.

                               ВВЕДЕНИЕ

   Степень совместимости PIE Commander 1.9 с Norton Commander 3.0 внача-
ле изумляет и даже создает впечатление реконструкции путем  дизассембли-
рования и последующей доработки. Однако дальнейший опыт работы убеждает,
что несмотря на высокую стерень совместимости по интерфейсу мы имеет де-
ло с оригинальным продуктом,  который, как мне кажется,  через несколько
версий сможет превратиться в  серьезного соперника Norton Commander,  по
меньшей мере на внутреннем советском рынке. Учитывая уход Джона Соши  из
фирмы, сроки разработки версии 4.0 Norton Commander представляются неоп-
ределенными, что создает благоприятные возможности для захвата части ры-
нка. Наш обзор мы начнем  с внешнего вида, т.е. высвечиваемых  на экране
панелей, хорошо знакомых большинству советских программистов.


                                ПАНЕЛИ

   Внешний вид панелей близок к прототипу. Правда обращает на себя  вни-
мание наличие внизу строки с  информацией о формате диска, что  особенно
полезно при чтении дискет. В отличии от NC, поддерживается до 4-х инфор-
мационных панелей (вместо 2-х).  После нескольких дней работы  автор по-
нял, что желательно иметь по одной панели на каждый используемый каталог
и не переотрывать их (теряя конфигурацию), а прятать как листы на столе.
Шаблон выбора файлов ( GRAY+/GRAY-) не общий, а индивидуальный для  каж-
дого окна. Эти шаблоны  сохраняются в файле конфигурации(вообще  говоря,
файл конфигурации СС  содержит гораздо больше  полезных сведений, чем  в
NC, что существенно упрощает работу).
   Можно управлять цветами, размерами и положением этих панелей.  Инфор-
мация о цветах сохраняется в файле конфигурации (если в панели "КОНФИГУ-
РАЦИЯ" установлена опция "Color"). Для восстановления умалчиваемых  цве-
тов Вы можете временно  выбрать опцию "Black &  White", а затем -  снова
"Color".
    Панели могут располагаться на экране произвольным образом и, в част-
ности, накладываться в частности накладываться друг на друга. При этом у
пользователей MultiEdit появляется возможность перенесения  выработанных
навыков работы с множеством панелей  и окон в командную оболочку.  Автор
использует "ращепленную на две" левую панель и две  полноразмерные пане-
ли(одна под другой) справа. Цвет панели легко связывается с ее  номером.
Для первых двух панелей сохраняются онятия "LEFT" и "RIGHT", а третяя  и
четвертая обрабатываются специальным образом.

   Наиболее важные функциональные клавиши:
   Alt-F1, Alt-F2,                     - выбор диска для панели
   Alt-1,  Alt-2, Alt-3, Alt-4           /* удачное и естественное решение */

   Ctrl-F1, Ctrl-F2, Ctrl-F3, Ctrl-F4  - включение/выключение панелей

   Ctrl-M                              - переход в режим передвижения текущей
                                         панели   /*   неудачна,   лучше
                                         что нибудь типа ScrollLock */

   Ctrl-F10                            - переход в режим раскраски    текущей
                                         панели.

      ДОПОЛНИТЕЛЬНЫЕ ВОЗМОЖНОСТИ КОРРЕКТИРОВКИ КОМАНДНОЙ СТРОКИ:

      Комбинация <CtrlIns> включает режим Overwrite. Передвижение курсо-
ра влево/вправо на символ при активном окне типа 'BRIF' может производи-
ться не  клавишами <Ctrl-S>/<Ctrl-D>,  а более  естественно -  клавишами
<ShiftLeft>/<ShiftRight>. Командная  строка высвечивается  ярким цветом.
Если командная строка не пуста,  то клавиша <ESC> вызывает ее  стирание.
Если  строка  пуста,  то  <ESC>  вызывает  те же действия, что и команда
<Ctrl-O> ( включение/выключение всех панелей)

                              СТЕК КОМАНД

    Стек команд, вызванных из PIE Commander ведется более удобно.  Запо-
минается не 10, а 20 последних команд. Стек сохраняется в файле конфигу-
рации - поэтому если у Вас включен режим автоматического сохранения сос-
тояния, последние команды не будут теряться даже при перезагрузках. Стек
ведется в соответствии с "Advanced LIFO" алгоритмом: Если введенная  ко-
манда уже имеется в стеке,  то стек сжимается ( исключая  старую команду
), а ее новая копия помещается в вершину стека. Таким образом, возле ве-
ршины стека накапливаются наиболее часто используемые команды.
    При выборе команды из режима 'History' она не выполняется  немедлен-
но, а помещается в строку ввода, где может быть исправлена перед нажати-
ем <Enter>.

                            СТЕК КАТАЛОГОВ

    Дополнительно к  стеку команд  ведется стек  (глубина 10) каталогов.
Содержимое стека выдается по <Alt-F6>. Выбор аналогичен выбору из  стека
команд, но ведет к смене каталога в текущем окне. Стек каталогов  сохра-
няется в файле конфигурации.

                           ФАЙЛ РАСШИРЕНИЙ

    Файл расширений ( CC.EXT по аналогии с NC.EXT) не имеет  ограничений
по длине и его семантика содержит ряд удачных расширений. Наиболее  важ-
ным является введенная возможность программирования различных  действий,
производимых с файлом при нажатии разных комбинаций клавиш, например:
      doc: word !.! - по нажатии <Enter> вызвать "word"
      doc# me !.!   - по нажатии <ShiftEnter> вызвать Multi Edit
      *@ copy !.! $  - по нажатии <AltEnter> скопировать файл
              в соседнюю панель /* удобно, например, для сброса на дискету
      (:,# и @  служат маркерами соответсвующей комбинации)

    Последний пример показывает, что синтаксис строк файла .EXT ("образ-
цов") также расширен:  '!%' означает имя  последнего каталога из  полного
пути текущей панели. Например:  для окна с путем  'C:\USER\SUB1' символы
'!%' будут заменены на имя 'SUB1'. 
    Кроме метасимвола '!' может  употреб-
ляться метасимвол '$', который означает то же самое, но для СОСЕДНЕЙ па-
нели. Например: *@ copy !.! $: такая комбинация позволит копировать  те-
кущий файл в соседнее окно.

    Введено понятие "локального" файла расширений по аналогии с локальным
меню: файл  "CC.EXT", расположенный  в каталоги,  обрабатывается перед
основным. 
    К сожалению, тип SUB-DIR  не введен в допустимые расширения  и
действий над каталогами задавать нельзя.

                           МЕНЮ ПОЛЬЗОВАТЕЛЯ

    Меню пользователя (CC.MNU по аналогии с NC.MNU) может иметь иерархи-
ческую структуру, с несколькими уровнями подменю: в качестве действия  в
любом пункте меню может быть указана строка вида: MENUCHAIN=имя  следую-
щего файла. Например:

     F12: Next Choice ...
          MENUCHAIN=c:\user\nxt.mnu

    Как и в Norton Commander, меню пользователя бывают локальные и глав-
ное. В строках ("образах действий") меню возможно употребление всех  ме-
тасимволов, допустимых в файлах расширений ( знаки '!' и '$' ).

    Допускается одновременное исользование  главного меню при  наличии в
текущей каталоги локального: клавишами 'Shift-F2' можно вызвать  глав-
ное меню при наличии локального.

                          ГРУППОВЫЕ ОПЕРАЦИИ

    Комбинация клавиш <ShiftIns> позволяет запомнить имена всех  выбран-
ных файлов в специальный набор данных с именем 'CC.TMP'. Имена помещают-
ся в файл по одному имени  на строке. Ряд утилит MS-DOS, например PKZIP,
могут брать имена входных файлов не из командной строки, а из файла. 
Таким образом, существенно  облегчается архивация группы  выбранных фай-
лов. Достаточно поместить в меню строку вида:

       Z: Архивация выбранных файлов в соседнее окно

          PKZIP -a $:!% @cc.tmp
                   ^  ^       ^
                   │  │       │
                   │  │       └────────  Архивировать файлы, имена
                   │  │                  которых находятся в CC.TMP
                   │  └────────────────  Имя текущей каталога в
                   │                     исходной панели.
                   └───────────────────  Имя диска в выходной панели

то для исходной панели 'C:\USER\ARCDIR' и второй панели 'A:\' эта строка
будет расширяться следующим образом:

          PKZIP -a A:\ARCDIR @cc.tmp

                         ОПЕРАЦИИ С КАТАЛОГАМИ

    Достижения в этой области несомненны, хотя само расширение не  везде
проведено  последовательено.  

    Существенно расширены операции с каталогами.  Директории
могут  быть  выбраны  (Клавишей  Ins  или  мышью);  Операции   'Copy',
'Rename/Move' и 'Delete' применим  к каталогам в той  е мере, что и  к
файлам. Для каталогов эти  операции выполняются рекурсивно. В  частности
командой 'Copy' можно скопировать целый каталог с сохранением  струк-
туры поддерева на новое место. Впрочем копирование идет медленно и автор
предпочел бы возможность использования для каталогов специального расши-
рения в файле расширений, чтобы иметь возможность вызвать команду  XCOPY
Командой Delete (F8) можно уничтожить каталог, вместе с содеращиися в нем файлами.
Во время выполнения операций 'Copy' и 'Move' на экране рисуется  динами-
ческая картина копирования, в которой виден не только процесс  копирова-
ния ТЕКУЩЕГО файла, но и ВСЕХ файлов/каталогов. Если выполняется копиро-
вание группы файлов/каталогов, то перед началом копирования проверяется,
хватит ли места  на выходном диске.  Оценка проводится приблизительно  (
без пересчета размеров кластеров ).

    В подсказке, появляющейся после выдачи команд Copy/RenMov появляются
строки, соответствующие путям от всех видимых панелей. Можно выбрать лю-
бую строку и/или нажать клавишу <F10=Tree> в любой строке.

    Существенно расширены возможности функции "сравнение каталогов". Во-
зможно сравнение двух каталогов на РАВНО, НЕ РАВНО или БОЛЬШЕ. При срав-
нении на РАВНО в обеих каталогах помечаются файлы с совпадающей  длиной,
датой, временем и атрибутами. При сравнении НЕ УЧИТЫВАЕТСЯ состояние ат-
рибута "АРХИВНЫЙ". При сравнении на БОЛЬШЕ помечаются одноименные  файлы
с БОЛЬШЕЙ датой и временем. Если дата и время совпадают, то файл помеча-
ется, если он больше по длине. Если файлы совпадают или отличаются толь-
ко атрибутами, то такие файлы не помечаются. Сравнение на БОЛЬШЕ полезно
при сравнении двух версии пакетов.

                      ВСТРОЕННЫЙ РЕДАКТОР ТЕКСТОВ

    Встроенный редактор текстов ( вызываемый по клавише F4 ) обладает на
порядок большим числом возможностей, чем редактор в Norton Commander 3.0
и, что  самое важное,  позволяет редактировать  достаточно большие файлы
(более 100К). Редактор совместим по функциональным клавишам с редактора-
ми интегрированных систем Quick C 2.х ( F1 - Help F2 - Сохранить текст в
файл F4 - Убрать  текст из окна и  начать редактировать новый файл  F5 -
Вызвать панель выбора нового файла F7 - Поиск контекста по файлу  (можно
задать дополнительные атрибуты поиска (искать слово или контекст и  др.)
F8 - Глобальная  замена контекста в  файле (можно задать  дополнительные
атрибуты поиска/замены). ESC, F10 - Окончание редактирования.  SHIFT-F10
- Сохранение текста и окончание редактирования).
    Допускается выделение фрагментов текста (как типа BLOCK, так и  STREAM)
клавишами (SHIFT-стрелки) или мышью. Нажатие Ctrl-Ins вызывает занесение
выделенного фрагмента в рабочую  область ("Clipboard"). В дальнейшем  Вы
сможете перенести текст из этой области в любое место данного (или  дру-
гого !) файла с помощью нажатия SHIFT-Ins.
    Нажатие Ctrl-Y  вызывает удаление  текущей строки.  Удаленная строка
попадает в рабочую область и может быть восстановлена. SHIFT-Del -  Уда-
ление выделенного  фрагмента с  одновременным занесением  его в "рабочую
область". Del -  Удаление текущего символа.  Bsp - Удаление  предыдущего
символа

                               ИМИТАЦИЯ МЫШИ

    PIE Commander обеспечивает имитацию мыши для программ не поддержива-
ющих это устройство. Мышь может использоваться следующим образом:
    - движение мыши аналогично нажатию клавиш-стрелок 
    - нажатие ЛЕВОЙ   кнопки соответствует нажатию клавиши <Enter>.
    - нажатие ПРАВОЙ  кнопки соответствует нажатию клавиши <Esc>.
    - нажатие  СРЕДНЕЙ кнопки  (на трехкнопочной  мыши) соответствует нажатию
      клавиши <F1>. Аналогично действует нажатие ОДНОВРЕМЕННО левой и  правой
      кнопки (на любой мыши).

    Это позволяет использовать мышь в любой команде, включая команды  MS
DOS. Например, если  Вы вызвали команду  'FORMAT', то для  подтверждения
форматирования можно нажать <Enter> или левую кнопку мыши.


                        Новые "горячие клавиши"

     Для часто используемых  режимов основного меню  введены специальные
клавиши для их быстрого вызова: Ctrl-A вызывает панель установки атрибу-
тов файла Ctrl-C вызывает панель CONFIGURATION Ctrl-F переключение  FULL
Screen ON/OFF Ctrl-T переключение соседней панели в pежим TREE и обратно
( аналогично Ctrl-L ).
     ALT-SHIFT-F4 вызывает панель для создания НОВОГО файла при помощи
внешнего редактора.
     Имеется  возможность  просмотра  на  экране информации из заголовка
".EXE" модуля. Для использования возможности можно подвести строчный ку-
рсор к файлу и нажать <Ctrl-G>.
     Упрощено  переименование  файлов   или  каталогов.  Путем   нажатия
<CtrlF6> текущая строка переключается в режим редактирования. После вне-
сения достаточно нажать <Enter> и файл будет переименован.
     Комбинация <Alt-F5>  позволяет ввести  пароль и  блокировать работу
компьютера до повторного ввода пароля. Если вызов PIE Commander  включен
в 'autoexec.bat', то разблокировка  машины становится не очень  простой.
для неквалифицированных пользователей. Если Вы забыли пароль, то для то-
го, чтобы продолжить работу Вам необходимо стереть файл 'CC.INI', в  ко-
тором сохраняется конфигурация. Для этого возможно Вам придется перезаг-
рузиться с дискеты.
     Нажатие <CtrlF9> инфертирует все выбранные файлы на текущей панели.
В частности, если  ничего не было  выбрано, то после  этой команды будет
выбрано все ! ( иногда это  быстрее, чем нажимать <GREY+ - Enter>.  Если
был выбран один файл, то после команды будет выбрано все кроме  данного.


                       ОБЛЕГЧАЮЩИЕ РАБОТУ МЕЛОЧИ

    В Norton Commander команды "SET" и/или "PATH" относятся к  вторичной
копии командного процессора и неэффективны при задании в командной стро-
ки оболочки. В PIE Commander команды "SET" и "PATH" заносятся в  таблицу
среды. После окончания PIE Commander все накопленные изменения уничтожа-
ются. Команды "SET" и/или "PATH", выданные из меню пользователя  обраба-
тываются как обычно. То же касается команд, встреченных в ".BAT" файлах,
вызванных из PIE Commander.

    Аналогично Norton Commander 3.0 командой 'SET' с переменной
'CC=' задает основной каталог оболочки.
                 set CC=C:\PIECOM

    Новый режим работы "Подсчет Размеров Директорий" позволяет постоянно
видеть на экране суммарные (рекурсивно рассчитанные) размеры  каталогов.
Для каждой директории этот размер вычисляется как сумма длин всех  внут-
ренних файлов и каталогов. Такой режим работы удобен для анализа  запол-
ненности винчестера. Подсчитанные размеры видны в поле "Size" информаци-
онных панелей. Режим сортировки панели "by Size", позволяет увидеть  са-
мые большие и самые маленькие каталоги.

    Имеется достаточно экзотическая возможность принудительно  завершить
команды вызванные в оболочке. Правда реализована она не совсем корректно.
(если это средство активизировано, то нельзя вызывать TSR-программы. Ав-
тор был неприятно удивлен этим сюрпризом, после чего отключил эту возмо-
жность в файле конфигурации. вящиеся резидентными (TSR). На время вызова
таких  программ  отключайте  средство  или  временно  выходите  из   PIE
Commander.

    Другая экзотическая возможность - "работа без звука" позволяет "при-
глушить" динамик на  время работы программ,  в которых не  предусмотрена
работа без звуковых  эффектов. К сожалению  оно функционирорует толь  ко
если включена опция "принудительное завершение команды".

    Для помеченных дисков/дискет в заголовке панели высвечиваются их ме-
тки. Высвечивание производится только в том случае, если в панели  отоб-
ражена корневой  каталог. Для  имен дисков,  переопределенных при помощи
команды SUBST в заголовке панели высвечивается истинное имя пути,  соот-
ветствующее логической букве диска. Для  всех дисков и дискет на  нижней
границе панели высвечивается ее емкость (в соответствии с физической ра-
зметкой), а также количество цилиндров (/t:xx) и количество секторов  на
дорожке (/n:xx) в форме, принятой в команде 'format'.

    Если вызванная  из командной  строки программа  осталась резидентной
(TSR), то после возврата в PIE Commander оператор получит  соответствую-
щее сообщение.

    Набор программ просмотра файлов (viewer'ы) не включается в стандартную
поставку и поставляется за отдельную ( небольшую ) плату. Если  на  вашем
компьютере используется Norton Commander 3.0, то Вы  можете  использовать
файлы 'VIEW', поставляемые с ним. Для того, чтобы PIE Commander использо-
вал эти файлы, каталог с  Norton  Commander  должна  быть  включена  в
'PATH' или описана при помощи set-переменной 'SET NC=...' или слита с ди-
ректорией PIE Commander.


                         ОТМЕЧЕННЫЕ НЕДОСТАТКИ

   1. Самым серьезным  недостатком является "монстрообразность"  и время
инициализации (частично связанное с наличием защиты от копирования). Для
AT/286 долгое завершение выполнение команды приводит к отказу от  работы
с продуктом. Использование на XT по этой причине вообще не рекомендуется

   2. Очень слабым место являются программы просмотра (вьюеры). Встроен-
ный viewer для текстовых файлов по своим возможностям значительно  усту-
пает  известному  вьюеру  LIST  (A  File  Viewing  and Browsing Utility,
Version 7.3 January  1990 (c) Copyright  Vernon D. Buerg).  Меню вьюеров
отсутствует,  хотя  логично  его  ввести.  При попытке просмотра больших
EXE-файлов зависает. 

   3. Средства работы с архивами в стандартной поставке отсутствуют, что
ведет к значительной потере привлекательности продукта (в настоящий  мо-
мент эти средства поставляются в отдельном пакете 'PIE VIEW' и  включают
вьюеры для текстовых файлов,  библиотек объектных модулей '.LIB'  и всех
видов архивных файлов ( ARC, ZIP, LZH, ICE, PAK )).

   4. Возможности переназначения функциональных клавиш в файле  конфигу-
рация не предусмотрено.

   5. Нет меню редакторов (оставлено два, что явно недостаточно). В  ре-
дакторе отсутствует транслитерация "русский/латинский" и макропоследова-
тельности клавиш.

   6. Не выдержана семантика работы  с деревом по Alt-F10. Не  совпадает
семантика F5(F6)-F10  (выдается дерево  соседней панели).  При этом  для
старших логических дисков дерево строится каждый раз (возможно ээто свя-
зано с какой-то ошибкой в логике).

   8. Отсутствует нумерация панелей, что при сложном их расположении  на
экране затрудняет работу. Операция  Zoom не реализована, а  переключение
панелей реализовано неудачно (по сравлению с MultiEdit).

   9. При копировании одиночных файлов выдается две параллельных  "инди-
катора скопированной части файла",  что несколько портит впечатление  от
этого нововведения.

   10. Нет истории  grey + (по  сообщению В.Черняка этот  недостаток уже
устранен).

   11. "Всплывающие" меню замедляют работу и отвлекают внимание. Пожалуй,
единственный случай, когда они уместны, это для различения операций COPY
и MOVE, поскольку автор,  да и наверное не  только он, часто путает  эти
клавиши при нажатии. Дополнительно желательно, чтобы эти панели  отлича-
лись по цвету, что тоже не сделано.

   12. Пакет допускает работу на 2-х языках одновременно, что  утежеляет
оболочку как минимум  на 20К. Эта  возможность никому не  нужна, и более
правильно поставлять две версии: "русскоязычную" и англоязычную".

   13. HELP сделан слабо. Контекстная зависимость не реализована.

   14. Режим работы с подсчетом размеров каталогов реализован "вчерне" и
неудобен при  нормальной работе,  т.к. размеры  высчитываются каждый раз
заново.

   15. Неудачное  название  программы  (СС),  не совпадающее с названием
PIE-COMMANDER, которое, впрочем, еще более неудачно.

                              ЗАКЛЮЧЕНИЕ

   Хотя из отмеченных недостатков большинство легко устранимы и  требуют
минимальной доработки (а часть уже устранена в версии 2.0, поскольку они
были сообщены В.Черняку по телефону), данный продукт является  серьезной
"заявкой на победу" на внутреннем рынке. Единственным принципиальным не-
достатком является "монстрообразность" и значительное время  инициализа-
ции. Учитывая распространенность незаконных копий Norton Commander  мно-
гие организации предпочтут перейти на данный продукт хотя бы из  сообра-
жений "более честного" использования программ. При этом судьба  продукта
во многом зависит от установленной на продукт цены. Автору представляет-
ся оптимальной цена порядка  25 руб. для индивидуальных  пользователей и
250-500 руб. для организаций (в форме годовой подписки на все  последую-
щие версии). В этом случае возможны массовые продажи, приносящие сущест-
венный доход, несмотря на низкую цену единичного экземпляра продукта.

   Наличие защиты от копирования несколько снижает потребительские свой-
ства изделия (переразметка диска или смена дискового драйвера становится
невозможной) и, возможно, от нее следует отказаться. Возможность копиро-
вания инсталляционных  дискет CERBERUS  делает данную  защиту защитой от
честных людей. Кроме того несмотря  на вязкость защиты она, как  и любая
число программная  защита, вполне  "проходима" при  наличии минимального
оборудования (AT/386), программных средств (Desqview, Turbo Dеbug) и те-
рпения, которые при  цене 1000 руб.  за экземпляр наверное  найдутся. По
крайней мере бы автор не  рискнул назначать 1000 руб. в  качестве премии
за взлом CERBERUS.

