     Описание  принципов  использования  антивирусной   программы
     ------------------------------------------------------------
ANTI-KOT версии 3.51.
--------------------

     Дополнено 18 декабря 1989 г.

     Содержание:
     -----------

 I.  Инструкция оператору по применению программы ANTI-KOT.
        1. Запуск программы.
        2. Выбор параметров при помощи меню.
        3. Поиск зараженных файлов.
        4. Поиск резидентных вирусов в оперативной памяти.
        5. Задание параметров программе ANTI-KOT.
        Приложение.

 II. Инструкция системному программисту по применению ANTI-KOT.
        1. Вирус RESTART.
        2. Вирус LETTERS.
        3. Вирус TIME.
        4. Вирус VACSINA.
        5. Вирус NEWW (MUSIC).
        6. Вирус SOFIA.
        7. Вирус MICRO88.
        Оперативная информация.



     Инструкция оператору по применению программы ANTI-KOT.
     ------------------------------------------------------

     1. Запуск программы.
     --------------------

     Антивирусную программу  ANTI-KOT можно  вызвать из  системы,
набрав на клавиатуре:

     ANTI-KOT и нажав клавишу  "Enter".

     2. Выбор параметров при помощи меню.
     ------------------------------------

     При  запуске  программы  ANTI-KOT  без  параметров на экране
будет высвечено следующее меню:

+----------------------------------------------------------------------------+

                   Антивирусная программа ANTI-KOT, версия 3.5

╔═════════════════════════════════════════════════════════════════════════════╗
║ Введите имя диска:                                                    [D  ] ║
╟─────────────────────────────────────────────────────────────────────────────╢
║ Введите имя подкаталога для поиска зараженных файлов:                       ║
║                                                                       [:\ ] ║
╟─────────────────────────────────────────────────────────────────────────────╢
║ Осуществлять поиск в подкаталогах (Y/N)?:                             [Yes] ║
╟─────────────────────────────────────────────────────────────────────────────╢
║ Отключить звуковое сопровождение (Y/N)?:                              [No ] ║
╟─────────────────────────────────────────────────────────────────────────────╢
║ Включить расширенные функции (Y/N)?:                                  [No ] ║
╚═════════════════════════════════════════════════════════════════════════════╝


Нажмите <пробел> для начала поиска или <ESC> для выхода
+------------------------------------------------------------------------------+

     Очевидно,  что  все  пункты  данного  меню  за   исключением
последнего  не  нуждаются  в  комментариях. При выборе последнего
пункта на экране появляется следующее меню:

+------------------------------------------------------------------------------+
. . .
╔═════════════════════════════════════════════════════════════════════════╗
║  Введите имя диска и подкаталога для служебных файлов:            [D  ] ║
║                                                                         ║
║                                                               [:\TP4\ ] ║
╟─────────────────────────────────────────────────────────────────────────╢
║  Взять перечень подкаталогов из файла ANTI-KOT.CFG (Y/N)?:        [No ] ║
╟─────────────────────────────────────────────────────────────────────────╢
║  Поиск новых типов вирусов (Y/N)?:                                [No ] ║
╟─────────────────────────────────────────────────────────────────────────╢
║  Поиск вирусов только в файлах .COM и .EXE (Y/N)?:                [Yes] ║
╟─────────────────────────────────────────────────────────────────────────╢
║  Контроль длин файлов (Y/N)?:                                     [No ] ║
╟─────────────────────────────────────────────────────────────────────────╢
║  Обновить таблицы длин файлов (Y/N)?:                             [No ] ║
╚═════════════════════════════════════════════════════════════════════════╝
. . .
+------------------------------------------------------------------------------+

     - имя  диска и  подкаталога для  служебных файлов определяют
подкаталог,   в   котором   будут   открываться  служебные  файлы
ANTI-KOT.CFG,  ANTI-KOT.LOG,   ANTI-KOT.CHK.  Первоначально   (по
умолчанию)  устанавливается  тот  подкаталог,  в котором хранится
сама  программа  ANTI-KOT.EXE.  Если  в  процессе  работы  у  Вас
появится необходимость изменить  даннный подкаталог, то  имейте в
виду, что будут закрыты все служебные файлы.

     - использование перечня  подкаталогов из файла  ANTI-KOT.CFG
обьяснено в п.5 (см ниже).

     -  режим  поиска  новых  типов  вирусов  выводит специальную
информацию в служебный файл ANTI-KOT.LOG. Пример такого файла:

Program start:  From EOF:  Program name:
E800005B81EBD4      1392   E:\T\ANTI1700.EXE
E800005B81EBD4      1392   E:\T\XCOPY.EXE
E800005B81EBD4       880   E:\T\COM.COM
E800005B81EBD4       880   E:\T\DEBUG.COM
FAFC2E8916F202       954   C:\IBMDOS.COM

     В третьей колонке перечислены имена подозреваемых файлов,  в
первой  -  команды,  с  который  начинается  данная программа, во
второй - длина в байтах,  на которую начало программы отстоит  от
конца  файла.  В  данном  примере  четыре  первых  файла заражены
некоторым вирусом. Действительно, все четыре программы начинаются
совершенно одинаково, и их начало отстоит на одинаковую  величину
от конца файла для файлов 1 и 2, 3 и 4 (.EXE 1392 и .COM 880).

     Файл IBMBIO.COM попадает в этот список всегда. Как  правило,
при  поиске  на  целом  винчестере  список  подозреваемых  файлов
колеблется от 10 до 20. Только полное совпадение первой колонки у
ряда  файлов  дает  основания  думать,  что  на  Вашем компьютере
завелся новый вирус.

     Не  стоит  ожидать,  что  все  программы с переходом в конец
будут занесены в этот список. Так, например, в список не  попадут
файлы небольшой длины (до 8K), некоторые программы, написанные на
языке С, программы созданные в Turbo Pascal 3 и некоторые другие.

     -  при  отключенном  режиме  поиска  "только в файлах .EXE и
.COM", поиск будет производится в файлах с любыми расширениями.

     - при задании режима  контроля длин файлов делается  попытка
открытия  файла  ANTI-KOT.CHK.  Если  такой  файл отсутствует, то
контроль не  может быть  произведен до  того момента,  пока Вы не
создадите  этот  файл  включением  следующей функции - обновления
таблиц контроля  длин файлов.  При создании  таких таблиц  в файл
ANTI-KOT.CHK будет выведена информация только о тех подкаталогах,
поиск  в  которых  Вы  осуществите.  Так,  если Вы задали поиск в
корневом подкаталоге  диска С:   без  просмотра подкаталогов,  то
файл ANTI-KOT.CHK может быть следующего содержания:

****** C:\
 22100 IBMBIO.COM
 30159 IBMDOS.COM
 25307 COMMAND.COM
  1706 DOSEDIT.COM

     Контроль длин файлов работает таким образом, что не выдается
сообщений об отсутствии файлов  или появлении новых, в  частности
какие бы диски и подкаталоги Вы не проверяли при содержимом файла
ANTI-KOT.CHK,  показанном  выше,  предупреждающие сообщения будут
выводится только в том случае, если изменилась длина именно  этих
четырех файлов. Например:

+------------------------------------------------------------------------------+
. . .
C:\COMMAND.COM
Старая длина -  25307
Новая  длина -  28212

Изменена длина файла. Нажмите любую клавишу . . .

+------------------------------------------------------------------------------+

     Для  контроля  длин  файлов  я  советую  один  раз составить
таблицы  для   всех  дисков   и  проводить   обновление  по  мере
необходимости,  причем  обновление  можно  проводить по отдельным
подкаталогам и информация о них будет вставлена в соответствующее
место файла ANTI-KOT.CHK. Это справедливо и для вновь создаваемых
подкаталогов.

     3. Поиск зараженных файлов.
     ---------------------------


     При запуске  антивирус будет  сканировать все  поддиректории
текущего  диска  (того,  с  которого  антивирус  запущен) с целью
поиска зараженных или испорченных файлов.


     На экране дисплея будут высвечены следующие сообщения:

+----------------------------------------------------------------------------+

                   Антивирусная программа ANTI-KOT, версия 3.5


    ╔══╦══════════╦═══════════════════════╦════════════╦════════════════════╗
    ║nn║ Название ║         Обьект        ║    Длина   ║      Лечение       ║
    ║  ║  вируса  ║       заражения       ║   вируса   ║                    ║
    ╠══╬══════════╬═══════════════════════╬════════════╬════════════════════╣
    ║ 1║  RESTART ║     COM файлы         ║     648    ║    файлы           ║
    ║ 2║  LETTERS ║     COM файлы, память ║    1701    ║    файлы, память   ║
    ║ 3║  TIME    ║ EXE-COM файлы, память ║ 1813..1828 ║    файлы, память   ║
    ║ 4║  VACSINA ║ EXE-COM файлы, память ║ 1339..1354 ║    файлы, память   ║
    ║ 5║  MUSIC   ║ EXE-COM файлы, память ║ 2568..2968 ║    файлы           ║
    ║ 6║  SOFIA   ║ EXE-COM файлы, память ║ 1800..1815 ║    файлы, память   ║
    ║ 7║  MICRO88 ║     COM файлы         ║     531    ║    файлы           ║
    ║ 8║  BOOT    ║ BOOT-сектор  , память ║ 2 сектора  ║    диск , память   ║
    ╚══╩══════════╩═══════════════════════╩════════════╩════════════════════╝


D:\TP4\COMP.COM


"Для выхода нажмите <ESC>"
+------------------------------------------------------------------------------+

     При обнаружении зараженного файла Вам предлагается  ответить
утвердительно (Y) или отрицательно  (N) на вопрос о  небходимости
восстановить файл:

     "Восстанавливать файл (Y/N) ?"

     При  утвердительном  ответе  на  данный  вопрос  Вам   будет
предложено установить дистрибутивную дискету в дисковод "A":

     "Вставьте в дисковод А дистрибутивную дискету ANTI-KOT."
     "Нажмите любую клавишу . . ."

  После того, как Вы вставите дистрибутивную дискету и нажмете
любую клавишу, на экран будет выдано сообщение:

     "Верификация успешно проведена!"
     "Можно изьять дискету из дисковода. Нажмите любую клавишу ..."

     Нажмите любую клавишу и  зараженный файл будет излечен.  При
лечении  других  зараженных  файлов  нет  необходимости вставлять
каждый раз дистрибутивную дискету, верификация проводится только
один раз на запуск программы ANTI-KOT.

     За один вызов  антивирусной программы возможна  проверка на
наличие вирусов нескольких дискет или винчестерных накопителей.

     Если верификация дистрибутивной дискеты проведена неудачно,
то на экран будет выдано сообщение:


      "Дискета не является оригинальной. Возможен только поиск
       зараженных файлов."
      "Лечение невозможно! Нажмите любую клавишу . . ."


     В данном  случае антивирус  будет предлагать  только стирать
зараженные файлы, но не лечить  их. Если Вы нажали на  клавишу по
ошибке  или  случайно  вставили  другую  дискету,  то  Вы можете
прервать работу программы  одновременным нажатием клавиш  <CTL> и
<BREAK> и запустить ANTI-KOT заново.


     При  обнаружении  испорченного  файла  (см.  описание вируса
RESTART во  второй части  руководства) Вам  предлагается ответить
утвердительно (Y) или отрицательно  (N) на вопрос о  небходимости
стереть файл:

     "Стеpеть  (Y/N) ? "

     При обнаружении  файла, недолеченного  пpогpаммой ANTI  (см.
описание  вируса  RESTART  во  второй  части  руководства),   Вам
предлагается ответить утвердительно  (Y) или отрицательно  (N) на
вопрос о небходимости исправить файл:

     "Долечивать файл (Y/N) ? "

     По  окончании  проверки  запрошенных  поддиректорий диска на
экран будет выдано одно из следующих трех сообщениий:

     "На диске A: пеpечисленных файлов не найдено. Нажмите любую
      клавишу . . ."

     "Под вылеченными вирусами могут быть другие; повторить
     процедуру (Y/N)?"

     "На диске A: больше зараженных файлов не найдено. Нажмите
      любую клавишу . . ."

     Если Вы получили второе сообщение, то лучше на него ответить
утвердительно. После вторичной и других (в случае  неоднократного
заражения) проверок Вы получите третье сообщение.

     Внимание!
     ---------

     При   лечении  файлов  на  дискетах  необходимо помнить, что
дискеты  не должны  быть заклеены. При  лечении файлов на  дисках
типа  "винчестер"  надо  быть  уверенным,  что они не защищены от
записи.

     Пример:
     -------

     Предположим,  что  ANTI-KOT  находится  в директории ANTI на
диске  C:    и  Вам  необходимо  проверить  на  наличие   вирусов
принесенную  из другой организации дискету. Пусть на  проверяемой
дискете   находятся  два  зараженных  файла  - один вирусом TIME,
другой вирусом RESTART.

     1. Вставьте в дисковод "A" проверяемую дискету.

     2. Перейдите в директорию C:\ANTI.

     3.  Наберите  на  клавиатуре  ANTI-KOT  и  нажмите   клавишу
"Enter".

     4.  При  обнаружении  первого  зараженного файла будет выдан
звуковой  сигнал,   а  на   экран  дисплея   будет  выведено  имя
зараженного файла и выданы сообщения:

     "Этот файл заpажен виpусом TIME"
     "Восстанавливать файл (Y/N) ?"

     5.  Вы  нажимаете  на  клавишу  "Y"  и  получаете  следующее
собщения:

     "Вставьте в дисковод А дистрибутивную дискету ANTI-KOT."
     "Нажмите любую клавишу . . ."

     6.  Изымите  из  дисковода  А проверяемую дискету, вставьте
дистрибутивную  и   нажмите  любую   клавишу.  После   проведения
верификации на экран будут выданы сообщения:

     "Верификация успешно проведена!"
     "Можно изьять дискету из дисковода. Нажмите любую клавишу ..."

     7. Изымите из дисковода А дистрибутивную дискету,  вставьте
проверяемую и нажмите произвольную клавишу.

     8.  Излечивание  зараженного  файла  сопровождается звуковым
сигналом и затем продолжается поиск других зараженных файлов.

     9.  При  обнаружении  второго  зараженного файла будет выдан
звуковой  сигнал,   а  на   экран  дисплея   будет  выведено  имя
зараженного файла и выданы сообщения:

     "Этот файл заpажен виpусом RESTART"
     "Восстанавливать файл (Y/N) ?"

     10. Для проведения лечения нажмите на клавишу "Y".

     11.  Излечивание  зараженного  файла сопровождается звуковым
сигналом и затем продолжается поиск других зараженных файлов.



     4. Поиск резидентных вирусов в оперативной памяти.
     --------------------------------------------------

     При  запуске  программы  ANTI-KOT  будет проведена проверка,
находятся ли в  оперативной памяти Вашего  компьютера резидентные
вирусы. При обнаружении резидентного вируса будет выдано одно  из
сообщений (возможно, что и одно за другим):

     'В оперативной памяти обнаружен вирус LETTERS,'
     'В оперативной памяти обнаружен вирус VACSINA,'
     'В оперативной памяти обнаружен вирус TIME,'
     'В оперативной памяти обнаружен вирус SOFIA,'
     'В оперативной памяти обнаружен вирус BOOT,'
     'В оперативной памяти обнаружен вирус MUSIC,'

     а затем одно из сообщений:

     "Нейтрализовать распространение вируса (Y/N) ?"
     "Нейтрализовать замедлениe (Y/N) ?"
     "Нейтрализовать осыпание букв (Y/N) ?"

     При отрицательном ответе на вопрос о распространение  вируса
выдается сообщение:

     "После проверки файлов необходима перезагрузка . . . "

     После этого будет осуществлен поиск зараженных файлов.

     Подробнее   о   резидентных   вирусах   см.   в   инструкции
программисту.

     5. Задание параметров программе ANTI-KOT.
     -----------------------------------------

     В качестве параметров программе можно задавать:

     [<путь>] [/L] [/C] [/S-]

     1. В  качестве параметра  [<путь>] программе  можно задавать
имя подкаталога:  "ANTI-KOT D:\DOS" или "ANTI-KOT A:".

     2. В  качестве параметра  можно задавать  "/L" для  проверки
текущей   поддиректории   без   ее   подуровней.  Предпочтительно
пользоваться этим параметром при проверке отдельного подкаталога,
так как  при запуске  программы через  меню пришлось  бы набивать
вручную имя подкаталога, которое часто бывает длинным.


     3. В  качестве параметра  можно задавать  "/C" для  проверки
ограниченного  списка  поддиректорий.  Поддиректории  должны быть
внесены в файл с именем ANTI-KOT.CFG. Например:

     c:\
     d:\
     d:\dos\

     Если файл ANTI-KOT.CFG не найден, то выдается сообщение:

     "file ANTI-KOT.CFG not found"


     4. При одновременном  задании параметров [<путь>]  [L/] [/C]
параметр [/C] имеет самый высокий преоритет;

     5. В  качестве параметра  можно задавать  параметр "/S-" для
отключения звукового сопровождения;


     Примеры:

     ANTI-KOT  /S-   /L  -   проверка  текущей   поддиректории  с
отключенным звуковым сигналом;

     ANTI-KOT /C - проверка поддиректорий, перечисленных в  файле
конфигурации ANTI-KOT.CFG;


     Приложение:
     -----------

     Ниже  приводится   полный  перечень   сообщений,  выдаваемых
ANTI-KOT (по состоянию на октябрь 1989):


'Вставьте в дисковод А дистрибутивную дискету ANTI-KOT.'
'Нажмите любую клавишу . . .'
'Дискета не является оригинальной. Возможен только поиск зараженных файлов.'
'Лечение невозможно! Нажмите любую клавишу . . .'
'Верификация успешно проведена!'
'Можно изьять дискету из дисковода. Нажмите любую клавишу . . .'

'В оперативной памяти обнаружен вирус LETTERS,'
'В оперативной памяти обнаружен вирус VACSINA,'
'В оперативной памяти обнаружен вирус TIME,'
'В оперативной памяти обнаружен вирус SOFIA,'
'В оперативной памяти обнаружен вирус BOOT,'
'Нейтрализовать вирус (Y/N) ? '
'После проверки файлов необходима перезагрузка . . . '
'Нейтрализовать распространение вируса (Y/N) ? '
'Нейтрализовать замедлениe (Y/N) ? '
'Без нейтрализации лечение невозможно (см. ANTI-KOT.LST) . . .'
'Нейтрализовать осыпание букв (Y/N) ? '
'Для выхода нажмите <ESC> '
' пеpечисленных файлов не найдено. Нажмите любую клавишу . . .'
'Под вылеченными вирусами могут быть другие; повторить процедуру (Y/N)?'
' больше зараженных файлов не найдено. Нажмите любую клавишу . . .'
'Диск заражен вирусом BOOT,'
'Восстанавливать BOOT-сектор (Y/N) ? '
'Восстанавливать FAT (Y/N) ? '
'Вставьте проверяемую дискету.'

'              Использование пpедохpанительных сpедств   '
'            позволит Вам избежать многих непpиятностей! '
'              Котик Олег.  Тел. 227-00-04, доб. 25-20   '
'                         19 октября 1989                '
'Kлавиши для редактирования "->" "<-" "Del" "Back" "End" "Home" "^Y"'
'Внимание: поле подкаталога будет проигнорировано. Нажмите любую клавишу . . .'
'Нажмите <пробел> для начала поиска или <ESC> для выхода'
'Файл ANTI-KOT.CFG не найден. Нажмите любую клавишу . . .'
'Антивирусная программа ANTI-KOT, версия 3.4'
'Введите имя подкаталога для поиска зараженных файлов:'
'Введите имя диска:'
'Осуществлять поиск в подкаталогах (Y/N)?:'
'Использовать перечень подкаталогов из файла  ANTI-KOT.CFG (Y/N)?:'
'Отключить звуковое сопровождение (Y/N)?:'
'Включить поиск новых типов вирусов (Y/N)?:'
'Завершается только при выходе из программы. Нажмите любую клавишу . . .'
'Для сбора информации открыт файл ANTI-KOT.LOG. Нажмите любую клавишу . . .'
'Ошибка открытия файла ANTI-KOT.LOG. Нажмите любую клавишу . . .'
'Поиск вирусов только в файлах .COM и .EXE (Y/N)?:'
'Неверное имя подкаталога '
'Нажмите любую клавишу . . .'

'ANTI-KOT version 3.4.'
'Автор: Котик Олег.  Тел. 227-00-04, доб. 25-20.'
'Использование:  '
'где:'
'<path> - имя подкаталога для поиска зараженных файлов;'
'/L     - поиск только в одном уровне подкаталога; '
'/C     - использование файла ANTI-KOT.CFG с перечнем подкаталогов;'
'/S-    - отключение звукового сопровождения;'
'Пример:  ANTI-KOT c:\dos /L /S-'
'Стеpеть файл (Y/N) ? '

'Вставьте дискету с файлом '
'Этот файл заpажен виpусом RESTART,'
'Этот файл испоpчен виpусом RESTART,'
'Этот файл испоpчен пpогpаммой ANTI, его можно только удалить,'
'Этот файл недолечен пpогpаммой ANTI, в нем осталось тело виpуса RESTART,'
'Этот файл заpажен виpусом LETTERS,'
'Этот файл заpажен виpусом TIME,'
'Этот файл заpажен виpусом VACSINA,'
'Этот файл заpажен виpусом MUSIC,'
'Этот файл заpажен виpусом SOFIA,'
'Этот файл заpажен виpусом MICRO88,'
'Этот файл содержит тело мертвого виpуса LETTERS,'
'Файл защищен от записи. Нажмите любую клавишу . . .'
'Восстанавливать файл (Y/N) ? '
'Долечивать файл (Y/N) ? '
'Закончить проверку диска '
'Ошибка открытия файла. '
'Файл ANTI-KOT.CFG не найден. Нажмите любую клавишу . . .'
'Ошибка чтения сектора. '
'Ошибка записи сектора. '
'Ошибка чтения FAT. '
'Ошибка чтения файла. '
'Файл защищен от записи.'
'Дискета защищена от записи.'









     Инструкция системному программисту по применению программы
     ----------------------------------------------------------
                            ANTI-KOT.
                            ---------

     Краткое описание обнаруживаеммых вирусов.
     -----------------------------------------

     1. Вирус RESTART.
     ----------------------

     Данный вирус  при запуске  зараженной им  программы вызывает
переход системы на адрес перезагрузки (адрес F000:FFF0 BIOS). При
этом  если  на  машине  был  поражен  файл  "COMMAND.COM", то при
попытке загрузки машина входит в бесконечный цикл. В этом  случае
загрузка может быть произведена только с дискеты.

     По данному вирусу необходимо отметить, что:

     - длина его составляет 648 байт;

     - заражает он файлы с расширением "COM";

     - вирус внедряется в конец заражаемой программы, а в  начало
программы прописывается переход на начало вируса. При этом внутри
тела вируса  запоминаются первые  три байта  заражаемой программы
для того, чтобы была возможность восстановить их впоследствии;

     -  при  каждом   запуске  зараженной  программы   управление
передается  на  начало  вируса,  вирус  отрабатывает  один   раз,
восстанавливает начало файла  в таком виде,  в каком оно  было до
внедрения вируса и передает управление снова на начало файла,  то
есть запускает программу, в теле которой свил себе гнездо;

     - в зависимости от текущего показания системных часов  вирус
либо заражает другие программы (это происходит в среднем в каждых
семи  случаях  из  восьми  запусков  зараженной  программы), либо
портит программу путем того, что прописывает в ее начало  переход
на перезагрузку;

     - зараженные или  испорченные программы вирус  помечает тем,
что устанавливает секунды во  времени создания файла в  "FFFF", в
дальнейшем эти файлы вирус  не трогает. В некоторых  организациях
на основе этого факта строили антивирусную профилактику - у  всех
файлов типа "COM" проставляли такие же секунды;

     -  вирус  заражает  или   портит  файлы  только  в   текущей
поддиректории и  в тех,  которые указаны  в системной  переменной
"PATH". Поэтому  в качестве  простейшей защиты  от данного вируса
может быть рекомендовано, например, при работе с чужой  дискетой,
снятие path с винчестера и запуск программ при текущем устройстве
"А:";


     2. Вирус LETTERS.
     -----------------------

     Он характеризуется тем,  что в определенные  моменты времени
клавиатура отключается  от системы  и на  экране можно  наблюдать
следующую   картину:      случайно   выбранные  на  экране  буквы
перемещаются сверху  вниз со  своих первоначальных  мест до самой
нижней  строки  или  до  того  места,  которое  уже занято другой
буквой. Процесс осыпания букв будет продолжаться до тех пор, пока
все  буквы  не  окажутся  в  нижних  строках.  Прежде, чем упадет
последняя  буква,  пользователь  не  сможет  получить  управление
системой. Функция включения этого визуального эффекта  достаточно
сложна, мне не удавалось ее вызвать  по заказу, и я не знаю,  что
будет происходить в графическом режиме.

     По данному вирусу необходимо отметить, что:

     - длина его составляет 1704 байта;

     - заражает он файлы с расширением "COM";

     - механизм распространения отличается от вируса перезагрузки
тем, что вирус  остается резидентным в  памяти и заражает  файлы,
которые  загружаются  в  память  для  исполнения.  В связи с этим
распространена  ошибка,  при  которой  вылечиваются  все файлы на
диске, но не производится перезагрузка машины и появляются  новые
зараженные программы;

     - механизм распространения похож на вирус перезагрузки  тем,
что данный вирус так же переносит себя в конец заражаемого  файла
и  так  же  сохраняет  внутри  себя  первые  байты   оригинальной
программы.   Вирус   хранится   в   закодированном   (посредством
логической  функции  XOR)  виде,  поэтому  в  теле  вируса нельзя
визуально найти исходные три байта;

     - вирус прячется при загрузке в память, то есть его не видно
в  памяти  системы  при  вызове  таких  программ, как VTSR, SMAP,
MAPMEM и  др. Достигается  это за  счет того,  что вирус сдвигает
загруженную  в  память  программу-разносчик,  образуя  в адресном
пространстве нечто  вроде пустого  окна, переписывает  себя в это
окно, становясь при этом незаметным для системы;

     - насколько я помню, вирус активизируется (в смысле осыпания
букв, но не распространения) только в том случае, если  системная
дата установлена между октябрем и декабрем 1988 года.

     3. Вирус TIME.
     --------------

     Вирус характеризуется тем,  что через несколько  минут после
запуска зараженной программы сильно  замедляет работу машины и  в
нижней  левой  половине  экрана  рисует прямоугольник. Замедление
обуславливается тем,  что вирус  "садится" на  прерывание 08h (по
таймеру)  и  при  каждом  прерывании  циклится  вхолостую, этим и
замедляя   процесс   процесс   работы  компьютера.  Прямоугольник
появляется  из-за  того,  что  вирусом  выдается прерывание 10h с
функцией "скроллинга" участка экрана.

     По данному вирусу необходимо отметить, что:

     - длина его составляет 1808 байт;

     -  заражает  он  как  файлы  с  расширением  "COM",  так и с
расширением "EXE";

     -  не заражает  файл "COMMAND.COM";

     -  механизм  размножения  вируса  основан  на том, что вирус
остается резидентным в памяти, занимая прерывание 21. При попытке
запуска  некоторой  программы  через  функцию 4В 21-го прерывания
вирус делает попытку переселиться в эту программу;

     - при заражении .COM файла вирус садится в начало файла,  то
есть записывает себя в начало, а уже после себя переписывает тело
заражаемой программы, в самый конец файла помещает  дополнительно
следующие пять байт:  "MsDos". Именно эти байты позволят вирусу в
дальнейшем отличать зараженные файлы от чистых;

     - при заражении .EXE файлов вирус переписывает себя в  конец
программы и  исправляет заголовок  EXE файла  (EXE File  Header),
запоминая  некоторые  переменные  внутри  себя.  При этом в конец
файла не  дописывается "MsDos",  и по  этой причине  одна и та же
программа ".EXE" может быть заражена не один раз. Антивирус может
не только находить зараженные  ".EXE"-файлы, но и вылечивать  их.
Однако  здесь  есть  один тонкий  момент. Вирус прописывает новую
контрольную сумму, а именно "1984", не сохраняя при этом  старую.
Я не знаю, где используется контрольная сумма, файлы  запускаются
вне зависимости от ее значения. Возможно, она применяется  только
для диагностики, но так или иначе, исходное значение  контрольной
суммы восстановить невозможно.

     - если системная дата  на Вашем компьютере выставлена  на 13
число  и  день  недели  -  пятница,  то  действие  вируса немного
изменяется - он будет не заражать файлы, а стирать их;

     - вирус  прячется при  загрузке в  память аналогично  вирусу
падающих букв;

     -  ANTI-KOT  определяет,  находится  ли в оператавной памяти
резидентная    часть    вируса    замедления.

     Вам предлагается нейтрализовать  вирус , в  противном случае
Вам будет предложено сделать перезагрузку. Нейтрализация  состоит
в том, что хотя вирус и  остается в памяти, он не может  заражать
запускаемые  программы.  При  возможности  также   нейтрализуется
прерывание по таймеру (int 8).


     4. Вирус VACSINA.
     -----------------

     - длина вируса составляет 1339 (53Bh) байт;

     - вирус садится как в .EXE, так и в .COM файлы;

     - аналогично вирусам падающих букв и замедления данный вирус
остается резидентным в памяти, занимая прерывание 21;

     - вирус  не прячется при  загрузке в  память;

     -  при  заражении  .COM  файлов  вирус  дописывается в конец
заражаемой программы, изменяя первые  три байта программы по  уже
известному алгоритму (см. вирус перезагрузки или падающих  букв).
При заражении файла его длина увеличивается до значения, кратного
16,  поэтому  при   лечении  недостаточно  укорачивать   файл  на
стандартную величину - исходная длина файла должна быть извлечена
из тела вируса;

     -  в  конце  тела  вируса  хранятся  байты 7Ah, F4h, 10h, по
которым  сам   вирус  определяет,   что  файл   уже  заражен,   и
впоследствии его не трогает;

     - при заражении EXE файлов в начало программы  прописывается
переход  на  тело  вируса,  которое  дописывается  в конец. Таким
образом,  файл  практически  перестает  быть  EXE  файлом  и  при
исполнении в  системе загружается  как COM  файл. Напомню,  что в
любом EXE  файле в  первых двух  байтах должно  стоять 4Dh и 5Ah.
Тело вируса для EXE файла отличается от тела вируса для COM файла
и  имеет  длину  132(84h)  байт  и  его действие заключается не в
распространении  вируса,  а  только  в  настройке  загруженного в
память файла и  передаче на него  управления. Для лечения  такого
файла  достаточно   восстановить  первые   три  байта   с  учетом
первоначальной длины файла и укоротить файл на 132 байта;

     - если EXE файл требует не всю свободную память системы  (не
равна  FFFF  переменная  MaxMem  в  ExeHeader), то вирус не будет
заражать такой файл;

     -  вирус  не  заражает  файлы,  размер  которых больше 64К и
размер которых превысил бы 64К при заражении;

     - при  заражении EXE  файла файл  уже практически  перестает
быть  EXE-файлом,  поэтому   возможно  его  вторичное   заражение
вирусом, но уже как файла COM;

     - чтобы быть точным необходимо добавить, что VACSINA  скорее
всего  создавалась  действительно  как  вакцина  против  вирусов,
однако дело не обошлось без ошибки. Техническая ошибка состоит  в
том, что после вакцинирования .EXE файла 132-байтным  настроечным
модулем возможно дописывание в файл основного куска длиной  1339.
Тактическая же ошибка в том, что после вакцинирования .EXE  файла
некоторые из  тех вирусов,  которые раньше  заражали только  .COM
файлы теперь  могут заражать  и вакцинированные  .EXE файлы. Этот
факт будет более понятен, если напомнить, что файл с  расширением
.EXE, не имеющий первых двух байт 4Dh и 5Ah, фактически  работает
как файл типа .COM.

     5. Вирус NEWW (MUSIC).
     ----------------------

     - длина вируса составляет 2885 байт;

     - вирус садится как в .EXE, так и в .COM файлы;

     -  вирус  тяжело  поддается  изучению  по  причине того, что
написан  на  языке  высокого  уровня  с  многочисленными вызовами
подпрограмм и  работой со  стеком. Поэтому  на сегодня  я не могу
предложить  исчерпывающей  информации  о  нем,  но  кое-что можно
отметить;

     - вирус  остается резидентным  в памяти,  занимая прерывания
21h и 1Ch;

     - занимая прерывание 1Ch, вирус контролирует прерывания 1h и
3h, а  также содержит  процедуру игры  мелодии в  5 часов вечера.
Контроль прерываний состоит в  том, что пока процедуры  обработки
этих прерываний состоят из одной команды возврата из  прерывания,
никаких действий вирусом не производиться, но стоит Вам загрузить
программу, модифицирующую данные прерывания (например  отладчик),
как  вирус  установит  для  них  собственные процедуры обработки.
Основной целью перехвата управления при обработке прерываний 1h и
3h является проверка, не  призошли ли эти прерывания  из кодового
сегмента, равного сегменту загрузки в память резидентного вируса.
Если  это  так,  то  это  означает, что кто-то пытается посмотеть
работу  вируса  под  отладчиком,  и  в  ответ  на  это вызывается
специальная процедура восстановления кода вируса, чем прерывается
работа отладчика;

     - при попытке  загрузки зараженной программы  под отладчиком
вирус в этом файле  уничтожается. Последнее основывается на  том,
что  резидентная   часть  вируса   отслеживает  момент   загрузки
программы в память без  исполнения (см. функцию 4Bh  со значением
регистра  AH=03  прерывания  21h),  и  если  в  память  загружают
зараженную программу, вирус сам излечивает ее;

     -  при  нейтрализации  вируса  в  памяти  Вы вправе ответить
отрицательно    на    вопрос    о    необходимости    прекращения
распространения вируса (речь  идет о прерывании  21h) и при  этом
ответить положительно на вопрос об отключении мелодии (прерывание
1Ch). В данном случае отключение мелодии не произойдет по причине
того, что вызов любой программы приведет к выполнению  прерывания
21h, которое Вы  отказались модифицировать, и  сработает механизм
восстановления кода вируса, в частности прерывания 1Ch;

     - в конце ноября  были обнаружены модификации вируса  MUSIC,
структура   которых   несколько   отличается  от  первоначального
варианта. В частности, обнаружены модификации вируса длиной  2568
и 2928 (A08h  и B70h). Кроме  отличий в длине  заметны внутренние
изменения в вирусах, что, вообще говоря, наталкивает на мысль  об
отечественном  происхождении  MUSIC.  При  обнаружении  вируса  в
оперативной памяти или в  зараженных файлах ANTI-KOT не  проводит
различий между модификациями и  всех их называет MUSIC.  В данной
ситуации программа работает в целом корректно за исключением того
случая,  когда   на  Вашем   компьютере  появяться   одновременно
MUSIC-2568  и  любая  другая  модификация.  Из-за  отличий  между
модификациями при работе с прерыванием 21h можно наблюдать  такую
картину, когда  после лечения  в оперативной  памяти MUSIC-2568 и
запуске  программы,  зараженной,  например,  MUSIC-2885, ANTI-KOT
вторично выдаст  сообщение о  наличии вируса  MUSIC в оперативной
памяти. Также возможна выдача подряд двух сообщений о  присутсвии
MUSIC в оперативной памяти, это не должно Вас смущать.  Возможно,
такие случаи проявления MUSIC  достаточно редки, однако я  считал
необходимым рассказать  о них.  В большей  степени они адресованы
тем пользователям, которые  при изучении работы  вирусов пытаются
поставить ANTI-KOT в сложные условия работы, например,  загрузить
в  память  сразу  все  имеющиеся  вирусы  и  посмотреть  как  это
переживет ANTI-KOT. Кроме слов благодарности я ничего не хочу  им
высказать, ибо при появлении ошибок они как правило звонят мне  и
тем самым помогают исправлять недостатки;

     -  после  пополнения  коллекции  вирусов  MUSIC  на Киевском
семинаре можно  утверждать, что  этот вирус  представлен довольно
многочисленным  семейством  -  шесть  модификаций. Ниже я привожу
перечень  их  с  указанием  длины  каждой модификации. Необходимо
пояснить, что я подразумеваю под  длиной вируса - это длина  того
постоянного  тела  вируса,  которое  дописывается  в  файл  после
выравнивания заражаемого файла до целого количества параграфов  (
до длины, кратной 16 ):

     Длина       Номер версии вируса

     1805        19h
     2680        21h
     2568        22h
     2752        26h
     2928        29h
     2885        2Ch

     Номер версии вируса - это реальное шестнадцатеричное  число,
которое возвращается резидентными  частями вируса при  выполнении
прерывания 21h с номерами функций  C500 для версий 19h, 21h,  22h
или C600  для версий  26h, 29h,  2Сh. Номер  версии имеет  вполне
определенный  смысл   для  самого   вируса,  который   состоит  в
следующем. Если запускать  поочередно файлы, зараженные  вирусами
разных  версий  в  порядке  возрастания  версий, то в оперативной
памяти  будет  создано  нечто  вроде  цепочки резидентных вирусов
MUSIC,  причем  при  запуске  незараженной  программы  она  будет
инфицирована  самой  последней  версией  вируса.  Если  же начать
загружать зараженные программы в порядке убывания версии  вируса,
то более старые ( с  меньшими номерами ) не будут  подгружаться в
память  после  более  молодых.  Но  гораздо примечательнее другой
факт, который дает представление об этом семействе вирусов как  о
некотором самообновляющемся  образовании. Дело  в том,  что вирус
любой  версии  при  нахождении  в  оперативной  памяти  и попытке
заражения некоторой  программы не  только контролирует,  заражена
уже эта  программа или  нет, он  определяет, какая  именно версия
присутствует в программе и если это будет более старая версия, то
вирус обновит ее  - а именно  сначала сам излечит  файл от старой
версии и вслед за этим заразит собсвенной версией.

     -  О  самих  версиях  следует  сказать следующее. Версия 19h
представляет  собой  вирус,  который  играет  достаточно   длинну
мелодию  при  попытке  теплой  перезагрузки  компьютера с помощью
клавиш <Ctrl>  + <Alt>  + <Del>.  Этот вирус  в отличие от других
занимает 9 обработки клавиатуры, а не 1Ch.

     - Версии 19h, 21h, 22h при заражении .EXE файлов  превращают
их в  файлы .COM  путем проставления  в начало  файла перехода на
тело вируса,  тогда как  версии 26h,  29h, 2Ch  запоминают внутри
себя 32 байта заражаемой программы.

     - все версии сначала увеличивают заражаемый файл до размера,
кратного 16,  а уже  потом дописывают  туда тело  вируса, которое
одинаково как  по длине,  так и  по содержанию  для файлов .EXE и
.COM. Исключение составляет только  версия 2Ch, у которая  в .EXE
файл дописывает на 4 байта меньше, чем в .COM.

     6. Вирус SOFIA.
     -----------------

     - длина вируса составляет 1800 (708h) байт;

     - вирус садится как в .EXE, так и в .COM файлы;

     - основное деиствие вируса состоит в том, что он при запуске
зараженной   программы   читает   BOOT   сектор  текущего  диска,
записывает  его  обратно,  организуя  данным  образом нечто вроде
собственного  счетчика,  и  при  определенных  значениях счетчика
записывает на диск в произвольный сектор произвольную информацию;

     - вирус  остается резидентным  в памяти,  занимая прерывания
21h и 27h;

     - вирус загружается в верхнюю область системной памяти;

     - контролируя прерывание 21h вирусы (имеются в виду  вирусы,
остающиеся резидентно в  памяти) как правило  отслеживают функцию
4Bh (загрузка или исполнение  программы). Вирус SOFIA кроме  того
отслеживает  такие  функции,  как  открытие  и  закрытие  файлов,
изменение аттрибутов  файлов и  некоторые другие.  Это приводит к
такому эффекту:  вы обнаружили больной файл, излечили его, но при
закрытии файла он будет вновь заражен. Поэтому особенность борьбы
с  данным  вирусом  состоит  в  том,  что без нейтрализации его в
оперативной памяти лечение зараженных файлов невозможно;

     -  при  заражении  .COM  файлов  вирус  дописывается в конец
заражаемой программы, изменяя первые  три байта программы по  уже
известному алгоритму (см. выше);

     -  при  заражении  EXE  файлов все происходит приблизительно
так, как в случае с  вирусом TIME. Небольшая сложность состоит  в
том, что вирус не запоминает длины исходного файла в чистом виде,
удлинняя  при  этом  файл  на  1800..1815 байт, но запоминает тот
самый  байт,   который  позволяет   все  же   точно  восстановить
первоначальную длину;

     - прерыванием 27h вирус пользуется для того, что  проверять,
не изменился ли вектор  21h, и при необходимости  восстанавливать
его;


     7. Вирус MICRO88.
     -----------------

     - длина вируса составляет 534 байт;

     - вирус садится в .COM файлы;

     -  при  заражении   файлов  вирус  дописывается в конец
заражаемой программы с изменением первых  трех байта программы;

     - механизм  распространения вируса  предельно прост  и очень
похож на тот,  которым пользуется вирус  RESTART с тем  отличием,
что заражение происходит только в текущем подкаталоге;

     -  вирус  при  заражении   программы  изменяет  ее  дату   с
установкой месяца  13 и  впоследствии использует  это как признак
того, что программа уже заражена;

     - файлы длиной менее 100h или более FA00h не заражаются;

     - похоже, что кроме распространения вирус ничего не делает;

   Оперативная информация
   ----------------------

     1. Вирусы TIME, LETTERS,  VACSINA, MUSIC, SOFIA, BOOT  могут
быть нейтрализованы в оперативной памяти, причем  безотносительно
к тому, были ли загружены  в память после них другие  резидентные
программы.

     2.  В  случае  массого  заболевания  ваших компьтеров, когда
вирусы появляются  вновь и  вновь, нейтрализовать  вирус в памяти
представляется более продпочтительным, чем сделать  перезагрузку,
так как наличие  в памяти нейтрализованного  вируса предотвращает
возножность загрузки в память новой копии вируса.

     Однако  это  не  распространяется   на  вирус  SOFIA  -   он
проверяет,  находится  ли  в  памяти  точная  его  копия. Если Вы
провели нейтрализацию в памяти и после этого стартуете зараженную
программу, то  вирус вторично  загрузиться в  память. Поэтому при
обнаружжении в памяти этого  вируса проверьте все файлы  на Вашем
компьютере, иначе  при запуске  зараженной программы  вирус снова
начнет распространяться.

     4. В последнее  время мною обнаружены  следующие особенности
заражения  EXE-файлов.  Вирусом   SOFIA  оказался  заражен   файл
DIAL.EXE  из  пакета  'ДИАЛОГ'.  Этот  файл  в отличие от обычных
EXE-файлов имеет  в полях  PartCnt и  PartPag (подробности  см. в
литературе по  DOS) значения,  которые при  подстановке в формулу
(PartCnt*512 + PartPag) не дают значения, равного  действительной
длине  файла.   При  заражении   файла  вирусом   SOFIA  значения
переменных PartCnt и PartPag  приводятся в соответствие с  длиной
зараженного файла, при  этом значения их  для исходного файла  не
запоминаются, что приводит  к невозможности правильного  лечения.
Очевидно,  это  является   непреодолимым  препятствием.  В   этом
отношении   хочю   порекомендовать   пользоваться    программами,
позволяющими  составлять  контрольные  суммы  файлов  и проверять
правильность  лечения  программ.    ANTI-KOT  в ближайшем будущем
будет дополнен такими функциями,  хотя простого решения здесь  не
получается хотя  бы потому,  что при  лечении файлов,  зараженных
вирусом TIME нет возможности восстановить исходное значение  поля
CheckSum в EXE-header (см. описание вируса TIME).

     При  заражении  файла   DIAL.EXE  вирусом  TIME   из-за  уже
указанных  особенностей  данной  программы  вирус  сел не в конец
файла,  а  в  область,   отстоящую  от  начала  файла   на  длину
(PartCnt*512  +  PartPag),  что  выводит  программу из строя. Для
борьбы с такими ситуациями я планирую включить функцию  сплошного
контекстного  сканирования  файлов,  хотя  случай  с   программой
DIAL.EXE представляется довольно редким.

     5. В последние дни сделаны следующие изменения, которые пока
не отражены в документе:

     -  в  главном  меню  появился  вопрос о необходимости выдачи
предупреждения  перед  лечением  каждого  зараженного файла/диска
(для  случая  вируса  BOOT).  При  отмене предупреждений не будет
выдаваться  звуковой  сигнал,  а  вопрос  о необходимости лечения
будет  задаваться  только  при  первом  обнаружении  вируса.  Это
означает,  что  в  случае  заражения  Вашего  компьютера, скажем,
вирусами MUSIC  и SOFIA,  вопросы о  необходимости лечения  будут
заданы два раза - первый при обнаружении первого файла с  вирусом
MUSIC и второй при обнаружении первого файла с вирусом SOFIA. Это
изменение   я   ввел   по   просьбе  тех  пользователей,  которым
приходилось запускать ANTI-KOT на компьютерах, сплошь  зараженных
вирусами   и   которым   при   лечении  приходилось  подтверждать
необходимость лечения файлов десятки раз. Однако советую отменять
предупреждающие сообщения только при известной степени доверия  к
программе;

     -  добавлена  возможность  проверять  перечисленные  в файле
ANTI-KOT.CFG  каталоги  с  подкаталогами.  Для  этого после имени
каталога необходимо поставить символ '*'. Например:

     C:\*
     D:\*

     В данном  случае при  запуске программы  с параметром  'C' :
'ANTI-KOT  /C'  будут  проверены  полностью  диски  C:  и D:. Это
изменение сделано по просьбе  тех, кто хотел запускать  программу
из файла AUTOEXEC.BAT. При внесении в этот файл строчки 'ANTI-KOT
/C'  будут  проверены  все  каталоги,  заданные  в ANTI-KOT.CFG и
программа завершится без выхода в главное меню;

     -  по  просьбе  пользователей,  не  имеющих  на  компьютерах
альтернативной кодировки введена  возможность работы программы  с
выдачей сообщений на английском языке;

     -  на  Киевском  семинаре  "Системмное  программирование" 14
декабря   1989   года   Безруковым   Н.Н.   и  другими  киевскими
программистами мне были любезно предоставлены новые разновидности
вируса  MUSIC.  Подробнее  об  этом  в  разделе  описания данного
вируса.

     Котик Олег. 18 декабря 1989 г.
