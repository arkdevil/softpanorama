
        Принцип функционирования и руководство по применению
             антивирусной программы CHECK21 (версия 3.3).

_____________________________________________________________________

Класс:              резидентные фильтры

Назначение:         детекция и нейтрализация присутствия файловых
                    резидентных вирусов в оперативной памяти

Основная концепция: контроль изменения процедуры обработки
                    прерывания 21h

Размер на диске:    3418б

_____________________________________________________________________

    Общеизвестно, что "лакомым кусочком " для вирусов является
возможность остаться резидентно в памяти,изменив при этом неко-
торые процедуры обработки прерываний.
    Такая стратегия открывает неограниченный простор для выбора
действий как на этапе  детонации  так и действий на этапе  раз-
множения. Эта концепция и является определяющей для класса рези-
дентных вирусов.Но она открывает также и возможность написания
эффективной антивирусной программы-фильтра,которая основывалась
бы на контроле такого рода изменений.

    Существует 2 стратегии изменения процедуры обработки прерыва-
ния:

   1. Запоминание текущего адреса из вектора прерывания,запись
на его место адреса вставляемой последовательности команд (встав-
ка "префикса") ,использование в новом  префиксе  вызова  старой
процедуры обработки прерывания.
 В результате вызова нескольких резидентных программ ,изменяющих
один и тот же вектор прерывания , образуется своего рода список:
префиксы   резидентных программ,после которых идет стандартная
процедура обработки прерывания DOS.Причем каждая следующая рези-
дентная программа реализует "вставку в начало" своего префикса.

   2.Известен и другой , более изощренный способ изменения проце-
дуры обработки прерывания.Он совпадает с принципом размножения ви-
русов, но не на диске,а в оперативной памяти и,в отличие от первой
стратегии,не изменяет текущий вектор прерывания. Действительно,воз-
можна запись в любую часть существующей процедуры обработки преры-
вания команды длинного перехода на вирусный участок.

   CHECK21 контролирует все способы первой и большинство - второй
стратегии изменения 21h прерывания.Выбор этого прерывания обьясня-







                           - 2 -


ется наибольшей привлекательностью его для вирусов : за ним скры-
вается множество функций DOS.

   Программа использует тактику "всплытия" : ее префикс всегда сле-
дует первым,т.е. фильтр реализует "вставку не в начало", а "вставку
после себя" любого появляющегося префикса.
   В результате  префикс  фильтра первым получает управление и вы-
полняет функцию контроля раньше всех.

   Контроль позволяет определить попытку вируса изменить процедуру
обработки 21h прерывания,т.е. найти вирус на самой ранней стадии -
когда им лишь подготавливается почва для дальнейшего проявления.И не
только определить, а и нейтрализовать.
   Например,если запрос на переустановку не удовлетворяется,значит
та часть вируса,которая спрятана в 21h прерывании,никогда не сможет
получить управление.

   Главная сложность в применении этой антивирусной программы зак-
лючается в решении вопроса :

как отличить попытку вируса от попытки невырусной программы,напри-
мер,системной, изменить существующую процедуру обработки прерывания?

   Пользователи-профессионалы в большинстве случаев могут опреде-
лить,изменяет ли программа прерывания (исходя из описания программы,
ее внешнего проявления и т.п.).

   Например,PRN10 - программа русификации принтера - не должна из-
менять 21h прерывание.
   Если при вызове этой программы поступило сообщение от CHECK21 -
это сигнал тревоги !

   Пользователю-непрофессионалу CHECK21 позволяет предотвратить
развитие эпидемии : если раньше при вызове программы CHECK21 "мол-
чал",а сейчас появилось сообщение - программа была заражена.

   Если у вас есть желание экспериментировать,воспользуйтесь воз-
можностью не разрешать переустановку при поступлении запроса.Если
после этого программа перестает выполнять свои "обязанности" - пере-
установка необходима и это не запрос вируса.

   Естественно,фильтр не определяет название вируса,а предупреждает
о необходимости удаления зараженной программы или запуска в дей-
ствие "батареи" антивирусов других классов : детекторов на конкрет-
ный тип,фагов ...

   В программе предусмотрена возможность использования параметра:

  CHECK21 F      - off - отключает контроль,удаляя CHECK21-пре-
                         фикс  из верхушки процедуры обработки
                         прерывания;








                           - 3 -


  CHECK21 N      - on  - включает контроль,помещая CHECK21-пре-
                         фикс  наверх.

  Любой другой параметр не изменяет состояние.

  Тактика "всплытия",используемая фильтром CHECK21 налагает неко-
торые ограничения на применение программы RE (RELEASE) :

  1. Желательно RE загружать раньше CHECK21.
  2. Если вы желаете удалить резидентный участок программы,изме-
     нившей 21h вектор после CHECK21,то удаляйте все участки,начи-
     ная с CHECK21,в противном случае нарушится "список префик-
     сов",о котором упоминалось выше, и при первом же вызове 21h
     прерывания произойдет зависание машины.


                       Интерфейс с пользователем.

   Диалог с пользователем ведется в стиле VIRBLK (многие уже
привыкли к нему) :

    - сообщения на фоне обратного контраста
    - разрешения действия нажатием '*'.

 Возможны следующие сообщения.
 Наиболее часто:

 - 'About to change interrupt vector NO.21h.Press '*'to allow
    change ' - последовал запрос на переустановку вектора преры-
    вания через 25h функцию DOS.Если разрешение не будет дано,
    выводится новое сообщение:
 - 'Do you want to terminate current program? Press '*' to ter-
    minate ' - нажав '*',вы разрешите прекращение текушей прог-
    раммы и передачу упраления DOS,в противном случае управление
    возвращается выполняемой программе .

    Через 25h функцию DOS изменяют вектор прерывания такие прог-
    раммы,как:
     VIRBLK,FLUSHOT,RE,
    вирусы:

      - LETTER FALL - "падающие буквы" - C1701R
      - BLACK FRIDAY - "черная пятница" - CE1813R
      - YANKEE DOODLE - CE1810R
      - предположительно - "самоед" - CE2890R

 - 'ATTENTION ! INT 21h was changed without your allowance.Press
    '*' to reset your interrupt vector' - вектор прерывания 21h
    был изменен с помощью прямой записи , нажав '*' вы разрешите
    переустановку вектора к старому значению.









                           - 4 -


    Прямой записью изменяют 21h вектор такие программы,как
     DOSEDIT,REALTIME,
    вирус:

    - DARK AVENGER - "черный мститель"("Эдик") - CE1800R.

  Следующие сообщения появляются крайне редко и являются,безуслов-
 но,сигналами тревоги:

 - ' BE VERY CAREFULL ! Your interrupt 21h procedure was changed
    by direct writing of instructions.Now interrupt procedure
    was restored.Press '*' to continue.'
 - ' ATTENTION !Current prefix of int 21h hasn't 4-byte address
    of old int 21h procedure.That's why int 21h was reset to
    previous address.Press '*' to continue'
 - ' ATTENTION ! Interrupt vector 21h was changed,but before
    CHECK21-int-prefix call was restored to previous value.Press
    '*' to continue'


                          Благодарности.

   Хочу поблагодарить А.Донченко,А.Грищука,Ю.Усыченко - моих
однокурсников - за поддержку в процессе разработки антивируса.
Большое влияние на меня оказала также книга Н.Н.Безрукова
"Компьютерная вирусология".

                          Наблюдения.

   Мне удалось проверить действие CHECK21 на 5 разных вирусах
 (они упомянуты выше).Все пять детектируются фильтром.
   Буду очень благодарен,если замечания по работе прграммы,ровно
 как и информацию о детекции с помощью CHECK21 новых вирусов,
 вы сообщите по адресу :

      Киев-147,ул.Энтузиастов,д.29/2,кв.140
      Двоеглазову Игорю Михайловичу
 или по телефону:

      517-02-05



   Двоеглазов Игорь                      декабрь,1989
