

               Утвержден :

           0 . ДА . 84222 - 08  81  01 - 1














                Антивирусная программа - полифаг 'Лiкар'.



                         Пояснительная записка .

                    0 . ДА . 84222 - 08  81  01 - 1

                               Листов надцать












                               - 2 -




                             0.ДА.84222 - 08 81 01-1







                          Содержание.

         1. Общая постановка задачи ......................
         2. Методика  обнаружения  и обезвреживания вируса
            в памяти и на диске...........................
         3. Структуры данных .............................
         4. Реализация алгоритма .........................
         5. Выводы .......................................
         6. Конфигурационный файл ........................










                      0.ДА.84222 - 08 81 01-1


        1. Общая постановка задачи.

        Необходимо  проверить  присутствие вируса в ОЗУ, в испол-
    няемом  файле, на диске и при возможности 'выкусить' вирус из
    тела программы не нарушая работоспособности последней.

                               - 3 -

        Для  решения данной задачи используются методы, приведен-
    ные ниже.








                   0.ДА.84222 - 08 81 01-1


        2.  Метод  проверки и нейтрализации вирусных программ.

        2.1  Поиск вируса в памяти.

        Поиск  вируса в памяти осуществляется по маскам, при этом
    каждому  экземпляру  вируса  соответствует  своя маска. Маска
    состоит  из  6-ти байт, характерных для данного вируса и 6-ти
    байт,  определяющих  местоположение  характерных байт относи-
    тельно  базового адреса проверки. Эта схема изображена на ри-
    сунке :


        ┌─────────────────────────────── базовый адрес в памяти
        │         ┌───────────────────── смещение от базы
        │<────────┴─────────>│
        V                    V
        XX XX XX M0 XX XX M1 M2 M3 XX XX M4 XX M5 XX тело вируса
                 ^        ^  ^  ^        ^     ^
        ┌────────┴────────┴──┴──┴────────┴─────┴────┐
        │           характерные байты               │
        └───────────────────────────────────────────┘


        Таким  образом, маска под один вирус требует 12 байт. Эт-
    от  алгоритм  построения маски был выбран в результате много-

                               - 4 -
    летнего  опыта  антивирусной  борьбы  и в настоящее время яв-
    ляется  наиболее  устойчивым к вирусным мутациям. Такая маска
    удовлетворяет  противоречивым  требованиям  выбора  как можно
    более  длинной маски для надежного распознавания вируса и как
    можно  более короткого участка кода для уменьшения вероятнос-
    ти  попадания мутации в зону маски. Данная маска может захва-
    тывать  длинный  участок  памяти (до 256 байт) при этом число
    критичних байт равно 6.  Что ж это так просто?  Нет!  Почему?
    Ответ  прост:  данный  алгоритм  необходимо применять в общем
    случае к каждому байту проверяемой  памяти.  Ясно  что  такая
    проверка  потребует  многих часов процессорного времени.  Для
    ускорения этой операции необходима  дополнительная информация
    о возможном местоположении вируса.  К счастью, такая информа-
    ция существует.

                         Где искать ?

        Из  теории  компьютерной вирусологии известно, что всякий
    резидентный  вирус  должен время от времени получать управле-
    ние.  Простейший способ - перехват вектора прерывания ДОС ли-
    бо  BIOS.  Поэтому  для  обнаружения вируса, не использующего
    регистры  DR0..DR6  процессоров 80386, 80486 достаточно прой-
    тись  по  цепочке  обработчиков  прерываний для всех жизненно
    важних прерываний. Таковыми являются : int 8h, 13h, 21h, 2Ah.
    Проврерив  обработчики  этих  прерываний  с  вероятностью 1.0
    можно  обнаружить любой современный вирус. Осталась самая ма-
    лость  -  проход  по  цепочке обработчиков прерывания. Данная
    задача имеет простое решение - трассировка памяти.

                         Трассировка.

        Трассировка  применяется любым отладчиком и заключается в
    следующих  принципах:  перехват  прерывания int 1h, установка
    флага  трассировки, вызов необходимого прерывания, сброс фла-
    га  трассировки.  После  установки флага трассировки МП 80X86
    начинает исполнять int 1h после выполнения каждой инструкции.
    Таким  образом, задача сводится к правильной обработке преры-
    вания  int  1h.  'Лiкар'  применяет активный способ обработки
    пошагового  прерывания. Это значит, что вирус будет обнаружен

                               - 5 -
    и  обезврежен внутри обработчика пошагового прерывания, так и
    не  получив управления. Это свойство приводит к тому, что при
    неправильном  уничтожении вируса скорее всего произойдет под-
    висание  коипьютера.  Эта  особенность может трактоваться как
    достоинство  либо как недостаток, авторы склонны считать, что
    это скорее достоинство.
        Трассировщик  памяти 'Лiкара' устроен немного сложнее. Он
    проверяет  не  каждый  байт программы обработки прерывания, а
    только  те  участки,  которые выровнены по границе параграфа.
    Это  объясняется следствием работы менеджера памяти ДОС. Кро-
    ме  того,  после  исполнения  каждой  инструкции трассировщик
    принудительно  устанавливает  флаг  трассировки.  Это сделано
    для  исключения  возможности сброса флага трассировки вирусом
    либо другой программой.
        Помимо  всего 'Лiкар' во время трассировки записывает ад-
    реса  всех обработчиков прерываний int 13h и int 21h. Эти ад-
    реса  могут пригодится позднее для проверки целостности ДОС и
    BIOS.


                          Надежность.

        Надежность  трассировщика  оценивается  по  числу  ложных
    срабатываний,  числу несрабатываний и числу завешиваний опер-
    ационной  системы.  За  время эксплуатации программы (2 года)
    было  обнаружено  только  зависание в многозадачном окружении
    DesqView, что было вызвано неправильным выбором функции ДОСа,
    по  которой производилась трассировка int 21h. Была использо-
    вана  функция 30h Get DOS version, которая является нереенте-
    рабельной.  После  замены  этой функции на DOS Fn 62h Get PSP
    segment  указанные  зависания  прекратились.  Сказанное  выше
    дает  основания  полагать,  что  программа проверки памяти на
    наличие вируса является вполне надежной.

                        Нейтрализация.

        Программа  -  полифаг  в отличие от программы - детектора
    не  ограничивается  обнаружением  вируса и констатацией факта
    заражения.  Ее  основная  задача  - лечение. Убить конкретный

                               - 6 -
    вирус  в  памяти  довольно просто. Для этого необходимо изме-
    нить  его  код таким образом, чтобы это изменение не было за-
    мечено  другими программами. Для этого необходимо найти часть
    кода  вируса, отвечающую за передачу управления исходному об-
    работчику  прерывания. Когда известна эта магическая последо-
    вательность  байт, достаточно записать ее по адресу, по кото-
    рому был обнаружен вирус. Для каждого вируса хранится его уб-
    ийственная  комбинация  в  6-ти  байтах. Ниже приведен пример
    такого действия:


           - код активного вируса :

                   cmp  ax, 4B00h
                   je   LOC_1
                   jmp  far cs:[0013h]  ; вызов ДОС

           - код нейтрализованного вируса :

                   jmp  LOC_2
                   je   LOC_1
            LOC_2:
                   jmp  far cs:[0013h]  ; вызов ДОС


                          Реализация.

        Реализация  вышеуказанных  соображений  выполнена  внутри
    объекта   TVirus.   Этот   объект   имеет  виртуальные методы
    TestMemory,  который проверяет память, и KillMemory, произво-
    дящий  нейтрализацию  вируса. Если вирус достаточно сложный и
    не  может быть убит стандартной процедурой, необходимо перек-
    рывать этот метод.


        2.2  Поиск вируса в файле.

        Поиск  вируса  в файле осуществляется по маскам, при этом
    каждому  экземпляру  вируса  соответствует  своя маска. Маска

                               - 7 -
    состоит  из  6-ти байт, характерных для данного вируса и 6-ти
    целых,  определяющих  местоположение характерных байт относи-
    тельно  базового  смещения  проверки. Эта схема изображена на
    рисунке :


        ┌─────────────────────────────── базовое смещение в файле
        │         ┌───────────────────── смещение от базы
        │<────────┴─────────>│
        V                    V
        XX XX XX M0 XX XX M1 M2 M3 XX XX M4 XX M5 XX тело вируса
                 ^        ^  ^  ^        ^     ^
        ┌────────┴────────┴──┴──┴────────┴─────┴────┐
        │           характерные байты               │
        └───────────────────────────────────────────┘


        Таким  образом, маска под один вирус требует 18 байт. Эт-
    от  алгоритм  построения маски был выбран в результате много-
    летнего  опыта  антивирусной  борьбы  и в настоящее время яв-
    ляется  наиболее  устойчивым к вирусным мутациям. Такая маска
    удовлетворяет  противоречивым  требованиям  выбора  как можно
    более  длинной маски для надежного распознавания вируса и как
    можно  более короткого участка кода для уменьшения вероятнос-
    ти  попадания мутации в зону маски. Данная маска может захва-
    тывать  длинный  участок  файла (до +/- 32767 байт), при этом
    число критичних байт равно 6. Данный алгоритм необходимо при-
    менять в общем случае к каждому байту проверяемого файла. Яс-
    но что такая проверка потребует  многих  часов  процессорного
    времени и файловых операций.  Для ускорения этой операции не-
    обходима дополнительная информация о возможном местоположении
    вируса. К счастью, такая информация существует.

                         Где искать ?

        Из  теории  компьютерной вирусологии известно, что всякий
    файловый вирус должен получать управление до начала выполнени
    я  программы.  Данная  цель  может быть достигнута установкой
    новой точки входа исполняемого файла. Поэтому для обнаружения

                               - 8 -
    вируса  достаточно  пойти в точку входа программы и проверить
    там  наличие  маски вируса. Выполнив эту проверку можно с ве-
    роятностью 0.99 обнаружить любой современный вирус.
        Существует три вида исполняемых  файлов:  .COM  и  .EXE.и
    .SYS Они различаются по нескольким параметрам:
        1)  размер COM файла не может превышать 64 Кбайт, т.к. он
    должен  полностью  разместится  в одном сегменте кода. Размер
    файла  в  принципе ограничен размерностью 2-го слова, поэтому
    не может превышать границы 2 Гбайт.
        2)  точка  входа  COM  файла всегда располагается в самом
    начале  файла.  Как  правило,  первая команда COM программы -
    безусловный  переход.  Точка  входа EXE файла определяется по
    заголовку EXE файла.
        Исходя  из  этих условий, COM файл может быть заражен из-
    менением  адреса  безусловного  перехода, записанного в точке
    входа,  а EXE файл может быть заражен как изменением заголов-
    ка  EXE  файла так и изменением адреса безусловного перехода,
    расположенного  в точке входа. Поэтому, 'Лiкар' не просто ид-
    ет  в  точку  входа, а пытается обнаружить возможную передачу
    управления  вирусу.  Для  этого  необходимо проверить наличие
    команд  безусловного перехода всех типов в точке входа файла,
    а  так  же  в  точке, на которую может ссылаться инструкция в
    точке входа программы. Ну, вобщем, легкая эмулляция всех ком-
    манд,  пока не будет команды, которая не передает управление,
    но это ерунда - вот мы в качестве диплома пишем эмулятор i386
    - вот это будте круто!


                          Надежность.

        За  время эксплуатации программы (2 года) не было обнару-
    жено ложных срабатываний,  вызванных неправильным алгоритмом.
    Вернее были когда-то, но это все было неправда, с тех пор все
    не так и все работаетправильно. Сказанное выше дает основания
    полагать,  что программа проверки файла на наличие вируса яв-
    ляется вполне надежной.

                        Нейтрализация.


                               - 9 -
        Программа  -  полифаг  в отличие от программы - детектора
    не  ограничивается  обнаружением  вируса и констатацией факта
    заражения.  Ее  основная  задача  - лечение. Убить конкретный
    вирус в  файле  довольно затруднительно. Для этого необходимо
    буквально  выкусить из тела программы тело вируса. Задача ос-
    ложняется  еще  и  тем, что многие вирусы шифруются и шифруют
    исходный  код  программы.  Другими  словами, антивирус должен
    повторить  процедуру, которую производит вирус в памяти перед
    передачей  управления зараженой программе, а так же исправить
    в случае необходимости заголовок EXE файла.

                          Реализация.

        Реализация  вышеуказанных  соображений  выполнена  внутри
    объекта TFileVirus.  Этот  объект   имеет  виртуальные методы
    TestFile,  который  проверяет  память,  и  Kill, производящий
    нейтрализацию  вируса. Если вирус достаточно сложный и не мо-
    жет быть убит стандартной процедурой, необходимо  перекрывать
    этот  метод.  Существует большое число однотипных вирусов-му-
    тантов,  различающихся  некоторыми константами. Нейтрализация
    такого  типа  вирусов  особенно  эффективна,  т.к.  позволяет
    включить  новый  вирус  простым порождением нового экземпляра
    базового объекта.


        2.3  Поиск вируса на диске.

        Поиск  вируса  на  диске осуществляется аналогично поиску
    вируса в файле.

                         Где искать ?

        Из  теории  компьютерной вирусологии известно, что всякий
    дисковый  вирус должен получать управление до начала выполне-
    ния  основной  программы.  Данная  цель может быть достигнута
    путем  записи  вируса  либо  в  boot-sector, либо в partition
    table  жестого  диска.  Поэтому для обнаружения вируса доста-
    точно  пойти  в  точку входа исполняемого сектора и проверить
    там  наличие маски вируса. Выполнив эту проверку, можно с ве-

                               - 10 -
    роятностью 0.99 обнаружить любой современный вирус.


                          Надежность.

        За  время эксплуатации программы (2 года) не было обнару-
    жено ложных срабатываний, вызванных неправильным  алгоритмом.
    Сказанное  выше дает основания  полагать, что  программа про-
    верки диска на наличие вируса является вполне надежной.

                        Нейтрализация.

        Программа  -  полифаг  в отличие от программы - детектора
    не  ограничивается  обнаружением  вируса и констатацией факта
    заражения.  Ее  основная  задача  - лечение. Убить конкретный
    вирус на  диске довольно затруднительно. Для этого необходимо
    буквально  выкусить из тела программы тело вируса. Задача ос-
    ложняется  еще  и  тем, что многие вирусы шифруются и шифруют
    исходный  код  программы.  Другими  словами, антивирус должен
    повторить  процедуру, которую производит вирус в памяти перед
    передачей  управления зараженой программе.

                          Реализация.

        Реализация  вышеуказанных  соображений  выполнена  внутри
    объекта TDiskVirus.  Этот  объект   имеет  виртуальные методы
    TestDisk,  который  проверяет  память,  и  Kill, производящий
    нейтрализацию  вируса. Если вирус достаточно сложный и не мо-
    жет быть убит стандартной процедурой, необходимо  перекрывать
    этот  метод.  Существует большое число однотипных вирусов-му-
    тантов,  различающихся  некоторыми константами. Нейтрализация
    такого  типа  вирусов  особенно  эффективна,  т.к.  позволяет
    включить  новый  вирус  простым порождением нового экземпляра
    базового объекта.


                             0.ДА.82203 - 07 81 01-1



                               - 11 -
        3. Структуры данных.

        При  проведении  антивирусной  борьбы  была  использована
    технология  ООП.  Это вызвано особенностями работы и архитек-
    туры  вирусных  программ, а так же особенностями работы анти-
    вируса. Фактически, зная все методы заражения, возможно пород
    ить  от одного объекта-вируса несколько экземпляров, раличаю-
    щиеся  быть может несколькими константами, определяющими нап-
    ример  способ  воостановления  исходной программы. Исключение
    составляют лишь вирусы, шифрующие исходную программу. Для ле-
    чения  таких вирусов необходимо построить алгоритм расшифров-
    ки, что является прерогативой вирусолога.
        'Лiкар' использует следующую иерархию объектов:


                        TObject
                        │
                        └───TVirus
                            │
                            ├──TFileVirus
                            └──TDiskVirus


        Неизвестные файловые вирусы должны быть порождены от объ-
    екта TFileVirus, дисковые - от TDiskVirus.


                        TCollection
                        │
                        ├───TVirusCollection
                        ├───TBirthDay
                        ├───TGoodProgram
                        └───TMsgCoolection


        Несортированная коллекция                вирусов-объектов
    TVirusCollection  содержит  всю  информацию,  необходимую для
    распознавания и уничтожения вирусов.


                               - 12 -

                        TSortedCollection
                        │
                        └───TPCollection


        Сортированная  коллекция TPCollection - это коллекция ук-
    азателей  на  обработчики жизненно важных прерываний DOS. Эти
    указатели используются для определения целостности операцион-
    ной системы.

                        TLecar

        Объект  TLecar  - это основной объект, содержащий все вы-
    шеуказанние объекты и реализующий сканирование дисков.


                         0.ДА.82203 - 07 81 01-1


        4. Реализация алгоритма.

        Предлагаемая  программа реализует подход описанный в пун-
    кте  2  данной  поянительной  записки.  При реализации авторы
    предполагали,  что  возможность  нейтрализации  вируса сущес-
    твует  всегда,  т.е. всегда существует достаточное количество
    корректно работающих вирусов.
        В  связи  с  этим  всегда производится лечение вируса при
    запросе пользователя.


                      0.ДА.84222 - 08 81 01-1

        6. Выводы.

        Представленная  программа  может  быть  рекомендована как
    средство  для  ведения  антивирусной борьбы на всех компьюте-
    рах,  совместимых  с  IBM PC в операционной среде MS DOS. Ха-
    рактерной  особенностью  является в возможность в большинстве

                               - 13 -
    случаев  корректно восстановить целостность рабочей среды ка-
    кой-либо программы.  Предназначена для поддержания работоспо-
    собности станций BBS,  работающих в пакетном режиме без учас-
    тия человека. Основная задача проверка проходящих через стан-
    цию программ и предотвращение распространения вирусных эпиде-
    мий и пандемий.


                      0.ДА.84222 - 08 13 01-1



                       А Н Н О Т А Ц И Я

        Программа  0.ДА.84222  -  08  выполнена  на  языке  Turbo
    Pascal 6.0,  7.0 Borland International в операционной системе
    MS DOS версии 5.0 на машине класса IBM PC AT,возможно исполь-
    зование  данной  программы на IBM совместимых машинах под уп-
    равлении операционных систем,  совместимых с MS-DOS, а так же
    в  многозададачных  расширениях  DOS DeskView,  TopView,  DOS
    Extender, DesqView+Xwindows, MS Windows. Кроме того, возможна
    работа в операционной системе OS/2 в окне DOS.
        Программа  предназначена  для обнаружения программ, рабо-
    тающих  под управлением MS DOS, зараженных известными вируса-
    ми, а так же для их обезвреживания.
        Программа  выполнена  как приложение DOS в виде исполняе-
    мого файла (ХИТ!!!!).  Она может быть запущена как из пригла-
    шения DOS,  так и из любого другого исполняемого файла. Рабо-
    тает полностью в автоматическом режиме не требуя вмешательст-
    ва  пользователя.  Диалоговый  режим  не поддерживается.  Как
    следствие управляющие параметры передаются в командной  стро-
    ке.
        'Лiкар'  поддерживает запросы через командную строку сле-
    дующего вида:

                Lecar drive: [/options], где

        drive:  - проверяемый файл/флопп/винчестер/файл-сервер. Ес-
    ли  в  качестве параметра указана * , то выполняется проверка

                               - 14 -
    всех доступных устройств, не являющихся флоппи-дисководами.

        options - ключи, задающие параметры работы:

        /f - при обнаружении вируса пытаться его нейтрализовать.

        /g - проверять все найденные файлы
             ( по умолчанию COM, EXE, SYS)

        /d - более  осторожная работа -применяется в случае за-
             висания программы,  когда  неизвестна причина (режим
    максимальной презервации).

        /h - выдача комментариев по поводу проверяемых программ и
             более высокий уровень 'болтливости'.

        /? - выдача подсказки по работе программы.

        Для  обеспечения  максимальной совместимости с существую-
    щими   операционнимы  системами  и  программным  обеспечением
    'Лiкар'  использует  доступ  к ситемным ресурсам только через
    DOS  и BIOS. Исключение составляют процедуры перехвата преры-
    вания,  поскольку известны вирусы, 'обманывающие' слишком до-
    верчивую  программу.  В  процессе работы программа использует
    следующие прерывания:

        01h - пошаговое прерывание,  используется при трассировке
              памяти на наличие вируса.

        08h - перехватывается на время трассировки для исключения
              возможности   работы  фоновой  программы  во  время
              трассировки памяти.

        10h - видеосервис,  используется  при   операциях  вывода
              сообщений на экран.

        13h - дисковый  ввод/вывод.  Используется при операциях
              чтения/записи физических секторов дисков.


                               - 15 -
        15h - используется для определения присутсвия многозадач-
              ного окружения TopView и DeskView.

        21h - DOS  сервис.  Используется для файловых операций,
              сканирования диска, при трассировке памяти.

        23h - обработчик Ctrl-Break. Используется для обесчения
              возможности  досрочно завершить выполнение програм-
              мы в процессе длительной утомительной проверки.

        24h - обработчик критических ошибок DOS во  время  диско-
              вых и файловых операций.

        25h - чтение логических секторов диска - используется при
              обнаружении дисковых вирусов.

        26h - запись логических секторов диска - используется при
              лечении дисковых вирусов.

        2Fh - Мультиплексное прерывание, используется при трас-
              сировке   памяти,  определения  сетевых  драйверов,
              присутствия многозадачного окружения MS WINDOWS.



                      0.ДА.84222 - 08 12 01-1


                      ТЕКСТ ПРОГРАММЫ

        см. файлы (*.pas,*.obj и пр.)



                            БЕЗ УМОЛЧАНИЙ


                      0.ДА.84222 - 08 81 01-1


                               - 16 -
                      6. Конфигурационный файл

        Для удобства работы и конфигурации введено новое,  доселе
    не использованное нами средство - файл конфигурации,  в кото-
    ром можно описать наиболее часто используемую Вами конфигура-
    цию и  потом запускать Lecar без дополнительных опций из ком-
    мандной строки. Параметры конфигурационного файла:

        Registered

        Данным параметром определяется регистрированная у Вас ко-
    пия программы Lecar или нет.  Если Вы пользуетесь регистриро-
    ванной копией,  значит Вы уважаете права авторов Lecar,  если
    не регистрированной,  значит не уважаете, никаких последствий
    это иметь не будет, но дело в принципе!
        Формат : Registered Yes|No|Неа|Ага

        Owner


        Данным параметром  определяется  на кого зарегестрирована
    данная копия Lecar,  если конечно Вы используете  регистриро-
    ванную копию,  если  Выц используете незарегистрированную ко-
    пию, то этот параметр Вам недоступен.
        Формат : Owner User_name

        CheckAllDrives


        Данным параметром  определяется проверять при запуске все
    найденные винчестера или нет.  Т.е. если у Вас в системе дос-
    тупны диски C,D,E,  то все они будут проверены.  Это же можно
    задать, дав в коммандной строке параметр *
        Формат : CheckAllDrives Yes|No|Неа|Ага

        CheckAllFiles

        Данным параметром определяется  проверять  проверять  все
    файлы или только файлы с расширением COM,EXE,SYS. Эта возмож-

                               - 17 -
    ность есть потому,  что некоторые исполняемые файлы не  имеют
    стандартных расширений,  например  программа использует овер-
    леи. Это же можно задать, дав в коммандной строке параметр *
        Формат : CheckAllFiles Yes|No|Неа|Ага

        Cure Yes

        Данным параметром можно задать режим в котором _все_ най-
    денные вирусы будут тут же удалятся, в противном случае будет
    только выдаваться сообщение о зараженности файла
        Формат : Cure Yes|No|Неа|Ага

        NonDocumented

        Процесс отладки Lecar достаточно однообразен и монотонен,
    ну можете себе представить - после добавления каждого  нового
    вируса приходится преверять все предидущие вирусы,  чтобы из-
    бежать эффекта "забывания" старых вирусов. Поэтому у нас пре-
    дусмотрен режим, в котором вывод сообщений несколько разнооб-
    разится, кроме того в этом режиме  проверяется  несколько  не
    совсем отлаженным алгоритмов,  которые могут привести к зави-
    санию. Поэтому, по умолчанию рекомендуется не использовать
        Формат : NonDocumented Yes|No|Неа|Ага

        ExpandFiles

        Это очень полезная опцию. Ну просто очень полезная. Lecar
    научился проверять  архивы  на предмет нахождения в них виру-
    сов. Очень удобно для входного контроля без ручной перепаков-
    ки архивов. Сами активно пользуемся. Более того, если в архи-
    ве будет найден вирус,  то Lecar его сначала отлечит, а потом
    еще и в архив на место положит, работает даже в случае если в
    архиве запомнено  дерево.  Естественно,  что  на этот процесс
    уходит достаточно большое количество времени,  если  особенно
    указывать ChtckAllDrives ;-).
        Формат : ExpandFiles Yes|No|Hеа|Ага

        EraseExpanded


                               - 18 -
        Этим параметром определяется стоит ли удалять файлы после
    разархивирования Это может  понадобится,  например,  если  Вы
    указали в  архиваторах pklite и lzexe и хотите иметь разархи-
    вированную копию модулей. Или же если Вы хотите иметь резерв-
    ную копию на случай, если будет неправильно вылечен файл
        Формат : EraseExpanded Yes|No|Hеа|Ага

        PathExpand

        ВНИМАНИЕ!!! Это очень важная опция, в случае, если Вы за-
    дали режим проверки архивов.  Здесь задается рабочий каталог,
    в который будут разархивироваться файлы для проверки, естест-
    венно, что при нынешних размерах архивах слишком бы много па-
    мяти потребовалось на хранение информации о том, какие именно
    файлы разархивировались, поэтому в этом рабочем каталоге про-
    веряются все файлы,  а потом,  естественно удаляются, поэтому
    указывайте здесь только ту директорию, в котролй действитель-
    но нет нужных Вам файлов,  а лучше, отведите Лекарю собствен-
    ную директорию для разархивирования.
        Формат : PathExpand path

        BeginDescriptor, EndDescriptor

        Здесь задаются опции архиватору.  Если нужного архиватора
    нет в PATH,  в поле Extract  укажите  полный  путь,  например
    C:\ARCHIVERS\PKUNZIP -o. Соотвественно значения полей:

    Packer - назвиние архиватора,  реально нигде не используется,
             т.е., практически это поле комментариев
    Extract - коммандная строка для извлечения файлов из архива
    Names - что именно извлекать из архивов при проверке
    Move - коммандная строка для засовывания файла назад в архив,
           в случае, если в нем будет обнаружен вирус
    Offset, Mark - смещения и маски для распознавания архиватора


                               - 19 -


Пример описания архиваторов:

BeginDescriptor
;   Packer    Extract              Names                 Move                 Offset, Mark
;   ============================================================================================
;   LHARC     LHARC e -c %1 %2     *.com                 LHARC a -m %1 %2    2,-lh1-
    LHA       LHA e /m1nc          *.com *.exe *.sys     LHA a /m1nt         2D02 6C03 6804 2D02 6C03 6804 ;2,-lh
    PKZIP     PKUNZIP -o           *.com *.exe *.sys     PKZIP -ex -o -a     5000 4B01 5000 4B01 5000 4B01 ;0,PK
;   PAK       PAK e %1 %2 *.PKT    *.com                 PAK a %1 %2         0,#261
;   ZOO       ZOO -e %1 %2 *.PKT   *.com                 ZOO -a %1 %2        5A00 4F01 4F01 5A00 4F01 4F01 ;0,ZOO
    ARJ       ARJ e -y -c -i -jr   *.com *.exe *.sys     ARJ a -y -c -e -i   6000 EA01 6000 EA01 6000 EA01 ;0,#96#234
;   PKARC     PKXARC %1 %2 *.PKT   *.com                 PKARC a %1 %2
EndDescriptor

        Поскольку конфигурационный файл по своим позможностям уже
    стал настолько нагроможден,  что на Лекаре уже можно програм-
    мировать, как на Norton Commander, мы приводим примеры наибо-
    лее удобных конфигураций:

     min.ctl - минимальная конфигурация
     cure.ctl - тоже самое,  только все исполняемые файлы, ар-
              хивированные PkLite разархивируются и проверяются
     exapnd.ctl - проверяются архивы и архивировванные  испол-
              няемые файлы
     allexpand.ctl - на всех дисках проверяются архивы и архи-
              вированные исполняемые файлы
     max.ctl - на всех дисках проверяются все архивы и архиви-
              рованные исполняемые файлы

        Все конфигурации  подозревают,  что существует директория
    D:\LSWAP,  поэтому если Вы хотите использовать одну  из  этих
    конфигураций, пожалуйста, создайте эту директорию или измени-
    те конфигурацию.  Естественно,  что для  установления  нужной
    конфигурации,  нужно дать команду copy cure.ctl lecar.ctl или
    аналогичную.

.
                               - 20 -


        Все что Вы только что прочитали  было  сдано  в  качестве
    курсового проекта по курсу МП САПР на оценку "отлично".  Спа-
    сибо преподавателю.

              Словарь военных слов, употребленных в Lecarе

          СДЯВ - вирус
          ВПХР - средства дезактивации СДЯВа

     В свое время был добавлен :
     RC713 -  виpус  является  неpизедентным  файловым  виpусом,
поpажающим COM файлы.  Размеp виpуса 713 байт. Стpатегия заpаже-
ния  - пpи запуске заpаженной пpогpаммы заpажается COM файл сна-
чала в коpневой диpектоpии тек.  диска,  а если таковых нет  или
все  заpажены,  то  пpоизводится  попытка  заpазить  COM  файл в
тек.диpектоpии.  Виpус снимает атpибуты.  Во вpемя своей  pаботы
виpус пеpеставляет вектоp INT 21H пpямо в DOS, чем обходит пpос-
тейшие стоpожевые сpедства. В случае, если диск защищен от запи-
си, выдается стандаpтное сообщение DOS:
  Write protect error.......
т.к. виpус не обpабатывает ошибки ввода-вывода. Кpоме того,
виpус не пpовеpяет pазмеp заpажаемого файла и поpтит те COM
чей pазмеp => 65535-713 байт, напpимеp AFD.COM
     Пpи опpеделенной дате (после 1989 года и не только) пpи
запуске заpаженной пpогpаммы после 14:00 пpоизводится пеpе-
загpузка системы путем INT 19H.

     В свое время был добавлен :
     Hercen RBSE1024 - инфицирует только загрузочноый  сектор  и
EXE-файлы. Имеет  оригинальную  стратегию действия - при запуске
зараженного файла,  вирус записывается в boot-секто винчестера и
создает файл  '.SYS,  после чего прямым поиском по Root-директо-
рии, находится  запись об этом файле и на место ' записывает E5h
(признак удаленного файла). В CONFIG.SYS на диске C: дписывается
строка "device='.sys",  но после этого длина CONFIG.SYS уменьша-
ется, так,  что этой срочки вроде как и нет. Этот финт основыва-
ется на том,  что редкий пользователь создает CONFIG.SYS, разме-

                               - 21 -
ром с кластер винчестера.  После загрузки с инфицированного вин-
честера, вирус опять находит CONFIG.SYS опять-таки прямым  поис-
ком по  Root-директории и увеличивает его длину,  восстанвливает
кавычку вместо E5h и отпускает  загрузку  дальше.  Стартую,  как
честный драйвер,   вирус   перехватывает   INT   21,   уменьшает
CONFIG.SYS и псевдоудаляет '.SYS.  А по 21-му заражает как обык-
новенный файловый вирус. Вот такой вирус пробегал. ВО!

     В свое время был добавлен :
     Вирус Jews-2 RCES2370,  он же FEDA(Федя), размер 2370 байт.
Живет  в  файлах COM,  EXE,  SYS и BIN.  В памяти вирус не виден
(поскольку остается резидентным толь ко  в  случае  загрузки  из
драйвера).
     Обрабатывает прерывания 21h,  8h.  Восьмое  использует  для
проигрывания  мелодии  "Подмосковные вечера" (сам не слышал,  но
говорят)     Отслеживает     функции      двадцать      первого:
3CH,5BH,3DH,3H,4BH,4H,4FH.
     В памяти инсталируется один раз,  контролируя себя по функ-
ции FEDAh, ожидая при вызове этой функции получить в ответ ADEFh
в AX и адрес предыдущего обработчика int 21h в ES:BX.
     Имеет три типа инсталятора : для COM, EXE и SYS/BIN-файлов.
В COM файлах калечит первые три байта,  заменяя их на JMP  в  хв
ост файла, где и живет. Эти байты хранит в нешифрованном виде со
смещением 7D9h от точки входа в вирус.
     В файлах  драйверов  тоже  обитает в конце файла.  Заменяет
указатель на точку входа программы стратегий  и  записывая  инс-
трукцию  JMP FAR в точку входа программы прерываний.Адрес преды-
дущей точки входа программы стратегий лежит со смещением  44h от
точки входа в вирус,  пять байт из программы прерываний лежат со
смещением 93Dh от того же места.
     Файлы (COM,  EXE,BIN, SYS) заражает находясь в резиденте по
стандартному образцу,  но только на флопах.  Размер файлов и  их
содержимое (при наличии вируса в памяти) не изменяется.
     При запуске зараженной программы при содействии CONFIG.SYS,
лежащего на диске C:,  плюхается во все файлы, загружаемые через
DEVICE.
     Для борьбы  с отладчиком и в целях уменьшения кода заменяет
адрес обработчика int 3 на int 21 и в дальнейшем к int 21  обра-
щается через int 3.

                               - 22 -

     В свое время был добавлен :
     Скандально известный  по американским хроникам вирус March6
RB512. Разбиратся с деструктивными свойствами данного мутанта не
было ни сил, ни желания, единственное, что можно сказать - вирус
основательно пеработан, но не в принципиальном смысле, а в смыс-
ле изменения масок, большая чать кода подверглась переработке. В
соответствии с старыми стоуновскими традициями,  хранит исходный
Boot дискетты  -  в 1/0/3 при адресации головка/цилиндр/сектор и
Partition винчестера в 0/0/7 при той-же адресации.
     Кроме того  исправлена  давнешняя ляпа с Int 2A - раньше не
смотрели там маски,  а просто - iret/не iret, отныне все по мас-
кам.

     В свое время был добавлен :
     Live after Death RC800 - добавлено  4  модификации  данного
вируса (похоже, что их на самом деле больше, но у нас было толь-
ко шесть).  В свое время приобрел популярность своим манипулиро-
ванием Int  2Fh  - ставит на себя 13-й инт для обмана сторожеви-
ков. Авторство данного вируса судя по  всему  не  без  основания
приписывается Dark  Avenger.  Заражает файлы многократно (видать
бага вкралась). При заражении вставляет на себя JMP первыми тре-
мя байтами и на место концовки программы записывает кусок своего
инсталлятора (естественно,  что  исходные  байты  запоминаются).
Имеет довольно оригинальную стратегию перехвата  - перехватывает
INT 2A - сетевое прерывание, которое ДОС вызывает в процессе об-
работки INT 21,  при этом в стеке находится функция,  с  которой
был вызван ДОС и параметры.

     В свое время был добавлен :
     Phoenix RC1704 - старший брат предидущего вируса,  все опи-
санное прежде относится и к этому вируса,  основная  особенность
(что и видно в названии) - специфическая любовь к Phoenix BIOS -
автор вируса явно не раз дизассемблировал этот BIOS, поэтому ви-
рус долго  ищет маски BIOSа,  после чего выставляет INT 13 в из-
вестный ему обработчик.

     В свое время был добавлен :
     Enola 1.09 - новая версия вируса  "Enola  gates  flight  to

                               - 23 -
Softpanorama" от  своего  старшего брата в лудшую сторону ничуть
не отлитчается.  Длина вируса 2304. Резидентен. При заражении по
запуску не отличает COM файла от EXE,  заражая EXE-файл как COM,
что приводит к зависанию зараженных EXE файлов. Устанавлиается в
резидент вставлением в обработчик 21-го прерывания Int 65, кото-
рый, естественно перехватывает.  Кроме того,  перехватывает  8-е
прерывания, на  котором занимается борьбой с отладчиком о вообще
всякой ерундой. У пользователей DR DOSа появления данного вируса
на компьютере приведет к зависанию систему в сявзи  с  тем,  что
COMMAND.COM там EXE файл и заразится некорректно.

     В свое время был добавлен :
     Бутовый вирус Rostov - мутация Stone, исходный партишн хра-
нит в 0/0/2, исходный бут дискеты в 1/0/3

     В свое время был добавлен :
     Generic Boot RBC512 - очередная вариация на тему Stone, хо-
тя внешне серьезно переработан.  При загрузке сохраняет содержа-
ние оригинального  13-прерывания в прерывание D3,  которым впос-
ледствии и  пользуется  вместо  13-го.  На   винчестере   хранит
исходный Partition  в 0/0/13 (десятичное),  на гибких дисках ис-
ходный Boot хранится в 1/0/3 как и у Stone. Больше вроде сказать
нечего, кроме  того,  что  появится кроме как из коллекции како-
го-то горе-вирусолога. Правда оказалось, что Generic - это назва-
ние, придуманное  сканером  McAfee для их универсальной маски на
бутовые вирусы, что-то типа :
     mov ax,Word Ptr[0413h]
     dec ax
     dec ax
     mopv Word Ptr[0413h],ax
Поэтому:

     В свое время был добавлен :
     Generic RB512 - почти тоже самое,  только чудок чильнее пе-
реработан -  во  у народа времени незанятого-то.  Пишет исходный
Partition винчестера в 0/0/13,  исходный бут пишет в разные мес-
та, в зависимости от размеров зараженной дискетты, но координаты
куда записал держит с себе со смещениями

     05-головка
     06-цилиндр
     04-сектор


                               - 24 -
     Тут неожиданно ожил очень старый вирус и
     В свое время был добавлен :
     SexRevolution RB512 - очередная  Stoneада-  исправлены  на-
чальные байты обработчиков - наверное, чтоб антивирусы не ловили
:-). Partition хранит в 0/0/8, исходный бот дискетты в 1/0/3


     Тут неожиданно ожил очень старый вирус и
     В свое время был добавлен :
     Den-Zuk -  ну  явно все знют что это такое - но чтоб само и
ногами 8-).  В общем,  по винтам не размножается,  исходный  бут
хранит в 0/028h/021h. При перезагрузке иногда рисует картинку.


     При обнаружении любых ошибок (не грамматических)  в  описа-
нии, просьба немедленно сообщить,  т.к. это может повлечь некор-
ректную работу Лекаря.

     Связывайтесь с нами:

     FIDO : 2:463/32 - MiKrOB Nest
            2:463/34 - MiKrOB Point
            2:463/33 - The Third Level

     RELCOM: max@asinfor.kiev.ua
             fil@fund.kiev.ua

     Соответственно на /34  и  /33  функционирует  BBs,  которые
только и ждут, что Вы позвоните и снимете последнюю версию Лека-
ря.

     А если кто непременно хочет связаться голосом, то звоните:

     (044) 449-9767 до и после 11.00





                               - 25 -
                          Logo Picture

      ┌──────────────────────────────────────────────────────┐
      │Lecar Lecar Le ┌─┐ ecar Lecar Lecar Lecar Lecar Lecar │
      │ Lecar ┌─┐ r  ┌┘│└┐ ecar Lecar Lecar Lecar ┌─┐ r Lecar│
      │r Lec ┌┘│└┐  ┌┘\│/└┐ ecar Lec ┌─┐ car Le ┌─┘│└─┐  Leca│
      │ar L ┌┘\│/└┐┌┘\\│//└┐ ecar L ┌┘│└┐ car  ┌┘\\│//└┐  Lec│
      │car ┌┘\\│//└┐\\\│///└┐ ecar ┌┘\│/└┐ ca ┌┘\\\│///└┐  Le│
      │ec ┌┘\\\│///└┐\\│///┌┘ Lec ┌┘\\│//└┐ c └┐\\\│///┌┘ r L│
      │Le └┐\\\│///┌┘\\│//┌┘ r L ┌┘\\\│///└┐ c └───╥───┘ car │
      │ Le └┐\\│//┌┘└──╥──┘ car ┌┘\\\\│////└┐ car  ║ ar Lecar│
      │r Le └──╥──┘  L ║ r Lec ┌┘\\\\\│/////└┐ car Lecar Leca│
      │ar Leca ║ acar  ║ ar Le │\\\\\\│//////│ ecar Lecar Lec│
      │car Lec ║ Lecar ║ car L └┐\\\\\│/////┌┘ Lecar Lecar Le│
      │ecar Le ║  Lecar Lecar L └┐\\\\│////┌┘  ┌┬@┬@┬@┬┐ ar L│
      │Lecar Lecar Lecar Lecar L └────╥────┘ c ││▓│▓│▓│╞═╗ r │
      │ Lecar Lecar Lecar Lecar Lecar ║ car Le ││Э│▒│Ь││ ║ ar│
      │r Lecar Lecar Lecar Lecar Leca ║ ecar L ││▒│Л│▒│╞═╝ ca│
      │ar Lecar Lecar Lecar Lecar Lec ║ Lecar  └┴─┴─┴─┴┘  Lec│
      │car Lecar Lecar Lecar Lecar Lecar Lecar Lecvar Lecar L│
      └──────────────────────────────────────────────────────┘

                        /MiKrOB&Turmite

