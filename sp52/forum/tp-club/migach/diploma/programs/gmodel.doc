
                    Модуль  GModel V 1.0

                  (c)  1992 Ярослав Мигач


       Даный модуль определяет базовые данные и обьект базовой
   модели для программ моделирования цифровых электронных схем и
   систем, с учетом задержек в элементах и затягивания фронтов
   сигналов ( эффект гонок по входу ).
       Модуль написан на языке программирования Turbo Pascal
   V 6.0 и требует для своей поддержки стандартные модули
   System, Dos и Crt, как правило, находящиеся в библиотеке
   TURBO.TPL .
       Ключи трансляции позволяют делать описываемый модуль
   оверлеем.

                Константы.

       MaxDealLm = 128 - эта константа определяет максимальное
   количество выводов логической электронной схемы или  системы
   используемой в качестве моделируемой единицы. При изменеии
   пользователем, константа не должна превосходиить диапазон
   одного байта. То есть максимальное устанавливаемое количество
   выводов - 255.

       MaxConnect = 5 - эта константа определяет максимальное
   количество выводов моделей ЛЕС соединенных в одном узле.
   Максимальное значение константы не должно выходить за
   байтовый диапазон. Не следует слишком увлекаться, тк. большое
   значение этой константы приведет к большому расходу памяти
   для обьекта модели. Разумное значение константы находится в
   диапазоне 5 - 15.


                Обьявляемые типы даных.

        StateLm - перечисляемый тип, определяющий состояние
    вывода логической электроной схемы или системы ( ЛЭС ) в
    текущий момент времени моделирования.  Переменная или
    константа этого типа может принимать следующие значения :
        > ZState   - вывод находится в Z состоянии, т. е. не
                   воспринимает и не выдает электрические
                   сигналы;
        > InLm     - вывод является входным для данной ЛЭС и
                   при опросе на выдачу сигнала распознается
                   моделирующей системой как Z состояние;
        > OutLm    - вывод является выходом микросхемы;
        > GroundLm - вывод дожен быть заземлен;
        > PowerLm  - на вывод должно быть подано напряжение
                   питания.
    Следует отметить, что первые три состояния могут изменятся в
    процессе моделирования, в зависимости о внутренней логики
    обработки сигналов моделируемой ЛЭС.


        InformLm - Тип данных, содержащий информацию о выходном
    состоянии моделируемой ЛЭС. Этот тип является записью,
    содержащей следующие поля :
        > State    - состояние вывода в текущий момент
                   моделирования;
        > U        - Выходное напряжение, если вывод находится в
                   состоянии OutLm.

        BaseModelPtr - указатель на базовый обьект модели ЛЭС.

        FullStateLm - Эта записть содержит полную информацию о
    выводе ЛЭС. Запись содержит следующие поля :
        > Info     - состояние вывода и его напряжение в режиме
                   "выход";
        > InPrU_1  - значение порогового напряжения для
                   идентификации логической "1" на данном входе
                   ЛЭС;
        > InPrU_0  - значение порогового напряжения для
                   идентификации логического "0" на данном
                   выходе ЛЭС;
        > InCounter - счетчик переключения. Это поле может
                   принимать заранее устанавливаемый
                   максимальное и минимальное значения, которые
                   определяют время реакции состояния входа на
                   изменение входного сигнала. При каждом такте
                   моделирования состояние счетчика изменяется в
                   большую или меньшую сторону, в зависимости от сигнала
                   поданного на вход. При достижении одного из
                   пороговых значений внутреннее состояние входа
                   переключается;
        > InPrCounter_1 - пороговое значение счетчика
                   переключения для установки входа в состояние
                   логической "1";
        > InPrCounter_0 - пороговое значение счетчика
                   переключений для установки входа в состояние
                   логического "0";
        > Out_1    - напряжение выхода ЛЭС для логической "1";
        > Out_0    - напряжение выхода ЛЭС для логического "0";
        > OutCount - приращение напряжения переключения выхода
                   при изменении состояния для элементарного
                   такта моделирования. Введение этого поля
                   обеспечивает как задержку по выходу, так и
                   затягивание фронтов выходных сигналов;
         > Friend  - список из MaxConnect выводов  ЛЭС к
                   которым подсоединен данный вывод текущей
                   модели.
    Таким образом запись по одному выходу будет занимать
    приблизительно 100 байт динамически распределяемой области
    памяти в момент моделирования.


        StateModel - Массив информации о всех выводах
    моделируемой ЛЭС. Фактически определяет состояние модели на
    текущий момент времени моделирования. Переменная такого типа
    расчитана на максимальное количество выводов модели ЛЭС,
    однако фактически массив будет занимать меньше места в
    памяти при распределении кучи методом FREEMEM.

        StateModelPtr - указатель на массив состояния модели.


                Базовый обьект модели ЛЭС. ( BaseModel )

       Поля.
       _____

       DealLm - Общее количество выводов конкретной модели ЛЕС

       Констракторы и дестракторы.
       ___________________________

       CONSTRUCTOR Init; - Инициализация обьекта модели ЛЭС,
    размещение в динамически распределяемой области памяти
    информационного массива модели. Констрактор базового обьекта
    не может быть использован непосредственно.

       DESTRUCTOR Done; VIRTUAL; - Деинициализация обьекта
    модели ЛЭС, удаление из динамически распределяемой области
    памяти информацию о модели, уничтожение таблицы виртуальных
    методов. Дестрактор является виртуальным и должен быть
    переназначен для реальных моделей.

       Базовые методы.
       _______________

       PROCEDURE GetStateLm ( NumLm : BYTE; VAR State : InformLm);
                     VIRTUAL;
                - Метод возвращает текущее состояние
    вывода обьекта моделирования ЛЭС на данный момент времени.
    Метод является виртуальным и должен быть переназначен для
    реальных моделей.
        > NumLm - номер вывода;
        > State - выходное состояние вывода.

       PROCEDURE SetStart; VIRTUAL; - Устанавливает начальное
    состояние выходов обьекта моделирования ЛЕС таким образом,
    чтобы оно соответствовало состоянию все единицы на входах.
    Метод является виртуальным и должен быть переназначен для
    реальных моделей.



       PROCEDURE ConnectLm ( MyNum, NumObj : BYTE;
                             ObjPtr : BaseModelPtr;
                             VAR Result : BYTE ); VIRTUAL;
                - Метод позволяет установить однонаправленное
    соединение с заданного вывода оьекта модели с заданным
    выводом другого обьекта модели. Не исключается соединение
    выводов оного и того-же обьекта. Метод является виртуальным
    и должен быть переназначен для реальной модели.
        > MyNum  - номер вывода данного обьекта;
        > NumObj - номер вывода подсоединяемого обьекта;
        > ObjPtr - указатель на подсоединяемый обьект;
        > Result - результат операции :
                 > 0  - успешное соединение;
                 > 1  - соединение уже было задано;
                 > 2  - нет места для соединения;
                 > 3  - соединение невозможно;


       PROCEDURE RunModel; VIRTUAL; - Производит один такт
    моделирования. Изменяет состояние выходов модели в
    зависимости от состояния входов и внутренней логики.


                Внешние процедуры и функции.


        PROCEDURE AbstractModel ( Line : STRING ); - эта
     процедура вызывается абстактными методами обьекта, для
     идентификации вызова метода абстрактного обьекта. В
     качестве параметра дожен быть передан строковый
     идентификатор абстрактного метода, которому было передано
     управление. Процедура переключает терминал в текстовый
     режим, выдает сообщение об ощибке и прерывает работу
     основной программы.


        PROCEDURE FatalError ( Un, Proc, Line : STRING );
     - Переводит терминал в текстовый режим и выдает сообщение
     о критической ошибке, прерывая после этого работу
     программы.
        > Un   - Имя модуля;
        > Proc - Название процедуры ( функции или метода );
        >Line - Характер ошибки.



        PROCEDURE ConnectModels
                       ( Num1 : BYTE; Obj1Ptr : BaseModelPtr;
                         Num2 : BYTE; Obj2Ptr : BaseModelPtr;
                         VAR Result : BYTE );
     - Выполняет соединение двух выводов различных  обьектов
     моделирования ЛЭС. Допускается соединение выводов одной и
     тойже модели.
        > Num1    - номер вывода первого обьекта модели;
        > Obj1Ptr - указатель на первый обьект модели;
        > Num2    - номер вывода второго обьекта модели;
        > Obj2Ptr - указатель на второй обьект модели;
        > Result  - результат операции :
                  > 0  - успешное соединение;
                  > 1  - соединение уже было задано;
                  > 2  - нет места для соединения;
                  > 3  - соединение невозможно.


        PROCEDURE SetKeyState ( Friend : ConcatLm, 
                                VAR CurrentState : InformLm );

     - Устанавливает суммарное состояние входного вывода модели 
     по массиву подключенных выводов.
        > Friend       - информация о подключенных выводах;
        > CurrentState - устанавливаемое состояние. Перед первым 
     вызовом процедуры для исследуемого состояния переменную 
     состояния необходимо установить в State = ZState и U = 0.0

