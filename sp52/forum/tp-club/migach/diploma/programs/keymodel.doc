
                    Модуль KeyModel V 1.0

                   (c) 1992  Ярослав Мигач


        В описываемом модуле приводятся базовый обьектный тип
   модели переключателя, и обьектные типы моделей трех различных
   типов переключателей. В интерфейсной секции также описан ряд
   вспомогательных типов данных и внешних процедур, необходимых
   для работы с обьектами, моделирующими переключатели.
        Модуль написан на языке программирования Turbo Pascal
   V 6.0 и требует для своей поддержки модули System, Dos, Crt
   - из стандартной библиотеки TURBO.TPL, а также модуль
   GMODEL.TPU где содержится базовый обьект для моделирования
   логических электронных схем и систем ( ЛЭС ).
        Ключи трансляции позволяют делать описываемый модуль
   оверлеем.


                Константы.

        MaxDealSwitch = 256; - Определяет максимально возможное
    количество замыкаемых контактов ( кнопок ) в  модели
    переключателя. При переопределении, константа не должна
    превосходить диапазон машинного слова. Приведенное значение
    константы вполне достаточно для моделирования большенства
    типов переключателей и даже клавиатур.


                Обьявляемые типы данных.

        KeyLm - Запись, содержащая полную информацию о состоянии
    вывода переключателя на текущий момент времени
    моделирования. Сюда включены следующие поля :
        > InfOut : InformLm; - cостояние вывода при его
                   интерпритации в качестве выхода перключателя;

        > Friend : ConnectLm
                   - массив записей, определяющий соединения с
                   соседними обьектами моделируемой системы.

        StateKeyModel = ARRAY [ 1..MaxDealLm ] OF KeyLm;
    - Массив состояния всех выводов переключателя на текущий
    момент времени моделирования.

        StateKeyModelPtr = ^StateKeyModel;
    - Указатель на массив состояний выводов переключателей.




    StateSwitch = ARRAY [ 1..MaxDealSwitch ] OF BOOLEAN;
    - Массив состояний контактов ( кнопок ) моделируемого
    переключателя.
      > FALSE - выключено;
      > TRUE  - включено.

        StateSwitchPtr = ^StateSwitch;
    - Указатель на массив состояния контактов.


                Обьектный тип базавой модели переключателя.

        BaseKeyModel = OBJECT ( BaseModel )

    BaseKeyModelPtr = ^BaseKeyModel;
    - Указатель на обьект модели абстрактного переключателя.


        Поля.
        ___________________________

        InfLm : StateKeyModelPtr; - Указатель на массив
   состояний выводов. Динамически распределяемая область памяти
   выделяется для этого указателя констрактором описываемого
   обьектного типа. Выход за границы диапазона обьявленного в
   констракторе количества выводов запрещен. Распределение
   памяти под данный указатель отменяется дестрактором
   обьектного типа.

        DealSwitch : WORD; - Переменная определяет количество
   замыкаемых контактов моделируемого переключателя. Меременная
   определяется при инициализации обьекта его констрактором и не
   должна изменять свое значение во время всего существования
   обьекта, поскольку она определяет действительную размерность
   массива состояний контактов.

        InfSwitch : StateSwitchPtr; - Указатель на массив
   состояний контактов переключателя. Массив определяет
   состояние кахдого из контактов моделируемого переключателя в
   каждый момент времении моделирования. Динамически
   распределяемая область памяти выделяется под указатель
   констрактором и перераспределяется дестрактором обьектного
   типа. Выход за пределы допустимого диапазона, определяемого
   переменной DealSwitch запрещен, проскольку эта переменная
   определяет реальный обьем памяти выделяемый массиву состояний
   контактов.



        Констракторы и дестракторы.
        ___________________________


        CONSTRUCTOR Init ( DLm : BYTE; DSwitch : WORD );
   - Инициализирует обьект описываемого обьектного типа.
   Распределяет память под массивы состояний выводов и контактов
   переключателя. Устанавливает действительный границы массивов
   состояний.
        > DLm     - количество выводов переключателя;
        > DSwitch - количество замыкаемых контактов
                  переключателя.

        DESTRUCTOR Done; VIRTUAL;
    - Деинициализирует обьект, перераспределяет память
    выделенную констрактором для массивов состояний, уничтожает
    таблицу виртуальных методов. Дестрактор является виртуальным
    и при необходимости может быть переназначен наследующими
    обьектными типами.


        Базовые методы.
        _______________


        PROCEDURE GetStateLm ( NumLm : BYTE;
                               VAR State : InformLm); VIRTUAL;
    - метод позволяет получить текущее состояние заданного
    вывода переключателя. Возвращаемое значение зависит от
    состояния модели переключателя на текущий момент времени
    моделирования. Этот метод замещает аналогичный метод
    базового обьекта абстрактной модели ЛЭС для любой модели
    переключателя.

        PROCEDURE SetSwitch ( NumberSwitch : WORD ); VIRTUAL;
    - Метод устанавливает состояние заденного контакта модели
    переключателя в положение "Включено". Если контакта с
    заданным номером не существует, то выводится сообщение о
    критической ошибке и выполнение программы прекращается.
    Метод является виртуальным и может быть переназначен
    наследюющим методом более конкретной модели.

        PROCEDURE DoneSwitch ( NumberSwitch : WORD ); VIRTUAL;
    - Метод устанавливает состояние заданного контакта модели
    переключателя в положение " Выключено". Если контакта с
    заданным номером не существует, то выводится сообщение о
    критической ошибке и выполнение пргограммы прекращается.
    Метод является виртуальным и может быть переназначен
    наследюющим методом более конкретной модели.


        FUNCTION GetStateSwitch ( NumberSwitch : WORD )
                                 : BOOLEAN; VIRTUAL;
    - Метод возвращает текущее состояние заданного контакта
    модели переключателя. Если контакта с заданным номером не
    существует, то вдается сообщение о критической ошибке и
    выполнкение программы прекращается. Метод является
    виртуальным и может быть переназначен более конкретными
    наследюющими оьектами моделей. Возвращаемое значение :
       > TRUE  - если контакт замкнут;
       > FALSE - если контакт разомкнут.

        PROCEDURE ConnectLm ( MyNum, NumObj : BYTE;
                              ObjPtr : BaseModelPtr;
                              VAR Result : BYTE ); VIRTUAL;
    - Метод устанавливает одностороннюю связь с другим обьектом
    ЛЭС между заданными выводами. Этот метод является
    переназначением аналогичного метода обьектного типа
    абстрактной модели элемента ЛЭС. При необходимости он может
    быть переназначен наследующими обьектами.

        PROCEDURE SetStart; VIRTUAL;
    - Метод производит начальную установку внутренних состояний
    обьекта перед началом первого такта моделирования. При этом
    все контакты устаноавливаются в состояние "Выключено"
    ( разомкнуто ), а все выводы принимают безразличное Z-
    состояние. Этот метод является переназначением аналогичного
    методя обьектного типа абстрактной модели элемента ЛЭС.  При
    необходимости метод может быть переназначен наследующими
    обьектными типами.

        PROCEDURE RunModel; VIRTUAL;
    - Производит один такт моделирования. Этот метод является
    абстрактным и должен быть переназначен обьектными типами
    реальных моделей переключателей. При непосредственном вызове
    генерируется сообщение о вызове абстрактного метода и
    выполнение программы прекращается.


                Обьектный тип модели позиционного
                       переключателя.

    PositionKey = OBJECT ( BaseKeyModel )
       - Идентификатор обьектного типа.

    PositionKeyPtr = ^PositionKey;
       - Указатель на обьект модели позиционного переключателя.

                              s1
              K1  _________|__ ___ ______  K2
                           |       ______  K3
                           .  s2     ......
                           |       ______  Knn
                           |  sN

        Модель характеризуется тем, что всегда один из контактов
    замкнут, а остальные при этом разомкнуты. Выходное состояние
    замкнутых между собой выводов одинаково. Разокнутые выводы
    находятся в безразличном Z - состоянии. Данная модель
    обеспечивает мгновенное переключение любого вывода с
    ведущим, что не соответствует реальному переключателю,
    который при переключении проходит все возможные состояния
    переключений между  переключаемыми выводами, что может
    повлиять на работу реальной ЛЭС.

        Поля.
        _____

        Данный обьектный тип дополнительных полей не содержит.


        Констракторы и дестракторы.
        ___________________________


        CONSTRUCTOR Init ( DSwitch : WORD ); - Производит
   инициализацию описываемого обьектного типа для модели N -
   контактного позиционного переключателя. Количество выводов
   устанавливается на 1 больше, чем количество контактов. Затем
   вызывается констрактор обьектного типа абстрактной модели
   переключателя.

        DESTRUCTOR Done; VIRTUAL; - Производит деинициализацию
   описываемого обьектного типа. Вызывает дестрактор обьектного
   типа абстракной модели переключателя для перераспределения
   памяти под массивы состояний.


        Базовые методы.
        ________________


        PROCEDURE SetSwitch ( NumberSwitch : WORD ); VIRTUAL;
   - Этот метод устанавливает заданный контакт в положение
   включено и является переназначением аналогичного метода
   обьектного типа абстрактной модели переключателя.  Заданный
   контакт принимает состояние замкнуто, остальные контакты
   переходят в положение "разомкнуто".

        PROCEDURE DoneSwitch ( NumberSwitch : WORD ); VIRTUAL;
   - Этот метод устанавливает заданный контакт в положения
   "разомкнуто" и является переназначением соответствующего
   метода обьектного типа абстрактной модели переключателя. Для
   данной модели метод вызывает сообщение о критической ошибке
   ( вызов недопустимого метода ) и выполнение программы
   прерывается.


        PROCEDURE SetStart; VIRTUAL;
    - Этот метод устанавливает все выводы в Z -  состояние,
    однако первая группа контактов переключателя считается
    замкнутой. Метод являетяся переназначением аналогичного
    метода обьектного типа абстрактной модели переключателя.

        PROCEDURE RunModel; VIRTUAL;
    - метод производит один такт моделирования для данной модели
    позиционного переключателя, устанавливая состояния выводов в
    зависимости от состояния контактов и состояния выводов
    сосдних обьектов, подключенных к данному.


            Обьект модели кнопочного ( однопозиционного )
                        переключателя.

                                 s1
                 K1  _________/ ______  K2


    SimpleKey = OBJECT ( BaseKeyModel )
        - Идентификатор обьектного типа.

    SimpleKeyPtr = ^SimpleKey;
        - Указатель на обьект модели кнопочного переключателя.

        Данная модель является в некотором смысле
   идеализированной, поскольку не учитывает явления дребезга
   контактов. Это можно отнести ко всем моделям переключателей,
   представленных в описываемом модуле обьектных типов моделей.
   Этот недостаток при необходимости можно устранить, введя
   несколько дополнительных переменных для идентификации
   состояния контактов и переназначив методы переключения
   контактов. При этом методы моделирования можно не изменять.

        Поля.
        _____

        Данный обьектный тип дополнительных полей не содержит.


        Констракторы и дестракторы.
        ___________________________


        CONSTRUCTOR Init; - Инициализирует обьявленный обьектный
   тип. Устанавливает количество выводов равное 2 и количество
   контактов - 1. Для размещения в памяти массивов состояний
   вызывает констрактор обьектного типа абстрактной модели
   переключателя.

        DESTRUCTOR Done; VIRTUAL; - Деинициализация обьектного
   типа. Для перераспределения памяти массивов состояний
   вызывает дестрактор обьектного типа абстрактной модели
   переключателя.



        Базовые методы.
        _______________


        PROCEDURE SetStart; VIRTUAL;
   - Устанавливает модельпереключателя в исходное состояние.
   Контакт разомкнут, выводы находятся в безразличном Z -
   состоянии. Этот метод является переназначением аналогичного
   метода обьектного типа абстрактной модели переключателя.


        PROCEDURE RunModel; VIRTUAL;
   - Производит один такт моделирования для данной модели
   переключателя. Устанавливает состояние выводов в зависимости
   от состояния контакта и состояний выводов подключенных
   обьектов моделей. Этот метод является переназначением
   аналогичного абстрактного метода обьектного типа абстрактной
   модели переключателя.


                Обьект модели переключателя типа
                        "сетка контактов"

                     1     N+1   2N+1           M*N+1
               K1  ___/| ___/| ___/| ___ ..... ___/| ___
                     2 |     |     |               |
               K2  ___/| ___/| ___/| ___ ..... ___/| ___
                     3 |     |     |               |
               K3  ___/| ___/| ___/| ___ ..... ___/| ___
                       .     .     .               .
                   .....................................
                     N .     .     .               .
               Kn  ___/| ___/| ___/| ___ ..... ___/| ___
                       |     |     |               |
                       |     |     |               |
                     Kn+1   Kn+2  Kn+3            Kn+m

    NetwareKey = OBJECT ( BaseKeyModel )
        - Идентификатор обьектного типа.

    NetwareKeyPtr = ^NetwareKey;
        - Указатель на обьект модели переключателя типа сетка.

        Данная модель имитирует переключатель типа "сетка
    контактов". К недостаткам модели можно отнести отсутствие
    дребезга. Следует отметить, что правильное поведение модели
    гарантируется лишь при одновременном нажатии не более чем
    3-х контактов сетки, поскольку метод моделирования
    просматривает только прямые пути соединения контактов. Этого
    ограничения как правило достаточно для большинства задач
    моделирования. Однако ограничение существенно при
    моделировании исключительных ситуаций. Для снятия
    ограничения необходимо переназначить метод RunModel и в
    новом методе анализированть все возможные пути
    подсоединений, хотя это и намного замедлит работу модели.


        Поля.
        _____


        DealNLm : BYTE; - количество выводов в плоскости N
   переключателя ( см. рисунок ).

        DealMLm : BYTE; - количество выводов переключателя в
   плоскости M.


        Констракторы и дестракторы.
        ___________________________


        CONSTRUCTOR Init ( DNLm, DMLm : BYTE );
   - Производит инициализацию обьекта для переключателя типа
   "сетка контактов". По назначенной сетке N x M определяется
   количество контактов переключателя и вызывается констрактор
   обьектного типа модели абстрактного переключателя для
   выделения памяти под массивы состояний обьекта моделирования.

        DESTRUCTOR Done; VIRTUAL;
   - Производит деинициализацию обьекта вызывая дестрактор
   обьектного типа абстрактной модели переключателя для
   перераспределения динамически размещаемой области памяти,
   выделенной констрактором под массивы состояний обьекта
   моделирования.


        Базовые методы.
        _______________


        PROCEDURE SetStart; VIRTUAL;
   - Устанавливает обьект модели в исходное состояние. Все
   контакты сетки разомкнуты, все выводы находятся в Z -
   состоянии. Этот метод является переназначением одноименного
   метода обьектного типа абстрактной модели переключателя.

        PROCEDURE RunModel; VIRTUAL;
   - Производит один такт моделирования для модели
   переключателя, определяемой данным обьектом. Этот метод
   является переназначением одноименного абстрактного метода
   обьектного типа абстрактной модели переключателя.

