Cофтпанорама 1990, No. 2 (6) ** VIR_CLUB **  Составитель: Н.Н. БЕЗРУКОВ
***********************************************************************
                                      Приводимые в данном разделе замет-
                                 ки  выражают  мнение авторов,  которое,
                                 естественно, может не совпадать с точки
                                 зрения составителя.

                                                               В. ГУСЕВ

             ПРЕДЛОЖЕНИЯ ПО БОРЬБЕ С КОМПЬЮТЕРНЫМИ ВИРУСАМИ

       Архитектура РС не позволяет надежно защищаться от  вирусов. Можно
ставить задачи защиты от:
       а) программной порчи носителей;
       б) порчи отдельных файлов;
       в) размножения пораженнывх программ.
Утверждается, что  первые две задачи надежно не могут быть решены.  Речь
сможно вести о решении третьей задачи.
       Предложение исходит  из предположения о наличии программного пре-
рывания загрузки программ (без выполнения),  используемого, в частности,
как  составная часть общеупотребительного прерывания "загрузить и выпол-
нить".
       Предложение позволяет  как обнаруживать загрузку зараженных прог-
рамм, так и попытку обойти контроль загружаемых программ.
       Все файлы  (кроме  указанных  ниже)  на  резидентном диске (файлы
программ) преобразуются к специальному виду (прививка!):
       а) участок  кода в точке входа заменяется на команды сигнализации
          обхода контроля с блокированием продолжения работы (и  возмож-
          ным переходом к анализу состояния памяти ЭВМ);
       б) заменяемый участок вписывается в конец файла;
       в) к  концу файла приписывается кеонтрольная сумма файла (КS);
       г) с файлом ассоциируется бит, единичное состояние которого несет
          смысл "программа находится на карантине",  а также счетчик вы-
          зовов, имеющий смысл срока карантина.
       Прерывание загрузки программ перехватывается резидентной програм-
мой,  включающей,  возможно,  также дополнительные входы, напиример, для
реализации упомянутой выше блокировки нормальной работы и анализа состо-
яния памяти.
       Перехватчик загружает  через  ОС запрашиваемый файл и сверяем KS.
Если обнаружена ошибка,  то анализируется, своя ли это программа, но ис-
порченная,  или исмпортируемая (это может делаться, например, по анализу
кода в точке входа).  В первом случае запуск программы отвергается с со-
ответствующей диагностикой. Во втором случае следует запрос к оператору.
Запуск выполняется только по его разрешению. При этом в специальном жур-
нальном  файле  желательно регистрировать время,  дату,  имя диска,  имя
программы и т.д. для последующего анализа.
       Для "своей" программы, не имеющей ошибок, перед запуском выполня-
ется преобразование:  восстановление кодов в точке  входа,  отбрасывание
хвоста файла.  Если программа на карантине, вычитается счетчик срока ка-
рантина (и исправляется KS, если нужно). В случае его обнуления, бит ка-
рантина обнуляется.
       Для записи на резидентный диск новых программ в специальном  фор-
мате используется особая утилита приема программ, устанавливающая, кроме
всего прочего,  признак карантина и его срок. Для программ, генерируемых
компиляторами,  в  ряде  случаев  установку признакат карантина можно не
требовать.
       Возможно чаще  должна  запускаться  утилита проверки KS файлов на
резидентном диске,  дублирующая функцию проверки программы-перехватчика.
Если ошибок не обнаруживается, можно стирать файл журнала с регистрацией
запусков импортируемых (чужих) программ.
       В случае  обнаружения ошибок KS или обхода программы-перехватчика
предлагается для анализа список подозрительных на вирус программ. В него
включаются программы,  зарегистрированные в журнале (чужие), и программы
на карантине (свои).
       Резидент ОС модифицируется:
       а) приписывается KS (т.к. проверяется утилитой);
       б) вызов  COMMAND.COM заменяется на вызов программы-перехватчика.
       Программа-перехватчик:
     а) снабжается KS (т.к. проверяется утилитой);
     б) завершает свое выполнение загрузкой и запуском COMMAND.COM.
     Лишь две  эти  программы  не модифицируются в точке входа.
     Копирование чужих программ дополняется входным контролем с помо щью
существующих программ контроля на вирус.
