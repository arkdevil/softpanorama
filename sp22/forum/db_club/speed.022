Софтпанорама, No.2, 1990 *** DB_CLUB *** Составители Accoнов А.,Костюков С.
**************************************************************************
                       DATA BASED ADVISOR/MATCH 87
                       dBASE-LAGUAGE SPEED TESTS
                         By Georg F.Goley. IV
    ----------------------------------------------------------------------

                              SPEED TESTS

                            Входной язык dBASE:

                         ТЕСТЫ ПРОВЕРКИ  СКОРОСТИ
                         ------------------------

             Clipper, dBASE III PLUS, FoxBASE+  и Quicksilver,

                           СОРЕВНУЮТСЯ В СКОРОСТИ

                        ( перевод С.Н.Костюкова )

         Существует по  меньшей мере  шесть наиболее важных характеристик,
    которые необходимо учитывать,  когда рассматривается вопрос об исполь-
    зовании языка dBASE для решения прикладных задач. К ним относятся:

         1. Простота использования для разработчика пркладных систем.
         2. Скорость.
         3. Специальные возможности.
         4. Совместимость с системами архитектуры dBASE.
         5. Простота использования для конечного пользователя.

         Эта статья посвящена рссмотрению только второго пункта,  а именно
    - скорости выполнения команд и функций.  Я упомянул  остальные  четыре
    характеристики в начале статьи для того,  чтобы подчеркнуть,  что ско-
    рость не всегда самое главное соображение при выборе  языка программи-
    рования.
         Цель этой статьи - продемонстрировать методику  для  выбора  наи-
    быстрейшего языка   для  конкретного  приложения.   Однажды  определив
    наиболее быстрый вариант(язык), вы можете рассмотреть остальные факто-
    ры  прежде  чем  сделаете  окончательный выбор  dBASE-ориентированного
    языка.
         Приводимые контрольные  испытания предназначены для прогнозирова-

                                    - 2 -
    ния возможностей языков в широком диапазоне приложений, основываясь на
    ограниченном наборе не вполне естественных тестов. Эта попытка, отчас-
    ти напоминает попытку предсказать профессиональную пригодность выпуск-
    ника университета  исключительно  на  основании результатов каких-либо
    интелектуальных тестов. Данная статья не является попыткой продемонст-
    рировать наиболее совершенную методику контрольных испытаний и, поэто-
    му я заранее соглашаюсь с возможной критикой в мой  адрес  и  в  адрес
    предлагаемой методики.
         Однако, несмотря на это,  я думаю,  что полученные  результаты  и
    описываемая методика могут быть полезны для пользователей dBASE-ориен-
    тированных систем.
         Одна из  наиболее сложных проблем в любом тестировании - объявле-
    ние победителя.  Для каждого из тестов дается заключительная оценка  в
    виде относительного весового значения.  Это позволяет дифференцировать
    важность различных компонентов языка.  Весовая  шкала  устанавливается
    путем ранжирования важности тестов для конкретного приложения.  Каждый
    пользователь для своего приложения определяет важность команд и  функ-
    ций языка и, сообразно этому, распределяет веса.  Например,  если ваша
    программа должна содержать большое  количество  операторов  управления
    экраном (@SAY,  @GET, CLEAR), то вы должны присвоить максимальные веса
    тестам, проверяющим быстродействие именно этих команд.
         С другой  стороны,   если ваши приложения больше ориентированы на
    различные вычисления и формирование  отчетов,   то  максимальные  веса
    должны назначаться командами типа SKIP, LOKATE и т.д.


                         ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ
                         ----------------------

         Реализация тестов осуществлялась на персональном компьютере  типа
    IBM, PC/AT, в конфигурацию которого входили следующие компоненты:

         стандартный процессор 80286 (10 Мгц);
         1 Мб оперативной памяти, адаптер монохромного дисплея и сам дисп-
         лей;
         44 Мб твердый диск со средним временем доступа 28 мс.


                                    - 3 -
         Каждый тест отрабатывается по двум вариантам:  со стандартным ма-
    тематическим сопроцессором и без него.
         Мы разделили "твердый" диск на две директории.  Одна из  них  ем-
    костью  15  Мб  содержала все программы в исходных кодах и контрольные
    данные для тестов.  Вторая часть,  которая включала оставшиеся 29  Мб,
    была предназначена для активных данных,  индексов, программ, ЕХЕ и OVL
    файлов.
         После этого  мы выполняли тесты для каждого языка.  Перед началом
    каждой новой серии тестов 29 Мб директория очищалась полностью от всех
    данных, которые сформировались и использовались в ходе предыдущего ис-
    пытания. Таким образом мы хотели поставить каждый испытуемый продукт в
    равные условия с точки зрения операций ввод/вывод для "твердого" диска.
         Для читателей, которые используют в своей работе ПК IBM PC/XT или
    эквивалентные модели,  необходимо помнить, что производительность этих
    компьютеров существенно отличается возможностью ПК серии АТ и  поэтому
    расхождение в  результатах тестов могут быть значительными.  Например,
    арифметические операции,  экранный  ввод/вывод  данных  осуществляется
    примерно в десять раз медленнее на моделях ХТ, чем на моделях АТ.


                      ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ
                      -----------------------

         Мы использовали следующие версии dBASE-ориентированных языков:

         Autumn'86 Clipper
         Quicksilver v.1.0
         FoxBASE+    v.1.21
         dBASE III + v.1.1


                      МАТЕМАТИЧЕСКИЙ СОПРОЦЕССОР 80287
                      --------------------------------

         Когда мы впервые обсуждали эту статью,  полагалось,  что  наличие
    или отсутствие  математического  сопроцессора  не может в значительной
    степени повлиять на Clipper и Fox-программы. Мы также решили, что сов-

                                    - 4 -
    сем незначительная  часть наших читателей позволяет иметь в своих сис-
    темах этот довольно дорогой процессор.
         После представления  программы  испытаний  всем  заинтерисованным
    производителям программного обеспечения,  фирма Fox Software сообщила,
    что после опробования тестов, они получили результаты, отличающиеся от
    наших. После некоторого исследования,  мы обнаружили, что Fox Software
    для опробования тестов использовала системы с 80287 процессором.  Ока-
    залось, что  использование  сопроцессора  увеличивает   быстродействие
    FoxBASE+   по крайней мере в  4  раза  в  отдельных тестах.   Clipper,
    dBASE III + и Quicksilver также увеличивали быстродействие с сопроцес-
    сором, но это увеличение было менее впечатляющим, чем у FoxBASE+.
         Вы заметите,  что преимущество того или иного языка при использо-
    вании процессора  80287 связаны с языком программирования,  на котором
    написаны все dBASE-ориентированные языки.


                          ХРОНОМЕТРИРОВАНИЕ
                          -----------------

         За редким  исключением мы использовали для замера времени систем-
    ный таймер.  Поскольку системный таймер дает точность до 0.54 секунды,
    многие из односекундных тестов мы принимали с округлением, т.к. в этом
    случае речь уже идет не об отличиях в испытаниях,  а  в  самих  часах.
    Кроме того, мы считаем, что использование системного таймера дает  бо-
    лее хорошие результаты, чем хронометрирование при помощи секундомера.
         Однако ручное хронометрирование все же пришлось применить в одной
    из групп тестов.  При первом прогоне Quicksilver показал  необъяснимое
    превосходство в индексировании, часто побеждал своих конкурентов в че-
    тыре раза большей скоростью на этой операции.   Поскольку  Quicksilver
    наследует идеологию индексирования от dBASE III + для нас это было не-
    ожиданностью, как, впрочем и для его разработчиков из фирмы Word Tech.
         Объяснение этой  загадки оказалось именно в системном хронометри-
    ровании результатов  испытаний.    Оказалось,    что   ранняя   версия
    Quicksilver, которую  мы  использовали,  периодически приостанавливала
    таймер в процессе индексирования. Word Tech уже решила эту проблему, а
    нам в тот период пришлось использовать ручной хронометраж.


                                    - 5 -
                          РЕЗУЛЬТАТЫ ТЕСТИРОВАНИЯ
                          -----------------------

         В каждой группе тестов (нумерация в крайней левой колонке) первая
    строка отражает результаты, полученные без математического сопроцессо-
    ра 80287. Вторая строка показывает результаты с процессором 80287.
      Колонки со 2-й по 5-ю показывают время (в секундах),  которое требо-
    валось  каждому  языку для выполнения теста.  В колонках с  6  по  8-ю
    представлены относительные показатели Clipper,  FoxBASE+ и Quicksilver
    по сравнению с dBASE III +.  В последней  колонке  содержатся  весовые
    значения, которые мы присвоили каждому тесту.


                           ИНДЕКСИРОВАНИЕ
                           --------------

         Первых два теста являются комбинацией восьми различных заданий на
    индексирование выполненных на двух файлах по 300 записей (другими сло-
    вами, тесты с 1 по 8). В первом файле длина записи - 64 байта, во вто-
    ром - 1000 байт.  Индексы строились по символическим, числовым, комби-
    нированным полям и полям типа дата.  Поскольку результаты  были  схожи
    для всех восьми тестов, мы  приводим их только для одного из них.

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

            1    69     39     31     41    1.77   2.23   1.68    2
            1    71     40     17     39    1.78   4.18   1.82    2
            2   643   1176    477    585    0.55   1.35   1.10    2
            2   591   1176    279    600    0.50   2.12   0.99    2

         Второй тест выполнен как комбинация четырех различных индексов  в
    файле на 10000 записей и 64 байта длины записи (тесты с 9 по 12).  Ин-
    дексы строились по дате,  символам, числам и смешанным ключам. Заметь-
    те, что Clipper справился с созданием индекса большой длины.  Заметьте
    также, что более приемлемые результаты показали FoxBASE+ и dBASE III +
    с использованием процессора 80287.
                     ДОБАВЛЕНИЕ ЗАПИСИ (APPEND)

                                    - 6 -
                     --------------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           13   199      7     16    108   28.43  12.44   1.84    10
           13   203      6     15    108   33.83  13.53   1.88    10

           14   534     37     29    387   14.43  18.41   1.38    10
           14   541     37     29    385   14.62  18.66   1.41    10

           15   320     27     96    215   11.85   3.33   1.49    10
           15   318     27     97    214   11.78   3.28   1.49    10

         Скорость, с  которой  можно  добавить в файл новую запись,  очень
    важная характеристика для любой прикладной системы.
         Тест 13  выполнил  100  команд  APPEND BLANK (добавить пустую за-
    пись), за каждой из которых выполнялся оператор REPLASE, который прис-
    ваивал одному  ключевому полю случайно генерированную 10-ти символьную
    константу. Открыт был только один индекс,  и использовался файл на 300
    записей с длиной записи 64  байта. Процесс повторялся 10 раз.
         Тест 14 использовал 300 записей 1001 байт по такой же схеме,  как
    в тесте 13.
         Тест 15 использовал 10000 записей длиной 64 байта по схеме  теста
    13.


                      ПОИСК В ИНДЕКСИРОВАННОМ ФАЙЛЕ (SEEK)
                      ------------------------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           16    76      5     43    78    15.20   1.77   0.97    30
           16    76      6     43    78    12.67   1.77   0.97    30
           17    77     32     53    85     2.41   1.45   0.91    30
           17    76     32     52    84     2.38   1.46   0.90    30
         В тесте  16  выполнилось 100 безуспеншных попыток поиска информа-
    ции, используя случайно сгенерированные константы в качестве  аргумен-

                                    - 7 -
    та. Обратите внимание на то, как быстро Clipper выполнил этот тест.
         Тест 17 выполнил также 100 попыток поиска,   используя  случайную
    константу в качестве аргумента.
         В обоих тестах использовался один и тот же файл из 10300 записей,
    с длиной записи 64 байта. Длина ключа 20 символов.


                    ДВИЖЕНИЕ ПО ФАЙЛУ (SKIP)
                    ------------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           18     8      3      3      2    2.67   2.67   4.00    3
           18     8      3      2      2    2.67   4.00   4.00    3
           19    48     27     10     13    1.78   4.80   3.69    3
           19    47     26      9     13    1.81   5.22   3.62    3
           20    71     26     28     17    2.73   2.54   4.18    3
           20    72     25     19     16    2.88   3.79   4.50    3
           21    33     31     21     24    1.06   1.57   1.38    7
           21    33     31     20     24    1.06   1.65   1.38    7
           22    87     67     87     82    1.30   1.00   1.06    7
           22    87     66     86     82    1.32   1.01   1.06    7
           23   364    328    322    317    1.11   1.13   1.15    7
           23   363    328    319    317    1.11   1.14   1.15    7

         В тестах  с  18  по 23 выполнялось сканирование файла с начала до
    конца.
         Тесты 18,  19,  20 выполнялись без использования индексов.  Тесты
    21, 22,  23 были выполнены с двумя открытыми индексами.  Тесты 18 и 21
    использовали файл из 300 записей с длиной записи 64 байта.  Тесты 19 и
    22 использовали 300 записей длиной 1000 байт.  Тесты 20 и 23 использо-
    вали 10000 записей длиной 64 байта.
         Обратите внимание на выдающуюся скорость Quicksilver в сканирова-
    нии неиндексированных файлов.

                    ПОИСК ПО УСЛОВИЮ (LOCATE)
                    -------------------------

                                    - 8 -
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           24    13      8      8      7    1.63   1.63   1.86    2
           24    13      7      5      7    1.86   2.60   1.86    2
           25    48     26     15     17    1.85   3.20   2.82    2
           25    48     26     12     17    1.85   4.00   2.82    2
           26   129    120    132     94    1.08   0.98   1.37    2
           26   111    113     43     83    0.98   2.58   1.34    2
           27    36     34     33     29    1.06   1.09   1.24    5
           27    35     34     25     28    1.03   1.40   1.25    5
           28    98     69     89     84    1.42   1.10   1.17    5
           28    97     69     87     84    1.41   1.11   1.15    5
           29   406    366    368    369    1.11   1.10   1.10    5
           29   390    365    329    367    1.07   1.19   1.06    5

         В тестах  выполнилась  команда LOCATE для индексированных и неин-
    дексированных файлов.  Тесты с 24 по 26 использовали неиндексированный
    файл, 27-29 использовали индексированные  файлы.
         В тестах 24,  25, 27 и 28 были отобраны 70 записей из 300. В тес-
    тах 26 и 29 были отобраны 2000 записей из 10000.
         Эти тесты еще раз подтвердили, что системы управления базами дан-
    ных часто ограничены по операциям ввода/вывода, к скорости необходимой
    для реальных приложений.


                      СВЯЗЫВАНИЕ
                      ----------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           30    78     46     45     60    1.70   1.73   1.30    15
           30    78     47     43     61    1.66   1.81   1.28    15
           31   234     99    101    132    2.36   2.32   1.77    15
           31   236     99     96    131    2.38   2.46   1.80    15
         В тесте 30 файл Ф был связан с файлом В,  и файл В в свою очередь
    был связан с файлом С.  В тесте производилось сканирование  от  начала
    файла A до конца со ссылками (обращением) к полям во всех трех файлах.

                                    - 9 -
         SELEKT A

         DO WHILE .NOT. EOF()

               DISPLAY A

               SEEK IN FILE B

               DO WHILE .NOT. EOF() .AND. KEY  IN B = KEY IN A

                     DISPLAY B

                     SEEK IN C

                     DO WHILE .NOT. EOF() .AND. KEY IN C = KEY IN B

                           DISPLAY C

                           SKIP IN C

                     ENDDO

                     SKIP IN B

               ENDDO

               SKIP IN A

         ENDDO

         Во втором тесте использовались те же три файла и программа, текст
    которой приведен.
         В обоих тестах отражается вид процесса,  который используется при
    формировании отчетов и обновлении информации в  файлах.   Такого  вида
    процессы также широко используются при формировании месячной и годовой
    отчетности.
         Например, Clipper  и  FoxBASE+ формируют за 50 минут месячный от-

                                    - 10 -
    чет, для которого dBASE III + должен истратить около 2-х  часов.   Для
    создания такого  отчета  при  помощи Quicksilver требуется не менее 67
    минут.


                ФОРМИРОВАНИЕ ОТЧЕТОВ (REPORT)
                -----------------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           32   553    519    469    544    1.07   1.18   1.02    15
           32   539    519    369    541    1.04   1.46   1.00    15

         Если вы используете dBASE REPORT FORM, то этот тест будет вам по-
    лезен. Тест включал операции расчета промежуточных и полных  итогов  в
    файле на 10000 записей.  Обратите внимание на то, что FoxBASE+ получил
    существенное преимущество при использовании процессора 80287.


                  ЗАМЕНА СУЩЕСТВУЮЩИХ КЛЮЧЕЙ
                  --------------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           33    34     15     16     28    2.27   2.13   1.21    8
           33    34     15     16     28    2.27   2.13   1.21    8

         Тест 33  включает 100 команд GOTO,  которые следуют за оператором
    REPLASE именяющим значение ключевого поля в открытом индексном  файле.
    Тест был  выполнен  на  10000 записей и значения для обновления ключей
    генерировались случайным образом.  Clipper и FoxBASE+ были единодушны,
    в то  время,  как Quicksilver индексная идеология dBASE помешала полу-
    чить существенное преимущество над dBASE.


                   ОБНОВЛЕНИЕ НЕКЛЮЧЕВЫХ ПОЛЕЙ
                   ---------------------------

                                    - 11 -
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           34   1051   809    575    706    1.30   1.83   1.49    20
           34   1046   809    576    705    1.29   1.82   1.48    20

         Этот тест  использует команду REPLASE ALL для обновления значений
    неключевых полей в 10000 записей.


                  ОПЕРАЦИЯ ПРИСВОЕНИЯ
                  -------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           35    77      9     13     14    8.56   5.92   5.50    10
           35    70      9     11     14    7.78   6.36   5.00    10

         В этом тесте 20 переменным различного типа присваивались неповто-
    ряющиеся значения.  Процесс повторялся 100 раз.  Обратите внимание  на
    существенное превышение  скорости  у  компилирующих языков.  Это может
    иметь большое значение в операциях с матрицами, векторами или в других
    видах программ, интенсивно использующих переменные.
















                                    - 12 -
                      ПУСТОЙ ЦИКЛ
                      -----------
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС
           37    92     17     21     20    5.41   4.38   4.60    10
           37    88     17     15     19    5.18   5.87   4.63    10

         Тест 37 делает 10000 итераций с пустым циклом.


                      УПРАВЛЕНИЕ ЭКРАНОМ
                      ------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           36    18     32     7      8     0.56   2.57   2.25    5
           36    18     32     7      7     0.56   2.57   2.57    5

         Этот тест просто выполняет очистку экрана определенное количество
    раз.

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           38    12     38     5      5     0.32   2.40   2.40    5
           38    11     38     4      4     0.29   2.75   2.75    5

         Тест 38 рисует и уничтожает на экране некоторое количество "коро-
    бок". Процедура повторяется 100 раз.

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           39    61     25     23     30    2.44   2.65   2.03    15
           39    59     25     19     29    2.36   3.11   2.03    15

         Тест 39 выполняет операцию GET, следующей за комендой CLEAR GETS.
    Процедура повторяется 100 раз.



                                    - 13 -
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС
           40    63     19     19     22    3.32   3.32   2.86    10
           40    61     19     14     22    3.21   4.36   2.77    10
         Тест 40 выполняет команду SAY, работающую с переменными, 100 раз.
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           41    86     15     26     17    5.73   3.31   5.06    15
           41    78     15     13     17    5.20   6.00   4.59    15

         Тест 41 выполняет команду SAY, работающую с константами, 100 раз.

           47   262     43     64     59    6.09   4.09   4.44    10
           47   257     42     41     59    6.12   6.27   4.36    10
         Тест 47 выполняет набор операторов SAY и GET, базирующихся на из-
    менении координат.
         Влияние сопроцессора 80287 на операции управления экраном сущест-
    венно, т.  к.  форматирование экрана (вывод информации)  математически
    интенсивная операция. Все SAY и GET тесты включали различные типы дан-
    ных.
         Первоя, что видит клиент в вашей разработке,  это скорость, с ко-
    торой появляются и сменяются изображения на экране.   Если  вы  хотите
    иметь преимущество  в большинстве операций управления экраном,  то ваш
    выбор однозначен - необходимо использовать компилятор.   dBASE  III  +
    просто очень медлителен в операциях ввода/вывода на экран и ваш клиент
    вряд ли станет ждать у экрана.


                  ОПЕРАЦИИ СО СТРОКАМИ
                  --------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           42    103     34    24      33   3.03   4.29   3.12    10
           42    100     34    14      29   2.94   7.14   3.45    10

         Множество строковых  функций  проверялось в тесте 42,  включавшем
    операции сцепления,  усечения символьных строк,  выделение подстроки и

                                    - 14 -
    т. д.
                   МАКРОРАСШИРЕНИЯ
                   ---------------
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           43     26      5     5       5   5.20   5.20   5.20     0
           43     26      5     4       6   5.20   6.50   4.33     0

           44     28      7     21      9   4.00   1.33   3.11     5
           44     27      7     16     10   3.86   1.69   2.70     5

         Тест 43 - контрольный тест, который не использует макрорасширений
    в процессе запоминания различных значений в переменных.
         Тест 44 эквивалентен 43,  исключая то, что макровыражения исполь-
    зовались в процессе запоминания.


                   МАТЕМАТИЧЕСКИЕ ОПЕРАЦИИ
                   -----------------------

         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           45    139     39    38      33   3.56   3.66   4.21     5
           45     93     24    12      16   3.88   7.75   5.81     5

           46    140     42    40      42   3.33   3.50   3.33     5
           46     88     25    10      20   3.52   8.80   4.40     5

         Тест 45 включает просто набор операций сложения, вычитания, умно-
    жения, деления.
         Тест 46 включает более сложные математические  компоненты  (лога-
    рифмы, корни и т.д.).






                                    - 15 -
                   ОТКРЫТИЕ ФАЙЛОВ БД С ИНДЕКСАМИ
                   ------------------------------
         Тест   PLUS   CLIP   FOX   QUICK   CLIP   FOX   QUICK   ВЕС

           48     71     63    66      98   1.13   1.08   0.72    12
           48     71     64    63      98   1.11   1.13   0.72    12

         В тесте  несколько  десятков  раз  открываются  и  закрываются  6
    рабочих областей.




