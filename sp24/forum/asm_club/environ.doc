Cофтпанорама 1990, No. 4 (8) ** ASM_CLUB **  Составитель: Н.Н. БЕЗРУКОВ
***********************************************************************
                                      Приводимые в данном разделе замет-
                                 ки  выражают  мнение авторов,  которое,
                                 естественно, может не совпадать с точ-
                                 кой зрения составителя.
***********************************************************************




           ПРОБЛЕМЫ С КОМАНДНОЙ СРЕДОЙ  В MS DOS/PC DOS.



     При использовании достаточно сложных пакетов в ДОС необходимо
достаточное место в среде (environment).  Это вроде бы элементарно
обеспечивается указанием в  файле CONFIG.SYS спецификации  Shell =
Command.Com /E:<n>, где <n>  - размер среды. Однако  данный размер
среды действует только для первичной копии командного  процессора.
При  запуске  пакетов  из  какой-либо  оболочки,  например  Norton
Commander  оказывается,   что  свободное   место  в   среде  почти
отсутствует ( обычно есть пара сотен байт, который образуются  при
загрузке  и  снятии  программой  RELEASE  резидентных  программ ).
Можно увидеть несколько решений проблемы :

     - каждый сложный пакет запускать командой ( точнее, пакетом )
       Command  /e:<env_size>  /c  batch_filename  что  приведет к
       потере  еще  около  4  килобайт  (  т.к. Norton Commander и
       большинство других оболочек тоже запускает копию командного
       процессора для исполнения команды введенной пользователем )
       и  к  удвоению  числа   пакетов.   Однако  данное   решение
       оказывется  наиболее  честным   и,  что  интересно,   самым
       работоспособным.

     - назвать Command.Com ( и установить соответственно Comspec )
       свою  программку,  которая   будет  передавать   настоящему
       Commandу  командную  строку  дополнив  ее указанием размера
       среды.    Данное  решение   также  работоспособно,   однако
       существуют программы, знающие о распределении памяти  после
       своего старта "слишком много". Пока единственной программой
       такого плана является Quaid Analyzer ( который почти  сразу
       зависает при запуске его под этим Commandом), однако  этого
       уже достаточно, чтобы забраковать этот способ.

     - найти в Commandе размер среды по умолчанию и увеличить его.
       Данная задача показалась бы невозможной, однако для ДОС 3.0
       и 3.1 существует  утилита фирмы Microsoft,  выполняющая эту
       задачу.  Возможно, такая  существует и для ДОС  3.3, однако
       она     мне     неизвестна.        Путем      сопоставления
       дизассемблированных  текстов  Commandов  версий  3.1  и 3.3
       удалось  найти  соответствующие  байты,  при  их  изменении
       задача увеличения среды была  решена, но начались ошибки  в
       распределении памяти  - возможно  в данной  версии Commandа
       это значение хранится  в двух местах,  или же был  превышен
       предел размера среды по умолчанию.

     - создать резидентную  программу, обрабатывающую функцию  4Bh
       прерывания 21h ( EXEC ) и при запуске программы Command.Com
       добавляющую в  командную строку  необходимый размер  среды.
       Данная  идея  также  была  реализована,  и  на  этом   пути
       возникают сложности, как  мне кажется превышающие  удобства
       от увеличения среды.

     - наконец  можно не  мучиться, а  исправить Norton Commander,
       чтобы  он  сразу  запускал  Command  при  выполнении команд
       пользователя  с  подходящим  размером  среды,  однако   это
       решение было бы наименее гибким.

     Как можно было увидеть, было испытано достаточное  количество
методов  увеличения  среды,  однако  ни   один  из  них  (   кроме
стандартного - первого по  порядку ) не дал  надежных результатов.
Если кто-то  добился большего  в этом  направлении, прошу сообщить
мне по телефону или письмом.

                                04.04.90 16:36

                                                  Свиридов И.А.
                                               д.т.(044) 263-87-70
                                           252127, Киев-127, а/я 804/7