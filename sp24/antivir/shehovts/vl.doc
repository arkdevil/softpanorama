




                          Вирусный Локатор.
                        ( Virus Locator 1.6 )



                        1. Введение.

  Программа VL ( Virus Locator ) предназначена для поиска вирусов, размножаю-
щихся через файлы, по маскам вирусов. Под маской вируса понимается та часть
кодов вируса, которая не изменяется при размножении файла.
  Отличие VL от таких программ как PC-TOOLS в том, что он ищет в файле все
маски вирусов одновременно, а также может работать без остановки при обнаруже-
нии вируса, выводя информацию о зараженных файлах на принтер. Кроме того, VL
удалит инфицированный файл (если вы выберете режим удаления), избавив вас от
этой нудной на большом винчестере работы.
  VL удобен для профилактической проверки винчестеров и дискет. В большом кол-
лективе пользователей вирус быстро переходит с машины на машину. После его
локализации на одном из PC и занесения новой маски в VL достаточно запустить
VL по всем машинам и вирус будет ликвидирован.




                        2. Подробнее о VL (Вирусном Локаторе).


  Полная поставка VL включает 3 файла:


     VL.DOC         - файл, который вы сейчас читаете
     VL.EXE         - собственно Вирусный Локатор (называемый далее VL)
     VL.MSK         - маленький файл ( 3 Кб ), в котором VL хранит маски и име-
                      на вирусов, а также техническую информацию.



 В VL.MSK уже установлены несколько масок вирусов: те, с которыми я столкнулся
при работе на PC или получил со стороны для определения маски.

 Для ознакомления с особенностями этих и других вирусов рекомендую
обратиться к "электронным статьям":
 1. Безруков Н.Н. "Компьютерная вирусология"  ,
 2. Бончев В.     "Ваксини срещу компютърни вируси" (на болгарском языке),
 3. Бончев В.     "Еще раз о компьютерных вирусах".


  VL ищет файл VL.MSK в том каталоге, в котором находится VL.EXE. Если VL.MSK
не будет найден, Локатор сообщит об этом и прекратит работу.







  В самом начале работы VL выводит на экран головное меню:

                     ┌─── Main menu ───┐
                     │                 │
                     │   Full search   │
                     │  Quick search   │
                     │  Select options │
                     │  Show options   │
                     │  Print options  │
                     │  Mask editing   │
                     │  Save changes   │
                     │      Info       │
                     │      Quit       │
                     └─────────────────┘
Его элементы:

             Full search          - поиск вирусов по всему файлу.
                                    Эта опция соответствует Begin search
                                    из более ранних версий VL


            Quick search          - быстрый поиск, в каждом файле иссле-
                                    дуется только 4 Кб. Алгоритм этого   
                                    поиска будет описан дальше.


            Select options        - выбор опций поиска, ниже будет
                                    описан подробнее


            Show options          - вывод на экран текущих опций поиска
                                    вирусов


            Print options         - печать текущих опций на принтер


            Mask editing          - работа с масками : удаление и
                                    добавление масок, печать масок и
                                    вывод их на экран


            Save changes          - сохранение измененных опций и
                                    отредактированных масок


            Info                  - краткая информация о VL


            Quit                  - выход из VL





  Если вы войдете в подменю Select options, то получите возможность выбора:


        Sound is                  - включения/выключения звукового
                                    сигнала, подаваемого при обнаруженни
                                    вируса


        File extension            - расширения файла, по которому будут
                                    выбираться файлы для поиска в них
                                    вирусов

        Search virus at           - поиска вируса: в каталоге, в
                                    файловой системе (системах), в
                                    конкретном файле. При поиске по
                                    каталогам происходит поиск и по
                                    подкаталогам

       Output sent to             - вывода краткой информации о
                                    найденном вирусе. При установке
                                    вывода на принтер VL не будет
                                    останавливаться при обнаружении
                                    вируса, а выведет информацию на
                                    печать и продолжит поиск

       File with virus            - реакции на зараженный файл: удаление
                                    без подтверждения, с подтверждением
                                    или не удаление


  При работе с меню пользуйтесь клавишами "стрелка вверх", "стрелка вниз",
"cтрелка вправо", "стрелка влево", Home, End.

  Некоторые ограничения : VL хранит не более 50 масок, длина маски вируса не
менее 2 и не более 15 символов. Алгоритм поиска вирусов таков, что чем длиннее
маска, тем быстрее поиск. Кроме того, поиск ускоряется, если маска содержит
одинаковые символы.

  Вирусный Локатор может запускаться с опциями F и Q. В этом случае происходит
запуск Локатора и работа с заранее установленными вами в Локаторе парметрами
поиска. Такой режим полезен для включения VL в командные файлы, например в
AUTOEXEC.BAT. Опции F и Q oзначают, соответственно, полный (Full) и быстрый
(Quick) режим поиска.

  Версия Локатора 1.6 позволяет исследовать дамп куска файла, содержащего
вирусную маску. Размер куска файла не будет превышать 4096+15 байт. Если вирус
расположен в конце файла, то дамп может иметь меньший размер, причем на экран
выводятся только те байты, которые принадлежат файлу. Те, кто работает с
PC-TOOLS, оценят данное свойство Локатора.
  Локатор запрашивает разрешение на вывод дампа во время остановки при обнару-
жении вируса.
  При выводе дампа на экране появится та его часть, где находится обнаруженная
маска, причем коды маски будут выделены ярко-белым цветом. Это выделение
сохранится при любом листании по дампу.




  Отличие VL от аналогичных программ в том, что он- открытая система. Вы полу-
чаете полную информацию о его работе, управляете Локатором. Это куда лучше,
чем какой-нибудь "детектор", который ищет неизвестно что неизвестно по какому
принципу выбирая файлы поиска.

  Вы работаете с VL версии 1.6.
  Эволюция Локатора выглядела так:

 Версия 1.0 : страдала многими недостатками и, в первую очередь, плохим
алгоритмом поиска. Поскольку VL ищет маску по всему файлу, то поиск является
критическим местом в программе. Поэтому версию 1.0 я решил не распространять,
взял другой алгоритм поиска (Боуера и Мура) и сделал версию 1.1.

 Версия 1.1 : cкорость поиска увеличилась в 3,2 раза.  В версиях 1.0 и 1.1
файл VL.MSK имеет размер 1 Кбайт. Однако оказалось неудобным работать с масками
вирусов, не зная их имен.  Дело в том, что из одного вируса можно выделить
несколько масок, да и обмениваться просто масками не так уж и удобно. Поэтому
появилась версия 1.2.

  Версия 1.2 : в Локаторе вы можете указать имя вируса и за счет этих имен файл
VL.MSK увеличился до 3072 байта (3 Кб). Все версии совместимы снизу-вверх по
файлу VL.MSK. При чтении VL.MSK размером в 1 Кб Локатором старшей версии все
маски будут безымянными.

  Версия 1.3 : версия 1.2 требовала инсталляции Локатора для поиска файла
VL.MSK.  Эта инсталляция оказалась делом обременительным и я решил возложить
заботы о поиске файла VL.MSK на сам Локатор (начиная с версии 1.3).  Кроме того
в версии 1.3 несколько изменен формат вывода имен масок вирусов.

  Версия 1.4 : избавлена от некоторых ошибок версии 1.3. Более удобным стал ввод
имени файла, каталога, маски. В предыдущих версиях вход в режим ввода любого
текста означал безусловную потерю его предыдущего содержимого. Особенно это было
заметно при переименовании маски, когда ради изменения одного символа
приходилось перебивать весь текст. Кроме того, начиная с этой версии в Локатор
добавлен простой самоконтроль на заражаемость.  Если размер файла VL.EXE
изменится (обычно в результате заражения вирусом), Локатор сообщит об этом и
откажется продолжать работу.  Для ускорения поиска вирусов введена опция Quick
Search. 

  Версия 1.5 : упрощен алгоритм Quick Search. Теперь он выглядит так:
                  определяется точка входа (первый исполняемый оператор
                  программы), осуществляется переход на нее и с этого места
                  читается 4 Кб

По сравнению с версией 1.4 скорость работы Локатора с опцией Quick Search
возросла в 1.8 - 2 раза.
  Очевидно, что при быстром поиске (Quick search) обычно обнаруживается только
последний из "севших" в файл вирусов.
  Относительно опции Full Search такой алгоритм дает увеличение скорости в 2-6
раз, но будет пропускать изощренные вирусы (знакомые с подобными алгоритмами!).
Правда, я с такими еще не сталкивался. Если вам попадется подобный вирус,
переходите на опцию Full Search (по английски FULL - полный,всеохватывающий, а
глупый - FOOL, хотя и звучат почти одинаково). И действительно, что может быть
надежнее глупого полного поиска маски по всему файлу?



  Версия 1.6 : Локатор "научился" работать с монохромным дисплеем. Обеспечена
возможность запуска VL в режиме командной строки. И, наконец, самое главное :
появилась возможность вывода на экран дампа части файла с вирусной маской.



  При именовании вирусов я придерживаюсь следующей системы: имя начинается с
типа размножения вируса, затем идет приращение файла при записи в него вируса,
затем - дополнительные признаки.
  Например:  CE1234R означает, что вирус размножается через .COM и .EXE файлы,
увеличивая их на 1234 байта и становясь резидентным.  Применяется следующая
типизация:

               C - размножение через .COM файлы
               E - размножение через .EXE файлы
               B - размножение через Boot Record (начальный загрузчик)
               R - вирус становится резидентным
               N - вирус распространяется через сеть ЭВМ



                        4. Использование Локатора.

  Вирусный Локатор может использоваться в двух вариантах, которые можно условно
назвать пассивным и активным.
  Пассивный вариант - это если вы не разбираетесь и не хотите разбираться в
вирусных проблемах, ассемблерных кодах и прочей дребедени, и не желаете
обременять себя поиском новых вирусов и их масок. В этом случае вы используете
VL с тем набором масок, который вы получили. В таком варианте VL не лучше и не
хуже других вирусных детекторов.
  Активный вариант - это тот случай, когда вы знаете PC-TOOLS, QED или что-либо
подобное, понимаете (пусть в общих чертах) механизм работы вируса и можете
определить маску вируса (не обязательно с первой попытки, я тоже ошибаюсь
иногда). Тогда вы сможете пополнять список вирусов в Локаторе, надежно защищаясь
от компьютерной заразы. Именно в этом случае у VL пока нет конкурентов. 
  И действительно, даже сколь угодно мощный вирусный детектор станет бессильным 
при появлении нового вируса (а новой версии этого детектора придется ждать 
неделями или месяцами). Ну а если у вас есть VL, то часа через два (время, 
потраченное на выделение маски вируса) ваш компьютер снова будет защищен.















                        5. Разное.


  Вирусный Локатор является некоммерческим продуктом и распространяется
бесплатно. Однако все претензии, советы и предложения я принимаю с
благодарностью и постараюсь с вашей помощью улучшать Локатор. В свою очередь
готов предоставлять вам информацию о новых вирусах, их масках и о новых
версиях моей программы.
 VL написан на языке Turbo-Pascal 5.5 с использованием оконного модуля WindTS.
 Для ускорения поиска маски в файле используются (с версии 1.5) две ассемблерные
процедуры из TURBO-Profeccional for PASCAL 4.0.
 Оконный модуль (unit) WindTS (Windows from TechnoSoft) избавил меня от всех
хлопот по созданию окон и меню на экране. Этот модуль является моей адаптацией
пакета Windows из TopSpeedModula под Turbo-Pascal (начиная с версии 4.0). Для
многих программ модуль WindTS куда удобнее, чем стандартный модуль CRT из
Turbo-Pascal.  Если вы работаете с Turbo-Pascal и заинтересовались модулем
WindTS, а также по всем вопросам, связанным с VL, обращайтесь ко мне по адресу:


       252207 Киев 207, проспект академика Глушкова, 20-а , Технософт,
              (отдел Ковалева).


    и / или по телефону 266-00-97 (Киев,с 9.00 до 18.00 по рабочим дням).


 


                       апрель 1990 г.         Шеховцов Александр


























------------------------------ Вопросы и ответы ------------------------------

1. Почему длина вирусной маски только 15 символов ?

   Эта величина была выбрана случайно. Но в дальнейшем, при исследовании разли-
 чных антивирусов я обнаружил, что ни один из них не ищет вирус по маске
 большей длины. Кроме того, при увеличении длины вводимой маски возрастает риск
 допустить опечатку при вводе. Честно говоря, я попробовал увеличить длину
 маски вдвое, но ничего путного из этого не вышло.


2. Локатор сообщает о зараженности некоторых программ, а другие антивирусы
   молчат. В чем тут дело?

   Конечно, это может оказаться и вирус, тогда выбросьте остальные антивирусы
 и похвалите VL всем своим друзьям. Но иногда Локатор обманывается на некото-
 рых программах, ведь в его основе : простой текстовый поиск, и совпадение
 цепочек кодов вполне возможно. Часто это бывает при поиске в антивирусах,
 если они содержат в себе те же маски вирусов, что и Локатор. Простейший выход:
 поместить эти антивирусы на отдельную дискету и удалить их с винчестера.


3. Почему на моем компьютере все меню имеют красивые тени, а на других PC они
   пропадают. Это ошибка?

   Нет, просто у вас хорошая IBM PC с цветным EGA или VGA дисплеем. Для таких
 дисплеев рисование теней под окнами не замедляет работу Локатора, а для
 дисплеев похуже подобные украшения использовать неразумно.


4. Я попытался исследовать новый вирус и определить его маску, но это оказалось
   долгой и нудной процедурой. Можно ли облегчить подобную работу?

   Да, в настоящий момент уже написана программа ML (Mask Looker), которая по
 нескольким зараженным файлам опеределяет дамп вируса и распечатывает те его
 коды, которые не меняются при размножении вируса. Вам остается взять из этой
 распечатки любые 15 символов, которые вам больше по вкусу, и поместить их в
 Локатор как маску этого вируса. Начиная с версии VL 1.6 я распространяю
 Локатор вместе с ML, так что требуйте ее у того, кто переписал вам VL.


5. Почему при установке поиска по "All hard disks" Локатор исследует файлы и
   на электронном диске ?

   Дело в том, что в MS-DOS нет простой возможности определить тип и количе-
ство дисков, а VL - не Norton Disk Doctor, чтобы при каждом запуске тестировать
винчестер. Поэтому стратегия поиска по "All hard disks" - это поиск по всем
устройствам, начиная с C:. В список этих устройств попадут как электронный
диск, так и каталоги, переименованные в устройства с помощью утилиты SUBST.







6. При сканировании файлов с атрибутом ReadOnly на защищенной от записи дискете
   появляется сообщение: "Error : Can not opened file ...". В чем причина?

   В Turbo-Pascal, на котором написан Вирусный Локатор, файлы прямого доступа
не могут открываться только для чтения, а лишь для чтения и записи. Следовате-
льно, Локатору приходится снимать атрибут ReadOnly с файла, а на заклеенной 
дискете он этого сделать не в состоянии.


7. Файл заражен одним вирусом дважды, а Локатор сообщил о вирусе только один
   раз. Это "прокол" Локатора?

   Нет, все дело в алгоритме поиска. Файл читается блоками по 4 Кб и в каждом
блоке каждая маска ищется только один раз. Я полагаю, что VL используется для
поиска вирусов, а не общего числа вхождений в файл текстовой цепочки. При таком
алгоритме поиска если в один блок уложатся две и более маски одного вируса, то
будет выдано только одно сообщение о вирусе. 


8. Если файл читается блоками, то что будет, когда маска вируса начнется в одном
   блоке, а закончится в другом?

   Для быстрого поиска (Quick Search) такой вопрос не стоит, поскольку из файла
будет читаться только один блок в 4Кб, а при полном поиске (Full Search) 
подобный случай учтен и корректно обработается (вы получите сообщение о вирусе).