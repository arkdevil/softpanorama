
TSRUNIT v1.10
Copyright (c) 1995 Nir Sofer, All rights reserved


INTRODUCTION
────────────

TSRUNIT is a FreeWare TP unit for creating resident programs (TSRs).
You are allowed to copy, modify and share this program with others. But when
you give TSRUNIT source code to other people (or upload it to a BBS) always
give them the whole original files which is included in TSRUNIT package.

If you improve TSRUNIT source code, i will appreciate it, if you'll send
me back the improved source code via mail. I might use it in the next
version of TSRUNIT.

I would like also to get comments and suggestions. You can send it by one
of the following ways:

1. Internet: nir@netvision.net.il
2. Fidonet:  Nir Sofer, at 2:403/138.0
3.
  Nir Sofer
  5 Shderot Hashoshanim St.
  52583 Ramat Gan
  ISRAEL

All mail will be answered. if you don't get a reply after a week, please
send it again. Mail may be lost sometimes...

FILES in TSRUNIT PACKAGE
────────────────────────

TSRUNIT.PAS  Main unit of TSRUNIT.
TSREXAMP.PAS Example to show you how to use TSRUNIT
TSREXAMP.EXE Compiled example of TSRUNIT
TSRUNIT.DOC  The file that you are reading now !


RULES FOR USING TSRUNIT
───────────────────────

There are some rules that you must know them before writing TSRs with TSRUNIT.

1. Add {$f+} to the beginning of your program to force Turbo-Pascal to use
   only far-calls. Otherwise, your program will get stuck or it may be
   generated strange errors.

2. Add {$m $800,0,0} to the beginning of your program to minimize the amount
   of memory that TP use. If you get "stack overflow error" message, you
   will have to increase the $800 value. But, remember that TSRs should use
   least memory as possible.

3. In the beginning of the main block, put the SetUserSignature procedure,
   this procedure will allow you to check if your TSR has already installed.
   In every TSR you have to use different Signature values.

4. After you sure that your TSR work perfectly, add {$s-} and {$r-} to the
   beginning of the program to minimize the code size.


USING TSRUNIT
─────────────

TSRUNIT is very easy to use unit. You just have to define the key combination
for activating the TSR procedure and the procedure itself.
To define the key combination, you have to define 2 variables:

keyflag - keyboard flag (shift,alt and ctrl)

bit 0 = Right Shift = 1
bit 1 = Left Shift  = 2
bit 2 = Ctrl        = 4
bit 3 = Alt         = 8
bit 4 = Scroll Lock active (not useful)
bit 5 = Num Lock active (not useful)
bit 6 = Caps Lock active (not useful)
bit 7 = Insert active (not useful)

For example: if you want to get Alt+Ctrl combination: keyflag = bit 2 + bit 3
= 4 + 8 = 12. You can also use the consts of TSRUNIT:

KeyFlag:= Alt + Ctrl;


keysc - keyboard scan code

Use the following table to find the suitable value to the key that you want
to use for activating the TSR:

     Key       Code    ║     Key          Code    ║     Key          Code
═══════════════════════╬══════════════════════════╬═══════════════════════
     Esc       1       ║     A            30      ║     Caps Lock    58
     1         2       ║     S            31      ║     F1           59
     2         3       ║     D            32      ║     F2           60
     3         4       ║     F            33      ║     F3           61
     4         5       ║     G            34      ║     F4           62
     5         6       ║     H            35      ║     F5           63
     6         7       ║     J            36      ║     F6           64
     7         8       ║     K            37      ║     F7           65
     8         9       ║     L            38      ║     F8           66
     9         10      ║     ;            39      ║     F9           67
     0         11      ║     '            40      ║     F10          68
     -         12      ║     `            41      ║     F11          133
     =         13      ║     Left Shift   42      ║     F12          134
     Bksp      14      ║     \            43      ║     NumLock      69
     Tab       15      ║     Z            44      ║     Scroll Lock  70
     Q         16      ║     X            45      ║     Home or 7    71
     W         17      ║     C            46      ║     Up or 8      72
     E         18      ║     V            47      ║     PgUp or 9    73
     R         19      ║     B            48      ║     Gray -       74
     T         20      ║     N            49      ║     Left or 4    75
     Y         21      ║     M            50      ║     Center or 5  76
     U         22      ║     ,            51      ║     Right or 6   77
     I         23      ║     .            52      ║     Gray +       78
     O         24      ║     /            53      ║     End or 1     79
     P         25      ║     Right Shift  54      ║     Down or 2    80
     [         26      ║     Prt Sc or *  55      ║     PgDn or 3    81
     ]         27      ║     Alt          56      ║     Ins or 0     82
     Enter     28      ║     Spacebar     57      ║     Del or .     83
     Ctrl      29      ║                          ║


Example:

suppose you want to activate your TSR every time that you press
Alt+Left shift+F1

KeyFlag:=8 + 2; {alt = 8, Left shift = 2}
Keysc:=59; {the scan code of F1 key is 59}

You can also use the consts of TSRUNIT:

Keyflag:=Alt + LeftShift
keysc:=_f1;


Installing the TSR:

To install your TSR, just call InstallTsr procedure:

procedure InstallTsr(tsrproc: ProcedureType);

The tsrproc variable represent the procedure that you want to activate every
time that the key combination is pressed.
For example:

KeyFlag:= LeftShift + Alt;
Keysc:= _r;
InstallTsr(RunMe);

If you run this example, the program will terminate, return to dos, and when
you press left shift+alt+R, the RunMe procedure will be activated.
While your TSR proceudre is active, you can remove it from memory by using
RemoveTsr procedure.
For checking if you are allowed to remove your TSR, use CheckIntVectors
procedure. This procedure checks 10,09 and 08 interrupt vectors to see if they
are still ours. If you have installed another TSR since you installed your
TSR, you could not remove it from memory.

Installation check:

With TSRUNIT you can also check if your TSR has already installed before.
To use this feature, you have to define in the beginning of your program, 2
word numbers, that install your TSR signature:

procedure SetUserSignature(Check,Return:word);

The Return value must be different from zero !
If you write a few TSRs with TSRUNIT, the Check value must be different.
Otherwise, some TSRs may be notified you that they have already installed,
even if they haven't.

The installation check signature is installed by using INT 10h.

INT 10 - Installation check of TSRUNIT programs.
        AX = DAADh
        BX = check signature
Return:
        CX = Return signature
        ES = Program segment prefix

To check if your TSR has installed, use InstallationCheck procedure.
If you get TRUE result, the TSR has already installed.

To see exactly how is it work, see TSREXAMP.PAS and TSREXAMP.EXE


HISTORY
───────

TSRUNIT v1.00  05/06/95   First release.

TSRUNIT v1.10  30/07/95

* Problems with MS-DOS 6.xx fixed by adding INT28 support.
* Check if the TSR has already installed before.
* The type of TsrProcedue variable is a procedure instead of pointer, so you
  don't have to add @ operator.
* Consts for all keyboard flags and keyboard scan codes.
* The TsrProcedure variable automatically assigned by InstallTsr procedure







