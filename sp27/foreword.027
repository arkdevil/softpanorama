                     Cофтпанорама 1990, No. 7 (11)
******************************************************************

             *****************************************
             *   К О Л О Н К А   Р Е Д А К Т О Р А   *
             *****************************************

                          Уважаемые коллеги !


     При подготовке первой части  "Компьютерной вирусологии" к пе-
чати этим летом автор проработал  значительный  объем  материалов,
посвященных проблеме компьютерных вирусов, и хотел  бы  поделиться
некоторыми выводами. Во-первых, количество известных  вирусов  для
MS DOS превысило две сотни (здесь возникает вопрос, как  их сосчи-
тали; по видимому, включая все или большинство  имеющихся штаммов,
так что число "базовых" вирусов все еще остается в пределах сотни)
и приводимый в данном выпуске детектор SCAN заявляет именно  о та-
ком количестве детектируемых  вирусов.  Во-вторых, создалась опас-
ность проникновения в СССР новых, более опасных и  изощренно напи-
санных вирусов - так называемых стелс-вирусов (см. ниже).

     В свете  имеющихся  фактов,  налаживание  сплошного  входного
контроля и исследования поступающего программного  обеспечения яв-
ляется важной задачей, решение которой не  терпит  отлагательства.
Помимо контроля батареей детекторов  важное  значение  приобретает
контроль при загрузке. К сожалению, имеющиеся утилиты для проверки
контрольной суммы файла "on the fly" (FluShot+)  еще  весьма несо-
вершенны и разработки в этом направлении становятся,  пожалуй, са-
мыми приоритетными.

     Другим важным методом противодействия, выходящим  в настоящее
время на передний план, является  индивидуализация  вычислительной
среды. Как минимум должен  использоваться  нестандартный  дисковый
драйвер (например, Advanced Disk Manager)  и  командный  процессор
(например 4DOS). Большая степень индивидуализации  достигается пе-
реходом  к  "MS DOS-совместимой"  операционной  системе  (DR  DOS,
Hi DOS), тем более, что по своим  эксплуатационным характеристикам
эти системы превосходят MS DOS. По имеющимся данным, DR DOS в нас-
тоящее время продает СП Интерквадро за конвертируемую  валюту, од-
нако, возможно, русифицированный вариант будет продаваться за руб-
ли.

     Хотя общее количество вирусов велико,  лежащие  в  их  основе
идеи сравнительно малочисленны и не так просто  поддаются расшире-
нию. Поэтому основной тенденцией, наблюдаемой в  настоящее  время,
является не столько появление новых типов вирусов,  сколько комби-
нирование уже известных идей. Такие "гибриды", как правило, оказы-
ваются опаснее базисных видов. Например, в  нескольких  из появив-
шихся недавно файловых вирусов используется  заражение  MBR,  т.е.
включены черты бутового вируса. Так что этот факт следует  иметь в
виду: заражение MBR или бут-сектора может  выполняться  из  файла.
Все же более часто наблюдается минимальная модификация  одного  из
получивших широкое распространение  (и,  следовательно, "доступно-
го") вируса. Последнее приводит к образованию  вокруг  "базисного"
вируса группы штаммов, причем их количество  в  некоторых  случаях
(например, для RCE-1813) превышает десяток. Причем эти штаммы нео-
бязательно более сложны, чем исходный. Встречаются  и "упрощенные"
варианты.

     Теперь несколько слов о стелс-вирусах.

     Как и другие продукты человеческой деятельности, компьютерные
вирусы претерпевают определенную эволюцию, которая  в значительной
степени облегчается тем, что в течении значительного  отрезка вре-
мени среда их размножения (MS DOS)  остается  практически неизмен-
ной. Если попытаться квантовать наблюдаемые непрерывные эволюцион-
ные изменения, то можно говорить о  поколениях  компьютерных виру-
сов.

     Понятие поколения компьютерного вируса связано, в основном, с
механизмом размножения и методами маскировки. Наблюдаемый cейчас в
ряде публикаций акцент на проявления того или иного вируса являет-
ся неверным: по сути вирус можно разделить на две достаточно неза-
висимые части: компоненту размножения и компоненту проявления. При
этом именно характеристики компоненты размножения  являются основ-
ными и определяют место конкретного вируса "в  эволюционной цепоч-
ке". В то же время популярная пресса акцентирует внимание  на ком-
поненте проявления, что видно хотя бы из распространенности нефор-
мальных названий типа "Тринадцатая пятница, День  Колумба, Воскре-
сенье, Пинг-Понг" и т.д. Если провести  аналогию  с  авиацией,  то
компонента размножения соответствует самому  летательному аппрату,
а компонента проявления - полезной нагрузке. Очевидно, что  один и
тот же самолет может доставлять и бомбы и листовки.

     Компонента  размножения  должна   обеспечить   две   основные
функции:

     - получить управление с тем, чтобы обеспечить  репликацию ви-
       руса;
     - избежать обнаружения для того чтобы выжить и выполнить пре-
       дыдущий пункт;

     Важность этих двух функций изменяется  в  ходе  эволюции.  На
первом этапе эволюции вирусов основной  является  репликация.  При
этом вопросам маскировки либо вообще  не  уделялось  внимание  при
разработке, либо они носили несистематический характер и были нап-
равлены на маскировку одного или двух изменений, возникающих в за-
раженной программе или системе. Этому этапу эволюции соответствует
первое поколение вирусов - вирусы, не рассчитанные  на преодоление
антивирусных средств.

     С распространением антивирусных  средств  вопросы  маскировки
стали основными и вирусу для того, чтобы выжить, важно  как  можно
дольше остаться незамеченным. В связи с этим основные  усилия  при
разработке стали направляться именно на маскировку.  В  результате
маскировка приобрела комплексный характер и соответствующие вирусы
можно условно относить к  новому  поколению  вирусов,  получившему
название стелс-вирусов.

     Конечно, граница между указанными двумя поколениями условна и
по ряду признаков уже RCE-2000 можно отнести к  стелс-вирусам. Од-
нако первым безусловно принадлежащим к этой категоpии вирусом  был
вирус RCE-04096 ( другие названия: 4096, 4K, Frodo  -  Фродо,  100
Years virus - 100 лет, Century virus - столетие,  Hiding  - Прячу-
щийся, IDF Virus - ИДФ-вирус, Stealth Virus - Стелс вирус).

     RCE-04096 был разработан, по-видимому, в Израиле в конце 1989
года. Неформальное название Century связано с тем,  что  вирус ис-
пользует поле года даты создания файла для отметки зараженных фай-
лов. При этом у зараженных файлов год создания  увеличен  на  100.
Название Фродо связано с тем, что вирус содержит бут-сектор в сво-
ем коде, хотя он никогда не записывает свое тело в бут-сектор. При
записи этого бут-сектора в бут-сектор дискеты и  попытке  загрузки
выдается сообщение "FRODO LIVES" (ФРОДО ЖИВЕТ или ФРОДО  ЖИВ).  По
данным П.Хоффман, 22 сентября это день  рождения  героев  трилогии
"Властелин колец" (Lord Of The Rings) - Бильбо  и  Фродо  Баггинов
(Bilbo and Frodo Baggin).

     При инсталляции находит по COMSPEC  и  заражает  COMMAND.COM.
Затем загружает себя в старшие адреса памяти, уменьшая  размер  на
6К. При этом, возможно, маскирует уменьшение системной  памяти  на
6К каким-то образом. Для определения положения  обработчика  21-го
прерывания вирус проходит при  инсталляции  соответствующую  часть
кода с флагом трассировки. Для получения управления по  21-му пре-
рыванию, похоже, вирус использует сплайсинг (врезку  в  обработчик
прерывания 21).

     Заражает как COM (включая COMMAND.COM)  и  EXE-файлы,  так  и
оверлейные файлы и файлы данных. Как уже указывалось,  в  качестве
признака заражения используется значение поля года  даты  создания
файла. Дли зараженных файлов вирус  изменяет  поле  года  создания
файла, увеличивая его на сто, например с 1990 до 2090.  В дальней-
шем это значение используется для определения зараженности файла.

     Приращение длины при заражении всегда равно  4096  байт.  При
наличии вируса в оперативной памяти это приращение  маскируется  и
не видно при просмотре оглавления командой DIR. Этот  эффект обес-
печен за счет перехвата операций, используемых  командой  DIR  при
просмотре оглавления, и вычитания 4К из  длины  зараженных  файлов
подобно тому, как это выполняет вирус RCE-02000.

     По некоторым данным, попытка чтения секторов,  относящихся  к
каталогам, перехватывается и перенаправляется к оригинальному сек-
тору, хранящемуся в конце зараженного файла. В этом случае измене-
ния не видны и через программы типа Norton Commander.  Кроме того,
любая попытка доступа к зараженному файлу, за исключением выполне-
ния ведет к выкусыванию тела вируса из  зараженного  файла.  Таким
образом обходится детектирование заражения  с  помощью  ревизоров.
Если при копировании выполняемого файла создается файл  с расшире-
нием, не используемым для выполняемых файлов (COM, EXE, BIN, SYS и
т.д.), то вирус выкусывает свое тело при копировании.

     Механизм поиска жертв включает заражение  открываемых файлов,
тем самым обеспечивая при использовании  детектора  на  зараженной
машине сплошное заражение проверяемых файлов (как RCE-1800).

     Тело вируса зашифровано и имеет  самомодифицирующийся инстал-
лятор. При кодировании использованы достаточно сложные приемы зат-
рудняющие трассировку.

     Из-за ошибки при кодировании вирус повреждает некоторые файлы
при заражении: после заражения не обновляет информацию в заголовке
файла. При запуске таких файлов MS DOS выдает  диагностическое со-
общение:

               ERROR in EXE File.

     Такие повреждения можно устранить, запустив CHKDSK /F,  а за-
тем соответствующий фаг.

     Иногда заражает файлы данных. Они могут быть  восстановлены с
помощью соответствующего фага.

     Фаза проявления написана достаточно подло.  Во-первых,  после
22 сентября 1990 при запуске любой зараженной программы происходит
зависание операционной  системы  (вирус  зацикливается),  создавая
впечатление машинной неисправности.  По  данным  П.Хоффман,  вирус
также медленно "сращивает" файлы на диске. Для этой цели вирус ма-
нипулирует FAT, изменяя количество  свободных  секторов. Пользова-
тель, использующий команду CHKDSK/F, обнаруживает, что файлы имеют
потерянные кластеры или кластеры, принадлежащие двум файлам однов-
ременно. Это проявление также выглядит как машинная неисправность.

     Все авторы публикаций,  включающих  описание  данного вируса,
сходятся в том, что вирус написан  программистом,  хорошо  знающим
"внутренности" операционной системы и знакомым с методами создания
антивирусных программ.

     Вирус RCE-4096 был обнаружен в Израиле в октябре  1989  года.
Существует несколько штаммов. Штамм 4096-B  аналогичен описанному,
но использует другой механизм шифровки тела.

     Данный вирус диагностируется полидетектором  SCAN.  Для визу-
ального обнаружения можно использовать наличие увеличенного на 100
года создания файла. Для этой цели можно просмотреть  дамп класте-
ров с каталогами с помощью Norton Utilities  (в  DIR  и  в  Norton
Commander видны только две последние цифры года). В  качестве фага
можно использовать программу CLEANUP, начиная с версии 66. Неясно,
является ли увеличение  года  достаточным  признаком  зараженности
файла, или вирус проверяет еще какие-то поля.  Если  этот  признак
достаточен, то возможна пассивная вакцинация файлов путем увеличе-
ния значения года создания на 100, как это  делалось  с  секундами
создания файла при вакцинации от вируса C-648. Кроме того, возмож-
но создание резидентной вакцины, обеспечивающей  увеличение значе-
ния поля года при считывании элемента каталога.

     При отсутсви CLEANUP для выкусывания можно  использовать упо-
минавшийся эффект, связанный с тем, что при  копировании выполняе-
мого файла в файл с расширением,  отличным  от  исполняемых  (COM,
EXE, BIN, SYS и т.д.) резидентный вирус выполняет выкусывание все-
го тела из файла. Для этой цели следует скопировать все EXE  и COM
файлы с переименованием, а затем после перезагрузки  с  защищенной
дискеты, содержащей эталонную операционную систему, скопировать их
обратно.

     Другим стелс-вирусом  следует  считать  вирус  512,  который,
по-видимому, разработан в  Болгарии  и  относится  к  группе  Dark
Avenger. Он был обнаружен студентом-программистом  Васил Никодимов
в ноябре 1989 года в Институте математики (София). Сведения  о нем
опубликованы в статье В.Бончева в номере 1-2 за 1990 журнала "Ком-
пютър за вас". Вирус содержит текстовую строку 666 в  конце  тела,
поэтому его иногда называют 666. В коде  вируса  используется  ряд
недокументированных функций MS DOS, свидетельствующих  о  глубоком
знании автором механизма работы операционной системы.

     Формально RC-0-512 представляет первый сегментированный рези-
дентный файловый вирус. Это первый реализованный вирус, в  котором
используется несовершенство распределения  дисковой  памяти  в  MS
DOS: размер кластера обычно превышает размер сектора как минимум в
два раза и поэтому можно  использовать  незаполненные  "хвосты"  в
последнем секторе для хранения части тела вируса (модификация пер-
вых команд или заголовка остается обязательной,  иначе  вирусу  не
получить управления). Фактически эту схему можно  рассмаривать как
вариант перенесения схемы бутового вируса на файловый  вирус.  Как
известно, бутовый вирус, в отличие от файлового,  сегментирован  и
состоит из головы и хвоста.  Голова  находится  в  бут-секторе,  а
хвост храниться где-то в другом месте и его  загрузка  выполняется
головой. Аналогично вирус  RC-0-512  рассматривает  первый  сектор
COM-файла как бут-сектор и заменяет его своим телом, а  хвост пря-
чет в неиспользуемый кластер последнего сектора. Очевидно, что ви-
рус может заражать на дискете только файлы, у которых  второй сек-
тор последнего кластера полностью свободен. На винчестере возможно
заражение бошльшинства COM-файлов, так  как  размер  кластера  там
значительно больше и один  свободный  сектор  имеется  практически
всегда.

     При заражении RC-0-512 записывает себя в первый  сектор зара-
жаемого COM-файла, предварительно переписав  "оригинальный" первый
сектор в один из незаполненных секторов последнего кластера, зани-
маемого файлов. Как уже указывалось, если такого кластера  нет, т.
е. длина программы отличается меньше числа, кратного размеру клас-
тера менее чем на 512 байт, то такие файлы вирус не  заражает. От-
сюда следует, что зараженные файлы, скопированные с помощью коман-
ды COPY MS DOS (а она копирует файл побайтово в рамках указанной в
заголовке длины)  будут неработоспособны,  а находящийся в них ви-
рус - работоспособным.

     Подобно специфическому механизму заражения,  вирус использует
необычный механизм инсталляции в оперативной памяти:  для хранения
собственного тела вирус "откусывает" первый буфер  буферного  пула
MS DOS, переставляя указатель на первый буфер так, чтобы он указы-
вал на второй буфер. Таким образом, определить его наличие в памя-
ти без полного сканирования оперативной памяти можно  только, если
знаешь, где искать. Этот факт свидетельствует о том, что оптимиза-
ция просмотра оперативной памяти в контекстных детекторах  и поли-
фагах представляется ошибочной.

     Как и в других вирусах группы DARK AVENGER,  заражение проис-
ходит как при открытии, так и  при  выполнении  файла.  Заражаются
файлы, первые две буквы расширения которых "CO".  При  копировании
заражаются как копия, так и оригинал.

     Вирус заражает COMMAND.COM. Поскольку при перезагрузке систе-
мы командный процессор загружается в память до появления в ней ре-
зидентного вируса, то вирус инсталлируется, а затем подгружает не-
достающую часть командного процессора из  свободного  сектора пос-
леднего кластера.

     Данный вирус диагностируется полидетектором SCAN и любым кон-
текстным детектором, содержащим соответствующую сигнатуру. Возмож-
ность создания резидентной вакцины неясна.

     Доступного фага для данного вируса пока нет.  В  связи  с ис-
пользуемым механизмом заражения при его создании возникает пробле-
ма с определением, хранится ли в соответствующем секторе последне-
го кластера оригинальная голова COM-файла (первы 512  байтов прог-
раммы) или файл был скопирован и там теперь просто  мусор.  В пос-
леднем случае восстановление приведет к записи мусора на место те-
ла вируса. Неясно также, что произойдет при оптимизации диска, со-
держащего зараженные файлы с помощью утилиты NCC, СОМPRESS и т.д.

     Описанный вирус, к сожалению,  не  является  единственным  из
разработанных в Болгарии в последнее время. Темпы создания вирусов
там, похоже, увеличиваются. В файле  FORETAB.027  приведена  часть
таблицы 3 версии 4.5 компьютерной вирусологии, содержащей 21 "све-
жий" болгарский вирус из числа  переданных  Веселином  Бончевым  в
США.   Описания  основаны   на  списке  вирусов,  распространяемом
П. Хоффман (версия от 10.09.90).

     Появилась и группа вирусов отечественной разработки, включаю-
щая RC-529, RC-600 и RCE-1600. Этого нам  только  не  хватало.  По
данным А.Сессы, кто-то пытается разрабатывать вирусы  в Днепропет-
ровске.

     Поскольку вирусы являются дестабилизирующим фактором для всех
пользователей, а любителей вариантов славы по типу славы Геростра-
та оказывается более чем достаточно, создается  опасная  ситуация.
Здесь уместно напомнить слова из  Тьюринговской  лекции  создателя
UNIX, замечательного американского программиста Кена Томпсона, ко-
торый в заключительной части лекции, прочитанной в  1983  г., ска-
зал:

     "Я хотел бы подвергнуть критике прессу за ее  освещение проб-
лемы "хакеров", банды 414, банды Дальтона (Dalton  gang),  и  т.д.
Действия этих ребят представляют собой в лучшем  случае вандализм,
а в худшем случае, возможно, правонарушение  и  воровство.  Только
несовершенство  уголовного  законодательства  спасает  хакеров  от
очень серьезных наказаний. Компании, которые могут  пострадать  от
этой активности (а большинство  крупных  компаний  являются  очень
уязвимыми в этом отношении), предпринимают значительные  усилия  с
тем, чтобы  добиться  изменения  уголовного  законодательства. Не-
санкционированный доступ  к  компьютерным  системам  уже  является
серьезным преступлением в ряде штатов и  в  настоящее  время соот-
ветствующие законы рассматриваются во многих  других  штатах  и  в
Конгрессе."

     "Надвигается взрывопасная ситуация. С одной  стороны, пресса,
телевидение и фильмы делают героев их этих  вандалов,  называя  их
вундеркиндами (whiz kids). С другой стороны, действия  этих  ребят
будут скоро наказываться годами тюрьмы."

     "Я видел, как эти ребята давали показания Конгрессу. Было со-
вершенно ясно, что они не отдают себе отчета в  серьезности  своих
действий. Это, возможно, недостаток культуры (cultural  gap). Про-
никновение в компьютерные системы должно накладывать  на  человека
то же клеймо, что и проникновение в чужую квартиру. И не имеет ни-
какого значения, что дверь  соседа  оказалась  незапертой.  Пресса
должна понять, что неверное использование компьютера ничем не луч-
ше,  чем  управление  автомобилем в нетрезвом состоянии"  (перевод 
Н.Н.Безрукова).

     Несмотря  на  несовершенство  действующего  законодательства,
возможность привлечения к судебной  ответственности  разработчиков
отечественных компьютерных вирусов имеется. В частности, в Уголов-
ном кодексе УССР имеется статья 90 "неосторожное  уничтожение  или
повреждение государственного или  общественного  имущества".  Если
трактовать случаи заражения  вирусом  приобретенного  организацией
коммерческого программного обеспечения  как  его  повреждение,  то
возбуждение уголовного дела против разработчика вируса представля-
ется возможным и в рамках действующего законодательства.

     Мы только сейчас начали получать более-менее правдивую инфор-
мацию о состоянии окружающей среды и  постепенно  начинаем осозна-
вать, до какого состояния доведена окружающая среда. На протяжении
жизни одного поколения, фактически на наших глазах,  огромные тер-
ритории превращены в ядовитые свалки. Все меньше становится рек, в
которых можно безопасно купаться.  Все больше становится мест, где
опасно жить. Компьютерные вирусы, наряду с троянскими программами,
являются опасными  загрязнителями  информационной  среды.  Поэтому
борьбу с компьютерными вирусами можно рассматривать как часть эко-
логического движения.

     Как и проблема загрязнения природы, проблема компьютерных ви-
русов уже вышла за рамки национальных границ.  Локальное загрязне-
ние какой-то территории (например, Софии) почти всегда превращает-
ся в национальную, а затем и в международную проблему. Транснацио-
нальное распространение вирусов наносит экономический ущерб, кото-
рый лишь по размеру отличается от  ущерба,  наносимого транснацио-
нальным распространением радиации или кислотных  дождей.  Понятно,
что должна существовать ответственность за эти "грязные  потоки" и
какая-то система санкций.

     СССР в настоящее время присоединился ко  многим международным
соглашениям по охране окружающей среды. В области  загрязнения ин-
формационной среды нам этого еще предстоит добиваться. Как и в об-
ласти охраны авторских прав на программное обеспечение,  в  данном
случае лучше добровольно привести свое законодательство к междуна-
родным нормам, не дожидаясь, когда нам это  придется  сделать  под
давлением (к сожалению обоснованным) со стороны других  членов ми-
рового сообщества. Мы должны учесть урок Болгарии, репутации прог-
раммной продукции которой нанесен определенный ущерб потоком изго-
товленных в стране компьютерных вирусов.

12.09.90                                   С уважением Н. Безруков


P.S. В предыдущих номерах бюллетеня некоторые программы, распрост-
     раняемые как SHAREWARE, помещались не в полном комплекте, а в 
     виде одного-двух модулей. Это в определенной степени противо-
     речит охране авторских прав на этот тип программого обеспече-
     ния  (см. файл READ.ME),  редакционной политике  и целям ОСП.
     Составитель приносит свои извинения по поводу допущенного не-
     досмотра.
