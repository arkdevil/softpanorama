			HOOK.COM

					       УНИСОФТ
					Пронякин Юрий Викторович
					   раб.тел. 268-74-44

   В черном списке 41-го выпуска СОФТПАНОРАМЫ оказался очередной
"родственник" неувядающего отладчика AFD. При более внимательном
рассмотрении можно прийти к выводу, что на самом деле кража была
двойной : присвоен был не оригинальный AFD, а одна из сделанных
ранее кем-то другим русификаций. Оттуда же происходит и докумен-
тация  ( в ней "голубые воришки" не везде исправили название на
свое - наверное,  от застенчивости.  А в первом браке программа
называлась FSD (Full Screen Debugger) - года полтора назад такое
мне уже попадалось).
   Ну что же, раз программу присваивают, значит, она чего-то стоит.
Хотя, конечно, дело вкуса. Женя Сусликов, например, ни за что не
расстанется с AT86, а один мой товарищ считает, что единственный
отладчик, с которым можно работать - DEBUG, и, кстати, успешно
разбирается с его помощью с программами,  о т к о м п и л и р о -
в а н н ы м и  FORTH-ом.  Ну и регистр флагов им в руки!
   Лично я не такой консерватор и поэтому в свое время с легкой
душой отказался от AFD в пользу ...  AFD Pro. Обе программы, как
мне кажется, предназначены для программистов, которые пишут на
ассемблере и при этом любят спокойную жизнь. Попробуйте, работая
с Quaid Analyzer, перехватить 21 прерывание - он вас задергает,
выскакивая на вызовы всех функций подряд, в то время, как вас
интересуют одна - две. В AFD эта проблема решается очень просто -
использованием точек прерывания по условию. Ну а что вам скажет
Turbo Debugger, если попытаться заставить его трассировать преры-
вание? А в AFD Pro я в свое время успешно трассировал загрузку
MS DOS-а (начиная с INT 19, а затем INT 13) на всемирно известном
компьютере "POISK", грузившемся не с диска, а через самодельный
сетевой адаптер с удаленной машины "ISKRA", которая в этот момент
сама перегружалась под этим же отладчиком!
   Добавьте к этому наличие дополнительных (запасных) регистров,
отсутствующих в процессоре, встроенных калькулятора и ассемблера
с метками, окон дампа, привязываемых не к фиксированным адресам,
а к текущему содержимому регистров, запись трассировки на диск и
последующее ее воспроизведение, возможность работать с символи-
ческими именами, присутствующими в исходном тексте программы -
кто еще умеет все это?
   Так что AFD - это действительно ОТЛАДЧИК. И все бы было хорошо,
если бы не необходимость время от времени разбираться с чужими
программами. Для таких дел нужен не отладчик, а фомка, в качестве
каковой чаще всего используют Quaid Analyzer. AFD уступает ему в
легкости перехвата векторов. Чтобы чего-то перехватить, нужно
установить окно дампа на область векторов (1), найти там нужный
вектор (2), поставить там, куда он направлен, точку прерывания (3).
А пальцы не казенные, и вообще - хочется спокойной жизни...
Еще хуже, что перехватить прерывание можно только на входе (а точку
вызова ищи в стеке), а если вектор направлен в BIOS, то остается
только идти пить кофе.

   Чтобы избавиться от этих неудобств и была написана программа
HOOK. Назначение ее очень простое: перехватить прерывание, указанное
в командной строке в HEX - виде. Маленький кусочек, оставляемый ею
в памяти (21d байт), не несет никакой отсебятины, а только предельно
корректно вызывает исходный обработчик этого прерывания, а потом
возвращает управление назад в вызвавшую программу.
   А чтобы этот кусочек не нужно было искать в памяти для установки
в нем точки прерывания на входе или выходе, программа сама вызовет
AFD, если он находится в резиденте, и вам останется только только
поставить точку прерывания на входе по адресу  CS:5C  или на выходе
по адресу  CS:6D  и продолжить выполнение программы. Для еще большего
упрощения процесса предлагается файл AFDPRO.BRK, автоматически
устанавливающий точки прерывания BR1 - на вход и BR2 - на выход.
Остается только после выскакивания AFD из резидента нажать F5 F3 F5
 - и дело сделано.

Примечание: байт после команды возврата из обработчика RET 2
	    (его смещение 70h) содержит номер перехваченного
	    прерывания - сервис для забывчивых! Изменение этого
	    байта никому ничем не грозит.


И, наконец, традиционные предупреждения и заверения :

   Программа предоставляется для совсем-совсем свободного применения
   и распространения при условии использования ее в некоммерческих
   целях. Ну а если вы умудритесь приспособить ее в коммерческих целях,
   то разрешается просто свободное использование.

      Если же вам возможностей программы покажется недостаточно,
   то вы можете получить улучшенную версию программы, которая умеет:

      а) перехватывать любое количество прерываний, отводя под
	 каждое все те же 21d байт
      б) не требует предварительного наличия отладчика в памяти,
	 а умеет дождаться его запуска и связаться с ним при
	 первом же удобном случае.

      Для этого вам нужно всего лишь приготовить символическую плату
   в 5 символических единиц любой валюты (включая республиканскую,
   областную и т.д.) наличными, или документ о 15 рублях  ONLY ,
   переведенных фирме УНИСОФТ на р/с 513161400/468223 в Киевском
   Горуправлении Национального банка, МФО 322249, и связаться с
   автором по приведенному выше телефону или другим доступным способом.
