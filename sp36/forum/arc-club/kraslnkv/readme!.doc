                                            Ю.Д.Красильников

    Программа сжатия/разжатия файлов и компрессор .COM-файлов.


    Мотивом для написания  данных программ послужила  опубликованная
ранее  в  "Софтпанораме"  статья  И.Тараненко  "Процедура   упаковки
данных SQUEEZE".  Процедура использовала  принцип работы  упаковщика
LZEXE.  Данный  алгоритм  отличает  простота,  эффективность и очень
высокая скорость распаковки данных. 

     Некоторым  недостатком  программы  И.Тараненко  является  малая
скорость упаковки. Это объясняется  тем, что для поиска  подстроки в
уже обработанной  части файла  используется полный  ее просмотр. Для
ускорения  работы  программы  И.Тараненко  использовал  ассемблерные
вставки  в  программе  на  C.  Однако  более разумным представляется
усовершенствование  алгоритма  с  целью  ускорения  поиска подстрок.
Поскольку  обработанная  часть  файла  уже  просмотрена,  то   легко
построить систему указателей, которая позволит существенно  ускорить
поиск.

     Наиболее  простым  методом  представляется следующий: создаются
два массива - массив char_list  (такого же размера, как и  буфер для
обрабатываемого файла) и массив  last_occurence из 256 элементов.  В
массиве last_occurence i-й элемент содержит номер позиции в  буфере,
в  которой  последний  раз  встречался  символ  с  кодом i, а каждый
элемент  массива  char_list  содержит  номер  предыдущей  позиции  в
буфере, где  встречается такой  же символ,  что и  в соответствующей
позиции буфера. (Если символ  еще не встречался, то  элемент массива
содержит -1). Тогда поиск  начала строки становится очень  простым -
нужно  лишь   взять  значение   соответствующего  элемента   массива
char_list,  которое  даст  позицию  в  буфере,  где  такой же символ
встречается  в  предыдущий  раз.  Процесс  построения  такой системы
указателей также  достаточно прост  (я бы  сказал, почти  очевиден).
При  переходе  к  следующей  позиции  буфера  нужно  прочитать  i  -
значение символа, находящегося  в ней, и  занести в текущую  позицию
массива  char_list  значение  из  last_occurence[i],  а  в   элемент
last_occurence[i] - номер текущей позиции. 

     Еще одно замечание к  программе И.Тараненко состоит в  том, что
его процедура при исчерпании входного буфера сбрасывает его  целиком
и  читает  новую  порцию  входного  файла,  что  приводит  тому, что
алгоритм  упаковки  начинает  работу   "с  нуля".  Более   корректно
сбрасывать буфер частично, чтобы  алгоритм всегда имел часть  буфера
для поиска в ней строк, которые можно использовать для упаковки.

     Предложенный метод  реализован в  программе sq-unsq.c,  которая
читает  исходный  файл,  упаковывает  его,  потом  распаковывает   и
сравнивает  исходный   и  распакованный   файлы.  Скорость    работы
программы  существенно  выше,  чем  у  программы Тараненко (я имею в
виду вариант на "чистом Си" - без ассемблерных вставок).

     На основе данной программы была разработана также программа  СС
(COM-Compressor), упаковывающая выполнимые файлы типа .COM.  Степень
упаковки, получаемая при помощи данной программы, превосходит  LZEXE
за счет  более компактного  распаковщика (в  нем опущены  фрагменты,
специфические  для   .EXE-файлов)  и   отсутствия  заголовка   файла
(программа  LZEXE  не  работает  с  файлами .COM, такие файлы должны
быть предварительно преобразованы в формат .EXE). 

     Прилагаемые файлы:

     SQ-UNSQ.C    - исходный текст программы упаковки/распаковки
                    информации;
     SQ-UNSQ.EXE  - программа упаковки/распаковки информации;

     FROG.ASM     - исходный текст программы-распаковщика 
                    информации для программы CC;
     FROG.BIN     - оттранслированная программа FROG.ASM;

     MAKECCH.C    - исходный текст программы преобразования файла
                    FROG.BIN в файл CC.H;
     MAKECCH.EXE  - программа преобразования FROG.BIN в CC.H;

     CC.C         - исходный текст упаковщика COM-файлов;

     CC.H         - файл, содержащий шестнадцатиричные константы,
                    представляющие программу-распаковщик;
     CC.EXE       - программа-упаковщик COM-файлов;

     CC.DOC       - (очень) краткое руководство по программе CC.



                                                Ю.Д.Красильников
                                                   05/06/1991

