                    ADDITIONAL MACROS FOR MULTI-EDIT 5.00
                                 Version 3.1

                    Designed & Programmed by Alex Romanov
                      Moscow University Computer Center
                               (095) 939-24-71

            Messages addressed to me may be sent via InterNet to
                          MOREYNIS@twin.srcc.msu.su

                      Wednesday, June 5, 1991, 20:14:09

                                 WHAT'S NEW

        Version 3.1 -- An option was added to improve performance of Mekeymap
macro (<Alt?>) that displays as a menu all current key assignments. See below
for more specific information.
        All remaining DVMENU invokes were replaced by appropriate calls to
DATA_IN.
        Minor corrections were made to DISP_RAM.MAC and REFORMAT.MAC.

        Version 3.0 -- This is the first release for Multi-Edit 5.00.
The most important changes were made to REFORMAT.MAC. The hyphenation algorithm
was improved significantly. The new Smart Hyphenation Engine is capable of
recognizing Russian prefixes and disallowing such awkward hyphenations as
выг-лядывать, разб-расывать, бе-зликий, etc. while virtually no good
hyphenations are lost!
        Random Access Memory Map can now display HMA if a XMS driver (such as
Microsoft HIMEM.SYS) is installed.
        Several macros were removed from AUGMENTA.MAC because they became
obsolete with the new version of Multi-Edit. One new macro (called ACCENTS) was
added. It lets you enter international characters conveniently without the need
to use an international keyboard driver. When the cursor is under, or to the
right of, the letter over which you desire to place an accent, hit <CNTR>
(i.e. <5> on numeric keypad) and then the desired accent (', `, ^, ~, etc.).
Alternatively, you can hit the arrow key specifying the direction of the
accent.

        Version 2.0 -- REFORMAT.MAC macros no longer support the low-level
option to specify vowels and consonants of the target language. Only Russian
words can now be hyphenated. Several options controlling the hyphenation
process have been added -- see the description below. The hard carriage return
and alternative hyphen settings have been relegated to macro command-line
parameters, as they are unlikely to be changed often. All in all, I think that
the current layout of the Hyphenation Support menu is more practical.
        Text-to-Chiwriter conversion can now use CONFIG.ASC to perform the
translation (/ASC option -- see the description below). The hyphens are now
translated as soft, which makes possible subsequent reformatting in ChiWriter.

        Version 1.2 -- Text-to-Chiwriter conversion and Allocated Memory Map
now work significantly faster.
        Several new macros were added to AUGMENTA.MAC, including Resident Text
Grab that allows capturing portions of screen output of other programs into
Multi-Edit windows. It is assigned to <AltF11> in KEYMAP.ADD. See AUGMENTA.HLP
for details.

                              -----------------

        This collection of additional macros for Multi-Edit 5.00 consists of
seven macro files. Their contents is described below.


                             AUGMENTA.MAC MACROS

        The macro file AUGMENTA.MAC contains a collection of simple tools
that facilitate your editing. There are several groups of macros:
        1. Block marking macros. You can quickly mark a single word by
pressing <Alt1>, mark text delimited by double (<Alt2>) or single (<Alt7>)
quotes or by white space (<Alt6>). <Alt9> and <Alt0> search backwards for an
open / forwards for a close, and then mark text between the found parenthesis
and its match. <Alt-> marks a function together with its arguments and <Alt=>
marks text to end of line. With block marking macros, you can quickly mark a
word or structure and then copy/move it to a new location, obviating the need
to re-type them. Although some people are able to type at fantastic rates,
outperforming the block copying process, block copying still has the advantage
of reducing the number of typos in your work.
        2. Special invokes of Multi-Edit system macros. These include scanning
current word into Search (<CtrlS>) or Search-And-Replace (<CtrlQ>) dialog
boxes. <CtrlB> takes the contents of a marked block into Search-And-Replace.
<AltY> scans the number from the screen into the calculator.
        3. Text manipulation. You can quickly convert words to lowercase
(<Ctrl_>) or uppercase (<Ctrl\>) or capitalize them (<Ctrl[>). <Alt,> and
<Alt.> interchange current word with its left/right neighbor. <Alt3> spaces
out the word.
        4. <Alt?> shows current Multi-Edit key assignment as a menu screen.
<AltF5> brings up the DOS screen. You can still bring up the ASCII table by
pressing <AltA>. Finally, <CtrlG> lets you change screen font if you have
previously installed a RAM-resident font table pointed to by any of the
auxiliary pointers in the SAVE_PTR area. See AUGMENTA.HLP for details.

        Starting with version 5.00, Multi-Edit stores its key mapping in a
special database format. The database manager DB takes its time to present
key assignments in a readable form. If you are working on a 8086 or 80286
based machine, you may be exasperated by the slow performance of Mekeymap
(<Alt?>) macro. To speed it up, it is expedient to write key assignments to
disk in text format, and we may get the database manager DB do that for us
using its /PR=1 Print records option. However, due to a minor bug, DB fails
to deliver what is expected of it when this parameter is passed. You may want
to fix that bug. Line 4396 of USERIN.SRC dated 17-10-90 reads

        Print_Records := False;

This initialization is incorrect. The line should read

        Print_Records := Parse_Int ('/PR=', Mparm_Str);

Make the correction and recompile USERIN.MAC. Then choose Menu, Install,
Key mapping, find Mekeymap among AUGMENTA.MAC macros, and add /P parameter
to its command line to let it know that you patched your USERIN.MAC. Save
configuration and press <Alt?> to run Mekeymap. Mekeymap will start up and
build the file MEKEYMAP.ME where key assignments will be stored in text
format. Subsequent calls to Mekeymap will access that file, which is much
faster.
        Mekeymap will automatically rebuild MEKEYMAP.ME every time the
original keymap database is modified.


                                DISP_RAM.MAC

        This macro file contains Random Access Memory Map, an environment
which allows to view/edit RAM. The default key is <CtrlX>. See DISP_RAM.HLP
for details.

                                DOSERROR.MAC

        This is an auxiliary macro which verbalizes DOS error codes.

                                  VIEW.MAC

        This file contains the BINARY_VIEW macro, assigned to <AltV> in DOS
shell.


                                REFORMAT.MAC

        The macro CONTROL_HYPHENS contained in this macro-file provides
screen interface for the Smart Hyphenation Engine developed by Alex Romanov.
Having set the parameters, it invokes kernel macro RUSS_REFORMAT that either
performs actual reformatting or stays resident (within Multi-Edit), taking
care of word wrap (with hyphenation) as you type.

        The macro RUSS_REFORMAT can process either one single paragraph
starting at current line, or multiple paragraphs contained in a marked line
block. This macro assumes a line to be the last line of a paragraph if one of
the following conditions holds:
        1) The next line is blank, or contains a page break.
        2) The next line starts at other column than specified as actual text
                left margin.
        3) Current line contains hard carriage return. This character is set
                by the system variable Hard_Cr.
The recommended key for CONTROL_HYPHENS macro is <CtrlF>. You can also define
a keyboard shortcut for RUSS_REFORMAT, say, <AltR>, but this is dangerous
unless you force using Undo by passing the /U parameter. Without Undo,
accidental hitting of the shortcut key would be disastrous if you are editing
a program (not a document). Since using Undo slows down the execution and
gobbles away available memory, the whole thing is not recommended.
        Note however, that if you are typing text with RUSS_REFORMAT resident
in memory, you can always use the quickstroke <AltR> to reformat the
paragraph down from current line. This is faster than invoking a second copy
of RUSS_REFORMAT via CONTROL_HYPHENS dialog box.

The macro CONTROL_HYPHENS admits a number of input parameters:

        /NH Initial setting: Hyphenation ...                Disabled
        /YU Initial setting: Hyphenate uppercase words ...  Yes
        /NJ Initial setting: Right justify text ...         No
        /CR=Hard carriage return (if you wish to use one).

Other input parameters are those to be passed to RUSS_REFORMAT.
These are:
        /U  Do NOT turn off Undo while reformatting.
                Undo is normally turned off to speed up execution and to
                save memory. By passing /U to RUSS_REFORMAT you can force
                using Undo, but you can run out of memory for Undo buffer
                (reformatting is a "heavy" operation).
        /___S - commands RUSS_REFORMAT to stay resident. For obvious
                reasons, you would not use this on CONTROL_HYPHENS command
                line. However, you can adjust the parameters below that
                pertain to resident mode.
        /R= stay-on row. This is the row in the window on which you
                stay when inserting new text. The default value is
                calculated to be the middle row of your window.
        /IC= column of the flashing "FRM" message on the status line.
                        The default value is 33.

Limitations: Russ_Reformat cannot process lines longer than 2030 characters.
Notice that adjoining lines are glued together during reformatting, so you
cannot reformat a text of width 66 to right margin 2000 directly. However,
this can be performed in two stages: first, you reformat your text to a small
right margin (say, 6), then you set the desired large value (2000) and
reformat again.
     If you are setting large values of Right_Margin (say, above 512), be
sure to turn justification OFF. The justification routine may not work
correctly if there are more than 255 spaces in the justified line.
     If you must reformat the text whereof the lines contain uninterrupted
stretches of more than 230 non-space characters, be sure to turn off
hyphenation. Attempting to hyphenate words longer than 230 may be disastrous!


                                 CONVERT.MAC

     This macro-file contains the macro TEXT_TO_CHI that converts file in
current window to ChiWriter format.

Input parameters for Text_To_Chi macro:
        /ASC= Full path and filespec to find CONFIG.ASC to be used for the
                translation. All characters except space (ASCII 32) can be
                remapped. The macro can use the environment variable CHIFILES
                to find CONFIG.ASC; if it is set then it is sufficient to just
                pass /ASC to the macro. If /ASC is not on the macro command
                line then the default ЙЦУКЕНГ keyboard layout is used.
                In that case you must build proper command line for
                TEXT_TO_CHI macro.
        /PAR= Full path and filespec to find ChiWriter's parameter file. This
                is processed only if you have passed /ASC. If the environment
                variable CHIFILES is set and the parameter file is named
                CONFIG.PAR then /PAR= specification is redundant and can be
                omitted.
        /LS= Default line spacing.
                0=single
                1=one-and-a-half
                2=double
                3=triple
        /Rus= Russian font name. Default: NORM__R
        /Rus#= ChiWriter's Russian font key. Default: %
        /Lat= Latin font name. Default: STANDARD
        /Lat#= ChiWriter's Latin font key. Default: 1
        /Lin= Linedraw font name. Default: LINEDRAW
        /Lin#= ChiWriter's Linedraw font key. Default: 8
        /NP= Initial setting for font to be used for numbers and punctuation.
                0=Latin
                1=Russian
        /WD= Default directory to write the output .CHI files.
        /CW - Having completed the conversion, save all files and invoke
                ChiWriter. (See the note below.)
        /D - Write the string "CW filename" directly into the keyboard buffer.
                If this parameter is not present, then BIOS INT 16h AH = 05h
                function is used. This function is not available on some
                systems.
        NOTE. With bad Cyrillic keyboard drivers the string "CW filename" can
                get translated when in Cyrillic mode. If you have this problem,
                use a better keyboard driver or just switch to Latin mode if
                you wish to immediately invoke ChiWriter using TEXT_TO_CHI
                macro.

        WARNING: If you don't use CONFIG.ASC method of conversion, you will
have to specify proper ChiWriter font names and font keys on the macro
command line, which will make the command line fairly long. For some reason,
the version of SETUP.SRC dated 17-10-90 limits macro command lines to just
32 characters. You may want to patch SetSave macro of SETUP.SRC.
Line 400 reads:

     Def_Str(MStr[80],MName[30],KName[17],Mode_Str[10]);

Delete [80] limit from Mstr definition. This will let Mstr be the default 254
characters long, which will probably be quite enough. Then recompile SETUP.SRC.


                                MACROLAN.MAC

        The MACRO_LANG_HELP macro should be useful to Multi-Edit macro
language programmers. It scans current word from the screen and searches
MACRO.HLX, MECOMMAC.HLX, or SRC.HLX for the description of the corresponding
macro language procedure, function, or variable. If it can be located, then
the appropriate help screen is displayed.

                INSTALLING MULTI-EDIT WITH ADDITIONAL MACROS

        To install Multi-Edit with the additional macros, you should:
1) copy all *.mac and *.hlp files to Multi-Edit directory.
2) append KEYMAP.ADD file to Multi-Edit keymap database that you are using.
3) invoke Multi-Edit. Choose Menu, Install, Key mapping. Choose your favorite
key assignment and pretend to modify it. That is, make some dummy change (like
insert a space and immediately delete it) to trick the editor into believing
that you modified the keymap. Exit Key mapping by pressing <ESC> and choose
saVe configuration and exit. Let Multi-Edit build keymap.src and then init.src
and compile them.
        The macro INSTALL supplied with the package will do all that for you.
        Now the editor is ready to run any of the above-listed macros. Press
<CtrlX> for Random access memory map, or <CtrlF> for Reformat, or <Alt?> to
have a look at your updated key assignment. Have a good time!
