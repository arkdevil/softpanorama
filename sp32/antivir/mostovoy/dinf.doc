  ╔════════════════════════════════════════════════════════════════╗
  ║             Антивирусная программа - ревизор диска             ║
  ║                     ┌─────────────────┐                        ║
  ║                     │ Disk Informator │                        ║
  ║                     └─────────────────┘                        ║
  ║              (c) Д.Ю.Мостовой & В.С.Ладыгин                    ║
  ║      Институт прикладной математики им. М.В.Келдыша АН СССР    ║
  ║                                                                ║
  ║                         29.11.1990       Версия 7.02           ║
  ╚════════════════════════════════════════════════════════════════╝


     Своевременное распознание болезни - залог успешного лечения !

   При случайном занесении  программного "вируса" труднее  всего вовремя
обнаружить, что машина заражена, чтобы своевременно предпринять меры  по
лечению и предотвращению "эпидемии".  Если быстро обнаружить "вирус", то
можно избежать потери большей части информации на винчестере.  Программа
"Disk Informator" предназначена  для предотвращения "вирусной  эпидемии"
на  Вашем  диске.   Она   следит  за  появлением  "вирусов"  в   файлах,
BOOT-секторе,  плохих  кластерах  и   PARTITION  TABLE  и  поможет   Вам
обнаружить не только уже известные, но и вновь появляющиеся вирусы.  Как
минимум  пять  вирусов  в  настоящее  время  обязаны  своим обнаружением
программе Dinf !

                          В Н И М А Н И Е !
   Программа Dinf снабжена системой защиты от несанкционированного копи-
рования. При первом запуске программа запоминает параметры машины и  при
попытке переписи ее на другую  машину перестает работать. Эта защита  не
ущемляет  права  владельца  программы  устанавливать  ее на произвольные
машины, но гарантирует, что никто  в его отсутствие не сможет  списать у
него  программу.   Распространятся  может   только  дистрибутивный   вид
программы. При отсутствии  законодательной охраны авторских  прав каждый
защищается как может!

┌────────────────────────────────────────────────────────────────────┐
│     Чтобы  не  потерять  программу,  храните  ее  дистрибутивную   │
│   копию! Не запускайте программу с дистрибутивной дискеты!         │
└────────────────────────────────────────────────────────────────────┘

                         Основные принципы
   Программные "вирусы",  заражая машину,  могут разместиться  в файлах,
BOOT-секторе или в PARTITION  TABLE.  Некоторые вирусы  помечают хороший
кластер как плохой и селятся там.  Записываясь в файлы, вирусы меняют их
длину  и  контрольную  сумму,  не  меняя  даты  и времени создания файла
(некоторые  вирусы  меняют  дату   и  время:   "студенческие"   бездарно
написанные  вирусы  просто  портят  их,  а  некоторые  вирусы   помечают
зараженные файлы, занося время 60 или 62 сек., 13 месяц или добавляя 100
к текущему году).  Записываясь в BOOT-сектор или PARTITION TABLE, вирусы
меняют их контрольную сумму и уменьшают доступный DOS объем  оперативной
памяти.   На  отслеживании  перечисленных  изменений  построена   работа
программы Dinf.

   В последнее  время BOOT-вирусы  значительно "поумнели"  и при попытке
программы  Dinf  прочитать  BOOT-сектор  для  того,  чтобы посчитать его
контрольную сумму, они "подсовывают" исходный незараженный  BOOT-сектор.
Но начиная с Dinf версии 6.08 и на эти пакостные вирусы появилась управа
(хотя она была и  раньше - по появлению  новых плохих кластеров).   Всем
BOOT-вирусам необходимо  жизненное пространство  в оперативной  памяти и
они получают его, уменьшая объем  памяти, доступный MS DOS.   Теперь при
каждом запуске программа Dinf проверяет не уменьшился ли объем доступной
оперативной памяти по сравнению с тем объемом, который был на компьютере
при первом запуске программы Dinf.  Если по какой-либо причине на  Вашей
машине  изменился  объем  основной  памяти  (например  тест самопроверки
памяти,  проходящий  при  включении  питания,  начал отбраковывать часть
памяти), то  необходимо переустановить  программу Dinf  с дистрибутивной
дискеты, в  противном случае  уменьшение этого  объема свидетельствует о
заражении машины BOOT-вирусом.

                          Работа программы
   После  записи  на  винчестер  дистрибутивной  программы  DINF.PGM   и
переименования  ее  в  DINF.EXE  необходимо  создать таблицу файлов. Эта
операция проводится один раз.  Для создания таблицы необходимо запустить
программу с указанием ключа "/w".  По умолчанию строится таблица файлов,
имеющих  расширения  COM,  EXE,  SYS,  BAT,  OS2.  Таблицы размещаются в
скрытых файлах в  корневом каталоге каждого  диска и содержит  следующую
информацию:   длины  файлов,  даты  создания  файлов,  времена  создания
файлов,  контрольные  суммы  файлов,  PARTITION  TABLE и BOOT-сектора, а
также список  номеров плохих  кластеров.   При первом  запуске программа
Dinf  запоминает  в  своем  теле  объем  доступной  оперативной памяти и
собственную контрольную сумму.

Пример создания таблиц файлов на дисках C: и D:

  C:\ANTIVIR>DINF C: D: /w

Если Вы хотите следить за  файлами с другими расширениями, при  создании
таблицы файлов можно явно перечислить расширения, например:

  C:\ANTIVIR>DINF C: D: /w COM EXE SYS BAT OVL BIN OBJ LIB

В дальнейшем все контрольные операции будут автоматически осуществляться
для файлов с указанными расширениями.

   Контрольные  операции  осуществляются  следующим  образом.    Сначала
программа сравнивает  доступный для  MS DOS  объем памяти  со значением,
которое  было  при  первом  запуске  Dinf. Если эта величина изменилась,
программа предупредит Вас о возможном наличии резидентного  BOOT-вируса.
После  этого  Dinf  проверяет   собственную  контрольную  сумму,   чтобы
убедиться, что  сама программа  не подверглась  заражению. Для повышения
надежности защиты  алгоритм расчета  собственной контрольной  суммы Dinf
отличается  от  алгоритма  расчета   контрольных  сумм  файлов.    Затем
программа  просматривает  свою  таблицу  и  сверяет  хранящуюся  в   ней
информацию с информацией, полученной из  каталога диска.  В этом  режиме
программа  фиксирует  удаленные  с  диска  файлы  и просит разрешение на
исключение  информации  об  этих  файлах  из  своей  таблицы.  Программа
известит  Вас  об  изменении  длины  или контрольной суммы любого файла,
занесенного в таблицу файлов.   Если изменилась длина файла, с  которыми
Вы  работаете,  разрешите  программе  подкорректировать  свою   таблицу,
ответив "Y" на  ее вопрос.   Если же изменилась  длина системного файла,
например длина файла COMMAND.COM, то ВНИМАНИЕ ! это скорее всего  работа
"вируса".

   Большинство   известных   вирусов,   внедряясь   в   файл,  сохраняет
нетронутыми  дату  и  время  его  создания. По этим признакам (изменение
длины или контрольной суммы без изменения даты и времени создания файла)
программа  Dinf  сообщит  Вам,  что  файл  инфецирован.   В  этом случае
выдается сообщение "I_N_F_E_C_T_E_D".  Если Вы получили такое сообщение,
то  с  вероятностью  99,999%   Ваша  машина  подверглась  атаке   вируса
(оставшиеся  0,001%  оставим  на  шутки  Ваших товарищей). В этом случае
запасайтесь всеми известными  Вам программами вирус-детекторами  и ищите
вирус.

  Если после изменения файла программа Dinf обнаружит странные  значения
даты или  времени последней  коррекции файла,  она сообщит  Вам об этом.
(Некоторые вирусы  помечают зараженные  файлы, проставляя  в каталоге 62
секунды,  13-й   месяц  или   20..  год).   В  этом   случае  рекомендую
перезагрузить  машину  с  чистой  заклеенной  дискеты  и  проверить   на
известные вирусы с помощью вирсус-детекторов. 

ЗАМЕЧАНИЕ:  Программа  TDSTRIP.EXE,  удаляющая  из EXE файлов отладочную
информацию  компиляторов  фирмы  BORLAND  Int.  уменьшает  длину файлов,
сохраняя  дату  и  время  создания,  что  вызывает  ложное  срабатывание
программы  Dinf.  Однако  не  реагировать  на  изменение  длины файлов в
сторону уменьшения нельзя, т.к.  я знаю как написать  вирус, уменьшающий
длины  файлов.  Как  это  сделать  я  не скажу, но кто-нибудь тоже может
придумать такой способ и тогда ...

   После  первой  проверки  программа  DINF  делает  обратную  проверку,
сканируя  диск  и  сверяя  файлы  на  диске  с  таблицей.  В этом режиме
выявляются новые файлы, появившиеся  на диске после последней  проверки.
Если  такие  файлы  обнаружены,  программа  просит  разрешения  добавить
информацию о них в таблицу.

   Для экономии  времени Вы  можете использовать  эти режимы  раздельно.
Ключ "/c" задает  первый режим работы,  а ключ "/n"  - второй. Например,
если  вы  удалили  какие-либо  файлы,  либо внесли изменения в некоторые
файлы, то быстро подкорректировать таблицу можно следующим образом:

   C:\ANTIVIR>DINF D: /c /u /f

   Если Вы записали новые файлы и хотите сразу внести информацию о них в
таблицу, наберите:

   C:\ANTIVIR>DINF D: /n /u /f


                        Использование программы
   Программу  Dinf,  на  мой  взгляд,  удобнее  всего  включить  в  файл
AUTOEXEC.BAT. Для этого туда необходимо добавить строку:


                   ┌──┬──────────────── проверяемые диски
                   │  │
                   V  V
   C:\ANTIVIR\DINF C: D: /d /f -lC:\DINF.LOG
                          A  A  A
                          │  │  │
                          │  │  └────── Задание ведения файла-протокола
                          │  └───────── "Быстрая" проверка
                          └──────────── Проверка один раз в сутки

Ключ  "/d"  включает  режим,  при  котором проверки будут осуществляться
только один раз в сутки при первом включении машины. Это сэкономит  Ваше
время при последующих перезагрузках.  Однако, при интенсивной работе  на
компьютере, особенно  с чужими  дискетами, я  бы рекомендовал пропускать
Dinf несколько раз за день. Некоторые вирусы (например широко  известный
"Черный мститель") могут за  несколько часов так "распахать"  винчестер,
что нечего и нечем будет проверять.
   Ключ  "-l<имя  файла>"  позволяет  записать  в файл протокол проверки
диска.

                        Дополнительные возможности
   Существуют  еще  три  ключа,  реализующие  дополнительные возможности
программы.  Ключ  "/i"  включает  "информационный"  режим,  при  котором
программа не корректирует таблицу файлов  (и не задает вопросов).   Ключ
"/u" включает режим, при котором все изменения автоматически заносятся в
таблицу.

   Ключ "/f" включает режим быстрой проверки диска (fast check). В  этом
режиме   контрольные   суммы   файлов   не   вычисляются,   а   контроль
осуществляется по изменению длин файлов.

   Все ключи должны начинаться с символа "/" или "-" и могут  задаваться
как большими так и маленькими буквами.

 Если вы наберете

   C:\ANTIVIR>DINF  ,

не указав параметры, то программа DINF выдаст на экран краткую справку о
своих параметрах и режимах работы.

 ╔════════════════════════════════════════════════════════════════════╗
 ║     Важной особенностью  программы Dinf является экономия Вашего   ║
 ║  времени и  усилий на  проверку  диска.  Существует  возможность   ║
 ║  выделить на диске рабочие директории, в которых допускаются из-   ║
 ║  менения длин файлов.                                              ║
 ╚════════════════════════════════════════════════════════════════════╝

   Для назначения рабочих директорий необходимо набрать команду:

  C:\ANTIVIR>DINF D: /e

На  экран  будет  выдано  окно  со  списком  всех подкаталогов диска, из
которого клавишами перемещения курсора и клавишей "ENTER" можно  выбрать
рабочие. Выбранные директории  будут помечены ярко-белыми  значками. При
обработке  этих  директорий  программа   не  спрашивает  разрешения   на
исправление таблицы и автоматически корректирует все изменения  (однако,
при этом сохраняется контроль на наличие вируса по принципу  "изменилась
длина  или  контрольная  сумма,  не  изменились  дата  и  время создания
файла").

 ┌──────────────────────────────────────────────────────────────────┐
 │                       В Н И М А Н И Е !                          │
 │   Чтобы избежать лишнего диалога с программой, пометьте все свои │
 │ рабочие подкаталоги сразу после создания таблицы файлов.         │
 └──────────────────────────────────────────────────────────────────┘


                            Примечание
   Программа  Dinf  проектировалась  так,  чтобы  обеспечить минимальные
затраты времени на  проверку дисков. Если  Вам показалось, что  скорость
работы программы Dinf снизилась,  то после очередной проверки,  когда Вы
убедитесь, что на диске все в порядке, пересоздайте таблицу файлов.  Для
этого выполните Dinf,  как было указано  выше, с ключем  "/w".  Скорость
работы программы  должна возрасти.   Это связано  с тем,  что  структура
таблицы  оптимальна  для  поиска  файлов  сразу  после  ее создания.  Со
временем при добавлении  новых файлов оптимальная  структура нарушается,
хотя замедление  работы программы  столь мало,  что скорее  всего Вы его
просто не заметите.   Имеет смысл пересоздать  таблицу после  добавления
сразу  большого  количества  файлов.   При  небольших изменениях таблица
будет  откорректирована  автоматически  (после  запроса на разрешение) в
процессе проверок.


                   Изменения относительно версии 4.08.
   С версии 5.00 поддерживаются все графические адаптеры (CGA, EGA, VGA,
Gercules). Выдача сообщений на  экран с использованием BIOS  существенно
замедляет работу программы. Чтобы  этого не происходило, программа  Dinf
выводит свои сооющения непосредственно в видеопамять, разбираясь с типом
адаптера для определения  адреса видеопамяти и  необходимости предотвра-
щения появления "снега" на CGA-экране.
   С версии 5.01 при всех операциях с диском производится поиск  вируса,
получившего название "TOOTHLESS" ("БЕЗЗУБЫЙ") длиной 534 байта.
   С версии 5.02 исправлены атрибуты цвета для адаптера Gercules.
   С версии 6.00 введен контроль на наличие вирусов в PARTITION TABLE  и
в BOOT-секторе. В связи с изменением формата таблицы файлов при переходе
на эту версию необходимо  пересоздать таблицу, используя ключ  "/w" (см.
выше).  Таблицы,  соответствующие  предыдущей  версии,  можно  стереть с
диска.
   В версии 6.01 внесены незначительные изменения.
   В версии 6.02 внесены незначительные изменения.
   В версии 6.03 введен  контроль  появления  новых  плохих  кластеров и
исправлена серьезная  ошибка, допущенная  в "незначительных  изменениях"
версии 6.02.  При переходе на эту версию необходимо пересоздать таблицы,
используя ключ "/w".   Старые таблицы заместятся  автоматически.   Смена
таблиц необходима для занесения номеров плохих кластеров.
   В версии 6.04 введен  дополнительный  контроль  сохранности файлов  с
таблицами.
   В версии 6.05  введена самопроверка файла  DINF.EXE на наличие  в нем
вируса.   Проверка осуществляется  путем расчета  и проверки контрольной
суммы файла.   Указанная проверка необходима,  так как некоторые  вирусы
заразив программу  DINF могут  вызвать ее  неправильное функционирование
(например,  однажды  я  долго  боролся  со  "сбоями на диске" при чтении
таблиц файлов, пока не обнаружил, что сам Dinf заражен). Программа  DINF
версии 6.05 предупредит Вас об этом.
   В версии 6.06 несколько улучшен алгоритм самотестирования.
   В версии 6.07 внесены незначительные изменения. Исправлены орфографи-
ческие ошибки в написании некоторых английских слов и приблизительно  на
1,5К уменьшен объем программы.
   В версии 6.08 введен  контроль появления резидентных BOOT-вирусов  по
уменьшению объема доступной основной памяти.
   В версии 6.09 внесены  незначительные изменения. Сообщение при  изме-
нении длины файла выдается в одну строчку.
   В версии 6.10 введена возможность записи в файл (или выдачи на  прин-
тер) протокола проверки диска.
   В версии 6.11 внесены  незначительные  изменения.  Улучшено  звучание
звукового сигнала, сопровождающего сообщения.
   Версия 6.12 ничем не отличается от 6.11, за исключением того, что был
использован другой компилятор Си.
   В  версии  7.00  введен  контроль  состояния файлов по их контрольной
сумме. При переходе на эту версию необходимо пересоздать таблицы  файлов
(выполнить Dinf с ключем "/w"). Старые таблицы заместятся автоматически.
Список  рабочих  директорий  будет  сохранен.   Необходимость   введения
проверки контрольных сумм была вызвана тем, что мне рассказали о вирусе,
который никогда не меняет длин файлов.  Алгоритм его работы очень прост,
так что я о нем рассказывать  не хочу, чтобы не вызывать повторений,  но
бороться с ним надо.
   В версии 7.01  существенно улучшена работа  с дисками. С  этой версии
поддерживаются  произвольный  размер  сектора  (отличный  от 512 байт) и
размер логического  диска больше  32 Мбайт  (для MS  DOS 4.00 и старше).
Исправлена  ошибка,  вероятность  проявления  которой  крайне мала:  при
чтении сектора с  PARTITION TABLE использовалось  прерывание 13h, но  не
проверялось условие, чтобы буфер чтения не пересекал границу физического
сегмента.
   В  версии  7.02  учтены  замечания,  высказанные на Втором Всесоюзном
конкурсе антивирусных программ, проходившем в Киеве в рамках конференции
"ANTIVIR-90". Убрана проверка на странные значения даты и времени файлов
при построении таблиц файлов.  (Поскольку многие "вакцинируют" все  свои
файлы,  устанавливая  их  время  со  значением  62 сек.) Увеличен размер
стека, что  позволяет осуществлять  рекурсивный спуск  по  более длинным
деревьям каталогов.  29.11.90

                                   ┌─────────────────────────────────╖
                                   │        (c)  1989,1990           ║
                                   │   Мостовой Дмитрий Юрьевич      ║
                                   │   Ладыгин  Виталий Сергеевич    ║
                                   │             * * *               ║
                                   │  Институт прикладной математики ║
                                   │     им.М.В.Келдыша АН СССР,     ║
                                   │  тел. 333-65-12, 250-79-87      ║
                                   │           г.Москва              ║
                                   ╘═════════════════════════════════╝