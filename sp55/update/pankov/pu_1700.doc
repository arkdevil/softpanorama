                                "Я, например,
                                на  свете лучшей книгой
                                считаю кодекс уголовный наш.
                                ...............................
                                Открою кодекс на любой странице
                                и не могу - читаю до конца !"

                                              Владимир Высоцкий





              Драйвер - расширитель возможностей
                   работы с гибкими дисками.

      ┌────────────────────────────────────────────────┐
      │ P U _ 1 7 0 0 . C O M   Beta V 3.3 от 24.09.92 │
      └────────────────────────────────────────────────┘

                           а также:

            6 небольших программ-"примочек" к PU_1700:

    - PU_tmFD.COM - программа тестирования носителя  и его вре-
                    менных характеристик на физическом уровне.
                                             V 1.2 от 12.12.92.

   - PU_tmFDm.COM - программа тестирования  временных  характе-
                    ристик носителя -  его  производительности,
                    на логическом уровне.    V 1.1 от 19.11.91.

   - PU_optFD.COM - программа   оптимизации  производительности
                    гибких носителей.        V 1.5 от 23.02.93.

   - PU_copFD.COM - программа копирования носителей любого фор-
                    мата в сжатый файл его образа и наоборот.
                                             V 2.8 от 26.03.93.

   - PU_edpFD.COM - программа редактирования системной  области
                    отформатированного носителя (BOOT+FAT+ROOT)
                    с целью увеличения полезного объема дискеты
                    на 5-15 килобайт.        V 1.9 от 23.02.93.

   - PU_wrcFD.COM - драйвер контроля качества записи информации
                    на  гибкие носители.  Применение последнего
                    повышает вероятность верного прочтения  за-
                    писанной Вами   информации.  Драйвер  может
                    быть резидентно загружен в UMB, HMA или ос-
                    новную память!
                                             V 1.1 от 26.03.93.


                  программист:    Панков Ю.И.
                дата создания:    1991-1993 г.


     PU_1700.COM - это русский аналог широко известного в нашей
стране драйвера 800.COM,  с расширенными, чем у последнего воз-
можностями.
     PU_1700 позволяет использовать Вам все старые форматы дис-
кет и много новых, сохраняя при этом полную совместимость с DOS
(и полную замену драйвера 800.COM). Новые форматы поддерживают-
ся на уровне BIOSа, поэтому они полностью совместимы с DOS и со
многими ее утилитами: FORMAT, DISKCOPY, DISKCOMP и другими.

  ┌────────────────────────────────────────────────────────┐
  │ Не выбрасывайте дискеты, у которых безнадежно запорчен │
  │                      0 трек !                          │
  └────────────────────────────────────────────────────────┘
     PU_1700 позволяет  их  безболезненно отформатировать любой
имеющейся у Вас утилитой,  на  любой  поддерживаемый  формат  и
обеспечит работу с ними!

     PU_1700 резидентно занимает менее 1.5 kb оперативной памя-
ти и работает под управлением DOS 3.30 и выше, может устанавли-
ваться  на  резидентное  обслуживание как из файла CONFIG.SYS в
качестве DEVICE=, так и из любого BAT-файла или командной стро-
ки. Повторный запуск PU_1700 позволяет просмотреть, а при необ-
ходимости, и перестроить параметры уже установленного драйвера.

     PU_1700 значительно расширяет  значения  опций  "/T:tt"  и
"/N:nn", а значит и возможности стандартной утилиты FORMAT:

     FORMAT drv:[/T:tt][/N:nn][и другие опции]           где:

     drv - имя форматируемого драйвера (A или B)
     tt  - число форматируемых цилиндров
     nn  - число секторов на треке

     Ниже приведена  далеко  неполная  таблица значений объемов
отформатированной дискеты в зависимости от типа дисковода, типа
дискеты и параметров форматирования (tt и nn):

  ┌────────────┬────────────────────┬───────────────────────┐
  │   Опции    │     Допустимый     │ Объем отформатирован- │
  │  FORMATа   │   тип дисковода    │ ной дискеты в байтах  │
  ├───────┬────┼────┬────┬────┬─────┼───────────────────────┤
  │   tt  │ nn │360к│720к│1.2м│1.44м│   норма   - максимум  │
  ├───────┼────┼────┼────┼────┼─────┼───────────────────────┤
  │ 40-41 │  9 │ +  │ +  │ +  │  +  │   362.496 -   371.712 │
  │ 40-41 │ 10 │ +  │ +  │ +  │  +  │   398.848 -   409.086 │
  │ 80-83 │  9 │    │ +  │ +  │  +  │   724.480 -   752.168 │
  │ 80-83 │ 10 │    │ +  │ +  │  +  │   806.460 -   837.120 │
  │ 80-83 │ 15 │    │    │ +  │  +  │ 1.212.928 - 1.259.008 │
  │ 80-83 │ 16 │    │    │ +  │  +  │ 1.294.848 - 1.344.000 │
  │ 80-83 │ 17 │    │    │ +  │  +  │ 1.376.768 - 1.427.968 │
  │ 80-83 │ 18 │    │    │ +  │  +  │ 1.457.664 - 1.512.960 │
  │ 80-83 │ 19 │    │    │    │  +  │ 1.539.584 - 1.596.928 │
  │ 80-83 │ 20 │    │    │    │  +  │ 1.620.480 - 1.681.920 │
  │ 80-83 │ 21 │    │    │    │  +  │ 1.702.400 - 1.765.888 │
  └───────┴────┴────┴────┴──────────┴───────────────────────┘
     Примечание: объем отформатированной дискеты можно еще без-
болезненно увеличить программой - "примочкой" PU_edpFD  на 5-15
килобайт:
                   83x10 - до 0.845.224 байт
                   83x18 - до 1.523.712 байт
                   83x21 - до 1.777.664 байт

     Как это делается? - описано ниже.

     PU_1700, в отличие от драйвера 800, имеет два дополнитель-
ных формата большого объема:

                - 1.44 MB  для  HD 5" (1.2 MB)
                - 1.68 MB  для  HD 3" (1.44 MB)

     Пример задания  на  форматирование дискеты HD на дисководе
1.44 MB (3") на объем 1.702.400 байт:

     FORMAT a:/t:80/n:21         /u  - для MS/DOS выше 5.0 Beta

     PU_1700 допускает  форматирование  до 83 цилиндров.  Такую
дискету нетрудно отформатировать.  Задание /t:41 и /t:81  безо-
пасны.  Дополнительные  цилиндры 82 и 83 (42 для DD) могут хуже
читаться или вовсе отсутствовать на Вашем  дисководе. Последнее
встречается крайне редко.  В любом случае при работе с дополни-
тельными цилиндрами Вы должны внимательно слушать, не ударяется
ли головка дисковода об ограничитель, расположенный перед валом
двигателя. Замечу, что это возможно крайне редко, т.к. все сов-
ременные  дисководы  допускают свободное перемещение головки до
84 трека.  И даже если Вы ничего не  услышали  подозрительного,
проверьте отформатированную Вами дискету с дополнительными тре-
ками какой-либо тестирующей утилитой,  на  предмет  присутствия
последних (Pctools и др.).

     Большинство форматов (даже большие !) могут  быть  сделаны
загрузочными заданием ключа /s команды FORMAT. Но следует отме-
тить,  что существуют BIOS не допускающие загрузку с  носителей
больших форматов.
           ┌──────────────────────────────────────┐
           │ HD 5" (1.44) может быть загрузочной! │
           └──────────────────────────────────────┘
     Однако, если Вы все же загружаетесь с "нестандартной" заг-
рузочной дискеты, Вы должны вызвать PU_1700 из Вашего AUTOEXEC.
BAT.  Иначе все нестандартные дискеты,  в том числе и загрузоч-
ная,  перестанут  читаться  после любой смены гибкого носителя!
Для изготовления загрузочных дискет DD 5" формата  720  KB,  не
забывайте установить параметр "/b720=Y".

     PU_1700 поддерживает работу стандартных утилит  DISKCOPY и
DISKCOMP значительно расширяя их возможности.  Вы можете приме-
нять указанные утилиты между различными типами  дисководов, при
условии поддержки их одинакового формата (см.  таблицу). Вы мо-
жете запустить DISKCOPY/DISKCOMP между 5" и 3"  дисководами. Вы
можете  безопасно  скопировать  стандартную дискету HD 3" на HD
5" и наоборот!  Заметим,  что драйвер 800 не позволит Вам этого
сделать.

     ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
     ║ HD 3" (1.44 MB) ║<═══════════>│ HD 5" (1.44 MB) │
     ╚═════════════════╝  DISKCOMP   └─────────────────┘

     ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
     ║ HD 3" ( 720 KB) ║<═══════════>│ HD 5" ( 720 KB) │
     ╚═════════════════╝  DISKCOMP   └─────────────────┘


     PU_1700 позволяет повысить производительность ваших диско-
водов до 70%  !. Стандартные утилиты FORMAT, DISKCOPY, DISKCOMP
и другие могут работать совместно с PU_1700  значительно  быст-
рее. Например:
               B                              A
      ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
      ║ HD 3" (1.44 MB) ║════════════>│ HD 5" (1.44 MB) │
      ╚═════════════════╝             └─────────────────┘
             ┌───────────────────────────────────┐
             │ может быть ускорено на 1 минуту ! │
             └───────────────────────────────────┘

     Драйвер 800 не позволит Вам и этого сделать, он только мо-
жет ухудшить хорошие временные характеристики Вашего дисковода.

     Работайте с форматами большого объема. Они не менее надеж-
ны,  чем стандартные. Специально принятые меры (только для фор-
матов  большого  объема) обеспечивают высокую надежность работы
даже на низко скоростных (старых моделях)  контроллеров  гибких
дисков.  И еще раз отметим,  что задание /t:81 (или меньше) при
форматировании безопасны.

     Итак, задания на безопасное форматирование дискет на  дис-
ководах:
                      A - 360  KB (5"),
                      A - 1.2  MB (5") и
                      B - 1.44 MB (3"):

    ╔════════════════════════════════════════════════════╗
    ║  FORMAT a:/t:81/n:10  -  на объем  .816.640 байт   ║
    ║  FORMAT a:/t:81/n:18  -  на объем 1.476.096 байт   ║
    ║  FORMAT b:/t:81/n:21  -  на объем 1.723.904 байт   ║
    ║  ---"---"---"---"-/u  -  для версий MS/DOS > 5.0 B ║
    ╚════════════════════════════════════════════════════╝


                      Запуск PU_1700.COM.
                    ───────────────────────
     PU_1700 версии 3.1 и выше выполнен в виде COM-файла, кото-
рый может быть описан как драйвер в файле CONFIG.SYS в формате:

  ╔══════════════════════════════════════════════════════════╗
  ║  DEVICE=drv:\path\PU_1700.com [/параметр]                ║
  ║    или                                                   ║
  ║  DEVICE=drv:\path\PU_1700.com [/параметр ... /параметр]  ║
  ╚══════════════════════════════════════════════════════════╝

     где:  drv:\path - полный путь к файлу PU_1700.COM.


     Или в файле начальной автозагрузки AUTOEXEC.BAT в формате:

   ┌─────────────────────────────────────────────────────────┐
   │ [drv:\path\]PU_1700 [/параметр]                         │
   │   или                                                   │
   │ [drv:\path\]PU_1700 [/параметр ... /параметр]           │
   └─────────────────────────────────────────────────────────┘

     где параметр[ы]:

            1) допустимы в только командах 1 запуска:
          ────────────────────────────────────────────
     /ke    - сохранить  блок среды  (ENV). Не имеет смысла при
              "DEVICE=" запуске.
     /psp   - сохранить префикс программного сегмента (PSP).
              Увеличивает длину резидента на 256 байт. Не имеет
              смысла при "DEVICE=" запуске.
     /cfat -  контроль  FAT  при  форматировании (необходим для
              корректной работы  утилиты  FORMAT   коммерческой
              версии MS DOS 5.0,  да и для других систем не по-
              мешает. Увеличивает длину резидента на 224 байта.

        2) допустимы в командах 1 запуска и перезапуска:
       ──────────────────────────────────────────────────
     /off   - отключение драйвера
     /on    - активизация отключенного драйвера
     /A=off - дисковод A не обслуживается (не установлен)
     /B=off - дисковод B не обслуживается (не установлен)
                                      ┐
     /A=360 - 360  KB, 5" (DD) ┌───┐  │
     /B=360 - 360  KB, 5" (DD) │ " │  │   Этими  параметрами
     /A=1.2 - 1.2  MB, 5" (HD) │ 5 │  │ нельзя переназначать
     /B=1.2 - 1.2  MB, 5" (HD) └───┘  │ типы установленных у
                                      │ Вас дисководов 3" на
     /A=720 - 720  KB, 3" (DD) ╔═══╗  │ 5" и наоборот!
     /B=720 - 720  KB, 3" (DD) ║ " ║  │
     /A=1.44- 1.44 MB, 3" (HD) ║ 3 ║  │
     /B=1.44- 1.44 MB, 3" (HD) ╚═══╝  │
                                      ┘
     /?     - вызов подсказки
     /sm=1  - 1 оптимальное  расположение секторов при формати-
              ровании для увеличения производительности  диско-
              вода.
     /sm=2  - 2 оптимальное  расположение секторов при формати-
              ровании для увеличения производительности  диско-
              вода.
    /sm=off - отключение оптимизации  расположения секторов при
              форматировании.
    /B720=Y - подключение редактирования BOOT сектора для носи-
              телей  формата  720 KB 5".
    /B720=N - отключение редактирования BOOT сектора для  носи-
              телей формата 720 KB 5".
  /BootA=nn - задает  номер цилиндра носителя,  где расположена
              (или надо  расположить)  его  системная   область
              (BOOT + FAT+ ROOT),  установленного в дисковод A.
              По умолчанию - 0 цилиндр.
              Пределы перемещения: 2 - 38 цилиндры.
  /BootB=nn - задает  номер цилиндра носителя,  где расположена
              (или надо  расположить)  его  системная   область
              (BOOT + FAT+ ROOT),  установленного в дисковод B.
              По умолчанию - 0 цилиндр.
              Пределы перемещения: 2 - 38 цилиндры.
     /nul   - не выводить сообщения драйвера.  Аналогичен пере-
              ключателю ">nul".  Имеет смысл при "DEVICE="  за-
              пуске. Введен  по многочисленным просьбам пользо-
              вателей DR DOS V6.0.
     /u     - отключение драйвера c выгрузкой его из памяти.
              Не имеет   смысла  для  "DEVICE="  установленного
              драйвера или при первом запуске.

       3) допустимы в командах 1 запуска и перезапуска и
      ───────────────────────────────────────────────────
                 работающие как переключатели.
                ──────────────────────────────

     /co    - включение / выключение режима  совместимости  для
              альтернативного обслуживания носителей 720 KB.
              Начиная с версии 3.3 этот параметр дополнен пара-
              метрами /с0 , /с1  и /c2.

     /if    - включение / выключение режима "чередования секто-
              ров" при форматировании больших форматов  (inter-
              leave factor = 2 - включен / 1 - выключен).

     Перезапуск драйвера без параметров  -  отображает  текущее
состояние уже установленного драйвера и только.
     Под перезапуском драйвера здесь понимается тот  факт,  что
драйвер уже установлен на резидентное обслуживание, и Вы запус-
каете программу PU_1700.COM только для смены или просмотра  па-
раметров драйвера, описанных в п. 2) и 3). При этом, PU_1700 не
становится второй раз на резидентное  обслуживание,  он  только
перестраивает резидентно установленный Вами драйвер.  Новые те-
кущие параметры обслуживания которого выводятся на экран Вашего
дисплея.  Драйвер  может  быть  перенастроен  (и даже отключен)
сколь угодное число раз. При перезапусках обращайте внимание на
то, что Вы хотите и что на самом деле получилось.



                         Рекомендации.
                        ──────────────

     1. Не  изменяйте  имена  стандартных  утилит  DISKCOPY   и
DISKCOMP. Утилита PU_copFD работает гораздо быстрее  и надежнее
стандартной - DISKCOPY даже не с DOS форматами носителей.

     2. Если у Вас возникают какие-либо трудности при работе со
специфическими программами (различными копировщиками), Вы може-
те отключить PU_1700,  задав "PU_1700/off" в командной  строке.
Задание "PU_1700/on" активизирует работу отключенного драйвера.

     3. Если у Вас  возникают  странные  сообщения  об  ошибках
распределения памяти после задания FORMAT, попробуйте параметры
/ke и /psp при запуске PU_1700.

     4. Функции  DISKCOPY  и  DISKCOMP  в некоторых оболочках и
утилитах могут не работать с новыми форматами - используйте со-
ответствующие команды DOS - это надежнее.

     5. Запуск  драйвера  PU_1700  можно  производить из любого
места файла AUTOEXEC.BAT.  Если Вы работаете  с  нестандартными
дискетами БЕЗ драйвера PU_1700,  возможен незамеченным непредс-
казуемый и искаженный обмен файлов!  Пользователи PU_1700 сооб-
щают, что как правило, происходит абсолютно незамеченным запись
только половины файла (часто на носители HD  5"  1.44  MB)  без
драйвера PU_1700 ! Я на своей машине ничего подобного не наблю-
дал !

     6. Работа с форматами большой емкости:  720 KB 5",1.44  MB
5" и 1.68 MB 3" несколько замедляется при работе с некачествен-
ными носителями.

     7. PU_1700 при каждом запуске автоматически распознает ти-
пы  установленных  дисководов  гибких дисков и показывает их во
время старта для для всех версий PU_1700 выше 1.2. Тип дисково-
да можно задать и в командной строке, например:

    "PU_1700 /A=1.2"   задает: A - дисковод 1.2 MB, 5" (HD).

     Внимание! Нельзя произвольно переназначать  типы  установ-
ленных у Вас дисководов с 3" на 5" и наоборот. Например, если у
Вас дисковод A обслуживает носители 5":  HD - 1.2 MB и DD - 360
KB,  то  в  командной  строке  допустимо  только  задание типа:
"/A=1.2"! Переназначение типа "/A=360" в данном случае допусти-
мо, но при этом не будут обслуживаться HD форматы. А переназна-
чения "/A=1.44" или "/A=720" в данном случае недопустимы,  т.к.
они  предназначены для обслуживания 3" дисководов,  поэтому при
таком переназначении, все работы с 5" носителями на этом диско-
воде, будут НЕПРЕДСКАЗУЕМО обслуживаться.
     Задание "/A=1.44"  означает,  что  дисковод  A обслуживает
носители 3" HD формата до 1.68 MB и DD формата до 830 KB.
     Задание "/A=1.2"  означает,  что  дисковод  A обслуживает
носители 5" HD формата до 1.49 MB и DD формата до 830 KB.

     8. Форматы до 81 цилиндров (/t:81) безопасны. А вот надеж-
ную работу с количеством цилиндров большим  81  не  гарантируют
даже изготовители дискет. Практика показывает, что 82 и 83 тре-
ки можно использовать для временного хранения информации.

      9. Если на Вашей машине PU_1700 не обслуживает гибкие но-
сители  формата 720 KB,  попробуйте параметр "/co" при запуске.
Все последующие перезапуски PU_1700 с параметром "/co" переклю-
чают  этот  режим.  Начиная с версии 3.3 этот параметр дополнен
параметрами /с0  ,  /с1  и  /c2,  для  обслуживания   носителей
дополнительных альтернативных форматов 720 KB.
     PU_1700 в  режиме  /B720=Y всегда корректирует BOOT сектор
носителей 5" DD формата 720 KB - это необходимо для  изготовле-
ния  универсальных загрузочных дискет.  Вы можете отключить ре-
дактирование BOOT сектора параметром /B720=N  при  запуске  или
любом  перезапуске  PU_1700.  Параметр /B720=Y необходим только
при формировании загрузочных дискет 5" DD формата 720 KB! В ос-
тальных случаях его можно и нужно отключить.

     10. Если на Вашей машине установлен старый (низко скорост-
ной) контроллер гибких дисков,  не поддерживающий работу с дис-
кетами больших форматов,  попробуйте параметр /IF при  запуске.
Все последующие перезапуски PU_1700 c параметром "/if" переклю-
чают этот режим. Параметр "/if" может изменить режим форматиро-
вания только больших форматов. Самые большие форматы форматиру-
ются независимо от задания параметра c IF=2. Не пользуйтесь без
надобности IF=2,  т. к. при этом заметно замедляется работа Ва-
шего дисковода,  незначительно увеличить которую можно парамет-
ром "/sm=".

     10. PU_1700 обслуживает все дискеты форматированные  прог-
раммой  FDFORMAT или системной утилитой FORMAT c драйвером 800.

     11. Если при форматировании дискеты выдается сообщение:

        invalid media or Track 0 bad - disk unisable
        Format failure
        Format another (Y/N)

     ответьте Y,  после чего повторите форматирование. Если это
не поможет, то Ваша дискета действительно запорчена.
     Как известно,  DOS не может использовать носители с испор-
ченным нулевым цилиндром.  "За бугром" такие дискетки,  видимо,
просто выбрасывают.  В условиях нашей действительности нам  та-
кое, пока, не по карману. Поэтому попробуйте:
     Перезапуском PU_1700 с параметром "/BootA=nn" или "/BootB=
nn"  подобрать   местоположение   системной   области   дискеты
(BOOT+FAT+ROOT - по умолчанию располагается на 0 цилиндре), при
котором она будет форматироваться  утилитой  форматирования  на
нужный Вам формат.  После удачного форматирования запишите зна-
чение перемещения системной области носителя на  его  этикетке!
Для работы с такой дискетой необходимо перенастроить драйвер PU
_1700 простым перезапуском с параметром  перемещения  системной
области.  Для работы с любой другой дискетой драйвер опять при-
дется подстроить перезапуском.  Я надеюсь, что это Вам придется
не так уж и часто делать. Учтите, что PU_1700 поддерживает раз-
дельно значения параметров для каждого из дисководов.
     Практика работы с такими  дискетами  показала,  что  после
операции  перемещения  системной области дискеты,  некоторые из
них полностью восстанавливали свою работоспособность  сразу или
через  некоторое время,  если это было следствием загрязнения 0
трека.  В таких случаях дискету можно переформатировать уже с 0
перемещением системной области.
     Возможность перемещения системной области дискеты Вы може-
те использовать и как некое средство разграничения доступа.
     Производительность работы с дискетами можно увеличить при-
мерно  вдвое,  если  расположить системную область дискеты в ее
середине!  При этом сократится суммарная  величина  перемещения
головки при работе с файлами,  а значит и время.  В тоже время,
ее (производительность) можно уже в свою очередь  еще увеличить
за счет оптимального расположения секторов на каждом из треков.
Об этом и пойдет разговор ниже.

     12. Для  повышения  производительности Ваших дисководов до
70% форматируйте дискеты с параметрами "/sm=1" или "/sm=2"! Это
достигается оптимальным расположением секторов на треке гибкого
носителя . Попробую это объяснить. Вы можете просто представить
последовательное чтение информации с дискеты:

     - позиционирование блока головок на 1 трек
     - чтение трека
     - позиционирование блока головок на следующий трек
     - чтение трека
     - и т. д..

     Ваша дискета  вращается с постоянной угловой скоростью 300
об/мин (5 об/сек - 1 оборот за 3.6 "тика") или 360 об/мин (6 об
/сек - 1 оборот за 3 "тика") в зависимости от типа дисковода во
время позиционирования блока головок и во время  чтения  трека.
Время выполнения операции позиционирования блока головок,  раз-
лично для разных дисководов и определяется  временем коммутации
головки  и временем пошагового перемещения блока головок,  если
последнее необходимо. За время позиционирования угловое переме-
щение  дискеты может составить 1-5 секторов.  Таким образом,  в
нашем выше рассмотренном,  упрощенном случае  последовательного
чтения  треков с дискеты,  без оптимального расположения секто-
ров,  блок головок может установиться на 2-ой, 3-ий, ... сектор
следующего трека, после завершения операции позиционирования. А
так как трек читается с 1 сектора,  то его  чтение  оказывается
возможным  только на следующем обороте дискеты.  Таким образом,
чтение трека реально произойдет за 2 оборота дискеты.
     При оптимальном расположении секторов на треке,  после за-
вершения операций чтение трека + позиционирование на следующий,
начало  1 сектора следующего трека располагается точно под нуж-
ной головкой или перед ней.  Поэтому чтение трека возможно  уже
за 1 оборот дискеты.
     DOS-Format программы  всегда  форматируют  с неоптимальным
расположением секторов на треке.  PU_1700 предоставляет два па-
раметра оптимального форматирования.  Какой из них Вам выбрать?
Нужно поэкспериментировать и подобрать оптимальный.  Для оценки
повышения производительности гибких носителей форматированных с
различным расположением секторов на  треках,  можно  воспользо-
ваться "примочками" к PU_1700: PU_tmFD.COM и PU_tmFDm.COM, тес-
тирующие абсолютное чтение гибкого диска на физическом и  логи-
ческом  уровнях.  PU_tmFD.COM  достаточно наглядно иллюстрирует
все выше сказанное и ответит на все возникшие  у  Вас  вопросы.
Часть  результатов тестирования всевозможных форматов дискет на
моей PC приведена ниже и,  возможно поможет Вам  выбрать  опти-
мальный параметр:

┌────────┬────────┬───────┬────────────────┬──────────────────┐
│Носитель│ Формат │ Объем │   Параметры    │ Абсолютное время │
│        │        │       │ форматирования │ чтения диска  в  │
│        │        │       │                │ сек и увеличение │
│        │        │  KB   │  /sm=off/1/2   │ производительно- │
│        │        │       │                │     сти в %      │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    19.8          │
│ 360 KB │ 40:9   │ 360   │    /sm=1       │    15.5    28%   │
│        │        │       │    /sm=2       │    17.0          │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    53.0          │
│ 360 KB │ 80:10  │ 800   │    /sm=1       │    31.9    66%   │
│        │        │       │    /sm=2       │    33.2          │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    39.0          │
│ 1.2 MB │ 80:15  │ 1200  │    /sm=1       │    30.1    30%   │
│        │        │       │    /sm=2       │    31.0          │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    79.5          │
│ 1.2 MB │ 80:18  │ 1440  │    /sm=1       │    57.2    39%   │
│        │        │       │    /sm=2       │    56.8    40%   │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    63.7          │
│1.44 MB │ 80:18  │ 1440  │    /sm=1       │    35.5    79%   │
│        │        │       │    /sm=2       │    36.4          │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │    79.6          │
│1.44 MB │ 80:21  │ 1740  │    /sm=1       │    66.9    19%   │
│        │        │       │    /sm=2       │    67.6          │
└────────┴────────┴───────┴────────────────┴──────────────────┘
     Выигрыш производительности носителей отформатированных оп-
тимально может достигать 79% по сравнению со стандартным.
     PU_1700 корректно поддерживает значения параметров  "/sm="
при работе  со многими утилитами:  FORMAT,  DISKCOPY,  SFORMAT,
PCTOOLS, FDFORMAT и другими!

     PU_optFD.COM -
     ──────────────
     только при установленном драйвере PU_1700, позволяет опти-
мизировать (или "переоптимизировать") любой носитель под задан-
ное  Вами  значение  параметра  "/sm=".  Прерывая  работу  этой
программы в различных местах,  можно изготовить дискету с пере-
менным параметром оптимизации.
     PU_optFD.COM совместно с драйвером PU_1700 дают  Вам также
возможность быстрого  реформатирования  "старых" дискет с целью
их обновления (с сохранением информации).

     PU_copFD.COM -
     ──────────────
     только при установленном драйвере PU_1700,  позволяет про-
извести быстрое копирование дискет любого формата (даже  не Dos
формата!)в сжатый файл (CFD формата) образа дискеты и обратно с
любым параметром оптимизации.  PU_copFD имеет необходимую подс-
казку при запуске.  Может работать с плохими носителями. Сжатый
файл образа дискеты можно еще "дожать" любым архиватором. Пони-
мает наличие  активного драйвера PU_wrcFD в Вашей системе и,  в
связи с этим, изменяет алгоритм восстановления.

     PU_edpFD.COM -
     ──────────────
     может работать как при установленном драйвере PU_1700, так
и без него и позволяет произвести редактирование системной  об-
ласти  дискеты (BOOT + FAT + ROOT) с ее очисткой в широких пре-
делах.  Программа позволяет увеличивать полезный объем  дискеты
уменьшением ее системной области,  вплоть до короткой, содержа-
щей только одну копию FAT.  Программа может  быть  использована
для короткого форматирования дискет.
     К сожалению, MS DOS всех версий, включая и 5.0, имеют одну
общую ошибку при разборе параметров носителя - безусловно уста-
навливают число FAT = 2, несмотря на то, что в блоке параметров
дискеты BOOT проставлена 1 ! У меня уже целая куча вопросов ти-
па:  "Для  чего  разработчики операционной системы вводят в нее
глобальные параметры,  с которыми не умеют работать!" к мальчи-
кам  фирмы  Microsoft.  PU_edpFD умеет [пере]настраивать MS DOS
для работы с такими дискетами. Кстати, DR DOS 6.0 правильно по-
нимает дискеты с любыми системными областями, но работает с ни-
ми раз в 5 медленнее, особенно фаза инициализации носителя!
     Системная область отформатированной дискеты включает в се-
бя 3 области: BOOT, FAT и ROOT:


        ┌───────────────────────────────┐──────
        │                               │
        │           B O O T             │     B
        │                               │
        │        (один сектор)          │     O
        ├───────────────────────────────┤
        │                               │     O
        │         Р Е З Е Р В           │
        │                               │     T
        │     (обычно 0 секторов)       │
        ╞═══════════════════════════════╡──────
        │                               │
        │           F A T  1            │
        │                               │    F
        │     (минимум один сектор)     │
        ├───────────────────────────────┤    A
        │                               │
        │           F A T  2            │    T
        │                               │
        │     (может отсутствовать)     │
        ╞═══════════════════════════════╡──────
        │                               │    R
        │           R O O T             │    O
        │                               │    O
        │(минимум один сектор = 16 огл.)│    T
        ╞═══════════════════════════════╡───────
        │                               │
        │         Д А Н Н Ы Е           │    D
        │                               │
        │    (все оставшееся дисковое)  │    A
        │    (    пространство       )  │
        │                               │    T
        │                               │
        │                               │    A


     PU_edpFD имеет 6 параметров при запуске из командной стро-
ки:
     Cn - "n" определяет количество секторов в кластере,  и мо-
           жет быть задан в пределах 1 - 16.  Чем больше  клас-
           тер, тем меньше область FAT.
     Fn - "n" определяет число FAT 1 или 2.  Системная  область
           считается короткой, если число FAT = 1.
     Dn -  "n"  задает  число  элементов  в  корневом  каталоге
           (1-800). Можно задать число секторов, выделяемое под
           ROOT параметром "Rn" (1-50). Замечу, что в одном се-
           кторе можно разместить 16 элементов оглавлений.
     S  -  если задан,то производится настройка DOS на работу с
           указанными  параметрами  или (если они не заданы ) с
           носителем, установленным в указанном Вами дисководе.
           Замечу,  что  MS DOS часто сама не в состоянии этого
           сделать.  Настройку надо производить всегда, если Вы
           работаете  с  носителем,  имеющим короткую системную
           область.
     Y  -  если задан, то производится  принудительная  очистка
           системной области - быстрое форматирование дискеты.

     После работы с дискетой,  имеющей короткую  системную  об-
ласть,  не  забывайте перенастроить MS DOS (параметр "s"),  при
переходе на работу со стандартными дискетами. Будьте вниматель-
ны - это позволит Вам безопасно увеличить объем носителя на 5 -
15 килобайт.
     Работайте с дискетами,  имеющими длинную системную область
(F2) - они правильно понимаются всеми версиями DOS.
     Длину системной области можно уменьшить параметрами "Cn" и
"Rn" или "Dn".  Все DOS правильно понимают и эти параметры,  за
исключением системных утилит PCTOOLS,  NDD и других.  Область с
"С1" или "С2" безопасна,  "С4" и выше может  потребовать  пере-
настройки DOS или вообще не восприниматься на уровне DOS!

     PU_edpFD версии >= 1.5  не  обслуживает  гибкие  носители,
имеющие запорченные треки,  информация о которых хранится в FAT
(последний всегда очищается при  формировании  новой  системной
области). Очистку системной области часто называют коротким или
быстрым форматированием.

     PU_edpFD имеет короткую подсказку при запуске.

     PU_wrcFD.COM -
     ──────────────
     может работать как при установленном драйвере PU_1700, так
и без  него.
     Говорят, что  надежность  записи на внешние носители можно
повысить установив режим записи с последующей верификацией  за-
писанного (VERIFY=ON).  Но не торопитесь устанавливать этот ре-
жим и вот почему.
     Сей режим  может раза в два быстрее "разбить" Ваш жесткий
диск и только!  Жесткий диск  довольно-таки  надежное  внешнее
устройство  - на которое либо пишется,  либо нет.  И проверять
качество записи на него всякий раз верификацией накладно - это
можно и нужно делать гораздо реже.
     Для гибких дисков установка режима записи с  верификацией
не гарантирует Вам на все 100%, последующего верного прочтения
информации. Надежность верной записи при этом  несколько  воз-
растает (т.к. происходит контрольное считывание "в воздух" за-
писанной информации на предмет контроля ее контрольных  сумм),
но  не намного и,  в конечном итоге,  обеспечивается качеством
изготовления носителя.  Верификация может обнаружить т.н. оди-
ночные  ошибки  и  совершенно  бессильна против двойных и выше
ошибок (для справки:  на машинах серии IBM/370 использовался и
используется   до  сих  пор  контроль  целостности  информации
посредством кодов Хэмминга,  исправляющих одиночные  ошибки  и
обнаруживающих двойные!).
     Уверяю Вас,  что  особой  необходимости  установки режима
VERIFY=ON только для гибких носителей нет.  Тем более, что при
этом может пострадать невинный жесткий диск.

      ┌────────────────────────────────────────────────┐
      │              Итак, мое мнение:                 │
      │  не устанавливать VERIFY=ON в Вашу систему !!! │
      └────────────────────────────────────────────────┘

    История создания PU_wrcFD.  Не так давно я выгружал на дис-
кеты  больших  форматов  около  60 MB программного обеспечения.
После первой выгрузки с VERIFY=ON,  5%  всех файлов не прочита-
лись  на  этой  же  машине.  Пришлось  срочно  написать драйвер
PU_wrcFD, под управлением которого и была произведена повторная
выгрузка программного обеспечения на те же дискеты, после кото-
рой все дискеты были успешно прочтены на  другой  машине.  Могу
особо  отметить  тот  факт,  что сам процесс второй выгрузки на
дискеты (под управлением NC V3.0) уже не был таким "слепым" как
первый - два раза запись заканчивалась успешно только со второ-
го раза (NC,  меню ошибки при записи указывало на  CRC  ошибку,
которую выставил PU_wrcFD при несравнении),  удалось пометить 2
не совсем надежные дискеты.
     Драйвер любую операцию записи на гибкий носитель подменяет
тремя последовательно произведенными:

 W - запись из буфера на носитель;
 R - чтение записанной информации с носителя в буфер драйвера;
 C - побитное сравнение двух буферов.

     Неудачное завершение любой фазы WRC алгоритма приводит  к
неудаче операции записи в целом. При несравнении буферов драй-
вер выставляет CRC ошибку чтения.
     При установке  драйвера особое внимание обратите на пара-
метр выбора размера внутреннего  буфера  "/n:xx".  Драйвер  не
обслуживает носители  размер  трека  которых превышает размеры
установленного Вами внутреннего буфера.

     При установленном PU_wcrFD отпадает необходимость в зада-
нии  параметра верификации "/v" для системних утилит DISKCOPY,
COPY,  XCOPY и др. Контроль верности записи на гибкие носители
производится драйвером автоматически при каждой записи и проз-
рачен для используемых Вами программных оболочек типа NC.

     Желательно драйвер  PU_wrcFD устанавливать "сверху" драй-
вера PU_1700 (за ним),  но "снизу" (до) драйверов  кэширования
или расширения жестких дисков (но можно и после).

    Надеюсь, что PU_wrcFD поможет Вам работать, а не мучиться!

  Время выполнения операции записи при этом увеличивается  в  2
раза.

   Запуск PU_wrcFD.COM может быть  осуществлен  как  драйвер  в
файле CONFIG.SYS в формате:
  ╔══════════════════════════════════════════════════════════╗
  ║  DEVICE=drv:\path\PU_wrcFD.com [/параметр]               ║
  ║    или                                                   ║
  ║  DEVICE=drv:\path\PU_wrcFD.com [/параметр ... /параметр] ║
  ╚══════════════════════════════════════════════════════════╝
     где:  drv:\path - полный путь к файлу PU_wrcFD.COM.
     Или в файле начальной автозагрузки AUTOEXEC.BAT в формате:
   ┌─────────────────────────────────────────────────────────┐
   │ [drv:\path\]PU_wrcFD [/параметр]                        │
   │   или                                                   │
   │ [drv:\path\]PU_wrcFD [/параметр ... /параметр]          │
   └─────────────────────────────────────────────────────────┘
                       где параметр[ы]:
     /?     - вызов подсказки.
     /off   - отключение драйвера
     /on    - активизация отключенного драйвера
     /nul   - не выводить сообщения драйвера.  Аналогичен пере-
              ключателю ">nul".  Имеет смысл при "DEVICE="  за-
              пуске.
     /u     - отключение драйвера c выгрузкой его из памяти.
              Не имеет   смысла  для  "DEVICE="  установленного
              драйвера или при первом запуске.
     /n:xx  - определяет размер буфера драйвера  в  секторах. 1
              сектор = 512 байт. По умолчанию n:21 - определяет
              буфер размером в  10.5  килобайт,  который  можно
              уменьшить:
              - до n:18, если у Вас не обслуживаются HD 3"
              - до n:10, если у Вас не обслуживаются HD 3"и 5".
              - до n:1,  Вас вполне устраивает значительное за-
                медление операций записи.
     /nohma - предписывает  не  использовать HMA при выборе об-
              ласти резидентной  загрузки  драйвера.  Не  имеет
              смысла при "DEVICE=" запуске.
     /noumb - предписывает  не  использовать UMB при выборе об-
              ласти резидентной  загрузки  драйвера.  Не  имеет
              смысла при "DEVICE=" запуске.

     Если на Вашей машине XMS - драйвер обслуживает  UMB,  HMA,
то  возможна резидентная автозагрузка драйвера PU_wrcFD в любую
из этих областей памяти,  но только не при  "DEVICE="  запуске.
Работа  драйвера  в  основной памяти или в UMB предпочтительнее
его работы из HMA,  т.к. в последнем случае работа производится
через небольшой,  но очень медленный диспетчер линии A20, кото-
рый обязательно располагается в UMB или основной памяти.
     Замечу, что после загрузки DOS 5.0 в HMA c  числом буферов
(buffers=) менее 20 , там остается 14-15 килобайт свободной па-
мяти. Что вполне достаточно  для  загрузки  PU_wrcFD  и  других
программ в HMA. 
     Если не один из параметров "/noumb" или "/nohma" не задан,
то драйвер попытается успешно загрузится резидентно  в  UMB,  в
случае неудачи - в HMA, в случае неудачи - в основную область.

     Если у Вас возникают какие-либо трудности  при  работе  со
специфическими программами (различными копировщиками), Вы може-
те отключить PU_wrcFD, задав "PU_wrcFD/off" в командной строке.
Задание  "PU_wrcFD/on" активизирует работу отключенного драйве-
ра.

     При форматировании  дискет  утилитой FORMAT,  не забывайте
установить параметр "/u" в командной  строке  команды  для  DOS
версий старше 5.0 Beta

     13. Если  на  Вашей машине установлена коммерческая версия
MS DOS 5.0 и PU_1700 некорректно работает с утилитой  FORMAT на
больших  форматах,  попробуйте параметр /cfat при запуске.  При
этом резидентная часть драйвера увеличится на 224 байта.

     14. Программы PU_tmFD,  PU_tmFDm и PU_optFD имеют одинако-
вый формат командной строки при запуске:

     PU_????? [drv] [N]  или  PU_????? [N] [drv]  где:

     drv - имя драйвера (по умолчанию: A)
     N   - если указан, то производится прямой вывод информации
           на экран Вашего дисплея,  в противном случае, запись
           на экран производится только во время обратного хода
           луча строчной развертки.

     Пример запуска программы PU_optFD:     PU_optFD B N

     15. Все  версии  "примочек"  описанных  выше совместимы со
всеми версиями PU_1700.  Более ранние версии "примочек"  несов-
местимы с версиями PU_1700 начиная с 3.1.

     16. PU_1700  реализует  алгоритм  TSR программ без PSP при
запуске из AUTUEXEC.BAT. Работу с такими программами не поддер-
живают драйверы типа RELEASE и некоторые типы вирусов ! Это мо-
жет быть одной из причин "зависания" Вашей ПЭВМ  при  установке
PU_1700. В таких случаях попробуйте параметр "/psp" при запуске
(при этом резидентная часть драйвера увеличится на 256  байт) -
возможно  это  поможет Вам.  А если это "зависание" - есть воз-
действие вируса?  Отделаться от RELEASE можно запустив  драйвер
как "DEVICE=" из CONFIG.SYS.
     Если вы используете утилиту APPEND с параметром "/x:on" из
набора коммерческой версии MS DOS 5.0,  то ее запуск желательно
производить после запуска PU_1700.  Утилита (APPEND)  настолько
"сырая",  что поведение операционной системы при ее установке в
таком варианте непредсказуемо!

     17. Широко  известные  в  нашей стране утилиты П.  Нортона
DISKEDIT,  NDD и другие работают корректно только с  избранными
форматами гибких носителей! Это для меня вообще непонятно, чего
проще - считал блок параметров носителя и работай.  Но оказыва-
ется, что там, "за бугром", успехом пользуется широко известный
у нас алгоритм "я хозяин вся страна" - параметры избранных фор-
матов описаны в теле самой программы, а считанные корректируют-
ся или игнорируются.  Поэтому дискета формата 1.7 MB может быть
"вылечена" в формат 1.44 MB утилитой NDD, а носители с короткой
системной областью распознаются утилитами,  как запорченные,  и
т. д..
     Будьте особо  внимательны  при работе утилит П.  Нортона с
гибкими носителями  нестандартных  форматов!  Утилиты  в  целом
прекрасные,  работают только с т.н.  стандартными форматами, но
их не мешало бы и доработать (утилиты).  От этого они  хуже  не
станут.

     18. Если на вашей машине установлены пакеты типа: STACKER,
HYPERDISK,  обслуживающие жесткие диски  и  контролирующие  INT
13H, и Вы используете драйвер PU_1700, то его желательно распо-
ложить "снизу" предыдущих - одним из первых в  AUTOEXEC.BAT или
в CONFIG.SYS.  При работе "сверху" могут увеличиться обобщенные
временные характеристики системы драйвер  +  контроллер  гибких
дисков.  Производительность  работы с дискетами в такой системе
может резко упасть, а некоторые форматы дискет могут и вовсе не
обслуживаться.  Если  у  Вас быстрый контроллер гибких дисков и
быстрый процессор,  то Вам безразлично где установлен PU_1700 -
"сверху" или "снизу" - все будет работать как надо. Этот эффект
может проявиться при обслуживании устаревших (медленных)  моде-
лей контроллеров медленным процессором (< 10 мгц), если INT 13H
до PU_1700 контролируют  несколько  "замедляющих"  программ.  К
"замедляющим" программам можно отнести драйвер PU_wrcFD,  уста-
новленный в HMA.  Кстати, программа PU_tmFD при этом ответит на
все возникающие у Вас вопросы.
     Считаю, что кэшировать гибкие носители совершенно ни к че-
му.  А отложенную запись на гибкие носители расцениваю как "ко-
нец света" или "А после меня - хоть потоп"!.


                          Изменения.
                         ────────────

     V 1.2 - разблокировано управление параметром "/ke".

     V 1.3 - изменены управляющие ключи командной строки, изме-
             нен "Help", введено "Info", изменена настоящая ин-
             струкция.

     V 1.4 - поддерживает  работу  утилит   DISKCOPY / DISKCOMP
             с дискетами всех форматов!

     V 1.5 - устранено "нежелание форматироваться после началь-
             ной загрузки системы".
             Изменена настоящая инструкция.

     V 1.6 - изменен алгоритм работы драйвера. (В худшую сторо-
             ну - бывает и такое.)
             Изменена настоящая инструкция.

     V 1.7 - изменен алгоритм работы драйвера. Работает с неко-
             торыми старыми "странными" версиями BIOS.
             Изменена настоящая инструкция.

     V 1.9 - изменен алгоритм работы драйвера. Введены дополни-
             тельные параметры   командной  строки:  "/cfat"  и
             "/if" - корректная работа под управлением  коммер-
             ческой версии MS DOS 5.0 и возможность  переключе-
             ния режима  форматирования (interleave factor) со-
             ответственно. Оптимизировано время ожидания  пози-
             ционирования головки  -  все  операции с дискетами
             стали работать заметно быстрее (только не со  ста-
             рыми контроллерами дисководов).
             Версия 1.9 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.0   изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки: "/sm" - возмож-
             ность оптимального расположения секторов при  фор-
             матировании - увеличение производительности Ваших
             дисководов до 70%.
             Версия 2.0 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.1   изменен алгоритм работы драйвера.  Драйвер коррек-
             тно работает с утилитой SFORMAT и другими.
             Версия 2.1 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.2   изменен алгоритм работы драйвера. Введены дополни-
             тельные параметры командной строки:
              "/sm=1", "/sm=2" и "/sm=off" взамен "/sm"
             для дополнительного увеличения производительности
             Ваших дисководов.  Драйвер  корректно работает со
             многими утилитами  и "форматерами" гибких  дисков,
             поддерживая заданные параметры: "/if" и "/sm=".
             Версия 2.2 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.3   Драйвер корректно работает с PU_optFD.COM -  опти-
             мизатором производительности гибких носителей.
             Версия 2.3 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.4   Драйвер     корректно   работает   под управлением
             DR DOS v6.0  (драйвер 800 под ней не работает !)
             Версия 2.4 опытная (Beta).
             Настоящая инструкция дополнена Приложением.

     V 2.5   Улучшен алгоритм распознавания активных дисководов.
             Версия 2.5 опытная (Beta).

     V 2.6   Изменен алгоритм работы драйвера.  Драйвер коррек-
             тно работает с утилитой NCACHE.EXE и ей подобных.
             Версия 2.6 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.7   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки:  /B720=, позво-
             ляющий отключать/подключать   редактирование  BOOT
             сектора носителей 720 KB 5"(DD).
             Версия 2.7 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.8   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки:  "/psp", позво-
             ляющий [не] использовать PSP драйвером.
             Версия 2.8 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.9   Технологическая версия программы.

     V 3.0   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки: "/BootX=", поз-
             воляющий работать с дискетами, у которых безнадеж-
             но запорчен 0 трек.
             Версия 3.0 опытная (Beta).
             Изменена настоящая инструкция.

     V 3.1   Изменен алгоритм  инициализации драйвера.  Драйвер
             может быть запущен как из файла  AUTOEXEC.BAT, так
             и из файла CONFIG.SYS в качестве  DEVICE= . Введен
             дополни тельный параметр командной строки: "/nul",
             эквивалентный  переключателю   системного   вывода
             ">nul".
             Версия 3.1 опытная (Beta).
             Изменена настоящая инструкция.

     V 3.2   Уточнен алгоритм обслуживания носителей HD 5" фор-
             мата 16-17 секторов.
             Версия 3.2 опытная (Beta).
             Изменена настоящая инструкция.

     V 3.3   Введен новый параметр командной строки "/u" - выг-
             рузка установленного  драйвера из памяти,  уточнен
             алгоритм обслуживания носителей HD  5" -  расширен
             круг BIOS корректно работающих с PU_1700.
             Версия 3.3 опытная (Beta).
             Изменена настоящая инструкция.





                Право распространения программы.
                   (жулики за компьютерами)
               ────────────────────────────────

     В СНГ пока нет защиты авторских прав.  У нас в стране  во-
ровство  называют  нелегальным копированием программных продук-
тов.  И в уголовном кодексе,  например России, есть целый букет
статей посвященных воровству и ни одной - "нелегальному копиро-
ванию" - такому же воровству - фантастика да и только ! Поэтому
ворует  вся  страна.  Причем ни один из жуликов не может себя в
чем-то упрекнуть,  т.к.  никто не ворует,  все достают. Один из
участников Московского семинара системных программистов спраши-
вает у другого - "Не подскажешь:  где достать STACKER V 3.0  ?"
Спрашивают как правило не где купить, а где украсть. А бывает и
такое:  " У меня есть (где украл не важно - есть и все!) свежая
версия  STACKER  V  3.0  - кому нужно могу дать." Это уже чисто
совковое мышление,  которое может измениться лишь  после  смены
поколений.
     Ниже приведены выдержки из "Постановления Верховного Сове-
та Российской Федерации О ВВЕДЕНИИ В ДЕЙСТВИЕ ЗАКОНА РОССИЙСКОЙ
ФЕДЕРАЦИИ  "О ПРАВОВОЙ ОХРАНЕ ПРОГРАММ ДЛЯ ЭЛЕКТРОННЫХ ВЫЧИСЛИ-
ТЕЛЬНЫХ МАШИН И БАЗ ДАННЫХ"":

     "Верховный Совет   п о с т а н о в л я е т :

     1. Ввести в действие Закон Российской Федерации "О  право-
вой  охране программ для электронных вычислительных машин и баз
данных" с 1 июля 1992 года......
     ...4. Установить,  что до 1 января 1994 года на территории
Российской Федерации использование  в научно-исследовательских,
учебно-просветительских  и  личных целях без извлечения прибыли
программ для электронных вычислительных машин и баз данных, вы-
пущенных в свет (опубликованных) до вступления в силу указанно-
го Закона,  допускается без согласия автора (правообладателя) и
без выплаты ему вознаграждения....."

     Итак, до 1 января 1994 года на всей территории России уза-
конено безнаказанное воровство программных продуктов! И без из-
влечения прибыли - ерунда какая-то совковая.  Украл - уже  при-
быль.  Как можно воровать без извлечения прибыли?  Что же будет
потом ?!

     А пока,  мне бы не хотелось увеличивать число законно сво-
рованных Вами программных продуктов. Поэтому:

     PU_1700.COM вместе  с настоящей инструкцией и "примочками"
может свободно распространяться ТОЛЬКО в некоммерческих  целях,
ТОЛЬКО  БЕСПЛАТНО  и без всяких ограничений.  Работайте на здо-
ровье!




           Желаю успехов!            Панков Ю.И.    26.03.93 г.
         г. Сергиев Посад
             (Загорск)
        тел. (254)-400-71 (дом)









                          Приложение.
                         ─────────────


        А. О максимально возможных форматах носителей.
        ──────────────────────────────────────────────

     Для носителей HD 5" (1.2 MB),  неформатированный объём ко-
торых на 80x2 треках равен 1.6 MB (1.638.400 байт),  максималь-
ный формат, работу с которым поддерживает MS DOS достигнут:

     80x2 треков по 18 секторов в 512 байт - 1.474.560 байт
                                              (1.44 MB)

     При этом за вычетом системных областей:  BOOT,  FAT и ROOT
полезный объем дискеты составляет 1.457.664 байт или 1.4235 MB.

     По 1 KB на треке (всего 163.840 байт ) ушло на  межсектор-
ные  промежутки,  уменьшить которые уже некуда.  Это предельный
формат для HD 5" с которым можно работать на уровне MS DOS.


     Для носителей HD 3" (1.44 MB), неформатированный объём ко-
торых на 80x2 треках равен 2.0 MB (2.048.000 байт),  максималь-
ный формат, работу с которым поддерживает MS DOS сейчас состав-
ляет:

     80x2 треков по 21 сектор в 512 байт - 1.720.320 байт
                                            (1.68 MB)

     При этом за вычетом системных областей:  BOOT,  FAT и ROOT
полезный объем дискеты составляет 1.702.400 байт или 1.6625 MB.

     По 2 KB на треке (всего 327.680 байт) ушло на межсекторные
промежутки, это многовато. Поэтому это не предельный формат для
HD 3" с которым можно работать на уровне MS DOS.  Я,  например,
уже  сейчас  умею  форматировать  HD 3" дискеты на максимальный
объем 1.76 MB (1.802.240 байт - 80x2 треков по 11 секторов  в 1
KB - это предел). Но с ними пока не работает MS DOS.
                          Примечание:
                         ────────────
     1. Увеличение  максимального  объема  дискеты  увеличением
числа отформатированных треков, на сколько это позволяет диско-
вод (например до 83),  я не рассматриваю в контексте предельных
форматов носителей,  т.к. это уже предельные возможности диско-
вода и носителя.
     2. Можно увеличить полезный объем отформатированной диске-
ты  уменьшением размеров ее системных областей,  отредактировав
последние "примочкой" PU_edpFD.  Например если  сделать  размер
кластера  равным  1  KB  (2 сектора),  то размер FAT уменьшится
вдвое. При этом полезный объем дискеты несколько увеличится, но
это кажущееся увеличение оборачивается уменьшением, если на та-
кую дискету записать больше 9 файлов.


        Б. О "чередовании секторов" при форматировании.
      ──────────────────────────────────────────────────

     При форматировании  трека  носителя  немаловажное значение
имеет так называемый "Interleave Factor",  определяющий порядок
следования секторов на треке ( в дальнейшем IF).
     Если IF = 1, то порядок следования секторов последователь-
ный: 1-ый, 2-ой, ... . При IF = 2 сектора располагаются в чере-
дующемся кольцевом порядке. Например, если на треке расположить
10 секторов с IF = 2,  то они должны быть расположены следующим
образом:
              1, 6, 2, 7, 3, 8, 4, 9, 5, 10
     Таким образом  увеличивается межсекторный промежуток между
последовательными номерами секторов.  Прямое чтение, запись или
форматирование такого трека производится контроллером за 2 обо-
рота двигателя.  А при IF = 3 - за 3. Таким образом можно попы-
таться  обойти скоростные ограничения контроллера,  существенно
понизив производительность Вашего дисковода !
     Форматирование дискет на высшие форматы,  без IF >= 2  не-
возможно, иначе  контроллер не успевает обрабатывать межсектор-
ные промежутки,  где хранятся угловые метки и  другая  полезная
информация.


     В. Особенности работы  утилиты FORMAT "коммерческой"
    ──────────────────────────────────────────────────────
              версии  MS DOS 5.0 совместно с 800.
             ────────────────────────────────────

     "Улучшенная" утилита  FORMAT  только и только этой версии
не очищает FAT длиною больше 9 секторов.  Она прекрасно форма-
тирует дискеты большого формата.  Но если размер FAT превышает
9 секторов,  то весь конец FAT прописывает  каким-то  мусором.
После  такого  "форматирования"  часть  диска  оказывается уже
"распределенной".  Привести в порядок такую дискету  нетрудно:
надо  очистить  конец 1-ой и 2-ой FAT после 9 их сектора любой
имеющейся у Вас под руками утилитой:  PCTOOLS,  NDD,  CHKDSK и
др.
     Описанный эффект может иметь место на форматах  более 1.44
MB.  Ответить на вопрос - кто же тут неправ: утилита FORMAT или
драйвер 800 затруднительно, на мой взгляд обе программы работа-
ют некорректно. Драйвер 800 на больших форматах безусловно выс-
тавляет размер FAT в 9 секторов утилите FORMAT, даже если нужно
больше или меньше.  Старые утилиты FORMAT "молча" пересчитывали
этот параметр после форматирования  и  формировали  "очищенный"
FAT нужной длины. Утилита FORMAT коммерческой версии MS DOS 5.0
тоже пересчитывает длину FAT,  а очищает ровно столько, сколько
выставил драйвер 800 - не более 9 секторов.
     Запуск PU_1700  с  параметром "/cfat" позволяет произвести
корректное форматирование дискет любого формата.  При этом раз-
мер резидентной части драйвера увеличивается на 224 байта.

     Поклонники драйвера 800 !
     Утилита FORMAT  Beta версии MS DOS 5.0 работает по старому
"корректно" под коммерческой версией MS DOS 5.0  независимо  от
установленного драйвера 800 или PU_1700 !
     Утилита FORMAT версии DR DOS 6.0 содержит, на  мой  взгляд
ошибку, которой  вполне хватило, чтоб совместно с драйвером 800
отказаться форматировать  все большие форматы дискет !  PU_1700
начиная с версии 2.4 корректно работает с этой утилитой.



        Г. О "заглушках" в PU_1700 или "почему я выпус-
     ─────────────────────────────────────────────────────
                       каю Beta версии".
                      ──────────────────

     PU_1700 уже почти не развивается. Версия 3.1 отличается от
3.0 только алгоритмом инициализации - более  престижным.  Алго-
ритм же обслуживания не изменился вообще.  Драйвер успешно "об-
катался" на многих машинах и на многих прикладных  пакетах, для
большинства из которых пришлось в драйвере предусмотреть специ-
альные "заглушки",  но конца этому пока невидно.
     Не все  версии  BIOS  одинаково  работают  под управлением
PU_1700,  Некоторые из них могут самостоятельно обслуживать но-
сители 360KB/720KB/1.2MB в дисководе 5"!  Все новые версии BIOS
пытаются обслуживать носители формата 720 KB в дисководе 5", но
делают это по разному. Поэтому у одних это получается, у других
нет.  Чаще - нет - и вот почему. Логический формат носителя 720
KB  в дисководе 5" MB физически может быть получен в двух вари-
антах:

     - на скорости передачи данных 300 kb/sec  - вариант 1
     - на скорости передачи данных 250 kb/sec  - вариант 2

     Он же может быть представлен BIOS - ом  в  трех  вариантах
байтом  описания носителя (Media),  в рабочей области по адресу
0000:490/491h - 54h, 57h и 97h !

     Неискушенный пользователь PC не должен путать скорость пе-
редачи данных контроллера и угловую скорость вращения носителя,
которая в обоих случаях постоянна и равна 300 об/мин.  Искушен-
ному  пользователю все это покажется белибердой,  но не торопи-
тесь с выводами, я и сам не сразу до всего этого дошел. Загнать
контроллер  флоппи  диска  можно  в любой режим - поэтому такие
дискеты есть и их нетрудно изготовить.  Тем более, если PC сей-
час собирают все кому не лень и где попало.  BIOS к таким маши-
нам,  как правило, подбирают самого позднего года изготовления.
В СНГ таких машин - основная масса - и на них могут происходить
любые процессы - вот так!  Это конечно явные мутации IBM машин,
но  ведь других то у нас нет и пока не будет!  И только поэтому
можно говорить и о 2 вариантах формата 720 KB 3".
     Хочу отметить тот факт,  что в любом из рассмотренных выше
или ниже случаях дисковод всегда исправен и  его  блок  головок
отъюстирован на заводе изготовителе.
     BIOS, как  правило,  обслуживает  только один из вариантов
формата 720 KB на одном накопителе.  Поэтому  возможен  случай,
когда  изготовленные  на  Вашей новой машине носители HD 5" 720
KB,  не будут читаться на IBM совместимых машинах!
     Параметр "/co"  драйвера PU_1700 мне пришлось ввести (сод-
рать  у  Альберто  Паскуали)  для  обслуживания   совместимости
обслуживания  "односкоростных"  (в  контексте  передачи данных)
форматов, но совместимость "разноскоростных" форматов в то вре-
мя даже не предполагалась.
     Для совместимости обслуживания "разноскоростных" носителей
формата 720 KB в PU_1700 только начиная с версии 3.3 введен це-
лый ряд дополнительных  параметров  совместимости,  позволяющих
настраиваться на некоторые мутированные BIOS.
     Мне недавно попалась машина,  самостоятельно обслуживающая
только дискеты варианта 2 на дисководе 5" !  Она  прекрасно  их
изготовляла (форматировала) и работала с ними,  но последние не
читалитсь ни на одной IBM совместимой машине ! Под PU_1700 вер-
сии  3.3 удалось на этой же машине изготовить носители варианта
1, которые прекрасно читались на любой PC!
     Если Вы все же так ничего и не поняли,  попробуйте  прочи-
тать все это еще раз и обратите внимание на то, что трудности в
обслуживании формата 720 kb DD 5" возникают только на  IBM  му-
тантах  !  И самое главное - PU_1700 работает сверху BIOS и ис-
пользует для своих нужд только функции последнего. Поэтому, при
очень сильной мутации функций BIOS,  надо попытаться их восста-
новить драйверами:  ATDQ,  DRV720,  FD_BIOS и другими. И только
после  этого можно попробуйте драйверы 800 или PU_1700. "Шагают
бараны в ряд - бьют барабаны ...  " - если Вы хотите  запортить
свои  дискеты  формата 360 или 720 kb,  советую работать только
под драйвером FDREAD - каким образом он это делает,  я подробно
описывал  в одной из прошлогодних Софтпанорам непосредсвенно на
полях фрагмента его исходного текста!

     Уже появились  накопители,  обслуживающие носители формата
2.8 MB.  Но у меня пока такого нет и, по всей видимости, пока я
буду работать в этой совковой организции, не будет.

     Я заранее  благодарен  Вам  за сообщения типа:  "Ваш с...й
драйвер не работает с программой или BIOS-ом ...."


                                                     26.03.93 г

   P.S.
     Я с удовольствием выпущу коммерческую версию PU_1700, если
найдется меценат,  поддерживающий эту работу и взявший на  себя
труд  редактирования и перевода подобной (а не этой) инструкции
на английский язык.


   P.S.
     С другой стороны,  я ясно себе представляю, что по крайней
мере в России,  таких людей пока нет и быть не может, они могут
появиться не раньше,  чем через 70 - 100 лет. И попробуйте меня
в этом переубедить!  Тогда я с удовольствием уберу эти строки и
эпиграф.


