
   TECHNNOTE.DOC                                              Февраль 1994
                    Техническая информация архиватора RAR

   Версия 1.40 beta


***************************************************************************
    Автор может изменять формат и структуру данных, изложенные ниже,
    хотя по возможности он старается обеспечить преемственность версий.
***************************************************************************


   1.Формат архива RAR

   1.1. Заголовок архива

HEAD_ID
4 байта         Идентификатор архива:  0x52 0x45 0x7e 0x5e

HEAD_LEN
2 байта         Полная длина заголовка архива, включая комментарии
                к архиву и все дополнительные поля

HEAD_FLAGS
1 байт          Набор флагов:

                0x01    - признак Volume (архивный том)
                0x02    - присутствует комментарий к архиву
                0x04    - архив защищен от модификации
                0x08    - признак Solid (непрерывный архив)
                0x10    - комментарий к архиву упакован
                0x20    - в архиве содержится поле EXT1

                остальные биты могут использоваться для внутренних целей

COMM_LEN
2 байта         Длина комментария к архиву.
                Присутствует, только если  (HEAD_FLAGS & 0x02) != 0

MAIN_COMMENT    Комментарий к архиву.
                Присутствует, только если  (HEAD_FLAGS & 0x02) != 0

EXT1_LEN
2 байта         Длина поля EXT1.
                Присутствует, только если  (HEAD_FLAGS & 0x20) != 0

EXT1            Дополнительное поле.
                Присутствует, только если  (HEAD_FLAGS & 0x20) != 0

????            Прочие дополнительные поля - в данной версии отсутствуют


   1.2. Заголовок файла в архиве

PACK_LEN
4 байта         Размер файла в сжатом виде

UNP_LEN
4 байта         Исходный размер файла

CHECK_SUM
2 байта         Контрольная сумма

HEAD_LEN
2 байта         Полная длина заголовка файла, включая комментарии
                к файлу, строку с именем файла и возможные 
                дополнительные поля

FTIME
4 байта         Дата и время файла в стандартном формате MS DOS

ATTR
1 байт          Атрибуты файла

FLAGS
1 байт          Набор флагов:

                0x01 - файл продолжается с предыдущего тома
                0x02 - файл продолжается в следующем томе
                0x04 - файл защищен с помощью пароля
                0x08 - присутствует комментарий к файлу

VER
1 байт          Минимальная версия RAR для распаковки:
                0 - RAR 0.99 (сейчас не поддерживается)
                1 - RAR 1.00 (сейчас не поддерживается)
                2 - RAR 1.30

NAME_LEN
1 байт          Длина имени файла

METHOD          Уровень сжатия: 0 - storing
                                1 - fastest
                                2 - fast
                                3 - normal
                                4 - good
                                5 - maximal


FILE_COMM_LEN
2 байта         Длина комментария к файлу.
                Присутствует, только если  (FLAGS & 0x08) != 0

FILE_COMMENT    Комментарий к файлу.
                Присутствует, только если  (FLAGS & 0x08) != 0

FILE_NAME       Имя файла - строка длиной NAME_LEN

????            Дополнительные поля - в данной версии отсутствуют

Примечание:

1. При появлении дополнительных полей в заголовках, их длина
   будет учитываться в HEAD_LEN.

2. Для обработки SFX архива необходимо пропустить SFX модуль путем
   поиска по архиву HEAD_ID. Гарантируется, что в самом SFX модуле
   HEAD_ID не встречается.


   2. Замечания по методу сжатия

   В RAR используется один из вариантов метода Лемпела-Зива с окном
   поиска 64 Kb (реально 62) : все строки символов, которые уже
   встречались в файле, заменяются на длину строки и смещение до
   предыдущего появления строки.

   Полученные длины строк, расстояния до них, а также оставшиеся
   одиночные байты обрабатываются с помощью динамического кодирования
   Хафмена. В файле не сохраняются таблицы длин кодов символов -
   таблица Хафмена постоянно выбирается из нескольких предопределенных
   заранее, а распределение символов по частотам появления строится
   по ходу работы.

   Такой метод дает ощутимое преимущество перед статическими
   кодировщиками в случае быстро меняющихся неоднородных данных (файлы
   типа *.EXE, *.LIB, и многие другие). Если же архивируется большой
   графический файл, который состоит из одних и тех же 20 - 30 байт,
   то архиваторы типа PKZIP обеспечат большую степень сжатия.

   На больших файлах (в частности текстовых) RAR может также выиграть
   у большинства архиваторов за счет большего размера окна поиска.

