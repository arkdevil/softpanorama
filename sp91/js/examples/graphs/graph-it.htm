<HTML>
<! This code is freeware  - with no warranties>
<! but if you use parts of it, please cite the author>
<HEAD>
<TITLE>Graph It</TITLE>

<SCRIPT LANGUAGE="JavaScript">

  function CodeHex() {     // Init ch. de codage en hexa

    this[0] = "80";

    this[1] = "01";

    this[2] = "02";

    this[3] = "04";

    this[4] = "08";

    this[5] = "10";

    this[6] = "20";

    this[7] = "40";

  }



  function DecHex() {

    var i = 0;

    for (i = 0; i < 10; i++) {

      this[i] = "" + i;

    }

    this[10] = "A";

    this[11] = "B";

    this[12] = "C";

    this[13] = "D";

    this[14] = "E";

    this[15] = "F";

  }



  var GrapheFen;

  var AboutFen;

  var Image = '';

  var lIntr = 0;

  var xHex = new CodeHex();

  var LHex = new DecHex();

  var y1 = 0.0;

  var y2 = 0.0;





  function EstInclus(Phr, Mot)  // Pb avec .indexOf()

  {

     var i = 0;

     var j = 0;

     var r = -1;

     var lMot = Mot.length;

     var lPhr = Phr.length - lMot;

     while ((i < lPhr) && (r == -1)) {

       for (j = 0; j < lMot; j++) {

         if (Phr.substring(i, i + 1) != Mot.substring(j, j + 1)) {

           r = -1;

           i += 1;

           break;

         }

         else {

           if (j == 0) {

             r = i;

           }

           i += 1;

         }

       }

     }

     return r;

  }



  function Remplace(Ch, Ch1, Ch2, Math)

  {

  // Si Math, Ch2 = 'Math.' + Ch2

  // remplace Ch1 par Ch2 dans Ch

     var i = 0;

     var j = 0;

     var k = 0;

     var t = Ch;

     var Remp = Ch2;

     var Ret = Ch;

     var sub = '';

     if (Math == true)

       Remp = 'Math.' + Ch2;

     while ((i != -1) && (j <= Ch.length)) {

       i = EstInclus(t, Ch1);

       if (i != -1) {

        j += i;

        if (j > 0)

          sub = Ret.substring(0, j) + Remp;

        else

          sub = Remp;

        k = j + Ch1.length;

        if (k < Ret.length)

          Ret = sub + Ret.substring(k, Ret.length);

        else

          Ret = sub;

        j += Remp.length;

        if (j <= Ret.length)

          t = Ret.substring(j, Ret.length);

        else

          i = -1;

       }

     }

     return Ret;

  }



  function VerNum(ChIn, Entier, Signe)

  // ChIn :  item à vérifier

  // Entier :  true ou false (reel)

  // Signe : booleen

  // Retourne booleen.

  {

     var cc='';

     var dd='';

     var OK = false;

     var d = 0;

     var i = 0;

     var j = 0;

     var nbpt = 0;

     ChIn = '' + ChIn;

     var NumCh = '1234567890';

     if (Signe == true) {

       if (ChIn.substring(0,1) == '+' || ChIn.substring(0,1) == '-') {

         d = 1;

       }

     }

     if (Entier == false) {

       NumCh += '.';

     }

     for (i = d ; i < ChIn.length ; i++)

     {

        cc = ChIn.substring(i, i+1);

        if (cc == ',') {

          cc = '.';

          nbpt += 1;

        }

        if ((nbpt > 0) && (Entier == false)) {

          OK = false;

          break;

        }

        for (j =0 ; j< NumCh.length ; j++)

        {

           dd = NumCh.substring(j, j + 1);

           OK = false;

           if (cc == dd) {

             OK = true;

             break;

           }

        }

        if (OK == false)

          break;

     }

     return OK

}



  function DefX(n)

  {

    this.size = n;

    var i = 1;

    for (i = 1; i <= n; i++)

      {

        this[i] = i;

      }

    return this;

  }



  function Defy(xm, xM, h, lo, f_x)

  {

    xm = parseFloat(xm);

    xM = parseFloat(xM);

    var i = 0;

    var nb = 0;

    var incr = (xM - xm) / lo;

    var m = (lo - 1) / (xM - xm);

    var x = xm;

    this.size = lo + 1;

    while (x <= xM) {

      i += 1;

      X[i] = 1 + Math.round((x - xm) * m);

      this[i] = eval(f_x);

      if (i == 1) {

        y1 = this[i];

        y2 = this[i];

      }

      else {

        if (this[i] < y1)

          y1 = this[i];

        if (this[i] > y2)

          y2 = this[i];

      }

      x = 0 + incr + x;

    }

    this.size = i;

    nb = i;

    if (y1 == y2) {

      y1 = Math.min(y1, 0) - 10;

      y2 = Math.max(y1, 0) + 10;

    }

    m = (h - 1) / (y2 - y1);

    for (i = 1; i <= nb; i++) {

      this[i] = 1 + Math.round((this[i] - y1) * m);

    }

    return this;

  }



  function Init_Image(x, y) {

    y = 0 + y;

    var DebImage = "#define count_width " + x + "'+unescape('%0A')+'#define count_height " + y + "'+unescape('%0A')+'static char count_bits[] = {";

    var nb_col = x / 8;

    var i = 0;

    lIntr = DebImage.length;

    // nb_pixel = (x / 8) * y;

    var Col = "";

    Image = "";

    for (i = 0; i < nb_col; i++) {

      Col = Col + "0x00,";

    }

    for (i = 0; i < y; i++) {

      Image = Image + Col;

    }

    Image = DebImage + Image.substring(0, (Image.length - 1)) + "}";

  }



  function DesPt(x, y, h, l) { // dessine un pt

    x = parseFloat(x);

    y = parseFloat(y);

    var posi = 2 + lIntr + (5 * (Math.floor((x - 1)/ 8) + ((h - y) * l / 8)));

    var xCh1 = Image.substring(posi, posi + 1);

    var xCh2 = xHex[x % 8];

    if (xCh1 != "00" ) { // Déjà 1 pt sur l'octet

      var xDec = 0;

      xDec = eval('0x' + xCh1) + eval('0x' + xCh2);

      xCh2 = LHex[Math.floor(xDec / 16)] + LHex[xDec % 16]

      }

    Image = Image.substring(0, posi) + xCh2 + Image.substring(posi + 2, Image.length);

  }



  function OuvreGraphe(L, H, Fonctionx, x1, x2)

  {

    var i = 0;

    var fx = '' + Fonctionx;

    var x = 0;

    if (navigator.appName == "MSIE" || navigator.appName == "Microsoft Internet Explorer"){

      alert('Sorry, at this time MS Internet Explorer does not support in-line pictures; you should use Netscape.');

      return;

    }

    if (! VerNum(L, true, false)) {

      alert ('Width is not numeric');

      return;

    }

    L = parseFloat(L);

    if (! VerNum(H, true, false)) {

      alert ('Heigth is not numeric');

      return;

    }

    H = parseFloat(H);

    if (! VerNum(x1, false, true)) {

      alert ('x min is not numeric');

      return;

    }

    x1 = parseFloat(x1);

    if (! VerNum(x2, false, true)) {

      alert ('x max is not numeric');

      return;

    }

    x2 = parseFloat(x2);

    if ((Fonctionx == null) || (Fonctionx == '')) {

      alert ('y(x) is mandatory');

      return;

    }

    fx = fx.toLowerCase();

    fx = Remplace(fx, 'ceil', 'CEIL', false);

    fx = Remplace(fx, 'exp', 'EXP', false);

    fx = Remplace(fx, 'e', 'E', true);

    fx = Remplace(fx, 'CEIL', 'ceil', true);

    fx = Remplace(fx, 'EXP', 'exp', true);

    fx = Remplace(fx, 'pi', 'PI', true);

    fx = Remplace(fx, 'abs', 'abs', true);

    fx = Remplace(fx, 'acos', 'ACOS', false);

    fx = Remplace(fx, 'cos', 'cos', true);

    fx = Remplace(fx, 'ACOS', 'acos', true);

    fx = Remplace(fx, 'asin', 'ASIN', false);

    fx = Remplace(fx, 'sin', 'sin', true);

    fx = Remplace(fx, 'ASIN', 'asin', true);

    fx = Remplace(fx, 'atan', 'ATAN', false);

    fx = Remplace(fx, 'tan', 'tan', true);

    fx = Remplace(fx, 'ATAN', 'atan', true);

    fx = Remplace(fx, 'floor', 'floor', true);

    fx = Remplace(fx, 'log', 'log', true);

    fx = Remplace(fx, 'max', 'max', true);

    fx = Remplace(fx, 'min', 'min', true);

    fx = Remplace(fx, 'pow', 'pow', true);

    fx = Remplace(fx, 'round', 'round', true);

    fx = Remplace(fx, 'sqrt', 'sqrt', true);

    x = x1;

    if (! VerNum(eval(fx), false, true)) {

      alert ('Sorry, I cannot evaluate y(x) for x min');

      return;

    }

    x = x2;

    if (! VerNum(eval(fx), false, true)) {

      alert ('Sorry, I cannot evaluate y(x) for x max');

      return;

    }

    if ((H < 8) || (L < 8) || (x1 == x2)) {

      alert ('The size of your graph would be too small !');

      return;

    }

    if (x2 < x1) {

      x2 = x1;

      x1 = x;

    }

    var Lo = L;

    L = 8 * Math.ceil(Lo / 8);

    X = new DefX(Lo + 1);

    var Y = new Defy(x1, x2, H, Lo, fx);

    var ImTaille = "HEIGHT=" + H + " WIDTH=" + L + " ALIGN='CENTER' BORDER = 1>";

    Init_Image(L, H);

    for (i = 1; i < X.size; i++) {

      DesPt(X[i], Y[i], H, L);

    }

    var Axe = 0;

    if ((x1 < 0) && (x2 > 0)) {

      Axe = 1 - Math.round(x1 * (Lo - 1) / (x2 - x1));

      for (i = 1; i <= H; i++) {

        DesPt(Axe, i, H, L);

      }

    }

    if ((y1 < 0) && (y2 > 0)) {

      Axe = 1 - Math.round(y1 * (H - 1) / (y2 - y1));

      for (i = 1; i <= L; i++) {

        DesPt(i, Axe, H, L);

      }

    }

    var wl = 150;

    var wh = 150;

    i = L + 30;

    if (i > wl)

      wl = Math.min(640, i);

    i = H + 80;

    if (i  > wh)

      wh = Math.min(480, i);

    GraphePop = window.open('','Graph','toobar=no,location=no,directories=no,status=no,scrollbars=yes,resizable=yes,copyhistory=no,width=' + wl + ',height=' + wh);

    GrapheDoc = GraphePop.document;

    GrapheDoc.close();

    GrapheDoc.open();

    var ChHtml ='<HTML><HEAD><BR><TITLE>' + 'Graph of y =' + Fonctionx + '</TITLE>';

    ChHtml += '<SCRIPT LANGUAGE="JavaScript">\n';

    ChHtml = ChHtml + "var Img = \'" + Image + "\';\n";

    ChHtml += 'function FermePop(){';

    ChHtml += 'self.close();';

    ChHtml += '}';

    ChHtml += '<\/SCRIPT>';

    ChHtml += '</HEAD>';

    ChHtml += '<BODY>';

    ChHtml += "<IMG SRC='JavaScript:Img'" + ImTaille;

    ChHtml += '<FORM>';

    ChHtml += '<CENTER>';

    ChHtml += '\<INPUT TYPE=button NAME=closeBtn VALUE=" OK " ONCLICK="FermePop()" \>';

    ChHtml += '</FORM>';

    ChHtml += '<BR CLEAR=ALL>';

    ChHtml += '</BODY></HTML>';

    GrapheDoc.write(ChHtml);

    GrapheDoc.close();

    self.GrapheFen = GraphePop;

  }



  function FermePop()

  {

    if (GrapheFen != null) {

      self.GrapheFen.close();

    }

    if (AboutFen != null) {

      self.AboutFen.close();

    }

  }



  function APropos()

  {

    AboutPop= window.open('','About','toobar=no,location=no,directories=no,status=no,scrollbars=no,resizable=no,copyhistory=no,width=250,height=225');

    AboutDoc= AboutPop.document;

    AboutDoc.close();

    AboutDoc.open();

    var ChHtml ='<HTML><HEAD><BR><TITLE>About Graph It</TITLE>';

    ChHtml += '<SCRIPT LANGUAGE="JavaScript">\n';

    ChHtml += 'function FermeBox(){';

    ChHtml += 'self.close();';

    ChHtml += '}';

    ChHtml += '<\/SCRIPT>';

    ChHtml += '</HEAD>';

    ChHtml += '<BODY>';

    ChHtml += '<STRONG>Graph It </STRONG>'

    ChHtml += '<BR>Version 1.05<BR><HR SIZE=2><BR>Copyright 1996-1997 Th. Thomas<BR><A HREF="mailto:tthomas@mail.dotcom.fr" >tthomas@mail.dotcom.fr</A>';

    ChHtml += '<FORM>';

    ChHtml += '<CENTER>';

    ChHtml += '\<INPUT TYPE=button NAME=CloseBtn VALUE=" OK " ONCLICK="FermeBox()" \>';

    ChHtml += '</FORM>';

    ChHtml += '<BR CLEAR=ALL>';

    ChHtml += '</BODY></HTML>';

    AboutDoc.write(ChHtml);

    AboutDoc.close();

    self.AboutFen = AboutPop;

  }



</SCRIPT>

</HEAD>



<BODY BGCOLOR="#FFFFFF">
 <FONT SIZE=5 COLOR='darkblue'><B>Describe your function and graph it !</B></FONT>
 
<FORM NAME='GrapheForm'>

<TABLE ALIGN=CENTER WIDTH="90%">

<TR><TH NOWRAP ALIGN=RIGHT>Width :</TH NOWRAP><TH ALIGN=LEFT><INPUT TYPE=text NAME=Largeur VALUE=64 SIZE=3 ></TH></TR>

<TR><TH NOWRAP ALIGN=RIGHT>Height :</TH NOWRAP><TH ALIGN=LEFT><INPUT TYPE=text NAME=Hauteur VALUE=64 SIZE=3 ></TH></TR>

<TR><TH NOWRAP ALIGN=RIGHT>y(x) =</TH NOWRAP><TH NOWRAP ALIGN=LEFT><INPUT TYPE=text NAME=Fonction SIZE=60 ></TH NOWRAP></TR>

<TR><TH NOWRAP ALIGN=RIGHT>x<SUB>min</SUB> :</TH NOWRAP><TH ALIGN=LEFT><INPUT TYPE=text NAME=x1 VALUE=0 SIZE=10 ></TH></TR>

<TR><TH NOWRAP ALIGN=RIGHT>x<SUB>max</SUB> :</TH NOWRAP><TH ALIGN=LEFT><INPUT TYPE=text NAME=x2 VALUE=0 SIZE=10 ></TH></TR>

</TABLE>

</CENTER>

<BR>

<FONT SIZE=5 COLOR='red' ALIGN=LEFT><B>Warnings</B></FONT><BR>

<UL>

<LI>All the stuff has been transferred, but computing may take some time, depending on the size of the graph (Width * Height), the complexity of your function, and the performances of your computer (and of your browser)...

<LI>No control is made on the evaluation of the function : specify an interval [x<SUB>min</SUB>, x<SUB>max</SUB>] avoiding division by zero and others numerical horrors !

<LI>All common expressions should be recognized : <EM>cos</EM>, <EM>sqrt</EM>, <EM>log</EM>, etc. Use * for multiplication and x for the variable, and<TT> x * x </TT>for x<SUP>2</SUP>.

<LI>Remarks, bugs reports and improvements are welcome : <A HREF="mailto:tthomas@mail.dotcom.fr" >tthomas@mail.dotcom.fr</A>.

</UL>

<BR>

<CENTER>

<INPUT TYPE='button' NAME='GrapheBtn' VALUE='Graph It !' onclick='OuvreGraphe(document.GrapheForm.Largeur.value, document.GrapheForm.Hauteur.value, document.GrapheForm.Fonction.value, document.GrapheForm.x1.value, document.GrapheForm.x2.value)'>

<INPUT TYPE='button' NAME='closeBtn'  VALUE='Close Box' onclick='FermePop()'>

<INPUT TYPE='button' NAME='AboutBtn' VALUE=' About...' onclick='APropos()'>

</FORM>
</center>

