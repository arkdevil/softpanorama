
                                  JP Software

                           4DOS Update Documentation

                       Version 5.0 -- November 23, 1993

   Copyright 1988 - 1993, JP Software Inc., All Rights Reserved.  Published
   by JP Software Inc., P.O. Box 1470, E. Arlington, MA 02174 USA, (617)
   646-3975.

   There are dozens of new features in this latest release of 4DOS!  Check
   through this file for a comprehensive list of what's changed since
   version 4.

   Some of the descriptions below may be more detailed than you need; if
   you aren't using a feature, feel free to skip to the next item.  If you
   are new to 4DOS with version 5.0, you can skip this file entirely, and
   begin with the 4DOS Introduction and Installation Guide.

   This file is divided into the following sections:

          General Features and Enhancements
          Startup, Initialization, and 4DOS.INI
          Command Line Editing and History
          Aliases
          Command Changes and Enhancements
          Variables and Variable Functions
          Bug Fixes

   Major new features and those which affect most users are marked with
   "**" in the lists below.  Other items discuss smaller or more technical
   changes.

   This file is formatted at 58 lines per page, and contains form feeds and
   page footers.  It can be viewed with a file viewer such as the 4DOS LIST
   command, or printed on most PC printers using the command:

                  copy updat50.doc prn

   Printing it with a program that formats the pages is not likely to work
   due to the formatting included in the file.





                                                               (11/93-5.0A)








   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 1



                             4DOS 5.0 Change List


   General Features and Enhancements
   ---------------------------------

   => **  Date, time, and size ranges are now available for all file
          processing commands:  ATTRIB, COPY, DEL, DESCRIBE, DIR, FOR,
          LIST, MOVE, RD, REN, SELECT, and TYPE.  Ranges allow you to
          select files for processing based the date or date and time a
          file was last modified (a date range); the modification time only
          (a time range); the file size (a size range); or a combination of
          these.  This is a powerful feature which substantially expands
          your file selection capabilities.

   => **  4DOS now supports global alias and history lists, so that you can
          share aliases and / or the command history between multiple
          shells.  To enable this feature use LocalAliases = No and / or
          LocalHistory = No in 4DOS.INI.  Storage for the lists will be
          reserved in low memory; to put it in a UMB instead use UMBAlias
          or UMBHistory in 4DOS.INI.

          You can set up a global list in any shell and a local list in any
          shell.  4DOS should properly handle inheritance between shells
          regardless of the local / global settings.  In OS/2 DOS sessions
          global lists are for one session only, you can NOT share them
          across multiple sessions!

   => **  .BTM files can now be compressed (and thereby "encrypted") with
          the new BATCOMP utility.  4DOS reads and processes compressed
          .BTM files just as it they were normal (uncompressed) files. 
          This makes it easy for PC and network managers to distribute
          batch files whose contents cannot readily be altered by the end
          user.  (The compression algorithm used is designed for fast,
          simple decompression, not extraordinarily efficient compression
          ratios.  Therefore its primary value is for batch file
          distribution, not reduced disk usage.)

   => **  The maximum file description length has been increased to 200
          characters, and the entire description is now displayed in the
          DIR output.

   => **  The prompt options for COPY, DEL, GLOBAL, MOVE, and REN have a
          third option now:  'R' (Remainder) turns off the Y/N/R prompt and
          performs the operation on the remainder of the matching files.

   =>     Commands that take a /P to pause output at the end of each page
          (ALIAS, DIR, SET, etc.) now accept an Esc as a "quit" character.






   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 2


   =>     Popup windows for the history lists, @SELECT, and filename
          completion now support horizontal scrolling.  A left or right
          arrow will move the window 4 columns.

   =>     4DOS now supports nested pipes (in command groups and batch
          files), and simultaneous pipes (in different 4DOS sessions).

   =>     Executable extensions can now call aliases as well as internal
          and external commands.

   =>     The 4DOS "prefix" commands (EXCEPT, FOR, GLOBAL, IF, and SELECT)
          parse their arguments slightly differently.  This should help
          simplify batch files, and improve compatibility with COMMAND.COM. 
          As a general rule, the need for multiple % signs and escape
          characters on the line after such commands has been dramatically
          reduced.  If you have complex prefix commands with multiple %
          signs, back-quotes, or escape characters in the command to be
          executed you may have to edit them slightly to accommodate this
          change.


   Startup, Initialization, and 4DOS.INI
   -------------------------------------

   =>     There are several changes to the startup switches:

              /P:  Can be followed by a filename to be executed in place of
              AUTOEXEC (for example, /P:C:\STARTUP\STARTUP.BAT).  If you
              want to pass parameters to AUTOEXEC, you can do so with
              quotes:  /P:"C:\STARTUP\STARTUP.BAT JOB1 37".

              /Y:  Forces 4START and AUTOEXEC into single-step mode.

   =>     AUTOEXEC.BAT now supports batch arguments.  You can pass
          arguments in the AutoExecPath directive in 4DOS.INI (below), in
          the AutoExecParms directive (below), or via the /P: switch
          (above).

   =>     4START is now passed the startup command line as batch file
          arguments.  This allows you to determine what parameters an
          application is passing to a secondary shell.

   =>     There are many new or changed 4DOS.INI directives:

              AutoExecPath = path:  Sets the path and (optionally) filename
              for AUTOEXEC.BAT.

              AutoExecParms = string:  Parameters to be passed to
              AUTOEXEC.BAT.

      **      BrightBG = Yes | NO:  (Introduced in 4DOS 4.02.)  Set to Yes
              to enable bright background displays rather than blinking



   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 3


              text on EGA and VGA systems.  See the section on Colors and
              Color Names in the manual or online help before using
              BrightBG.

              Descriptions = YES | No:  Enables or disables processing of
              file descriptions in COPY, DEL, MOVE, and REN.

              HistCopy = Yes | NO:  If set to YES, 4DOS will copy a command
              recalled from the history back to the end of the history
              list.

              HistLogName = filename:  Specifies the default name for the
              history log file.

              INIQuery = Yes | NO:  If set to Yes, 4DOS will display a
              prompt after each subsequent line in the current INI file.

      **      InputColors = Color:  4DOS will display your command line
              input in the specified color.

      **      LocalAliases = YES | No:  If set to No, 4DOS will create a
              common alias list for all copies of the command processor.

      **      LocalHistory = YES | No:  If set to No, 4DOS will create a
              common history list for all copies of the command processor.

              ListStatBarColors = Color:  Sets the LIST status bar colors.

              OutputBIOS = Yes | NO:  If YES, 4DOS will use the BIOS
              routines for screen I/O in those commands which normally
              write directly to the screen.  Required only for DOS/V
              (Japan) and some very unusual video cards.

              ScreenColumns = nnnn:  This is primarily for use with
              OutputBIOS.  It specifies the number of columns to use rather
              than using the value in the ROM BIOS data area.

              SelectColors = Color:  Sets the SELECT screen colors.

              SelectStatBarColors = Color:  Sets the SELECT status bar
              colors.

      **      UMBAlias = Yes | NO | 1 ... 8:  Load global aliases into a
              UMB or a specific UMB region, rather than into low memory.

      **      UMBHistory = Yes | NO | 1 ... 8:  Load global history into a
              UMB or a specific UMB region, rather than into low memory.

      **      UMBLoad = Yes | NO | 1 ... 8:  Now allows loading 4DOS into a
              single, specific UMB region.





   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 4


      **      UMBEnvironment = Yes | NO | 1 ... 8:  Now allows loading the
              environment into a single, specific UMB region.

   =>     4DOS now allows non-4DOS section names (names other than
          [Primary] or [Secondary] in 4DOS.INI.  Directives in such
          sections are ignored.


   Command Line Editing and History
   --------------------------------

   => **  There is a new popup directory history window which shows recent
          directories you've used.  To pop up the window, press Ctrl-PgUp. 
          Select a line and press Enter to return to the highlighted
          directory.

   => **  There is a new filename completion window.  F7 or Ctrl-Tab will
          pop up a pick-list window of all the matching files, and Enter
          will insert the selected filename into the command line.

   => **  You can set the colors for input you type at the prompt with the
          new InputColors directive in 4DOS.INI.

   =>     You can control whether recalled history lines are copied to the
          end of the history with the new HistCopy directive in 4DOS.INI.

   =>     History saves are now case-sensitive.


   Aliases
   -------

   => **  There is a new kind of keystroke alias.  If you preface the key
          name with two @ symbols, 4DOS will execute the command
          immediately, without echoing the alias.

   => **  If you enter an unknown command, 4DOS will now look for an alias
          "UNKNOWN_CMD", and will execute that alias after appending the
          command line.  WARNING: If the UNKNOWN_CMD alias contains an
          unknown command, your system will loop forever!

   =>     ALIAS /R files can have lines continued if the line ends in an
          escape character.


   Command Changes and Enhancements
   --------------------------------

   =>     ATTRIB will now append a "\*.*" to a directory name, unless you
          specified the /D option.





   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 5


   =>     COPY, DEL, MOVE, and REN have a new switch:  /T(otal) to display
          file counts only.  This disables the display of file names (like
          /Q), but still displays the totals.

   =>     DEL now supports the /F(orce delete) option in OS/2 2.1 DOS
          sessions.  A /F will delete the file without saving it to the
          "undelete" directory.

   =>     DEL displays the disk space freed in the summary line.

   => **  DIR has several changes:

              * Colorization is fully supported without ANSI.SYS.

              * Descriptions can be up to 200 characters long.  Those which
              are too long to fit on the screen will be word-wrapped at the
              right edge of the screen.

              * New switches and switch changes:

                  /C:  (Compression) You can now use /CP or /CHP to return
                  the compression value as a percentage instead of a ratio. 
                  If you use /CHP, the P must follow the H -- /CPH will NOT
                  work.  Also, SuperStor drives are now supported (see
                  APPNOTES.DOC for details on compression support).

                  /H:  (New) Do not display "." and "..".

                  /I:  (New) Display only those files whose descriptions
                  match the specfied text.  The text can include any of the
                  4DOS extended wildcards; the search is case insensitive.

                  /R:  (New) Disable long description wrapping.  If /R is
                  used for on-screen display the description is truncated
                  with a right arrow.  In redirected output the entire
                  description is sent to the output device as one long
                  line.

   => **  DO is a new loop control command for batch files.  You can use
          several methods to control the loop:

              DO n:  Repeat the loop n times.

              DO FOREVER:  Repeat the loop until you exit with LEAVE or
              GOTO.

              DO var = start TO end [BY n]:  Repeat the loop until the
              variable passes the end value.

              DO WHILE condition:  Repeat the loop while the condition is
              true (the condition can be any of those available in the IF
              and IFF commands).



   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 6


              DO UNTIL condition:  Repeat the loop until the condition
              becomes true.

          A loop terminates with an ENDDO.  You can use ITERATE to return
          to the start of a loop, and LEAVE to exit a loop.

   =>     DRAWBOX has a new ZOOM option.

   =>     IF and IFF now support decimals in numeric tests.

   =>     INKEY has two new switches:

              /C:  Clears the keyboard buffer before accepting input.
              /P:  Does not echo your input (for passwords).

   =>     INPUT has four new switches:

              /C:  Clears the keyboard buffer before accepting input.
              /E:  Displays and allows you to edit an existing value.
              /L:  Sets the maximum input length.
              /P:  Displays asterisks for your input (for passwords).

   => **  KEYBD is a new command to toggle the state of the Caps Lock, Num
          Lock, and Shift Lock keys.

   => **  LIST has been completely rewritten and offers many new features:

              * Line and column numbers are displayed, and you can go to a
              specific line.

              * Hexadecimal display, print, and search are now supported.

              * You can pop up a window with the current fully expanded
              filename, size, date and time.

              * LIST is significantly faster.

   =>     LOG now supports a "history" log, which is independent from the
          regular command log.  The history log saves the original commands
          entered into the history list, without the date and time
          information stored in the normal log file, and before alias and
          variable expansion.  You can use it as an aid in writing batch
          files or creating a history file which can be reloaded later.

   => **  MD has a new switch:  /S builds all necessary intermediate
          directories.  For example, MD /S \DIR1\DIR2\DIR3 will create all
          three directories if necessary.

   =>     MOVE will now display the space freed (if any), like DEL, and
          supports the /F(orce delete) option in OS/2 2.1 DOS sessions.  A
          /F will delete the file without saving it to the "undelete"
          directory.



   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 7


   => **  ON is a new error-handling command for batch files:

              ON BREAK command:  Execute the command when a ^C or ^Break is
              detected.

              ON ERROR command:  Execute the command after a DOS or 4DOS
              error.

   =>     SCREEN, SCRPUT, and VSCRPUT now accept row and column offsets
          relative to the current cursor position.  To specify a relative
          offset, rather than an absolute row or column, use a + or -
          before the argument.

   =>     SELECT now supports the /CP and /CHP compression switches, and
          the /I switch to select files by description (see DIR for
          details).

   => **  SETDOS has four new options:

              /B:  Sets your EGA or VGA board for blinking text (/B0, the
              default) or bright background colors (/B1).  See the section
              on colors and color names in the manual for details before
              using this option.  Also see the BrightBG directive in
              4DOS.INI.

              /D:  Enables (/D1, the default) or disables (/D0) description
              processing for COPY, DEL, MOVE, and REN.  Also see the
              Descriptions directive in 4DOS.INI.

              /X:  Controls command parsing.  You can enable or disable
              alias and variable expansion, multiple and conditional
              commands, redirection and pipes, command grouping, quoting,
              and the escape character.  For use in batch files to avoid
              problems with special characters in text strings.

              /Y:  Enables (/Y1) or disables (/Y0) single-step operation in
              batch files.  Use this option for batch file debugging.

   => **  START is a new command for OS/2 2.1 users only.  It starts a DOS,
          Windows, or OS/2 application from an OS/2 DOS session.  Most of
          the switches supported by the 4OS2 START command are available
          under 4DOS as well.


   Variables and Variable Functions
   --------------------------------

   (When using variables and variable functions remember that the name must
   be preceded by a "%" sign:  %+, %_DAY, %@FILEOPEN, etc.):

   =>     The _CPU variable now returns "586" for Pentium processors.




   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 8


   => **  The new internal variables are:

              Variable    Returns
              --------    -----------------------------------------------
              =           the current escape character (can be embedded in
                          commands, but cannot be ECHOed)
              +           the current command separator (can be embedded in
                          commands, but cannot be ECHOed)
              ??          the reason an external program terminated
              _APMAC      AC status
              _APMBATT    battery status
              _APMLIFE    remaining battery life
              _BG         now includes bright background colors when
                          appropriate
              _COUNTRY    the country code
              _DAY        the day of the month (1 - 31)
              _DOY        the day of the year (1 - 366)
              _FG         now includes bright background colors when
                          appropriate
              _HOUR       the hour (0 - 23)
              _KSTACK     1 if KSTACK.COM is loaded, 0 if not
              _HLOGFILE   the name of the current history log file
              _LOGFILE    the name of the current log file
              _MINUTE     the minute (0 - 59)
              _MONTH      the month of the year (1-12)
              _SECOND     the second (0 - 59)
              _SWAPPING   the swapping type (XMS, EMS, DISK, or OFF)
              _SYSERR     the error code for the most recent DOS error
              _WINTITLE   the title of the current OS/2 2.x DOS session
              _YEAR       the year (1980-2099)

   =>     You can now include commas in the result of @EMS, @XMS,
          @FILESIZE, and other similar functions by following the units
          character (b|B|k|K|m|M) with a 'c'.  For example,
          "@filesize[4dos.com,bc]" will display the size of 4DOS.COM in
          bytes, with a comma every three digits.

   =>     @FILESIZE will now return the total size of all matching files if
          you specify wildcards in the filename.

   => **  The new variable functions are:

                  (Be sure to read the manual or online help before using
                  the @FILECLOSE, @FILEOPEN, @FILEREAD, @FILESEEK, or
                  @FILEWRITE functions.)

              @CDROM[d:]:  Returns 1 if the drive is a CD-ROM, 0 if not.

              @DEC[var]:  Returns the decremented value of a variable (the
              same as %@EVAL[var-1]).





   4DOS 5.0  [11-23-93]           UPDAT50.DOC                        page 9


              @FILEAGE[fname]:  Returns the date and time as a single
              numeric value (useful for comparing file dates and times).

              @FILECLOSE[n]:  Close the file whose handle is "n".

              @FILENAME[fname]:  returns the name + extension (no path)

              @FILEOPEN[filename,read | write | append]:  Opens the file in
              the specified mode and returns the file handle.

              @FILEREAD[n]:  Reads a line from the file whose handle is
              "n".

              @FILES[filename]:  Returns the number of files matching the
              filename specification.

              @FILESEEK[handle,offset,start]:  Seeks to the specified
              offset in the file whose handle is "n".

              @FILEWRITE[n]:  Writes a line to the file whose handle is
              "n".

              @FINDFIRST[fname,[nrhsa]]:  Find the first matching file and
              return its name.

              @FINDNEXT[fname,[nrhsa]]:  Find the next matching file.

              @INC[var]:  Returns the incremented value of a variable (the
              same as %@EVAL[var+1]).

              @INSTR[start,length,string]:  The same as SUBSTR, but puts
              the start and length at the beginning to avoid problems with
              commas in the string.

              @MASTER[varname]:  Return a value from the master
              environment.

              @NUMERIC[n]:  Returns 1 if the variable is composed entirely
              of numeric digits (0-9), or the thousands or decimal
              separators.

              @RANDOM[min,max]:  Returns a random integer value between min
              and max, inclusive.

              @REPEAT[c,n]:  returns the character repeated 'n' times.

              @TRIM[string]:  Strips leading and trailing whitespace
              (blanks and tabs) from the string.


   Bug Fixes
   ---------



   4DOS 5.0  [11-23-93]           UPDAT50.DOC                       page 10


   =>     Fixed a bug that prevented /D from disabling AUTOEXEC when using
          the F8 key under DOS 6 and AutoExecPath was set to an explicit
          file name.

   =>     Fixed NetwareNames so it works properly even if UMBLoad fails. 
          Also NetwareNames is now ignored except in the true primary
          shell.

   =>     In a primary shell, 4DOS.INI is now located on the boot drive,
          not the current drive at startup time.  This should affect OS/2
          users only -- boot drive and current drive are the same under
          DOS.











































   4DOS 5.0  [11-23-93]           UPDAT50.DOC                       page 11

