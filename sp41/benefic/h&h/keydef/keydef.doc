
						Посвящается Роберту Фриппу.
						Devoted to Robert Fripp.


	KEYDEF - ПОЧТИ УНИВЕРСАЛЬНЫЙ ДРАЙВЕР МАКРОСОВ



	 Предназначение:

  Программа - драйвер макроопределений для hotkey'ев, предназначена для работы
в основном в редакторе Norton Commander'а (глобальная идея была сделать KeyDef
корректно работающим не во всех, но хотя бы в большинстве редакторов). 
Причиной создания была лень написания фраз типа #include, #define, a также
некоторых других фраз, перечисленных в файле casm.kdc. KeyDef также очень
может быть полезен паскалистам с их BEGIN'ами,ЕND'ами. Безусловно KEYDEF 
предназначен только для вставок стандартных конструкций в текст, и не 
предназначен для различного рода форматирований текста и т.п.. и как
показывает практика у программистов чрезвычайно редко появляется потребность
в последнем.
  Наберите команду на prompt'e Dos'a  :
	 KD CASM.KDF
KEYDEF загрузится в память, используя откомпилированный файл данных CASM.KDF
затем начните редактировать какой-нибудь файл встроенным редактором NC. 
Нажмите поочередно правый ALT ,затем клавишу P - вы при помощи нажатия 
всего двух клавиш получили обрамление С-шной процедуры. Великолепно не так ли. 
Попробуйте проделать то же самое с другими комбинациями клавиш. 
Например ALT-", ALT-<. Да здравствует, вы теперь избавлены он мерзкой 
обязанности набивать в сотый, тысячный раз слова #include ""  и #include <>,
причем заметим что курсор встал именно на место между скобок. 
И это все для вас дорогой пользователь. Прочитайте MANUAL дальше и вы узнаете 
как создавать собственные файлы макроопределений. 
  KEYDEF поначалу был задуман как универсальный драйвер макросов, который 
мог бы работать  корректно практически во всех редакторах, но очевидная 
сложность задуманного, а также изрядная лень автора не позволили осуществить 
хотя бы большей части задуманного. 
  В программе был использован относительно новый принцип назначения
Hotkey'ев - это не одновременное, а последовательное нажатие клавиш (принцип
почти один к одному передран с программы PEEK-POKE Д. Гуртяка),
вследствие чего нет пересечения с hotkey'ями большинства
других редакторов, а также в наличии практически неограниченный набор
возможных макроопределений. К примеру в языке TURBO EDITOR MACRO
LANGUAGE можно определять только одновременные нажатия, в тоже время 
необходимо помнить о зарезервированных комбинациях дабы не загубить файл
TCCONFIG.TC .

	В каких редакторах KEYDEF работает вполне корректно ?

  1. Встроенный редактор в NORTON COMMANDER. 
  2. Norton Editor (NE). размер 32375
  	В  NE  KEYDEF не может успешно работать в нормальном режиме FAST.
  	Наберите команду на prompt'e Dos'a  
  	KD/SLOW
  	В этом случае KEYDEF будет работать медленно, но корректно и согласитесь что
  	это не совсем удобно для тех, кто быстр мыслью.
  	В случае если вы захотите сделать вставку быстрой необходимо 
  	отредактировать NE. Для этого нужно заменить 6 байтов по смещению 
	55D9h на строку A9,00,00,A9,00,00. В этом случае при скроллинге
	NE станет издавать надоедливые звуки, так как не будет успевать
	обрабатывать keystrokes.
  	Для начала быстрой вставки в NE наберите команду на prompt'e Dos'a  
	KD/FAST 
  3. Старые TURBO EDITOR'Ы. Работа вполне корректна в режиме FULL SCREEN.
  4. Новые TURBO EDITOR'Ы. Работает только в режиме SLOW.
  5. EDIT.COM Александра Сафоненкова. При генерации перевода строки и TAB 
     KEYDEF выдает сокращенный код ASCII, поэтому перевод строки не работает.

  
                   Состав КeyDef'а.

   КЕYDEF   DOC   
   KD       EXE    резидентный драйвер
   KDC      EXE    программа компилятор .kdc - файлов в файлы .kdf или
                   рекомпилятор .kdf-.kdc
   SCANCODE LST    список сканкодов клавиатуры.
   MASK     KDC    закомментированный пример .KDC файла со всеми
                   комбинациями. Рекомендуется создавать свои файлы .KDC
                   редактируя этот.
   PAS      KDC     \   примеры текстовых файлов составляемых пользователем
   CASM     KDC     /   для программы KD.EXE
   PAS      KDF     \   скомпилированные файлы
   CASM     KDF     /

                     Программа KD.EXE

   
     Это резидентная программа, которая будучи загруженной занимающет
   в памяти около 2.5 KB плюс размер файла .kdf . Oна предназначена для
   переопределений клавиш по желанию пользователя . Здесь был использован
   новый принцип определения "горячих клавиш"(hotkeys). Для того, чтобы
   hotkeys не пересекались с hotkey'ями редакторов, используется не
   одновременное нажатие контрольной клавиши и обычной, а последовательное,
   т.е для вставки макроопределения нужно нажать и отпустить контрольную
   клавишу ,а затем нажать определенную клавишу.
     Допустимые контрольные клавиши на 101-AT keyboard левые и правые
   Ctrl,Alt,Shift т.е их всего шесть. на каждую из них можно определить 86
   клавиш, серые клавиши движения курсора ,a также серые
   PgUp,PgDn,Home,End,Insert,Delete действуют также как белые справа.
   Клавиши PrtSc,Scroll-Lock,Pause не используются. Обе клавиши Enter являются
   зарезервированными, комбинация "контрольная клавиша,Enter" вызывает перевод
   строки без разбиения последней и перемещение курсора под начало предыдущей
   строки.
   Таким образом одновременно можно определить до 504 макроопределений
   избегая одновременно пересечений с hotkey'ями программ - редакторов.
   Рекомендуется использовать комбинации приведенные в файле MASK.KDC,
   их всего 480. Создавайте свои файлы редактируя MASK.KDC

   Синтаксис до загрузки: KD /options pathname (после инсталляции
   просто KD).

   синтаксис после загрузки: KD /options

   Опции:
   /h,?    help
   /fast   скорость вставки быстрая
   /slow                    медленная
   /on     сделать KD активным
   /off    выключить KD
   /w      записать параметры на диск в файл KD.EXE : скорость вставки, 
	   ON||OFF, pathname.KDF. Впоследствии эти параметры будут исполь-
	   зованы по умолчанию.
   /u      выбросить KD из памяти

   Прим.   Последовательность клавиш ALT,ALT,F9 переключает KD в ON|OFF,
	   причем в правом верхнем углу отображается статус.

   Warn:   Не употребляйте /w option if kd.exe has been pklited or lzexeced.
 			
   Размер здорового файла KD.EXE 8086 байт (очень популярное число).

                   Составление макроопределений (KDC.EXE)

     Для составления макроопределений было придумано нечто вроде языка
   по синтаксису похожего на описание строк языка C, а также был написан
   примитивный компилятор текстовых файлов в формат, используемый программой
   KD.EXE. Текстовым файлам принято давать расширение .KDC (по умолчанию) .
   Eсли ввести команду :
   KDC/C CASM
   то на диске появится новый файл CASM.KDF - это и есть бинарный файл
   используемый KD.COM.
   Допустим, что вы не желаете хранить оригинальные текстовые файлы
   и стерли их, но вам вдруг понадобилось внести исправления.
   Это не беда - введите команду :
   KDC /R CASM.KDF
   и вы получите исходный текст на языке KDC.
   Ниже приведен пример исходного текста нескольких макроопределений,
   из файла PAS.KDC в котором определены макроопределения для работы
   с языком PASCAL:
 ┌───────────────────────────────────────────────────────────────────┐
 │ ;statements                                                       │
 │ W        -RA11   "WHILE  DO\nBEGIN\n\nEND\u\u\u\e\l\l\l"          │
 │ R        -RA30   "BEGIN\n\nEND\u"                                 │
 │ C        -RA2E   "CASE  OF\nBEGIN\n\nEND\u\u\u\e\l\l\l"           │
 │ G        -RA22   "GOTO  ;\l"                                      │
 │ ;functions                                                        │
 │ W        -LA11   "WRITELN ();\l\l"                                │
 │ R        -LA13   "READLN ();\l\l"                                 │
 │                                                                   │
 └───────────────────────────────────────────────────────────────────┘
   Синтаксис:

   Макроопределение в данной версии KDC.EXE может умещаться только на одной
   строке. В текст могут быть включены строки-комментарии, в этом случае
   в первой позиции строки должен находиться символ точки с запятой ';'.
   Собственно макроопределение начинается с символа '-' перед ним можно
   вставлять любые символы за исключением смволов минус ' - '
   и двойная кавычка ' " ' в качестве комментария. Далее за символом '-'
   следует код hotkey'я, первые два символа определяют контрольную
   контрольную клавишу, следуюшие два символа это сканкод клавиши в
   шестнадцатиричном формате.
   Кодирование контрольных клавиш:
   LA      - Left Alt
   RA      - Right Alt
   LC      - Left Ctrl
   RC      - Right Ctrl
   LS      - Left Shift
   RS      - Right Shift
   Сканкод пишется в шестнадцатиричном виде причем если номер сканкода меньше
   10h необходимо писать в первой позиции 0 ( к примеру -RS03 ).
     Текст макроопределения следует за определением hotkey'я. Он заключается
   в двойные кавычки и может содержать
   
   символы управления курсором

   \n      new line
   \u      cursor up
   \l      cursor left
   \e      эмулирует нажатие клавиши End (курсор в конец строки)

   , а также некоторые символы:

   \"      вставить в текст '"'
   \\      вставить в текст '\'
   \t      вставить в текст TAB

   Warning: нельзя оставлять пустые строки.
   	
   Как представляется четырех команд управления курсором вполне достаточно.
   Использивание KDC.EXE
   KDC /option filespec
   Oпции:
   /C   закодировать файл. На выходе файл .KDF
   /R   декодировать файл. На выходе файл .KDC
  	

				H&H Intl. Corp., (C) 1991

				(c) Сергей Белялов, 
				Томск, 634055, пр.Академический 13-52
				т.(382-2)25-85-42 (дом.)
