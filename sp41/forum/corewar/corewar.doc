  ************************************************************
  *                                                          *
  *			C O R E W A R                        *
  *                                                          *
  *                    " Бой в памяти "   		     *
  *                                                          * 
  ************************************************************


	Оглавление :

 1. Введение
 2. Система комманд языка REDCODE.
 3. Супервизор MARS.
 4. Примеры программ.


			  - 1 -

                        Введение.
			---------

  Идея создания компьютерных программ, моделирующих поведение живых
организмов  отнюдь  не  нова.  Еще  в  50-е годы были предприняты первые
попытки  воплощения  ее  в  жизнь  (  впрочем  не  вполне успешные из-за
недостаточного развития вычислительной техники ). Позже появились вполне
жизнеспособные "организмы" и оказалось, что их создание довольно
увлекательное занятие, способное преподнести немало сюрпризов самому
автору. На этом был основан прототип CoreWar - программа Darvin, которая
реализовывала среду обитания с довольно сложными эволюционными
процессами. Именно ее высокая популярность побудила авторов CoreWar к
созданию более простой и общедоступной версии похожей среды, не
утратившей однако своего многообразия. В последнее время CoreWar,
несмотря на кажущуюся простоту, стала интернациональным увлечением с
официальными чемпионатами мира. Попробовать свои силы может каждый
желающий, и, возможно, именно Вы придумаете нечто новое, оригинальное и
непобедимое.

                          - 2 -

               Система команд языка REDCODE.
               -----------------------------
  Программы для CoreWar пишутся на языке низкого уровня REDCODE,
представляющем собой очень простой ассемблер, впрочем предоставляющий
довольно широкие возможности. Сам процесс боя состоит в том, что две
программы параллельно выполняются под управлением супервизора MARS
( Memory Array Redcode Simulator ), используя при этом одну область
памяти. Проигравшей считается первая прекратившая выполняться программа,
независимо от того, как это произошло.
  Адресное пространство супервизора MARS представляет собой кольцевой
буфер из 8000 слов ( не путать с машинным словом ! ). Так как программы
загружаются в память на случайные места, то код должен быть позиционно
независимым.  Поэтому в языке прямой адрес интерпретируется как смещение
относительно текущей выполняемой команды. Отрицательные числа
представляются дополнением до 8000 ( т.е. -1 = 7999 ).

  Существует 4 типа адресации :

    1) прямая ( операнд ) - реальный операнд - слово, лежащее со
       смещением 'операнд' относительно текущей выполняемой команды.

    Пример :
              0: JMP 2 ─┐
              1:        │
              2:    <───┘

    2) косвенная ( @операнд ) - при косвенной
       адресации реальным операндом является слово, лежащее по смещению,
       равному содержимому ячейки, используемой для адресации,
       относительно этой ячейки.

    Пример :
              0: JMP @2 ─┐
              1:         │
              2: 3 ┌─<───┘
              3:   └─────┐
              4:         │
              5:   <─────┘

    3) косвенная с автоинкрементом ( >операнд ) и косвенная с
       автодекрементом ( <операнд ) - выполняется аналогично косвенной,
       но содержимое используемой для адресации ячейки инкрементируется
       или декрементируется ( декремент выполняется до использования,
       инкремент - после ).

    4) непосредственная ( #операнд ) - может использоваться только для
       задания констант - не адресов ! ).

    Пример :
	     MOV #0 10 - правильно,
	     MOV 10 #0 - неправильно.


 Система команд :
 --------------

┌───────────┬──────────────────┬───────────────────────────┐
│           │ Тип адресации    │                           │
│ Мнемоника ├────────┬─────────┤        Действие           │
│           │1-й оп. │ 2-й оп. │                           │
├───────────┼────────┼─────────┼───────────────────────────┤
│ MOV A B   │ #@<>   │  @<>    │          B := A           │
├───────────┼────────┼─────────┼───────────────────────────┤
│ ADD A B   │ #@<>   │  @<>    │       B := B + A          │
├───────────┼────────┼─────────┼───────────────────────────┤
│ SUB A B   │ #@<>   │  @<>    │       B := B - A          │
├───────────┼────────┼─────────┼───────────────────────────┤
│ JMP A     │ @<>    │  НЕТ    │      Переход на A         │
├───────────┼────────┼─────────┼───────────────────────────┤
│ JMZ A B   │ @<>    │  @<>#   │ Переход на A, если B = 0  │
├───────────┼────────┼─────────┼───────────────────────────┤
│ JMN A B   │ @<>    │  @<>#   │ Переход на A, если B <> 0 │
│ JMG A B   │        │         │                           │
├───────────┼────────┼─────────┼───────────────────────────┤
│ DJN A B   │ @<>    │  @<>    │ B := B - 1, и если B <> 0,│
│           │        │         │ то переход на A.          │
├───────────┼────────┼─────────┼───────────────────────────┤
│ CMP A B   │ #@<>   │  #@<>   │ Если A <> B, то пропустить│
│           │        │         │ следующую команду.        │
├───────────┼────────┼─────────┼───────────────────────────┤
│ SPL A     │ @<>    │  НЕТ    │ Размножение управления на │
│           │        │         │ A. ( см. ниже )           │
├───────────┼────────┼─────────┼───────────────────────────┤
│ DAT B     │ #      │  НЕТ    │ Резервирует ячейку со зна-│
│           │        │         │ чением B. ( невыполня-    │
│           │        │         │ емая! )                   │
└───────────┴────────┴─────────┴───────────────────────────┘

 Пояснения :

   - команда SPL действует следующим образом ( A(i) - i-я ветвь ) :

   A(1) A(1) A(1) A(2) A(1) A(2) A(3) A(1) A(2) A(3) A(1) A(2) ...
	      │              │
              │              │
              └─ SPL         └─ SPL



 Структура команд и данных :
 -------------------------

     Одно слово содержит в себе поле кода команды, два поля кода типа
   адресации и два поля операндов.

      ┌───────────┬─────────────────┬───────────────────┐
      │ Поле кода │ Поля кода типа  │  Поля операндов   │
      │  команды  │   адресации     │                   │
      │           ├────────┬────────┼─────────┬─────────┤
      │           │ 1-й оп.│ 2-й оп.│ 1-й оп. │ 2-й оп. │
      │           │        │        │         │         │
      ├───────────┼────────┼────────┼─────────┼─────────┤
      │    0..9   │  0..4  │  0..4  │ 0..7999 │ 0..7999 │
      └───────────┴────────┴────────┴─────────┴─────────┘


   При резервировании ячейки командой DAT или записи в нее константы
   командой MOV в поле кода команды помещается 0 и команда становится
   невыполнимой. При попытке исполнить невыполнимую команду ветвь
   оканчивается, т.е.

  	A(1) A(2) A(1) A(2) A(1) A(1) A(1) ...
  			│
  			│
  			└─ Невыполнимая команда.

     При использовании ячейки в качестве переменной ( в сравнениях и
   арифметических действиях ) все операции выполняются над полем второго
   операнда. Содержимое остальных полей при этом не играет роли и не
   изменяется. Команда вида MOV #... ... также помещает константу в поле
   второго опреанда, но дополнительно обнуляет остальные поля. Любая
   другая команда MOV копирует все поля одной ячейки в другую.

 Использование меток :
 -------------------

   Данная версия компилятора REDCODE допускает использование меток,
 причем метка START: имеет специальное значение - с нее начинается 
 выполнение программы. Если метка START: отсутствует, выполнение будет 
 начинаться с первой команды.

 Пример :

	  JMP CONT    аналогично     JMP 2
	  MOV A B                    MOV A B
    CONT: CMP C D                    CMP C D

 
 Директивы компилятора :
 ---------------------

   END - прекращение компиляции. Должна присутствовать в любой программе.


 Особенности данной версии :
 -------------------------

   Для простоты реализации компилятора к исходному тексту предъявляются
 дополнительные требования :

	- между именем метки и двоеточием не должно быть пробелов;
	  ( LOOP:  - правильно,
	    LOOP : - неправильно. )
	- в строке может быть записана только одна команда.

   Любой текст, стоящий после команды игнорируется, поэтому комментарии
 можно записывать просто в конце строки, отделяя пробелом от команды.
 При необходимости закомментировать всю строку достаточно просто
 поставить в ней ';' в любом месте.

 Сообщения об ошибках :
 --------------------

    "Undefined command"         - неизвестная команда.
    "Invalid operand"           - неправильный операнд.
    "Undefined label"           - неизвестная метка.
    "Illegal address mode"      - неправильный тип адресации.
    "Unexpected end of file"    - не обнаружена директива 'END'.

 После обнаружения первой ошибки компиляция прекращается.

 Вызов компилятора :
 -----------------

   REDCODE <исх. файл>

   После удачной компиляции создается файл с тем же именем и расширением
 .COM, содержащий исполнимый код программы.

			  - 3 -

		     Супервизор MARS.
		     ----------------

   MARS параллельно исполняет две программы, полученные после компиляции
 их исходного текста с помощью REDCODE. Исполнение начинается с того,
 что программы загружаются в память ( кольцевой буфер из 8000 слов ),
 первоначально заполненную нулевыми словами, на случайные места ( на
 расстояние не меньше 1000 ячеек ). После этого поочередно выполнется по
 одной команде из каждой програмы. Создание и уничтожение ветвей
 программы происходит следующим образом :
     
 A(1) B(1) A(1) B(2) A(1) B(1) A(2) B(2) A(1) B(1) A(2) B(1) A(1) B(1)
       │              │              │              │
       │              │              │              └─ Невыполнимая
       └─ SPL         └─ SPL         └─ Невыполнимая   команда.
					команда.
 Графический интерфейс :
 ---------------------

 Выполнение сопрождается визуальным отображением по следующим правилам :

   1. 8000 адресов изображаются в 50 строк по 160 элементов.

   2. При начальной загрузке в память коды программы, указанной первой,
   изображаются синими точками, второй - красными.

   3. После начала выполнения команды вида  MOV ... A окрашивают точку
   на экране, соответствующую адресу A в белый цвет, если копируемое
   слово содержит невыполнимую команду, или в цвет, соответсвующий той
   программе, чья команда выполняется, в противном случае. При
   выполнении других команд соответсвующая им точка просто мигает.

   4. В нижней части экрана отображается количество свободной памяти,
   используемой супервизором, и количество работающих ветвей каждой
   программы. Обновление информации включается/выключается клавишей 
   <Enter>.

   Выполнение программ прекращается в том случае, если окончились
 невыполнимой командой все ветви какой-либо из них и на экран выдается
 соответствующее сообщение. Также работу супервизора можно прервать
 клавишей < ESC >.

 Запуск супервизора :
 ------------------

   MARS < 1-я прогр. > < 2-я прогр. >


			  - 4 -

		   Примеры программ.
		   -----------------

     Chang ( чертик ) :

	MOV 0 1          Копирует сам себя в следующее слово и таким
                       образом едет по памяти.


     Защита от чертика :

	MOV #0 -1        Непрерывно стреляет перед собой нулем.
	JMP -1


     Mice ( мыши ) :

	PTR:	DAT	#0               Копирует сама себя с хвостом
	START:	MOV	#12 PTR        нулей ниже на 821 слово,
	LOOP:	MOV	@PTR <PTR1     размножает туда управление,
		DJN	LOOP PTR       проверяет не изменилась ли
		SPL	@PTR1          ее первая ячейка, если нет,
		ADD	#653 PTR1      то к смещению 821 добавляет 653,
		JMZ	START PTR      повторяет все сначала, и т.д.
	PTR1:	DAT	#833


P.S. С предложениями просьба обращаться :

         г. Самара, М.Тореза 48-16, Широбоков М.А. т.663284