.H                        1. Назначение пpограммы
 
        Прогpамма "BookMaker V2.1" делает возможным производство 
.I BookMaker
печатной продукции, максимально приближенной по виду к промышленной. 
Любая вышедшая из типографии книга со времен Гуттенберга состоит из 
многих тетрадок или буклетов. Именно для форматирования и печати 
.I буклет
брошюровочных листов и предназначена программа "Book Maker".
    BookMaker - это , конечно же не PageMaker, но ведь и делает он не 
страницу, а книгу! Да к тому же именно старую добрую книжку 
из брошюр, а не новомодное безобразие, которое распадается не успев 
выйти из типографии. Для того, чтобы распечатать приличную книжку от вас 
потребуется текст ее на дискете ( по-моему, основной источник 
распространения информации в СССР), достаточное количество бумаги и 
принтер, поддерживающий уплотненную ( condensed) печать. Итак, вперед.

 
.H                        2. Необходимое оборудование
                        
        Программа была разработана под управлением ОС MS-DOS V3.30, но я
не вижу причин, по которым она не выполнялась бы в MS-DOS другой версии.
Использовался принтер СМ6337, и, если вам кажется, что он совместим с 
вашим (или во всяком случае с Epson), то все будет работать нормально. 
Если же вам кажется обратное, то вам придется конфигурировать программу. 
Желательно, но совсем не обязательно наличие Винчестера. Количество
одновременно открытых файлов в CONFIG.SYS должно быть не меньше 5.

.H                        3. Запуск программы
                        
.H                        3.1 Командная строка программы
 
В общем виде командная строка выглядит так:
        
A:\>book file1[ file2][...]
                        
 Файлы file1, file2, fileN будут идти в брошюре друг за другом и со сквоз-
ной нумерацией страниц. Количество этих файлов ограниченно только длинной
командной строки.
 
.H                        3.2 Работа с меню программы

         После запуска вы оказываетесь в главном меню программы, откуда 
доступны рабочие подменю и  основные команды.
         Программа первоначально делалась на ЭВМ Искра 1030, и потому в 
ней традиционно оставлена основная кодировка дисплея. Однако меня 
.I кодировка дисплея
оправдывает то, что некоторые предпочитают считать ее кодировкой ГОСТ и, 
следовательно, основной. Если при первом запуске на экране у вас все 
нормально и не лезут всяческие русские буквы, то я вам сочувствую, но 
зато вы можете спокойно работать дальше. Если же они-таки лезут 
проведите комбинацию   Setup/Display/SymbTable и все будет в порядке. 
Рекомендую сразу же сделать Setup/Update , чтобы не отвлекаться на 
настройку дисплея в следующий раз.
         Если вы указывали имена файлов в командной строке, можете 
выбрать сразу  Make  и вывод, по умолчанию, пойдет на принтер. Если 
принтер это не то, что вам нужно, выберите Output и введите имя файла, в 
котором все и окажется. Однако, чтобы посмотреть что-же это получилось 
нужна будет некоторая сноровка. Поэтому, лучше не смотрите в файл, а 
пошлите его сразу на принтер. Если вы не уверены, что ваш принтер 
совместим с Epson, проведите настройку принтера  по пункту 3.2.3.2.

.H         3.2.1 Input

.H         3.2.1.1 Path

         Здесь задается путь к файлу, начиная от головного каталога 
диска. Поле автоматически заполняется при выборе файла в интерактивном 
режиме ( следующий пункт).

.H         3.2.1.2 Name

         Здесь задается шаблон и отмечаются файлы по этому шаблону, 
которые войдут в книгу. По умолчанию, под шаблон попадают все файлы в  
данном каталоге. Если вас это устраивает, просто нажмите <Enter>. Файлы 
выбираются клавишей <Insert>, переход в другой каталог <Enter>, 
окончание выбора - <F10>, отмена выбора - <Esc>.

.H         3.2.1.3 DOS Shell

         Временный выход в DOS. Оставлен для совместимости с версией 
1.5, в которой не было интерактивного выбора файлов. Предполагалось, что 
пользователь в случае ошибки может проверить содержимое каталога.

.H         3.2.2 Output

         Задание имени файла вывода. Разрешено любое имя, кроме CON

.H         3.2.3 Setup

         Самое большое подменю программы.

.H         3.2.3.1.1 Display / Color

         Переключение цветов для обеспечения нормальной работы на 
 черно-белом или монохромном мониторе.
.I монитор

.H         3.2.3.1.2 Display / Symb.Table

         Как уже отмечалось, программа поддерживает как основную, так и 
 альтернативную кодировку знакогенератора дисплея.

.H         3.2.3.2 Printer

         В данном подменю производится настройка на тип принтера, 
отличающийся от Epson FX/EX/LX/LQ. Если Ваш принтер не будет работать с 
BookMaker'ом, внимательно изучите руководство по принтеру и введите 
новые управляющие последовательности. Управляющие символы вводятся как 
последовательность <Ctrl-P><Ctrl-[CHAR]>.

.H         3.2.3.2.1 Init
 
         Вводится последовательность для начальной установки принтера. 
Он должен обеспечивать печать плотностью не менее 17 символов/дюйм.

.H         3.2.3.2.2 Alternative

         Вводится последовательность для переключения кодовой таблицы 
принтера. По умолчанию, происходит переключение принтера СМ6337 на 
альтернативную кодовую таблицу.

.H         3.2.3.2.3 IndexOn

         Вводится последовательность для включения верхнего индексного
 шрифта ( Superscript ).

.H         3.2.3.2.4 IndexOff

         Вводится последовательность для выключения индексного режима.

.H         3.2.3.2.5 Double

         Вводится последовательность для включения режима Двойной печати 
 ( Double Strike ).

.H         3.2.3.3 Update

         Команда позволяет запомнить текущее состояние программы : режим 
дисплея, параметры текста, глобальные режимы, имена входных и выходного 
файла и другие параметры.

.H         3.2.3.4 Text

         Меню установки и проверки параметров страницы

.H         3.2.3.4.1 Blanks

         Задается количество пробелов между двумя колонками текста на 
.I пробелы         
странице. Используя команду  Setup / Text / Test и другие команды 
установки параметров текста, добейтесь, чтобы колонки текста 
располагались на странице симметрично.

.H         3.2.3.4.2 Lines
 
         Задается количество строк на странице. Иногда значение по 
.I строки         
умолчанию (40) даже многовато, но иногда удается впихнуть и 42 строки.

.H         3.2.3.4.3 Chars

         Задается количество символов в строке. К сожалению, в данной 
.I символы         
 версии все символы сверх этой длины обрезаются, но в модификации "b" 
 этот недостаток будет исправлен.

.H         3.2.3.4.4 Margin

         Задается левый отступ для наилучшего расположения текста. 
.I отступ         
 Некоторые при помощи этого отступа умудрялись печатать ровно посередине 
 листа на рулонной перфорированной бумаге .

.H         3.2.3.4.5 Test

         Позволяет проверить правильность расположения текста на 
странице, выводя тест, показывающий границы столбцов текста. Активно -
только если указать PRN в качестве устройства вывода.

.H         3.2.3.5 Mode
         
         Задаются глобальные режимы работы.

.H         3.2.3.5.1 Roll

         Распечатка на рулонной бумаге. Может быть "off" т.е. листовая 
.I рулонная бумага         
бумага, "1st" т.е. 1- я сторона и "2nd" т.е. сторона вторая. Для того, 
чтобы распечатать книгу на рулоне, вы должны прогнать программу сначала 
с параметром "1st", а затем "2nd", стараясь при этом, чтобы границы 
страниц на обеих сторонах бумаги совпадали.

.H         3.2.3.5.2 Control

         Управление режимом обработки кода перевода формата. Если 
"Ignore", то код <FF> игнорируется, в противном случае производится 
переход на новую страницу.

.H         3.2.3.5.3 Justify

         Включает выравнивание текста по правой границе, определяемой в 
 Setup / Text / Chars.

.H         3.2.3.5.4 Alternative 

         Включить дополнительный знакогенератор принтера. Первоначально 
предназначался для распечатки на принтере СМ6337 текстов, набранных в 
альтернативной кодировке, но вполне может использоваться для включения 
предварительно загруженного пользовательского шрифта.

.H         3.2.3.5.5 Go

         Очень полезный режим, позволяющий дойти без печати до 
определенного листа в определенном буклете.

Note! Имеется в виду номер физического бумажного листа в буклете, а не 
номер страницы.

.H         3.2.3.5.6 Page

         Назначить начальный номер страницы. Отличие этого режима от 
предыдущего состоит в том, что в данном случае текст печатается с 
начала, но нумеруется начиная с нужного Вам номера. Это позволяет 
печатать очень большие тексты при небольшом об"еме дискового 
пространства, кусками.

.H         3.2.3.5.7 Sheets

         Задать количество листов в буклете. Здесь также имеются в виду 
.I лист ( sheet)         
листы, на каждом из которых помещается 4 страницы. Будьте осторожны при 
задании очень толстых буклетов, в обычных книжках их размер редко 
превышает 10.

.H         3.2.3.5.8 Double
          
         Этот ключ сделан специально для любителей пить кофе в
промежутках между сменой листов. Хотя яркость печати при этом, конечно, 
повышается. 

.H         3.2.3.6 Lists
           
         Это подменю обработки списков, т.е. Оглавления и Алфавитного
указателя.

.H         3.2.3.6.1 Print contents
           
         Переключатель делает возможным получить оглавление в конце книги.
.I оглавление         
Оглавление записывается в файл "book.cnt", его формат описан ниже, и вы
можете его корректировать как угодно.

.H         3.2.3.6.2 Contents
           
         Переключатель может принимать два значения Manual или Auto,
и устанавливает режим обнаружения заголовков, соответственно ручной
или автоматический. По-видимому в версии 2.1a так и не будет реализован,
поскольку если с режимом Manual все ясно, и заголовком считается все,
что отмечено директивой .H (см п.3.3), то не понятно, что считать
критерием заголовка в режиме Auto.

.H          3.2.3.6.3 Print Contents index

          Включает печать содержания, отсортированного в алфавитном
порядке. Используется та же информация и тот же файл, что и для просто
содержания.

.H          3.2.3.6.4 Print Index

           Включает печать алфавитного указателя( Index). В него
.I Index
включаются термины, которые были отмечены директивой .I (см. п. 3.3).
.I Термин           
Вся информация о них заносится в файл "book.trm".

.H         3.2.3.7 Sign

         Задается подпись, которая будет печататься вместе с номером 
буклета в низу его первого листа. Полезно задать информацию об авторе и 
теме книги.

.H         3.2.4 Make

         Запустить книжку на печать. (Горячая клавиша - <Alt-M>) Если Вы 
задали листовую бумагу и выводите на принтер, перед печатью каждого 
листа будет появляться запрос на его смену

  Insert Sheet 1 of 10 and press any key
 ( Вставьте лист 1 из 10 и нажмите любую клавишу )

или переворот

   Swap Sheet 1 of 10 and press any key
 ( Переверните лист 1 из 10 и нажмите любую клавишу)

 В  этот момент вы можете выйти в главное меню нажав <ESC>.
 Появится запрос

   Exit to Main menu. Sure? [Y/N] [N]:
 ( Выход в главное меню. Желаете? [Y/N] [По умолчанию N])

 Аналогичный запрос появляется если нажать <ESC> в режиме вывода на диск 
или рулонную бумагу.  Чтобы выйти нажмите Y.


.H         3.2.5 Analyse

         Режим исследования текста. ( Горячая клавиша <Alt-A>) 
Производит исследование текста на количество листов и самую длинную 
строку. После окончания прохода выдается сообщение

   102 pages founded ( 26 sheets ). Longest string has 78 chars.
 ( 102 страницы найдено ( 26 листов). Самая длинная строка 78 символов)

Теперь ваша задача установить желаемое количество листов в буклете и 
длину строки.

.H         3.2.6 Info

         Показывается текущее состояние задачи и все наиболее важные ее 
 параметры.

.H         3.2.7 Quit

         Выход из задачи ( Горячая клавиша <Alt-Q>)

.H         3.3 Строковые команды

         В версию 2.0 введены возможности размещения текста для 
 наилучшей наглядности таблиц и рисунков, а также возможности вставки 
 графики. Пока они обеспечиваются лишь тремя командами, но в 
 дальнейшем их число, возможно, увеличится. Команды должны быть 
 вставлены в обрабатываемый текст там, где вы хотите изменить 
 размещение. 
  Итак

 1: .S <NNN> - Space - Проверяет, хватает ли <NNN> строк до конца 
 страницы, и если нет - переходит на следующую;

 2: .T <NNN> - Table - Размещает таблицу длиной <NNN> строк. Если 
 таблица не влезает на текущую страницу, она будет перенесена на 
 следующую, текущая же будет заполнена текстом, идущим за таблицей.

 3: .F <NNN> - Free - Резервирует свободное место, например, для 
 размещения графической иллюстрации. Логика резервирования такая же, 
 как и у команды .T.
 
 4: .H <Строка> - Header -  Помечает строку как заголовок, т.е.
 элемент содержания. Это единственная команда, которая оставляет
 аргумент в тексте, хотя сама исчезает.
 
 5: .I <Строка> - Index -  Помещает элемент в алфавитный указатель.

 Notes! Ключевой символ "точка" должен быть первым символом в строке, 
 иначе она будет обработана, как обычный текст.
        На строке с командой не следует размещать другой текст, т.к. 
 вся строка за командой игнорируется. К тому же, это вызовет ошибку.

.H               4. Сообщения об ошибках.   
        Ошибки, как и в жизни, бывают фатальные и не очень значительные.
При распознавании фатальной ошибки программа выдает звуковой сигнал и
прекращает работу. При незначительных ошибках ( обычно неправильный ввод)
неправильное значение просто игнорируется. Однако следует помнить, что
программа не может распознать, все ли вы ввели правильно ( хотя и 
пытается), к чему это приведет, и приведет ли вообще к чему либо.   

        Фатальные ошибки таковы:   

- Illegal string command < Текст > ( Неверная строковая команда )
Строка, начинающаяся с точки не может быть интерпретирована как 
строковая команда.

- System error : code < Число > ( Системная ошибка )  
Пожалуйста, запишите этот код и пришлите мне описание ситуации в которой 
возникла ошибка и, если возможно, дискету с обрабатываемым текстом и 
файлом book.ini. Дискету верну.

- Trade mark MODIFIED! ( Торговая марка МОДИФИЦИРОВАННА )
Комментарии излишни...


 Остальные ошибки не фатальны:   

- Booklet not found (Буклет не найден)
Буклет и лист заданный в команде GO не существует в тексте.

- <Filename> not found ( Файл не найден )
Оставлена из версии 1.5 как реакция на гипотетический случай, когда в 
момент  интерактивного выбора входного файла он еще существует, а в 
момент работы исчезает в никуда ( видимо, забирается инопланетянами ).

- Cannot run 2nd copy of COMMAND.COM ( Не могу запустить вторую копию 
командного процессора)
Если при этом машина еще не зависла, то дальнейшие попытки временного 
выхода в DOS лучше оставить.

- Text too big to fit in memory ( Текст слишком большой для помещения в 
память)
Вероятность получения этого сообщения в версии 2.0 близка но не равна 
нулю. ( См. также файл BOOK.NEW) 

- You mightnot understand text on CON ( Вы не сможете понять текст на 
консоли )
Возникает, если вы пытаетесь указать дисплей, как устройство вывода. 
Действительно, текст, получаемый в результате форматирования вряд ли 
может быть правильно интерпретирован.

- Syntax error in command: .S 1@ , ignored ( Синтаксическая ошибка в 
команде : .S 1@ игнорируется )
По видимому  вы ошиблись при наборе строковой программы, это бывает, не 
расстраивайтесь. Эта строковая команда будет проигнорированна.

- Nothing to do! ( Нечего делать! )
Вы же не указали имена файлов для ввода!

- Reserved space  43 lines exceeds a page, ignored. ( Зарезервированное 
место 43 строки превышает размер страницы. Игнорируется )
Я посчитал, что любая иллюстрация не может превышать страницы. Если я не 
прав - опровергните меня ( письменно ).

- Cannot process recurrent command: .T 10, ignored. ( Не могу обработать 
рекуррентную команду: .T 10 , игнорируется )
В момент резервирования места для таблицы или свободного места 
встретилась другая команда резервирования.

- Contents file "book.cnt" is not compatible. ( Файл содержания "book.cnt"
не совместим)
Что-то вы подсунули непонятное, а не файл содержания. То же относится и к
сообщению 
- Term file "book.trm" is not compatible. ( Файл терминов "book.trm" не
совместим)

- Error sorting list. ( Ошибка сортировки списка )
По-видимому, не хватило памяти для размещения списка, либо Ваш список 
состоит из более чем 65535 элементов. На строке статуса указано при
сортировке какого именно списка произошла ошибка.


.H            5.Заключение

         В заключении, мне хотелось бы посетовать на то, что я не в
состоянии выявить все ошибки, а держать штат экспертов не могу. Поэтому,
мне остается только воспользоваться великим принципом "as is", хотя я и
хотел бы гарантировать всем зарегистрированным пользователям получение
исправленных версий программы. В любом случае, прошу сообщать мне о
появлении постоянных ошибок по телефону:

   (0725) - 248592 Герин Ярослав.
   
          Мой (неофициальный) представитель в Санкт-Петербурге:
          
   ЛЭТИ, РТФ, кафедра Радиоэлектронных средств, лаборатория САПР
   Мелкий Алексей


.H  Приложение А.
.H            Форматы файлов содержания и терминов.

          Файл "book.cnt" представляет из себя обычный текстовой
файл следующей структуры:

.T 11
     Строка    Содержание    Смысл      
     -----------------------------
        1     Contents 10    Идентификатор
        2     Элемент огл.1  Заголовок
        3     Строка 1       Его номер строки
        4     Страница 1     Его номер страницы
        .......................................
        n     Элемент огл.N  Заголовок
        n+1   Строка N       Его номер строки
        n+2   Страница N     Его номер страницы

           Элемент "Строка N" служит для распознавания заголовков, 
которые не помещаются на одной строке. Таким образом, если у элемента
N "Строка N" = 5, "Страница N" = 12, a у элемента N+1 "Строка N+1" = 6,
"Страница N+1" = 12, то считается, что это один заголовок, и ссылка на
него в оглавлении тоже будет одна.

        Файл "book.trm" имеет похожую структуру, однако я посчитал,
что для термина достаточно и одной строки.

.T 8
     Строка     Содержание      Смысл
     --------------------------------
        1       Terms 10        Идентификатор
        2       Элемент 1       Первый термин
        3       Страница 1      Его номер страницы
        ....................................
        N       Элемент N       N-ый термин
        N+1     Страница N      Его номер страницы
        
         Структура же файла "book.ini" гораздо более сложна, и я не берусь
об"яснить ее на пальцах, да и время еще не пришло.

                         