                         6.ОТЛАДКА ПРОГРАММ

         Никто не застрахован от ошибок при составлении программ. Одни
    совершают их в большем количестве, другие - в меньшем. Квалифика-
    ция пользователя определяется не удельным весом ошибок во вновь на-
    писанной программе, а умением быстро их обнаруживать и устранять.
    Проведению отладочных работ в значительной мере содействуют специ-
    альные языковые средства и хорошо разработанные процедуры систем-
    ного контроля.
         Практически все синтаксические ошибки, связанные с нарушением
    правил написания операторов и выражений, выявляются современными
    системами программирования на стадии компиляции исходного текста
    или при анализе программных строк в процессе их набора. Ошибки та-
    кого рода мы условимся называть статическими.
         В отличие от них существует ряд семантических ошибок динами-
    ческого характера, выявить которые можно только во время выполне-
    ния программы. К ним относятся ошибки в организации работы циклов
    и подпрограмм, приводящие к недопустимому взаимодействию связанных
    операторов типа DO - LOOP, FOR - NEXT, GOSUB - RETURN, WHILE - WEND.
    Просчеты в количестве повторений цикла  могут привести к появлению
    индексных выражений, выходящих за пределы, установленные при описа-
    нии массивов. Аварийные ситуации могут быть вызваны алгоритмически-
    ми ошибками (переполнения в результате выполнения арифметических
    операций, недопустимые значения аргументов функций и т.п.), наруше-
    ниями ряда системных ограничений (превышение допустимых длин стро-
    ковых значений, емкости буферов и других системных областей памяти,
    глубины вложенных структур и т.п.), обращениями к несуществующим
    файлам и директориям, сбоями в работе оборудования.
         Контроль за подобного рода динамическими ошибками берет на се-
    бя системное окружение периода выполнения программы, которое инфор-
    мирует нас о возникшей ситуации и выдает программные координаты об-
    наруженной ошибки. Однако первопричину зафиксированного события
    должен обнаружить сам пользователь. В этом и заключается первый
    этап процесса отладки программы.
         Устранение статических и динамических ошибок еще не означает,
    что программа решает поставленную задачу. На втором этапе отладки
    придется убедиться в правильности выбранного алгоритма и его про-
    граммной реализации.

             6.1.Выполнение программы в отладочном режиме

         Каждая из описываемых систем предоставляет пользователю воз-
    можность выполнить отлаживаемую программу или ее любые фрагменты в
    режиме трассировки. При этом система фиксирует последовательность
    выполняющихся строк и в том или ином виде выдает их пользователю.
         В GW-системе номера программных строк заключаются в квадратные
    скобки и поступают в окно вывода, перемежаясь с результатами работы
    программы. Информация о трассировке программы PROG1, приведенной в
    приложении D, выглядит следующим образом:

           [10][20][30][40][50][60][70][60][70][60][70][80] .0625

    С целью экономии времени и места количество повторений цикла в этом
    примере было сокращено с 3000 до 3.
         В Turbo-системе последовательность выполняющихся строк фикси-
    руется примерно в таком же формате, но выводится в специальное окно
    с заголовком Trace. Программные строки, у которых отсутствуют номе-
    ра или метки, в трассировочный список не попадают.
         Quick-система в режиме трассировки резко замедляет скорость
    выполнения программы (примерно до 5 операторов в сек) и выделяет
    обрабатываемую строку в листинге программы повышенной яркостью и
    другим цветом. Это дает возможность визуально проследить за поряд-
    ком выполнения операторов. Если скорость прокрутки слишком высока
    по сравнению с реакцией пользователя, то он имеет возможность "про-
    стучать" каждый шаг трассировки, просматривая ее историю в прямом
    или обратном порядке. Для этой цели в режиме Debug предусмотрена
    процедура History ON. Если она включена, то система запоминает по-
    следовательность шагов выполнения программы. Пройтись по этой цепоч-
    ке без повторного выполнения операторов можно нажимая клавиши Shift
    +F10 (движение вперед) или Shift+F8 (движение назад). Каждое нажатие
    указанной пары перемещает курсор на очередную строку программы.
         Для того, чтобы распространить режим трассировки на всю прог-
    рамму, достаточно разместить в ее первой строке оператор TRON или
    с помощью соответствующих средств управления системой установить
    режим трассировки. В GW BASIC'е это выполняется директивой TRON
    (достаточно нажать клавишу F7). В Turbo-системе необходимо войти в
    режим Debug, выбрать процедуру TRACE и нажатием клавиши Enter вклю-
    чить трассировку (ON). В Quick-системе после входа в меню Debug не-
    обходимо установить "галочку" в строке Trace ON. Если ее нет, то
    она появится после нажатия клавиши "T".
         Если режим трассировки необходимо задействовать только на от-
    дельных участках отлаживаемой программы, то первым оператором кон-
    тролируемого фрагмента должен быть оператор TRON, а последним -
    TROFF.
         Системы Turbo BASIC и Quick BASIC предусматривают возможность
    пошагового выполнения программы.
         В Turbo-системе под шагом программы понимают одну или несколь-
    ко программных строк, начинающихся с номера строки или метки. Ини-
    циация очередного шага осуществляется здесь нажатием пары клавиш
    Alt+F10. Если при этом включен режим трассировки, то выполнение
    очередного шага сопровождается появлением метки (номера) в окне
    Trace. Отказ от пошаговой прокрутки и переход к автоматическому
    продолжению работы программы происходит после нажатия клавиш Alt+
    F9.
         В Quick-системе под шагом программы понимают каждую програм-
    мную строку, независимо от наличия у нее номера или метки. Выпол-
    нение очередного шага происходит после нажатия клавиши F8 или F10.
    Если очередная строка содержит обращение к внешней процедуре, то
    нажатие клавиши F8 распространяет пошаговый режим и на вызываемую
    процедуру. Нажатие клавиши F10 приводит к выполнению очередного
    шага с автоматической прокруткой вызываемой подпрограммы.
         Система Quick BASIC располагает еще двумя отладочными сред-
    ствами, позволяющими приостановить выполнение программы. Первое из
    них - это останов на одной из помеченных программных строк. Такие
    точки останова (breakpoint) фиксируются путем нажатия клавиши F9.
    Помеченной считается строка, в которой в этот момент находился кур-
    сор. Отмена точки останова производится повторным нажатием клавиши
    F9. Имеется возможность отменить сразу все набранные остановы.
         Второе отладочное средство - это останов при выполнении задан-
    ного условия (watchpoint). Условия останова набираются в режиме
    Debug и имеют вид обычных операций отношения (A = 0, N > 1000).
    Как только такое условие становится истинным, работа программы пре-
    кращается, и пользователь может увидеть оператор, при выполнении
    которого произошло ожидаемое событие.


             6.2.Системная реакция на программные прерывания

         Прерывания, возникающие в процессе выполнения программы, об-
    рабатываются описываемыми системами, практически, одинаково. В сис-
    темных переменных ERR и ERL запоминаются соответственно числовой
    код зафиксированной ошибки и номер (метка) строки, выполнение кото-
    рой вызвало прерывание. На экран дисплея выдаются координаты прер-
    ванной строки и текст сообщения, поясняющий характер обнаруженной
    ошибки. После этого выполнение Бейсик-программы аварийно завершает-
    ся и пользователю предоставляется возможность исправить ошибку.
         Описываемые системы используют одинаковую нумерацию и иден-
    тичный состав сообщений о динамических ошибках. Небольшие отклоне-
    ния можно заметить лишь в том, что некоторые из сообщений в той
    или иной системе заменены "пустыми" текстами типа "Unprintable er-
    ror" (GW и Quick BASIC) и "Undefined error" (Turbo BASIC). Полный
    перечень сообщений с краткими их комментариями приведен в табл.27.

                                                    Таблица 27
    ┌─────────────────────┬─────────────────────────────────────────┐
    │     Код и текст     │           Причины ошибки                │
    │      сообщения      │                                         │
    ├─────────────────────┼─────────────────────────────────────────┤
    │  1.NEXT without FOR │ Оператор NEXT встретился до оператора   │
    │                     │ FOR или в паре FOR - NEXT употреблены   │
    │                     │ имена разных переменных                 │
    │                     │                                         │
    │  2.Syntax error     │ Обнаружена синтаксическая ошибка в стро-│
    │                     │ ке с указанным номером                  │
    │                     │                                         │
    │  3.RETURN without   │ Выполнению оператора RETURN не предше-  │
    │    GOSUB            │ ствовало обращение к подпрограмме       │
    │                     │                                         │
    │  4.Out of DATA      │ При выполнении оператора READ были ис-  │
    │                     │ черпаны данные                          │
    │                     │                                         │
    │  5.Illegal function │ Неправильное обращение к функции, выз-  │
    │    call             │ ванное ошибочными значениями или недо-  │
    │                     │ пустимым типом аргументов               │
    │                     │                                         │
    │  6.Overflow         │ В результате выполнения арифметической  │
    │                     │ операции получено число, выходящее за   │
    │                     │ максимально допустимые пределы          │
    │                     │                                         │
    │  7.Out of memory    │ Программа слишком велика, содержит недо-│
    │                     │ пустимо много вложенных циклов или под- │
    │                     │ программ, использует очень громоздкие   │
    │                     │ арифметические выражения                │
    │                     │                                         │
    │  8.Undefined line   │ В программе отсутствует строка, номер   │
    │    number           │ которой указан в операторе перехода     │
    │                     │                                         │
    │  9.Subscript out    │ Значение индексного выражения выходит   │
    │    of range         │ за об'явленные пределы                  │
    │                     │                                         │
    │ 10.Duplicate        │ Повторное определение массива. Эта же   │
    │      Definition     │ ошибка фиксируется и в случае появления │
    │                     │ оператора DIM после установления размер-│
    │                     │ ности массива по умолчанию (10,10х10)   │
    │                     │                                         │
    │ 11.Division by zero │ Деление на нуль                         │
    │                     │                                         │
    │ 12.Illegal direct   │ Попытка использовать запрещенный опера- │
    │                     │ тор в режиме непосредственных вычислений│
    │                     │                                         │
    │ 13.Type mismatch    │ Несоответствие допустимого и использо-  │
    │                     │ ванного типов данных (строковое значе-  │
    │                     │ ние вместо числового или наоборот)      │
    │                     │                                         │
    │ 14.Out of string    │ Исчерпана область хранения символьных   │
    │    space            │ переменных                              │
    │                     │                                         │
    │ 15.String too long  │ Длина строки превышает максимально допу-│
    │                     │ стимое значение                         │
    │                     │                                         │
    │ 16.String formula   │ Символьное выражение слишком сложно     │
    │    too complex      │                                         │
    │                     │                                         │
    │ 17.Can't continue   │ Продолжение программы невозможно. Напри-│
    │                     │ мер, после внесения изменений программу │
    │                     │ нельзя продолжить по директиве CONT     │
    │                     │                                         │
    │ 18.Undefined user   │ Использован оператор USRn(X) без описа- │
    │    function         │ ния функции (DEF USRn) или употреблена  │
    │                     │ функция, не об'явленная в виде процеду- │
    │                     │ ры FUNCTION                             │
    │                     │                                         │
    │ 19.No RESUME        │ Подпрограмма обработки ошибочных ситуа- │
    │                     │ ций не содержит оператора RESUME        │
    │                     │                                         │
    │ 20.RESUME without   │ Оператор RESUME использован не в рамках │
    │    error            │ подпрограммы обработки ошибочных ситуа- │
    │                     │ ций                                     │
    │                     │                                         │
    │ 22.Missing operand  │ Пропущен операнд                        │
    │                     │                                         │
    │ 23.Line buffer      │ При вводе превышена максимально допусти-│
    │    overflow         │ мая длина строки                        │
    │                     │                                         │
    │ 24.Device Timeout   │ За предусмотренный интервал времени от  │
    │                     │ устройства ввода/вывода не поступил ожи-│
    │                     │ даемый сигнал                           │
    │                     │                                         │
    │ 25.Device Fault     │ Ошибка в работе принтера или интерфейс- │
    │                     │ ной карты                               │
    │                     │                                         │
    │ 26.FOR without NEXT │ Для оператора FOR не обнаружен соответ- │
    │                     │ ствующий ему оператор NEXT              │
    │                     │                                         │
    │ 27.Out of Paper     │ В принтере не заправлена бумага         │
    │                     │                                         │
    │ 29.WHILE without    │ Ошибка в оформлении цикла WHILE - WEND  │
    │    WEND             │ (отсутствует конец цикла)               │
    │                     │                                         │
    │ 30.WEND without     │ Ошибка в оформлении цикла WHILE - WEND  │
    │    WHILE            │ (отсутствует начало цикла)              │
    │                     │                                         │
    │ 33.Duplicate label  │ Дублирование меток                      │
    │                     │                                         │
    │ 35.Subroutine not   │ Подпрограмма не определена              │
    │    defined          │                                         │
    │                     │                                         │
    │ 37.Argument-count   │ Несоответствие количества аргументов    │
    │    mismatch         │                                         │
    │                     │                                         │
    │ 38.Array not defined│ Массив не определен                     │
    │                     │                                         │
    │ 39.CASE ELSE        │ Отсутствует выбор CASE ELSE             │
    │    expected         │                                         │
    │                     │                                         │
    │ 40.Variable         │ В этой конструкции допустимо употребле- │
    │      required       │ ние только имени переменной             │
    │                     │                                         │
    │ 50.FIELD Overflow   │ Длина записи в файле прямого доступа    │
    │                     │ превышает размеры буфера, отведенного   │
    │                     │ по оператору FIELD                      │
    │                     │                                         │
    │ 51.Internal error   │ Внутренняя ошибка системы               │
    │                     │                                         │
    │ 52.Bad file number  │ Попытка обращения к файлу, который не   │
    │                     │ был открыт. Попытка открыть файл с не-  │
    │                     │ допустимым номером                      │
    │                     │                                         │
    │ 53.File not found   │ На диске не найден файл с указанным име-│
    │                     │ нем. Возможна ошибка в задании имени    │
    │                     │                                         │
    │ 54.Bad file mode    │ Недопустимый файловый режим. Возможно   │
    │                     │ неправильное употребление операторов    │
    │                     │ обмена (PUT или GET для последователь-  │
    │                     │ ных файлов, LOAD для файла прямого до-  │
    │                     │ ступа) или задание недопустимого режима │
    │                     │ в операторе OPEN                        │
    │                     │                                         │
    │ 55.File already open│ Попытка удалить открытый файл или от-   │
    │                     │ крыть его повторно                      │
    │                     │                                         │
    │ 56.FIELD statement  │                                         │
    │    active           │                                         │
    │                     │                                         │
    │ 57.Device I/O Error │ Ошибка оборудования                     │
    │                     │                                         │
    │ 58.File already     │ Попытка присвоить файлу имя уже суще-   │
    │    exists           │ ствующего файла                         │
    │                     │                                         │
    │ 59.Bad record length│ Недопустимая длина записи               │
    │                     │                                         │
    │ 61.Disk full        │ На диске нет свободного места           │
    │                     │                                         │
    │ 62.Input past end   │ Попытка прочитать данные из файла, кото-│
    │    file             │ рый уже исчерпан                        │
    │                     │                                         │
    │ 63.Bad record number│ Недопустимый номер записи               │
    │                     │                                         │
    │ 64.Bad file name    │ Ошибка в задании имени файла            │
    │                     │                                         │
    │ 66.Direct statement │ При загрузке программного файла (LOAD)  │
    │    in file          │ GW-система обнаружила строку без номера │
    │                     │                                         │
    │ 67.Too many files   │ Слишком много файлов, в оглавлении нет  │
    │                     │ места для нового файла                  │
    │                     │                                         │
    │ 68.Device           │ Устройство недоступно (не включено или  │
    │      unavailable    │ не переведено в режим On-line)          │
    │                     │                                         │
    │ 69.Communication    │ Переполнен буфер телекоммуникационного  │
    │    buffer overflow  │ канала                                  │
    │                     │                                         │
    │ 70.Permission       │ Попытка обращения к защищенным данным   │
    │       Denied        │ (запись на дискету с заклееной прорезью,│
    │                     │ обращение к файлу с защищенными запися- │
    │                     │ ми и т.п.)                              │
    │                     │                                         │
    │ 71.Disk not Ready   │ Дискета не вставлена или дисковод не    │
    │                     │ приведен в состояние готовности         │
    │                     │                                         │
    │ 72.Disk Media Error │ Разрушен участок с носителем информации │
    │                     │ на диске                                │
    │                     │                                         │
    │ 73.Advanced Feature │ Использована конструкция, еще не реали- │
    │                     │ зованная в рамках данной версии         │
    │                     │                                         │
    │ 74.Rename across    │ В попытке переименовать файл указано,   │
    │    disks            │ что новый файл должен быть расположен   │
    │                     │ на другом диске. Такая процедура запре- │
    │                     │ щена                                    │
    │                     │                                         │
    │ 75.Path/File Access │ Неверно задана спецификация файла       │
    │    error            │                                         │
    │                     │                                         │
    │ 76.Path not found   │ Не найдено оглавление                   │
    └─────────────────────┴─────────────────────────────────────────┘


            6.3.Индивидуальная обработка программных прерываний

         В состав пользовательской программы может быть включена под-
    программа, осуществляющая нестандартную обработку программных пре-
    рываний. Точка входа в такую подпрограмму об'является с помощью
    следующего оператора :

                         ON  ERROR  GOTO  N

    Если значение N отлично от нуля, то стандартная реакция системы на
    программные прерывания блокируется. Теперь при возникновении любой
    особой ситуации во время выполнения программы управление будет пе-
    редано указанной подпрограмме. Для анализа типа события и локализа-
    ции места ошибки можно воспользоваться значениями системных перемен-
    ных, перечень которых приведен в табл.28. Если во время работы
    подпрограммы обработки ошибок снова возникнет особая ситуация, то
    задача снимается.

                                                         Таблица 28
    ┌──────────────┬───────────────────────────────────────────────────┐
    │ Наименование │            Значение переменной                    │
    │  переменной  │                                                   │
    ├──────────────┼───────────────────────────────────────────────────┤
    │  ERADR       │ Адрес команды, при выполнении которой была обна-  │
    │              │ ружена ошибка. Turbo-система в режиме Debug поз-  │
    │              │ воляет опознать оператор исходной программы, со-  │
    │              │ ответствующий ошибочной команде                   │
    │  ERDEV       │ Код ошибки, обнаруженной при работе с внешним ус- │
    │              │ тройством                                         │
    │              │                                                   │
    │  ERDEV$      │ Идентификатор устройства, при работе которого бы- │
    │              │ ла обнаружена ошибка                              │
    │              │                                                   │
    │  ERL         │ Номер строки исходной программы, при выполнении   │
    │              │ которой возникла особая ситуация                  │
    │              │                                                   │
    │  ERR         │ Код программной ошибки (см. табл.27)              │
    │              │                                                   │
    │  EXTERR      │ Массив, используемый в GW-системе и содержащий    │
    │              │ четыре элемента, в которых находится расширенная  │
    │              │ информация об ошибке                              │
    └──────────────┴───────────────────────────────────────────────────┘

         Возврат из подпрограммы обработки ошибочной ситуации осущест-
    вляется с помощью оператора RESUME. Будучи употреблен без аргумента
    или с нулевым аргументом, он передает управление оператору, при вы-
    полнении которого возникла ошибочная ситуация. Это дает возможность
    повторить действие, если ошибка носит случайный характер.
         Для обхода ошибочного оператора используется модификация RE-
    SUME NEXT. Возможен и вариант возврата на строку с заданным номером
    или меткой :

                           RESUME  150

         Программное прерывание не всегда означает ошибку в работе ал-
    горитма. Некоторые ситуации типа исчерпания данных могут быть зара-
    нее запланированы :

                   10 ON  ERROR  GOTO  1000
                   20 READ A,B,C
                  ...............
                  250 GOTO  20
                  .............................
                         1000 IF  ERR = 4  THEN  RESUME 260
                         1010 PRINT "ERR="; ERR, "ERL="; ERL
                         1020 RESUME NEXT

         Отладке программы обработки ошибочных ситуаций может оказать
    содействие оператор ERROR n. Он моделирует возникновение ошибки с
    кодом n (0 <= n <= 255).
         Выполнение оператора  ON ERROR GOTO 0  восстанавливает систем-
    ный режим контроля за программными прерываниями.