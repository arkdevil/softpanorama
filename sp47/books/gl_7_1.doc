             7. ОСНОВНЫЕ ПРИЕМЫ РАБОТЫ В СРЕДЕ GW BASIC


         Название системы происходит от сокращения фразы Gee Whiz
    BASIC, которую довольно трудно перевести на русский язык. Первое
    слово имеет несколько значений - "лошадка", "вот это да!","ого!",
    ... . Поэтому иногда систему GW называют надежной лошадкой. Вто-
    рое слово, являющееся синонимом whizz, переводится как "чудо",
    "прелесть", "здорово", "молодец", ... . Будем считать, что соче-
    тание "чудо - Бейсик" не очень противоречит замысловатому GW.
         GW BASIC представляет собой завершающий этап в развитии
    семейства MS BASIC, BASIC-T, BASIC-D и BASIC-A  - первых програм-
    мных продуктов фирмы Microsoft Corp., появившихся в составе опе-
    рационных систем MS DOS и PC DOS.
         Известно довольно много версий GW BASIC, появившихся в ре-
    зультате совместных усилий фирм Microsoft и Commodore на ПЭВМ
    типа PC-10, PC-20, PC-30, Microsoft и Apple Computer на ПЭВМ ти-
    па Macintosh. В этом разделе приводятся сведения о версии 3.23,
    функционирующей под управлением MS DOS - 3.30 .
         В отличие от более современных систем компилирующего типа
    (Quick BASIC - 4.0, Turbo BASIC - 1.1) GW BASIC базируется на
    интерпретации. Любая Бейсик-программа может исполняться только
    в среде GW-системы и интерпретируется заново при каждом очередном
    запуске. В последнее время в литературе появилось сообщение о
    разработке GW-компилятора.
         GW-интерпретатор версии 3.23 является программным продуктом
    фирмы Microsoft Corp. и состоит из единственного модуля
    gwbasic.exe, занимающего на диске 80608 байтов.


                 7.1.Вызов и настройка интерпретатора

         Старт GW-системы сопровождается запуском ее единственного
    модуля, для настройки которого в командной строке задается набор
    необходимых параметров :

     >gwbasic [ nameprog ] [ <input ] [ [>] >output ] [/c: n] [/d]
                             [/f: n] [/i] [/m: [n1] [,n2]] [/s: n]

    Здесь :
      nameprog - имя Бейсик-программы, которая автоматически загружа-
                 ется в память после вызова интерпретатора и начинает
                 выполняться. Имя программы может быть задано как пол-
                 ной спецификацией файла (диск,корневое оглавление,
                 вложенные оглавления, имя файла), так и именем файла
                 без указания расширения .BAS, если нужный текст на-
                 ходится в текущей директории;
      <input   - назначение устройства ввода, в качестве которого по
                 умолчанию выступает клавиатура (KYBD:);
    [>]>output - назначение устройства (файла) вывода, в качестве ко-
                 торого по умолчанию выступает экран дисплея (SCRN:).
                 Наличие двух подряд идущих символов ">>" означает,
                 что файл вывода открывается для дозаписи с сохране-
                 нием ранее находившейся в нем информации;
      /c: n    - установка максимального размера буферов, обслужива-
                 ющих обмен по телекоммуникационным каналам связи
                 (COM1: и/или COM2:). По умолчанию емкость буфера
                 вывода равна 128 байтам, а емкость принимающего бу-
                 фера - 256 байтам. Нулевое значение n отменяет под-
                 держку работы с каналами связи;
      /d       - признак установки режима вычисления значений матема-
                 тических функций (ATN, COS, EXP, LOG, SIN, SQR, TAN)
                 с удвоенной точностью;
      /f: n    - установка максимального количества n одновременно
                 открытых файлов. Каждый открываемый файл требует для
                 своего обслуживания 194 байта памяти под так называ-
                 емый блок управления (FCB - File Control Block) и
                 128 байтов под буфер для обмена данными. По умолча-
                 нию система ограничивает количество одновременно
                 открытых файлов числом 3;
      /i       - признак статического распределения памяти под обла-
                 сти FCB и буфера обмена;
    /m: n1[,n2]- установка максимального адреса ячейки оперативной
                 памяти (n1) и максимального размера блока (n2), ис-
                 пользуемых системой. Указанные ограничения необходи-
                 мы в тех случаях, когда используются ассемблеровские
                 подпрограммы и занимаемые ими области не должны пе-
                 ресекаться с системой.

         Все числовые параметры, изменяющие размеры соответствующих
    системных областей, задаются десятичными, восьмеричными или шест-
    надцатеричными константами. Порядок задания управляющих парамет-
    ров - произвольный. Однако имена вызывамого программного файла и
    файлов ввода/вывода располагаются в начале командной строки.


             7.2.Директивы управления системой GW BASIC

         Помимо директив (операторов), используемых для работы с фай-
    ловой подсистемой MS DOS  и описанных в разделе 2.5.5, система
    GW BASIC располагает специфическим набором директив, полный пере-
    чень которых приведен в табл.29.
         С целью ускорения набора наиболее употребительных директив
    их полный или частичный текст закреплен за функциональными клави-
    шами :

       F1  :  LIST                  F6  :  ,"LPT1:" + CHR$(13)
       F2  :  RUN + CHR$(13)        F7  :  TRON + CHR$(13)
       F3  :  LOAD"                 F8  :  TROFF + CHR$(13)
       F4  :  SAVE"                 F9  :  KEY
       F5  :  CONT + CHR$(13)       F10 :  SCREEN 0,0,0,+ CHR$(13)


                      7.2.1.Ввод новой программы

         Ввод новой программы начинается с директивы NEW, которая
    производит очистку оперативной памяти от предшествующей программы
    и ее переменных.
         Время набора можно сократить, воспользовавшись директивой
    AUTO, которая устанавливает режим автоматической нумерации вводи-
    мых строк. Первый ее аргумент опеделяет новый начальный номер (N)
    или воспринимает в качестве точки отсчета номер только что вве-
    денной строки (.). По умолчанию начальный номер принимается рав-
    ным 10. Второй аргумент (dN) задает шаг нумерации строк. При его
    отсутствии шаг принимается равным 10 или устанавливается по зна-
    чению dN, употребленному в ранее набранной директиве AUTO. Пос-
    ледний вариант имеет место, если  первый аргумент завершается за-
    пятой, а dN - отсутствует.
         Отмена режима автоматической нумерации строк происходит пос-
    ле нажатия клавиш Ctrl+Break (Ctrl+S).
         Длина программной (логической) строки в системе GW BASIC
    может доходить до 255 символов. При наборе длинной строки, содер-
    жащей более 80 символов, курсор автоматически переходит в начало
    следующей экранной строки. Набор строки завершается нажатием кла-
    виши Enter.
         Во время набора текущей строки можно исправить замеченные
    пользователем ошибки. Для этого применяются клавиши перемещения
    курсора,Delete,Backspace,Insert.
         Одной из наиболее распространенных ошибок начинающих пользо-
    вателей является исправление, удаление или замена фрагментов ранее
    набранной программы без нажатия клавиши Enter. При такого рода
    коррекциях курсор следует обязательно перевести в конец исправля-
    емой строки, после чего необходимо нажать клавишу Enter. В про-
    тивном случае исправление останется только на экране, а в програм-
    ный файл не попадет.
         Вообще говоря, для исправления строки с номером N или только
    что набранной строки лучше воспользоваться директивой EDIT и
    средствами экранного редактора, описанными в разделе 7.2.3.
         Удаление ненужных или ошибочно набранных строк может быть
    выполнено двумя способами. Одиночную строку проще удалить, набрав
    ее номер и нажав клавишу Enter, т.е. введя пустую программную
    строку. Для удаления фрагмента, начинающегося строкой с номером
    N1 и заканчивающегося строкой с номером N2, естественно восполь-
    зоваться директивой DELETE.

                                                  Таблица 29
    ┌─────────────────────────┬───────────────────────────────────────
    │ Формат директивы        │               Назначение
    ├─────────────────────────┼───────────────────────────────────────
    │ AUTO [N] [,[dN]]        │ Установка режима автоматической
    │ AUTO  .  [,[dN]]        │ нумерации строк
    │                         │
    │ CONT                    │ Продолжение выполнения прерванной
    │                         │ программы
    │                         │
    │ DELETE [N1] [-N2]       │ Удаление строк текущей программы
    │ DELETE  N1-             │ Удаление программы, начиная со
    │                         │ строки N1
    │                         │
    │ EDIT N                  │ Переход в режим редактирования
    │ EDIT .                  │ указанной или текущей строки
    │                         │
    │ KEY i,"ss...s"          │ Закрепление текста ss...s за
    │                         │ функциональной клавишей Fi
    │ KEY LIST                │ Вывод на экран полных текстов,
    │                         │ закрепленных за всеми функциональными
    │                         │ клавишами
    │                         │
    │ LIST [N1][-N2][,"file"] │ Вывод фрагмента текущей программы на
    │ LIST [N1-][,"file"]     │ экран или в указанный файл
    │                         │
    │ LLIST [N1][-N2]         │ Вывод фрагмента текущей программы на
    │ LLIST [N1-]             │ принтер
    │                         │
    │ LOAD "file" [,R]        │ Загрузка программного файла
    │                         │
    │ MERGE "file"            │ Слияние указанного программного
    │                         │ файла с текущей программой
    │                         │
    │ NEW                     │ Удаление текущей программы из памяти
    │                         │ и очистка значений всех переменных
    │                         │
    │ RENUM [Nnew],[Nold][,dN]│ Перенумерация строк текущей программы
    │                         │
    │ RUN [N] [,R]            │ Выполнение текущей программы
    │ RUN "file" [,R]         │
    │                         │
    │ SAVE "file" [,A]        │ Запоминание текущей программы в
    │                         │ формате ASCII
    │ SAVE "file" [,P]        │ Запоминание текущей программы в
    │                         │ защищенном формате
    │                         │
    │ SYSTEM                  │ Возврат из GW-системы в MS DOS
    │                         │
    │ TROFF                   │ Отключение режима трассировки
    │ TRON                    │ Включение  режима трассировки
    └─────────────────────────┴───────────────────────────────────────


             7.2.2.Запоминание и загрузка программных файлов

         Чтобы сохранить текущую программу на винчестере или дискете,
    надо нажать клавишу F4, после чего в командной строке появится
    начало директивы SAVE. Затем необходимо набрать полную или уко-
    роченную спецификацию программного файла, закрыть кавычку и на-
    жать клавишу Enter :

                   SAVE   "d:\basic\gwbasic\prog1"
                   SAVE   "prog1"

    Имя файла можно и не заключать в кавычки. В директиве SAVE может
    присутствовать еще один аргумент - буква A или P. В первом случае
    текст программы запоминается в формате ASCII, что позволяет его в
    дальнейшем редактировать и распечатывать. Несмотря на то, что фор-
    мат ASCII предполагает хранение программы в виде обычного тексто-
    вого файла, GW-система все-таки его модифицирует, заменяя служеб-
    ные слова одно- или двухсимвольными комбинациями. Поэтому такой
    текст нельзя отредактировать, например, средствами Нортон-редак-
    тора или передать на исполнение другим Бейсик-системам. Так что
    обрабатывать текст программы можно только в среде GW-системы.
         Во втором случае (P) для хранения программы используется
    специальный защищенный формат. После этого программу можно толь-
    ко выполнить, но редактировать или распечатывать ее нельзя. Этот
    вариант может быть использован при передаче своих разработок
    другим лицам или организациям с целью сохранения в тайне текста
    исходной программы. Абсолютную защиту это, естественно, не обес-
    печивает, так как знание внутреннего представления защищенного
    файла позволяет восстановить его текст.
         Дисковые программные файлы загружаются в память с помощью
    директив LOAD или RUN :

                       LOAD "prog1" [,R]
                       RUN  "prog1" [,R]

    Директива LOAD без параметра R перед загрузкой осуществляет очист-
    ку памяти от предыдущей программы и ее переменных и только после
    этого считывает указанный программный файл. Зтаем загруженную про-
    грамму можно редактировать, распечатывать и выполнять.
         В сочетании с параметром R директива LOAD напоминает оператор
    CHAIN. Перед вызовом новой программы из памяти удаляются все стро-
    ки предшествующей программы, но значения всех ее переменных и сос-
    тояние открытых файлов сохраняются. Это обеспечивает возможность
    передачи данных между программами. Файл, загруженный с параметром
    R, начинает немедленно исполняться.
         Директива RUN в сочетании с именем файла действует подобно
    оператору LOAD и единственное отличие состоит только в том, что
    загружаемый файл в любом случае начинает исполняться.
         К тексту текущей программы можно присоединить содержимое
    любого дискового файла с помощью директивы MERGE. При такой за-
    грузке строки текушей программы из памяти не удаляются, но если
    во вновь вызываемой программе имеются строки с совпадающими но-
    мерами, то они замещают прежние операторы.


               7.2.3.Редактирование текущей программы

         Для внесения изменений в текст текущей программы его необхо-
    димо предварительно вывести на экран дисплея с помощью директивы
    LIST. Корректуру в текст можно вносить, используя примитивные
    средства вставки/удаления в сочетании с клавишами перемещения кур-
    сора. Однако большего эффекта можно достичь с помощью клавишных
    функций экранного редактора GW-системы. Полный их перечень приве-
    ден в табл.30.
         Если об'ем вносимых изменений достаточно велик и в программе
    появилось большое количество вставленных строк, то текст программы
    можно улучшить путем перенумерации строк с помощью директивы
    RENUM :

                RENUM   [Nnew] , [Nold] [,dN]

    Строке текущей программы с номером Nold присваивается номер Nnew.
    Все последующие строки перенумеруются с шагом dN. По умолчанию
    перенумерация начинается с самой первой строки, а в качестве па-
    раметров Nnew и dN принимается 10.
         Процедура перенумерации заменяет не только номера строк про-
    граммы, но и производит соответствующие исправления в операторах,
    ссылавшихся на прежние номера. Это относится к операторам услов-
    ного и безусловного перехода, восстановления блока данных (RES-
    TORE) и возврата из подпрограмм (RETURN, RESUME) с указанием но-
    меров строк, к системной переменной ERL.


                  Клавишные операции            Таблица 30
    ┌────────────────────────────────────────────────────────────────
    │                  Перемещения по тексту
    ├─────────────────────┬──────────────────────────────────────────
    │  Комбинация клавиш  │    Направление перемещения курсора
    ├─────────────────────┼──────────────────────────────────────────
    │ <--        , Ctrl+] │    На одну позицию влево
    │ -->        , Ctrl+\ │    На одну позицию вправо
    │ Ctrl+<--   , Ctrl+B │    В начало предыдущего слова или числа
    │ Ctrl+-->   , Ctrl+F │    В начало следующего слова или числа
    │ Home       , Ctrl+K │    В левый верхний угол экрана
    │ End        , Ctrl+N │    В конец текущей логической строки
    │  |         , Ctrl+6 │    На одну строку вверх
    │  |         , Ctrl+- │    На одну строку вниз
    │ Ctrl+Enter , Ctrl+J │    В начало следующей экранной строки
    │ Tab                 │    В ближайшую справа позицию, номер
    │                     │    которой кратен 8
    ├─────────────────────┴──────────────────────────────────────────
    │                           Удаление
    ├─────────────────────┬──────────────────────────────────────────
    │  Комбинация клавиш  │               Назначение
    ├─────────────────────┼──────────────────────────────────────────
    │  Bcsp     , Ctrl+H  │     Удаление символа слева от курсора
    │  Ctrl+Bcsp, Del     │     Удаление символа над курсором
    │  Ctrl+End , Ctrl+E  │     Удаление части логической строки от
    │                     │     позиции курсора до конца строки
    │  Ctrl+[   , Esc     │     Удаление текущей логической строки
    │                     │     целиком
    ├─────────────────────┴──────────────────────────────────────────
    │                           Вставка
    ├─────────────────────┬──────────────────────────────────────────
    │  Комбинация клавиш  │           Выполняемая функция
    ├─────────────────────┼──────────────────────────────────────────
    │  Ins   , Ctrl+R     │     Включение или отключение режима
    │                     │     вставки
    ├─────────────────────┴──────────────────────────────────────────
    │                      Прочие операции
    ├─────────────────────┬──────────────────────────────────────────
    │  Комбинация клавиш  │             Назначение
    ├─────────────────────┼──────────────────────────────────────────
    │  Ctrl+Break         │     Устанавливает режим ввода и отменяет
    │                     │     автоматическую нумерацию строк
    │  Crtl+M     , Enter │     Вводит текущую строку до позиции
    │                     │     курсора
    │  Ctrl+G             │     Генерирует кратковременный звуковой
    │                     │     сигнал
    │  Ctrl+Home  , Ctrl+L│     Чистит экран и перемещает курсор в
    │                     │     левый верхний угол
    │ Ctrl+NumLock, Ctrl+S│     Останавливает программу. Для продолже-
    │                     │     ния  нажать любую клавишу
    │  Ctrl+PrtSc         │     Включает или отключает режим, при 
    │                     │     котором информация, выдаваемая на 
    │                     │     экран дисплея, одновременно печатается 
    │                     │     на принтере
    │  Shift+PrtCs        │     Выводит содержимое экрана на принтер
    └─────────────────────┴──────────────────────────────────────────


              7.2.4.Выполнение и прерывание программы

         Запуск текущей программы производится нажатием клавиши F2,
    т.е. путем выполнения директивы RUN без параметров. При этом
    интерпретация начинается со строки с наименьшим номером. Дирек-
    тиву RUN с указанием входной точки приходится набирать :

                      RUN  150 [,R]

    Параметр R, как и при загрузке новой программы, позволяет сохра-
    нить значения всех переменных и состояние открытых файлов.
         Прервать выполняющуюся программу можно нажав клавиши Ctrl+
    Break (Ctrl+S). После этого работу программы можно продолжить с
    помощью директивы CONT, если в текст текущей программы с момента
    останова не вносилось каких-либо изменений. Останов программы, в
    частности, используют для просмотра значений переменных.
         Для получения дополнительной информации о ходе выполнения
    текущей программы можно воспользоваться директивами TRON и TROFF,
    выполнение которых осуществляется нажатием единственной клавиши
    F7 или F8. При включении режима трассировки накапливаются и выда-
    ются номера исполняющихся строк, по последовательности которых
    можно судить о правильности или ошибочности в запрограммированной
    логике алгоритма. Режим трассировки отменяется директивами TROFF
    и NEW.
