
             "УНИВЕРСАЛЬНЫЙ" ДРАЙВЕР VGA/EGA И КЛАВИАТУРЫ,
                     ЗАНИМАЮЩИЙ МАЛЫЙ ОБЪЕМ ПАМЯТИ

                 1. Назначение и краткие характеристики

     Данный драйвер предназначен для "руссификации" экрана и  клавиатуры 
IBM PC -  совместимых компьютеров,  оснащенных адаптерами  VGA или  EGA, 
работающих под управлением MS DOS версии не ниже 3.30.
     Целью разработки драйвера являлась необходимость минимизации объема 
занимаемой резидентом памяти при обеспечении поддержки всех  графических 
и  текстовых  видеорежимов  VGA  и  EGA,  работа  на  VGA  или  EGA  без 
дополнительной настройки, возможность работать как в альтернативной, так 
и основной  кодировках  простым переключением  режима  работы  драйвера, 
воэможность  подзагрузки   пользовательских  шрифтов   русских  букв   и 
отсутствие жестких требований по  совместимости с IBM  PC, кроме как  на 
уровне BIOS.
     Драйвер  клавиатуры   может  дополнительно   включаться  в   состав 
резидента.
     Объём занимаемой памяти резидентом без  драйвера клавиатуры -  6000 
байт ( 5.86 Кбайт ).
     Объём занимаемой памяти резидентом с драйвером  клавиатуры -   6336 
байт ( 6.19 Кбайт ).
     Драйвер поддерживает видеорежимы, использующие шрифты размером 8*8, 
8*14 и 8*16 ( 8*10 - не поддерживается).
     Для экономии памяти  драйвер перегружает память  знакоформирователя 
(ЗНФ) только  для старшей  половины кодовой  таблицы IBM  PC, в  которой 
содержатся русские буквы ( коды 128  - 255 ).  При этом, для  разложений 
символов 8*14 (EGA) и 8*16 (VGA)  для кодов 128-255 используется один  и 
тот же  ЗНФ.  Матрица  изображения  символа  в  пикселях  размером  8*14 
получается из матрицы размером 8*16 путем отбрасывания верхней и  нижней 
строк. Для первой половины  кодовой таблицы сохраняется  соответствующий 
внутренний ЗНФ IBM PC.
     Драйвер автоматически  проверяет  наличие  VGA.  Если  не  VGA,  то 
подразумевается EGA.
     Драйвер проверен на IBM PC/AT-совместимых компьютерах с  адаптерами 
EGA и VGA при  работе с различными  текстовыми и графическими  пакетами, 
включая CheckIt, MSWORD, AutoCad, различные СУБД.

                          2. Запуск программы

     Имя файла программы драйвера - VGAEGA_K.COM.
     При первом запуске дополнительно могут задаваться следующие ключи :

/E - Использовать на VGA  ЗНФ размером 8*14  (как на  EGA) вместо  8*16. 
     Этот ключ вспомогательный, предназначен для того, что бы увидеть  в 
     текстовом  видеорежиме  на  VGA  как  будут  "смотреться"   символы 
     загруженного ЗНФ на EGA.

/L4:filecpec или
/L6:filespec,
/L8:filespec - Загрузить  ЗНФ  (filespec  -  полное  имя  файла  ЗНФ)  с 
               разложением символов соответственно 8*14  или 8*16 и  8*8 
               на  место  внутреннего  ЗНФ  драйвера.  Файл  ЗНФ  должен 
               содержать матрицы  разложений для  символов всей  кодовой 
               таблицы (коды 0  - 255). Из  них драйвер загрузит  только 
               ЗНФ для  кодов 128-255.  Нет  смысла задавать  сразу  два 
               ключа /L4... и /L6..., так как фактически будет  загружен 
               только последний заданный  ЗНФ. Можно использовать  файлы 
               массивов ЗНФ  из  пакетов  Л.Г.Бунича  и  Д.Гуртяка  (см. 
               предыдущие выпуски Софтпанорамы) либо им аналогичные.

/R4:filecpec или
/R6:filespec,
/R8:filespec - То же, что и /L..., но файл ЗНФ должен содержать  матрицы 
               разложения символов только  для старшей половины  кодовой 
               таблицы - кодов 128 - 255.

/M - Переключение в режим  основной кодировки.  Внутренние ЗНФ  драйвера 
     (8*16 и 8*8)  перестраиваются в соответсвии  с основной  кодировкой 
     русских букв. Этот ключ действует так  же и на драйвер  клавиатуры. 
     Ключи /L...  и /R...  и этот  ключ позиционно  зависимы. Т.е.  если 
     загружаемый ЗНФ соответствует альтернативной кодировке, то ключ  /M 
     должен следовать  за  ключем /L...(/R...),  а  если основной  -  то 
     наоборот.

/K[HPTUB] - Включить  в  резидент  драйвер  клавиатуры,   необязательные 
            опции:
             H - русскую букву 'Н' передавать латинской 'H';
             P - русскую букву 'р' передавать латинской 'p';
             T - русскую  букву  'р'  передавать  с  её   действительным 
                 scan-кодом 23h, а не 0h, как по умолчанию;
             U - назначить на  клавиши '-','='  и '\'  украинские  буквы 
                 'і','ї' и 'є', соответственно. Кодировка этих букв -  в 
                 соответствии  с  предложениями   по  стандартизации   ( 
                 см.Софтпанораму 1991,  No.1 (15)).  Производится  также 
                 перегрузка соответствующей части ЗНФ. Поэтому ключ /K с 
                 этой опцией (/KU) позиционно зависим с ключами /L...  и 
                 /R... так же, как и ключ /M.
             B или B:n -  в режиме  РУС включать  рамку на  экране. n  - 
                 символ, младшие 4 бита которого определяют цвет  рамки. 
                 Если n не  задано, то цвет  рамки (по умолчанию)  будет 
                 синим.

           Переключение ЛАТ/РУС - ЛЕВЫЙ/ПРАВЫЙ Shift.    

/? - Вывод справки по ключам и о состоянии драйвера.


     Ключи при повторном запуске программы драйвера :

/X - Выгрузка драйвера из памяти, освобождение памяти.

/OFF - Выключить (деактивировать) драйвер.

/ON  - Включить ранее деактивированный драйвер.

/M   - Перевести ранее загруженный драйвер в режим основной кодировки.

/A   - Перевести  ранее  загруженный  драйвер  в  режим   альтернативной 
       кодировки.

/L... и
/R... - Загрузка ЗНФ (см. выше) в уже загруженный драйвер.

/?    - Вывод справки по ключам и о состоянии драйвера.

ПРИМЕЧАНИЕ. При повторном запуске драйвер обрабатывает только один ключ, 
            первый в командной строке.  Поэтому, необходимо столько  раз 
            запускать драйвер, сколько ключей необходимо отработать  для 
            уже загруженного драйвера.

     Таким образом,  например,  запуск драйвера  с  включением  драйвера 
клавиатуры и синей рамкой в режиме РУС должен производится по команде

                    vgaega_k /kb


                           3. Общие замечания

     3.1. Размер памяти резидента  драйвера для выполнения  поставленных 
задач на первый взгляд кажется  малым, тем не  менее пока не  обнаружены 
ситуации, когда драйвер неверно срабатывал.

     3.2.  Поскольку  для  EGA  и  VGA   используется  один  и  тот   же 
знакоформирователь (фонт)  русских  букв, то  на  EGA  символы  русского 
алфавита будут выглядеть  крупнее букв латинского  алфавита. Если  такое 
положение не устраивает, то при работе с EGA можно загрузить фонт  8*14, 
входящий в комплект поставки. Загрузка осуществляется по ключу :
                    /r4:[path\]8x14r.fnt

     3.3. В режиме основной кодировки в силу непреодолимых  особенностей 
аппаратуры VGA  горизонтальные линии,  нарисованные с  помощью  блоковых 
графических символов, будут содержать  разрывы в 1  пиксель. По этой  же 
причине,  могут   наблюдаться   искажения  некоторых   символов   фонтов 
загруженных из файлов, не входящих в комплект поставки драйвера.

                          4. Комплект поставки

Имя файла    Размер

VGAEGA_K.COM 10500  - драйвер VGA/EGA и клавиатуры;
VGAEGA_K.DOC        - описание драйвера;
8x16r   .FNT  2048  - массив ЗНФ 8*16 для кодов 128-255;
8x14r   .FNT  1792  - массив ЗНФ 8*14 для кодов 128-255;
8x8r    .FNT  1024  - массив ЗНФ 8*8  для кодов 128-255;

TBL     .COM   203  - программа  вывода   на   экран   кодовой   таблицы 
                      символов;
SETVMD  .COM   308  - программа  установки  произвольного   видеорежима, 
                      номер  которого   задается  в   командной   строке 
                      (видеорежимы 8,9,A,B,C рекомендуется не задавать);
VIDEOTST.BAT   431  - командный файл для простейшей проверки драйвера во 
                      всех видеорежимах;
EGA.COM        999  - программа И. Кононенко.  Используется  в  тестовом
                      .BAT файле для определения типа адаптера.

ПРИМЕЧАНИЯ. 1.Массивы знакоформирователей  8*16 и  8*8 являются  копиями 
            внутреннего ЗНФ драйвера и даются "на всякий случай".
            2.Массив знакоформирователя 8*14 может использоваться на EGA 
            (см.выше).


                             **************

     При наличии уже  большого количества  драйверов для  "руссификации" 
экрана  и  клавиатуры  разработка  еще  одного  драйвера  может  вызвать 
удивление.  Анализ  целей,  которые   были  поставлены  при   разработке 
показывает, что  был разработан  "походный"  вариант такого  драйвера  с 
малым объёмом памяти, который должен работать  во всех режимах на EGA  и 
VGA. Но  и  в  качестве  "не  походного"  варианта  драйвер  заслуживает 
внимания.  Поэтому,  есть  смысл  сравнить   его  с  уже   существующими 
драйверами, обеспечивающие поддержку всех режимов VGA и EGA (режим  8*10 
- не рассматривается).  Для сравнения  можно взять  драйвер RKSD  версии 
3.3.4 разработки Лузана С.В.  ( Есть драйвер  UNISCR версия 2.3b  Бунича 
Л.Г., но на одном компьютере с EGA мне показывали, что с ним не  работал 
MSWORD в  одном из  своих режимов).  Драйвер  RKSD, если  следовать  его 
описанию, является одним  из наиболее совершенных  в настоящее время  (к 
сожалению, когда этот текст уже был подготовлен, было обнаружено, что на 
том компьютере, где не работал с MSWORD драйвер UNISCR, точно так же  не 
работает и драйвер RKSD). Более того, прогон приведенного .BAT  файла  с
драйверами  RKSD и  UNISCR  показал,  что не  во всех  видеорежимах  они
чувствуют себя "ХОРОШО" (на упоминавшемся выше компьютере с EGA ).

     По  сравнению   с  драйвером   RKSD  с   точки  зрения   управления 
видеорежимами, данный  драйвер должен  обеспечивать  большее  "качество" 
управления видеорежимами. Оба эти драйверы проверены  на одних и тех  же 
программных продуктах.  Кроме того,  при отладке,  автор сам  "устраивал 
разные пакости" своему драйверу.
     Отличия  предлагаемого  драйвера  от   драйвера  RKSD  ("в   лучшую 
сторону") заключаются в следующем :
 - объём занимаемой памяти на EGA меньше приблизительно на 0.5 Кбайт,  а 
   на EGA - на 4.5 Кбайт;
 - драйвер сравнительно  легко  переключается  с  режима  альтернативной 
   кодировки в режим основной и наоборот.

     Данный драйвер содержит более простой  драйвер клавиатуры (от  него 
можно отказаться) и меньшее  разнообразие различных режимов  инсталяции. 
Но  автор  реализовал  то,  что,  по  его  мнению,  действительно  может 
пригодится на  практике  (по крайней  мере,  "help" едва  помещается  на 
экране).

                             **************

     Данный драйвер  не  запрещает  вытворять  прикладным  программам  с 
видеоадаптерами всё,  что им  вздумается. Но  есть одна  тонкость.  Если 
какая-либо программа, добыв адрес внутреннего ЗНФ драйвера, "захочет"  с 
ним что-то сделать (например, переписать в другое место) в  произвольный 
момент времени без установки соответствующего видеорежима, то она  может 
получить  вовсе  не  тот  ЗНФ,  на   который  расчитывала  (но  это   не 
распространяется на манипуляции с видеорежимами  через BIOS, т.е.  через 
драйвер). Причины,  по которым  прикладная  программа может  что-то  там 
делать с ЗНФ трудно придумать, но  можно. В этом смысле, например,  если 
удасться повторно загрузить данный драйвер (автор умеет это делать),  то 
один драйвер  другому "глаз  не выклюет".  А информация  о  расположении 
различных ЗНФ в памяти для драйвера  является жизненно необходимой,  так 
как своих  ЗНФ для  латинского  шрифта у  него  нет, он  использует  те, 
которые  ему  предоставляет  BIOS  или  ,как  в  данном  случае,   ранее 
загруженный драйвер. Заметить то, что были загружены два драйвера  можно 
только после выгрузки одного из них,  что у автора и происходило  иногда 
при отладке.

                             **************

Разрешается  свободное  распространение   и  использование  драйвера   в 
некоммерческих целях без изменения кода драйвера.

                             **************

Поскольку "полную гарантию дает только  страховой полис", автор  заранее 
благодарен за любые сообщения по поводу работоспособности драйвера.

                              г. КИЕВ
                              р.т. 441-62-31
                              Гаврилкин Владимир Анатольевич

