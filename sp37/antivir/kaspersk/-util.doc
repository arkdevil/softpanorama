                                              'Доктор'  Е. Касперский
                                             ═════════════════════════

                     Антивирусные утилиты  -UTIL.COM
                    ═════════════════════════════════

        Антивирусные утилиты включают в себя карту, дамп и  дизассемблер
памяти, карту состояний векторов прерываний, трассировщик и  перехватчик
прерываний. Утилиты предназначены  для анализа состояния  компьютера при
заражении  его  неизвестным  программе  -V.EXE  вирусом  и  для проверки
"чистоты" оперативной памяти компьютера. Вызов -UTIL.COM происходит либо
из  командной  строки,  либо  из  антивируса  -V.EXE,  вызов   резиденты
осуществляется одновременным нажатием Alt-'+'.

        При запуске -UTIL.COM из командной строки используются следующие
параметры:

        /E - диалог на английском языке;
        /R - диалог на русском языке;
        /P - остаться резидентно.


        Вызов  утилит  производится  через  меню  "Утилиты",   настройка
диалога - меню "Настройка", выход - меню "Выход".


╒═════════════════════════════════════════════╕
│  Утилиты         Настройка          Выход   │
╘╒════════════════════╕═══════════════════════╛
 │ Карта памяти Alt-1 │
 │ Прерывания   Alt-2 │         Вызов карты памяти, карты прерываний,
 │ Дамп памяти  Alt-3 │         редактора памяти и дизассемблера
 │ Дизассемблер Alt-4 │         происходит при нажатии Alt-1,2,3,4 из
 │ Трассировщик       │         любого окна.
 │ Перехватчик        │
 ╘════════════════════╛


╒═════════════════════════════════════════════╕
│  Утилиты         Настройка          Выход   │
╘════════════════╒═══════════════════╕════════╛
                 │ Russ/Engl Alt-F10 │  Диалог русский/английский.
                 │ EGA/VGA    Alt-F9 │  25 или 43/50 строк на экране.
                 │ Связь адресов НЕТ │  Соответствие адресов дампа
                 ╘═══════════════════╛  памяти с адресами дизассемблера.


╒═════════════════════════════════════════════╕
│  Утилиты         Настройка          Выход   │
╘═══════════════════════════════════╒══════════════╕
               Выход из утилит      │ Выход  Alt-X │
               Остаться резидентно  │ Остаться TSR │
               Удаление резиденты   │ Удаление TSR │
                                    ╘══════════════╛


                             Карта памяти
                            ══════════════

        Карта памяти состоит из шести колонок. Колонки отображают
следующую информацию:

        1 - сегментный адрес блока распределения памяти (MCB);
        2 - сегментный адрес префикса программного сегмента (PSP);
        3 - размер блока в параграфах (16 байт) или в килобайтах;
        4 - имя владельца блока: программы или системной области; если
            имя не определено, то указывается знак '?',
        5 - тип блока памяти (драйвер, программа, среда программы);
        6 - список перехваченных блоком векторов прерываний.

┌────┬────┬──────┬───────────┬──────┬──────────────────┬─────────────┐
│MCB │PSP │Размер│ Имя блока │  Тип │Используемые      │Всего:   639K│
│    │    │блока │           │ блока│вектора прерываний│Свободно:454K│
├────┼────┼──────┼───────────┼──────┼──────────────────┴─────────────┤
│  - │0000│  39K │DOS DATA   │      │ 01 03 04 0F 1E 20 25 2A 2B 2C  │
│09C3│0000│  19K │DRIVERS    │      │ 0C 15 19 1B 29 33 EC FC FD     │
│0EA5│0EA6│ 3,3K │COMMAND.COM│прогр.│ 22 23 24 2E                    │
│0F79│0F7A│ ,06K │ свободно  │      │                                │
│0F7D│0EA6│ ,17K │COMMAND.COM│среда │                                │
│    │    │      │           │      │                                │
└────┴────┴──────┴───────────┴──────┴────────────────────────────────┘


                          Векторы прерываний
                         ════════════════════

        В это окно выводится информация о состоянии векторов прерываний:
номер прерывания,  значение вектора  в формате  "сегмент:смещение" и имя
программы  или  системной  области  памяти,  на которую указывает вектор
прерывания.  Для  наиболее  часто  используемых  прерываний  указываются
их функции (назначение).  Перемещение в окне  - клавиши UP,  DOWN, HOME,
END, PGUP, PGDN.

┌────────────┬───────────┬──────────────┬────────────────────────────┐
│ Прерывание │   Адрес   │   Владелец   │ Функция                    │
├────────────┼───────────┼──────────────┼────────────────────────────┤
│ Int 00     │ 1E00:0234 │ -UTIL.COM    │Divide error                │
│ Int 01     │ 0070:075C │ IO.SYS       │Single-step                 │
│ Int 02     │ F000:E2C3 │ ROM BIOS     │NMI                         │
│ Int 03     │ 0070:075C │ IO.SYS       │Breakpoint                  │
│ Int 04     │ 0070:075C │ IO.SYS       │Overflow                    │
│ Int 05     │ F000:FF54 │ ROM BIOS     │Print-Screen                │
│            │           │              │                            │
└────────────┴───────────┴──────────────┴────────────────────────────┘


                              Дамп памяти
                             ═════════════

        В окно дампа памяти выводится в текстовом или  шестнадцатиричном
виде  информация  о  содержании  оперативной  памяти  компьютера.  Выбор
необходимого  участка  осуществляется   либо  перемещением  в   пределах
текущего сегмента  при помощи  клавиш UP,  DOWN, PGUP,  PGDN, HOME, END,
либо указанием начального адреса участка при помощи клавиш LEFT,  RIGHT,
'0'-'9', 'A'-'F'.

        Управление режимами просмотра дампа памяти:

        F2 - сохранение на диск участка памяти в текстовом или
             шестнадцатиричном виде;
        F3 - видимые/невидимые знаки расширенного алфавита;
        F4 - текстовой/шестнадцатиричный дамп;
        F5 - редактор памяти;
        F7 - поиск по текстовому/шестнадцатиричному шаблону.


                             Дизассемблер
                            ══════════════

        Дизассемблер позволяет просмотреть текст программ, загруженных в
память, и удобен при отладке или анализе резидентных программ (например,
резидентных  вирусов).  Выбор  участка  памяти  для   дизассемблирования
производится либо клавишами  UP, DOWN, PGUP,  PGDN в пределах  сегмента,
либо указанием адреса  участка при помощи  клавиш LEFT, RIGHT,  '0'-'9',
'A'-'F'.

                             Трассировщик
                            ══════════════

ВНИМАНИЕ! Использование этой  функции может привести  к непредсказуемому
          поведению компьютера! Будьте осторожны!

        Трассировщик  проходит  по  тропинке  (обработчику) указываемого
прерывания  и  выдает  ассемблерный  листинг  результата  трассировки. В
листинге содержатся имена программ, перехвативших указанное  прерывание,
адреса,  шестнадцатиричный  дамп  и  мнемоники  выполненных  в  процессе
трассировки ассемблерных  команд. Трассировщик  полезен для  обнаружения
неизвестного резидентного вируса и поможет при его анализе.

        Выбор трассируемого прерывания и начальные состояния регистров
происходит в меню регистров:
                           ┌─────────────────────────────────────┐
                           │ INTERRUPT 12      TRACE  CANSEL     │
                           │ CS:IP=1E00:06DE   AX=0000   SI=0000 │
                           │ SS:SP=1E00:FFC4   BX=0000   DI=0000 │
                           │ DS=1E00 ES=B800   CX=0000   BP=0000 │
                           │ Flags=7283        DX=0000           │
                           └─────────────────────────────────────┘


                              Перехватчик
                             ═════════════

ВНИМАНИЕ! Использование этой  функции может привести  к непредсказуемому
          поведению компьютера! Будьте осторожны!
          Вызов этой  функции возможен  только если  -UTIL.COM находится
          РЕЗИДЕНТНО в памяти.

        Перехватчик  встраивается  в  цепочку  выбранного  прерывания  и
сообщает о каждом вызове этого  прерывания. При этом на экран  выводится
окно, в котором указываются номер перехваченного прерывания и  состояния
всех регистров в момент перехвата.

        Выбор перехватываемого прерывания происходит в меню:

                           ┌─────────────────────────────────────┐
                           │ INTERRUPT 00  INTERCEPT  CANSEL     │
                           │ CS:IP=1E00:06DE   AX=0000   SI=0000 │
                           │ SS:SP=1E00:FFC4   BX=0000   DI=0000 │
                           │ DS=1E00 ES=B800   CX=0000   BP=0000 │
                           │ Flags=7283        DX=0000           │
                           └─────────────────────────────────────┘

════════════════════════════════════════════════════════════════════════
