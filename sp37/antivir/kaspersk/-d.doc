                                              'Доктор'  Е. Касперский
                                             ═════════════════════════

                     Антивирусный монитор  -D.COM
                    ══════════════════════════════

        Монитор  -D  -  это  резидентно  находящаяся в памяти программа,
которая  позволяет   выявлять  "подозрительные"   действия   компьютера:
изменение и переименование  выполняемых программ (.COM-  и .EXE-файлов),
запись на  диск по  абсолютному адресу,  форматирование диска, появление
резидентных программ и  некоторые опасные функции  DOS. Помимо этого  -D
ведет  контроль  за  распределением  оперативной  памяти компьютера и за
состоянием некоторых системных областей DOS.

        С  помощью  -D  можно  остановить  распространение компьютерного
вируса на самой ранней стадии.  Кроме того монитор полезен при  работе с
программами, подозрительными на наличие  вируса или "троянского коня"  и
при  разработке  резидентных  программ.  Монитор  позволяет  следить  за
распределением  оперативной  памяти  компьютера  (окно  "Карта памяти" в
основном  меню  монитора)  и,  таким  образом, своевременно обнаруживать
резидентные вирусы.  При помощи меню монитора можно выбрать, на какие из
возможных "подозрительных" ситуаций он должен реагировать.

        При   "подозрительном"    поведении   компьютера    -D    выдает
предупреждение (на  экране появляется  окно с  подробной информацией)  и
ждет  указания  на  разрешение  или  запрещение  данного  действия. Ниже
приводится полный список выдаваемых сообщений.


                     Управление монитором  -D.COM
                    ══════════════════════════════

        После выдачи любого из описанных выше сообщений необходимо  либо
разрешить, либо запретить операцию, вызвавшую сообщение.  При разрешении
операции компьютер  продолжит ее  выполнение. При  запрещении монитор -D
установит указатели об ошибке (например, "файл не найден", "диск защищен
от  записи"  и  пр.)  и   произведет  возврат  в  программу,   вызвавшую
"подозрительную"  операцию.  Если  при  этом  вызывающая  программа   не
проверяет правильность выполнения  операции, то результат  ее дальнейшей
работы непредсказуем.

        Некоторые  операции  выполняются   многократно  (например,   при
форматировании  или  оптимизации  диска).  В этом случае удобно временно
отключить соответствующий режим, при этом не будут выдаваться  сообщения
об  отключенной  операции  (например,  при  форматировании  диска  нужно
отключить  режим   проверки  на   форматирование).  Отключение   режимов
производится  либо  вызовом  основного  меню,  либо  повторным  запуском
монитора.

                        Основное меню монитора
                       ════════════════════════

        Вызов  основного  меню  осуществляется  одновременным   нажатием
клавиш Alt  и '-',  выход -  нажатием клавиши  ESC.   При вызове меню на
экране появляются два окна:  окно установки режимов и окно карты памяти.
Если по некоторым причинам войти   в меню невозможно, то монитор  подаст
звуковой сигнал.

 ╦════════════════════╦══════════════════════════════════════════════╦
 ║Изменение файлов  ДА║Всего / Указано / Свободно   640 / 639 / 507 K║
 ║Переименование    ДА║────┬────┬────┬────────────┬──────────────────║
 ║Контроль памяти   ДА║MCB │PSP │ $$ │ Программа  │ Прерывания       ║
 ║Форматирование    ДА║────┼────┼────┼────────────┼──────────────────║
 ║Прямая запись     ДА║09C3│0008│7,4K│DRIVERS     │                  ║
 ║Опасные вызовы    ДА║0BA2│0BA3│3,2K│COMMAND.COM │22 24 2E          ║
 ║Профессионал     НЕТ║0C76│0C77│,04K│  свободно  │                  ║
 ║English      Alt-F10║0C7A│0BA3│,15K│COMMAND.COM │                  ║
 ║Удаление  -D        ║1A48│1A55│ 22K│-D.COM      │10 1B 1C 20 23 26 ║
 ╚════════════════════║20E5│0BA3│507K│COMMAND.COM │                  ║
                      ╚════╧════╧════╧════════════╧══════════════════╝


        В  меню  установки  режимов  выводится  информация об активности
(включено - 'ДА', выключено  - 'НЕТ') режимов выявления  соответствующих
"подозрительных" операций и производится их переустановка (клавиши ENTER
или RETURN).

        Отключить или включить режимы  можно повторным запуском -D.  При
этом монитор находит в памяти компьютера свою ранее загруженную копию  и
передает ей аргументы, указанные в командной строке:

        C:>-D  [список аргументов]

        Допустимые аргументы:     +n    - включить режим n=1,...,7;
                                  -n    - выключить режим n=1,...,7;
                                  /E    - диалог на английском языке;
                                  /R    - диалог на русском языке.

        Например, при запуске монитора строкой

        C:>-D  -1  +2  +3  -4  +5  +6  +7  /E

будут включены все режимы, кроме первого и четвертого (изменение  файлов
и форматирование дисков), язык диалога - английский.


       "Подозрительные" ситуации и список сообщений монитора -D
       ═════════════════════════════════════════════════════════

              Изменение и переименование COM и EXE-файлов
             ─────────────────────────────────────────────

        Эти  сообщения  будут  появляться   при  операциях,  ведущих   к
изменению  COM  или  EXE-файлов  (изменение  имени, открытие для записи,
создание  файла).  Подобные  действия  предпринимаются практически всеми
вирусами (за исключением загрузочных) при инфицировании файлов.

     ┌─────────────────────────┐       ┌─────────────────────────┐
     │  program_name           │       │  program_name           │
     │  ОТКРЫВАЕТ (FCB)        │       │  ОТКРЫВАЕТ для ЗАПИСИ   │
     │  file_name              │       │  file_name              │
     ├─────────────────────────┤       ├─────────────────────────┤
     │  program_name           │       │  program_name           │
     │  СОЗДАЕТ (FCB)          │       │  СОЗДАЕТ                │
     │  file_name              │       │  file_name              │
     ├─────────────────────────┤       ├─────────────────────────┤
     │  program_name           │       │  program_name           │
     │  ПЕРЕИМЕНОВЫВАЕТ (FCB)  │       │  ПЕРЕИМЕНОВЫВАЕТ        │
     │  file_name              │       │  file_name              │
     └─────────────────────────┘       └─────────────────────────┘


                            Контроль памяти
                           ─────────────────

        Многие  вирусы  оставляют  в  памяти компьютера свою резидентную
часть, некоторые  из них  используют для  этого прерывания  DOS.  В этом
случае будет выдано сообщение о попытке программы остаться резидентно  в
памяти.
              ┌────────────────────────────────────────┐
              │  program_name                          │
              │  остается РЕЗИДЕНТНО                   │
              └────────────────────────────────────────┘

        Большинство вирусов размещают  свою резидентную часть  в области
программ,  уменьшая  при  этом  количество  свободной  памяти.   Монитор
перехватывает такие ситуации и выдает сообщение:

              ┌────────────────────────────────────────┐
              │  Свободная память уменьшилась на xxx K │
              └────────────────────────────────────────┘

        При включенном режиме "Контроль памяти" монитор  восстанавливает
таблицу векторов прерываний после окончания работы каждой программы. Это
блокирует распространение большинства  резидентных вирусов, а  некоторые
вирусы оказываются просто уничтоженными.


      Запись на диск по абсолютному адресу и форматирование диска
     ─────────────────────────────────────────────────────────────

                   ┌───────────────────────────────┐
                   │ program_name                  │
                   │ ЗАПИСЫВАЕТ (int xx) на диск X:│
                   ├───────────────────────────────┤
                   │ program_name                  │
                   │ ФОРМАТИРУЕТ (int xx) диск X:  │
                   └───────────────────────────────┘

        Данные   сообщения   сигнализируют   о   том,   что    программа
"program_name" пытается  записать на  диск один  или несколько секторов,
используя  абсолютную  адресацию  секторов  на диске или отформатировать
один  или  несколько  секторов  на  диске.   Эти  функции практически не
используются обычными программами (за исключением утилит форматирования,
оптимизации  и  восстановления  диска),  зато  используются   некоторыми
вирусами. Использование прерываний 13h, 40h, 26h является одним из самых
эффективных  способов  уничтожения  информации  на  диске,  в частности,
таблиц Disk Partition Table и File Allocation Table.

Внимание!  При сообщении о записи или форматировании секторов на диске с
           использованием  прерываний  13h   и  40h  указывается   номер
           физического  диска  ('A:'  -  первый,  'B:' - второй и т.д.).
           Если винчестер  разбит на  несколько логических  дисков, то в
           сообщении  указывается  номер  ФИЗИЧЕСКОГО  диска: 'C:', если
           идет обращение к первому винчестеру, 'D:' - если ко  второму.
           Для того,  чтобы выяснить,  на какой  ЛОГИЧЕСКИЙ диск ведется
           запись, необходимо  проанализировать таблицы  разбиения диска
           (Disk Partition Table) на всех логических дисках.


                      Вызов "опасных" функций DOS
                     ─────────────────────────────

                  ┌─────────────────────────────────┐
                  │ program_name                    │
                  │ Опасный вызов DOS (int xx,f.xx) │
                  └─────────────────────────────────┘

        Подобные сообщения   сигнализируют о   том, что   идет "опасное"
обращение  к  DOS,  не  свойственное  прикладным  программам.  "Опасные"
функции DOS часто используются вирусами при размножении.


                        Профессиональный режим
                       ────────────────────────

        При включенном режиме "Профессионал" сообщения монитора будут
сопровождаться списком состояний всех регистров.

┌─────────────────────────────────┬───────────────────────────────────┐
│ program_name                    │ CS:IP=xxxx:xxxx  AX=xxxx  CX=xxxx │
│ Опасный вызов DOS (int xx,f.xx) │ SS:SP=xxxx:xxxx  BX=xxxx  DX=xxxx │
│                                 │ DS:SI=xxxx:xxxx      BP=xxxx      │
│ Разрешить:  [ ДА ]  [ НЕТ ]     │ ES:DI=xxxx:xxxx      Flags=xxxx   │
└─────────────────────────────────┴───────────────────────────────────┘


                             Карта памяти
                            ══════════════

        Карта памяти состоит из пяти колонок:

первая    - сегментный адрес блока распределения памяти (MCB);
вторая    - сегментный адрес префикса программного сегмента (PSP);
третья    - размер блока в параграфах (16 байт) или килобайтах;
четвертая - имя программы, занимающей блок памяти, или знак '?'
            если имя не определено;
пятая     - используемые векторы прерываний.

        Указывается также:

Количество свободной памяти    ────────────────────────────┐
Количество оперативной памяти, указываемое BIOS  ──────┐   │
Количество оперативной памяти ─────────────────────┐   │   │
                                                   │   │   │
Несовпадение значений полного размера памяти       │   │   │
("Всего") и размера, указываемого BIOS ("Указано"),│   │   │
часто служит сигналом о наличии вируса в системе.  │   │   │
Но следует учитывать, что в некоторых случаях      │   │   │
это несовпадение вполне законно.                   │   │   │
                                                   │   │   │
╦═══════════════════╦══════════════════════════════│═══│═══│═══╦
║Изменение файлов ДА║Всего/Указано/Свободно       640/639/486 K║
║Переименование   ДА║────┬────┬────┬─────────┬─────────────────║
║Контроль памяти  ДА║MCB │PSP │ $$ │Программа│ Прерывания      ║
║Форматирование   ДА║────┼────┼────┼─────────┼─────────────────║
║Прямая запись    ДА║09C3│0008│7,4K│DRIVERS  │15 19            ║
║Опасные вызовы   ДА║0D16│0D17│3,2K│COMMAND. │22 24 2E         ║
║Профессионал    НЕТ║0DEA│0E00│,04K│-D.COM   │                 ║
║English     Alt-F10║0DEE│0D17│,25K│COMMAND. │                 ║
║Удаление  -D       ║0DFF│0E00│ 23K│-D.COM   │09 10 13 1B 1C 23║
╚═══════════════════╣    │    │    │         │26 28 2F 40 EC F1║
                    ║    │    │    │         │FF               ║
                    ║13C0│13C6│ 64K│SS.COM   │00 05 ED EF FB   ║
                    ║23C6│23CC│,06K│    ?    │           ──┐   ║
                    ║23CB│0D17│486K│COMMAND. │30 F3 F8 FE  │   ║
                    ║9D58│0000│3,6K│    ?    │21 27    ───┐│   ║
                    ║9E41│0000│7,0K│    ?    │         ──┐││   ║
                    ╚════╧════╧════╧═════════╧═════════  │││  ═╝
                                                         │││
                        Вирус 'Den-Zuk' (загрузочный)  ──┘││
                        Вирус 'Eddie' (файловый)       ───┘│
                        Вирус '1701'  (файловый)       ────┘


════════════════════════════════════════════════════════════════════════
