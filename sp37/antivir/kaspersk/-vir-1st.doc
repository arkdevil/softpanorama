
                    Евгений Валентинович Касперский
                    ───────────────────────────────

              Компьютерные вирусы и методы борьбы с ними
              ══════════════════════════════════════════



                                Мы и обернуться не успеем, а уже навалят
                                больше прежнего...

                                   А. и Б. Стругацкие  "Град обреченный"

                                Стоит мне что-нибудь проглотить, как тут
                                же  происходит  что-нибудь   интересное.
                                Посмотрим, что будет на этот раз!

                                   Льюис Керрол "Алиса в стране чудес"


           Компьютерные вирусы.  Предварительные соображения
           ═════════════════════════════════════════════════

           По поводу термина
           ─────────────────
        Первые исследования саморазмножающихся искусственных конструкций
проводились в середине нынешнего столетия. В работах фон Неймана, Винера
и  др.  дано  определение  и  проведен  математический  анализ  конечных
автоматов,  в  том  числе  и самовоспроизводящихся. Термин "компьютерный
вирус"  появился  позднее  -  официально  считается,  что  его   впервые
употребил сотрудник Лехайского  университета (США) Ф.Коэн  в 1984 г.  на
7-й конференции по безопасности информации, проходившей в США. С тех пор
прошло немало времени, острота проблемы вирусов нисколько не  снизилась,
однако строгого определения, что же  такое компьютерный вирус, так и  не
дано, несмотря на то, что попытки дать такое определение предпринимались
неоднократно.   Поэтому я  наберусь смелости  и попытаюсь сформулировать
собственное определение.

        КОМПЬЮТЕРНЫМ  ВИРУСОМ   называется  программа,   которая   может
создавать свои копии (не обязательно полностью совпадающие с оригиналом)
и внедрять их в файлы, системные области компьютера, вычислительные сети
и т.д. При этом копии сохраняют способность дальнейшего распространения.
Следует отметить, что операционная система удовлетворяет определению, но
вирусом не является.

           По поводу самих вирусов и их авторов
           ────────────────────────────────────
        Сам я не написал  ни одного вируса, не  знаком ни с одним  из их
авторов, и, следовательно,  мои соображения по  этому поводу могут  быть
лишь чисто теоретическими.

        Так кто же пишет вирусы?  На мой взгляд, основную массу  вирусов
создают  люди,  которые  только  что  изучили  язык  ассемблера,   хотят
попробовать  свои  силы,  но  не  могут  найти  для них более достойного
применения.  Из  под  пера   подобных  "умельцев"  часто  выходят   либо
модификации "классических"  вирусов,  либо  вирусы  крайне   примитивные
и с большим числом ошибок (такие вирусы я называю "студенческими").

        Самую опасную группу  составляют "профессиональные" вирусы.  Эти
очень   тщательно   продуманные   и   отлаженные   программы   создаются
профессиональными, часто очень талантливыми, программистами.Такие вирусы
часто используют достаточно оригинальные алгоритмы,  недокументированные
и мало кому известные способы проникновения в системные области  данных.
Часто "профессиональные"  вирусы выполнены  по технологии  "стелс".  Для
меня  остаются  загадкой  причины,  которые  могут  заставить   человека
направить свои немалые способности на такую бессмысленную работу.

           Умрет ли MS-DOS от вирусной болезни?
           ────────────────────────────────────
        В большинстве стран эта проблема не является столь острой как  в
Советском Союзе,так как там в значительно меньшей степени распространено
пиратское копирование  программного обеспечения;  гораздо более  активно
действуют  фирмы,   специализирующиеся  на   производстве   антивирусной
продукции; много разнообразной литературы, посвященной данному  вопросу.
В результате большинство  пользователей знают, что  такое вирус и  какие
могут быть последствия его "визита", готовы к борьбе с ним, но  "живьем"
ни одного вируса не видели уже очень давно.

        В  нашей  стране  все  обстоит  гораздо более серьезно. Основным
источником приобретения  новых программных  продуктов у  нас является их
бесконтрольное   копирование;   очень   часто   персональные  компьютеры
используются в "многоперсональном"  режиме.  Для  распространения вируса
это  самая  благодатная  среда.   В  результате  в учебных институтах, в
организациях факт заражения вирусом вполне обычное явление, что-то вроде
насморка. Это может кончиться плачевно при заражении каким-либо  опасным
вирусом. Хотя, если на компьютере нет ничего, кроме DOS и большого числа
игр, то вируса можно не бояться - невелика потеря.

        Следует  отметить  быстрый   рост  числа  компьютерных   вирусов
советского производства (по моим данным, их общее число на 1989г - 1, на
1990 г.: август - 3 или 4, сентябрь - около 6, октябрь - около 15,ноябрь
- около 20 и т.д.).  Это естественно, когда есть возможность  заниматься
на работе  чем угодно,  а ничем  полезным или  прибыльным заниматься  не
хочется  или  нет  возможности,  то  от  нечего делать можно попробовать
запрограммировать  вирус  (тем  более,  что  это  пока  не  преследуется
уголовно). К тому же  программирование все больше и  больше превращается
из  искусства  в  ремесло,  а  среди  программистов все реже встречаются
"интеллектуалы"  и  все  чаще  ремесленники-"таперы",  что  не  может не
сказаться на "индексе порядочности" среди представителей этой профессии.
В результате компьютерное хулиганство процветает.


        ───────────────────────────────────────────────────────────────

        В разделах 1 -  3 приведены классификация компьютерных  вирусов,
их  структура  и  способы  распространения,  изложены  алгоритмы  работы
имеющихся  в  моей  коллекции  вирусов.  В  разделе  4   рассматриваются
действия,   рекомендуемые   пользователю   компьютера   при    заражении
компьютера  вирусом.  Этот  раздел  предназначен  в  первую  очередь для
системных  программистов,  которым  приходится  сталкиваться со случаями
заражения компьютера вирусом.   В разделе 5 содержится  описание утилит,
входящих в состав комплекса  "-V", и руководство пользователю  по работе
с ними.

        Разделы,  посвященные  описаниям  компьютерных  вирусов, впервые
опубликованы в журнале "Компьютер Пресс", N 5-7, 1991 г., часть  раздела
"Методы борьбы с вирусами" опубликована в журнале "Интеркомпьютер", N 6,
1990 г.

        Заранее благодарю всех, кто пришлет свои замечания,  предложения
или сообщит об обнаруженных в тексте неточностях. Мой адрес

        ┌────────────────────────────────────────────────┐
        │ 109028  Москва, Тессинский переулок., дом 6/19 │
        │         Акционерное Общество "КАМИ"            │
        │         Научно-производственный отдел          │
        │         телефон (8-095) 499-15-00              │
        └────────────────────────────────────────────────┘



                 1. Классификация компьютерных вирусов
                 ═════════════════════════════════════

        Вирусы можно разделить на классы по следующим признакам:
                - по среде обитания вируса;
                - по способу заражения среды обитания;
                - по деструктивным возможностям;
                - по особенностям алгоритма вируса.


        По СРЕДЕ ОБИТАНИЯ вирусы можно разделить на сетевые, файловые  и
загрузочные.   Сетевые  вирусы  распространяются  по  компьютерной сети,
файловые внедряются  в выполняемые  файлы, загрузочные  - в  загрузочный
сектор диска (Boot-сектор) или в сектор, содержащий системный  загрузчик
винчестера  (Master  Boot  Record).  Существуют  сочетания  -  например,
файлово-загрузочные  вирусы,  заражающие  и  файлы и загрузочные секторы
дисков.


        СПОСОБЫ  ЗАРАЖЕНИЯ  делятся  на  резидентный  и   нерезидентный.
Резидентный вирус при  инфицировании компьютера оставляет  в оперативной
памяти  свою  резидентную  часть,  которая затем перехватывает обращение
операционной  системы  к   объектам  заражения  и   внедряется  в   них.
Резидентные вирусы  находятся в  памяти и  являются активными  вплоть до
выключения или перезагрузки компьютера. Нерезидентные вирусы не заражают
память  компьютера  и  являются  активными ограниченное время. Некоторые
вирусы оставляют в  оперативной памяти небольшие  резидентные программы,
которые не распространяют вирус. Такие вирусы считаются нерезидентными.


      По ДЕСТРУКТИВНЫМ ВОЗМОЖНОСТЯМ вирусы можно разделить на:

        а) безвредные,  т.е.  никак  не  влияющие  на работу  компьютера
           (кроме  уменьшения  свободной  памяти  на  диске в результате
           своего распространения);

        б) неопасные,   влияние   которых   ограничивается   уменьшением
           свободной памяти  на диске  и графическими,  звуковыми и  пр.
           эффектами;

        в) опасные вирусы,  которые могут привести  к серьезным сбоям  в
           работе компьютера;

        г) очень  опасные,  которые  могут  привести к потере  программ,
           уничтожить данные, стереть необходимую для работы  компьютера
           информацию, записанную  в системных  областях памяти,  и даже
           способствовать быстрому  износу движущихся  частей механизмов
           (например, головок винчестера).


      По ОСОБЕННОСТЯМ АЛГОРИТМА можно выделить следующие группы вирусов:

        а) "студенческие" - крайне примитивные вирусы, часто  содержащие
            много ошибок;

        б) "стелс"  -  вирусы-невидимки,  представляющие   собой  весьма
           совершенные программы, которые перехватывают обращения DOS  к
           пораженным файлам или секторам дисков и "подставляют"  вместо
           себя незараженные участки информации.Кроме этого такие вирусы
           при  обращении  к  файлам  используют достаточно оригинальные
           алгоритмы, позволяющие "обманывать" резидентные  антивирусные
           мониторы. Один из первых "стелс"-вирусов - вирус "V-4096";

        в) вирусы-"призраки" -  достаточно труднообнаружимые вирусы,  не
           имеющие сигнатур,  т.е. не  содержащие ни  одного постоянного
           участка кода. В большинстве случаев два образца одного и того
           же вируса-"призрака" не будут иметь ни одного совпадения. Это
           достигается шифрованием основного тела вируса и модификациями
           программы-расшифровщика.

        Некоторые вирусы (например, вирусы семейства "Eddie",  "Murphy")
используют  часть  функций  полноценного  "стелс"-вируса. Чаще всего они
перехватывают функции DOS FindFirst  и FindNext (int 21h,ah=11h,  12h) и
"уменьшают" длины зараженных  файлов. Такой вирус  невозможно определить
по  изменению  длин  файлов,  если,  конечно,  он резидентно находится в
памяти. Программы, которые не используют указанные функции DOS (например,
"Нортоновские  утилиты"),  а  напрямую  используют  содержимое секторов,
хранящих каталог, показывают правильную длину зараженных файлов.

        К особенностям  алгоритма вируса  можно отнести  и скорость  его
распространения.  Скорость распространения файловых вирусов,  заражающих
файлы только  при их  запуске на  выполнение, будет  ниже, чем у вирусов
заражающих файлы и при их открытии, переименовании, изменении  атрибутов
файла и  т.д. Некоторые  вирусы ("Eddie",  "Murphy") при  создании своей
копии в оперативной памяти  компьютера пытаются занять область  памяти с
самыми   старшими  адресами, разрушая    временную   часть    командного
интерпретатора COMMAND.COM.   По окончании  работы зараженной  программы
временная часть  интерпретатора восстанавливается,  при этом  происходит
открытие  файла  COMMAND.COM  и,  если  вирус  заражает  файлы  при   их
открытии, его заражение.   Таким образом, при  запуске подобного  вируса
первым будет заражен файл COMMAND.COM.



      2. Способы распространения и структура компьютерных вирусов
      ═══════════════════════════════════════════════════════════

                         2.1. Файловые вирусы
                         ════════════════════

        Вирус  может  внедриться  в  файлы  трех типов - командные файлы
(BAT), загружаемые  драйверы (SYS,  в том  числе IO.SYS  и MSDOS.SYS)  и
выполняемые двоичные файлы (EXE, COM). Возможно внедрение вируса в файлы
данных, но эти  случаи возникают либо  в результате ошибки  вируса, либо
при  проявлении  вирусом  своих  агрессивных  свойств. Конечно, возможно
существование  вирусов,  заражающих  файлы,  содержащие  исходные тексты
программ,  библиотечные  или  объектные  модули,  но  подобные   способы
распространения   вируса   слишком   экзотичны   и   в   дальнейшем   не
рассматриваются.

        На  сегодняшний  день  мне  известны  два  BAT-вируса.   Они  не
представляют  интереса,  так  как  достаточно  примитивны,  очень просто
обнаруживаются и удаляются.

        Вирусы, внедряющиеся  в SYS-файл,  приписывают свои  коды к телу
файла  и  модифицируют   его  заголовок  так,   что  DOS   рассматривает
инфицированный файл  как цепочку  из двух  (или более)  драйверов. Такой
вирус может  быть чрезвычайно  опасным и  живучим, так  как внедряется в
оперативную память при загрузке DOS раньше любой антивирусной программы,
если она, конечно, тоже не является драйвером.

        Незараженный            Зараженный
        файл драйвера           файл драйвера

        ┌─────────┐             ┌─────────┐
        │Заголовок│             │Заголовок│
        ├─────────┤             ├─────────┤
        │ Драйвер │     ──>     │ Драйвер │
        │         │             │         │
        │         │             │         │
        └─────────┘             ├─────────┤
                                │Заголовок│
                                ├─────────┤
                                │ Вирус   │
                                │         │
                                └─────────┘

        Аналогично вирус может записать свои коды в начало драйвера, а
если в файле содержится несколько драйверов, то и в середину файла.


        Выполняемые  двоичные   файлы  имеют   форматы  COM   или   EXE,
отличающиеся  заголовком  и  способом  запуска  программ  на выполнение.
Расширение  имени  файла  (".COM"  или  ".EXE")  не всегда соответствует
действительному формату файла,  что, правда, никак  не влияет на  работу
программы. Файлы  COM и  EXE заражаются  по-разному, следовательно вирус
должен отличать файлы одного формата от другого.Вирусы решают эту задачу
двумя  способами:   одни  анализируют  расширение  имени  файла (".COM",
".EXE"), другие - заголовок файла.  Первый способ далее будет называться
заражением .COM- (или .EXE-) файлов, второй - заражением COM- (или EXE-)
файлов. В большинстве случаев  вирус инфицирует файл корректно,  т.е. по
информации,  содержащейся  в  теле  вируса, можно полностью восстановить
зараженный файл.  Но вирусы, как и большинство программ, часто  содержат
незаметные с первого взгляда ошибки.  Из-за этого даже вполне  корректно
написанный  вирус  может  необратимо  испортить  файл при его заражении.
Например, вирусы,  различающие типы  файлов по  расширению имени  (.COM,
.EXE) очень опасны, так как портят файлы, у которых расширение имени  не
соответствует внутреннему формату.

        Файловые   вирусы   при   распространении   внедряются   в  тело
заражаемого файла: в его начало, конец или середину.Существует несколько
возможностей внедрения вируса в середину файла: он может быть скопирован
в таблицу настройки адресов,в область стека, может "раздвинуть" файл или
переписать часть файла в его конец, а свои коды в освободившееся  место,
и т.д. Кроме того, копирование вируса в середину файла может произойти в
результате ошибки  вируса -  в этом  случае файл  может быть  необратимо
испорчен. Встречаются и другие способы внедрения вируса в середину файла,
например, у вируса "Mutant".

        Известны три  способа внедрения  вируса в  начало файла.  Первый
способ заключается в том,что вирус переписывает начало заражаемого файла
в его  конец, а  сам копируется  в освободившееся  место. При  заражении
файла вторым  способом вирус  создает в  оперативной памяти  свою копию,
дописывает к ней заражаемый файл и сохраняет полученную конкатенацию  на
диск. При заражении третьим способом вирус записывает свои коды в начало 
файла не сохраняя старое  содержимое начала файла. Естественно,  что при
этом файл перестает работать и не восстанавливается.

             ┌────────┐       ┌ ─ ─ ─ ─┐       ┌────────┐
             │Файл    │───┐    Свободно        │Вирус   │
             │--------│   │   ├────────┤       ├────────┤
             │        │   │   │Файл    │       │Файл    │
             │        │   │   │        │       │        │
             └────────┘   │   │--------│       │--------│
                          └──>│        │       │        │
                              └────────┘       └────────┘
            Внедрение вируса в начало файла первым способом

             ┌────────┐       ┌ ─ ─ ─ ─┐       ┌────────┐
             │Файл    │───┐    Свободно        │Вирус   │
             │        │   │   ├────────┤       ├────────┤
             │        │   └──>│Файл    │       │Файл    │
             │        │─┐     │        │       │        │
             └────────┘ │     │        │       │        │
                        └────>│        │       │        │
                              └────────┘       └────────┘
            Внедрение вируса в начало файла вторым способом

             ┌────────┐       ┌────────┐
             │Файл    │       │Вирус   │
             │--------│       ├────────┤
             │        │       │Файл    │
             │        │       │        │
             └────────┘       └────────┘
            Внедрение вируса в начало файла третьим способом


        Наиболее  распространенным  способом  внедрения  вируса  в  файл
является дописывание вируса в конец этого файла. При этом вирус изменяет
начало файла таким образом, что первыми выполняемыми командами программы,
содержащейся в файле, являются команды вируса. В COM-файле в большинстве
случаев это достигается изменением его первых трех (или более) байтов на
коды инструкции JMP Loc_Virus (передача управления на тело вируса). EXE-
файл либо переводится в формат COM-файла и затем заражается как COM-файл,
либо модифицируется  заголовок файла.  В заголовке  EXE-файла изменяются
значение стартового адреса (CS:IP) и значение длины выполняемого  модуля
(файла), реже  - регистры-указатели  на стек  (SS:SP), контрольная сумма
файла и т.д. Дополнительно к  этому длины файлов перед заражением  могут
увеличиваться до значения, кратного параграфу (16 байт).

             COM-файл                   EXE-файл
           ┌────┬────┐                 ┌─────────┐
        ┌──│JMP │    │            ┌────│Заголовок│
        │  ├────┘    │            │    ├─────────┤
        │  │Программа│            │    │Программа│
        │  │         │            │    │         │
        │  ├─────────┤            V    │         │
        │  │Вирус    │       Стартовый ├─────────┤
        └─>│         │       адрес     │Вирус    │
           │         │       ─────────>│         │
           └─────────┘                 │         │
                                       └─────────┘
                    Внедрение вируса в конец файла

        СТАНДАРТНЫМ  СПОСОБОМ  ЗАРАЖЕНИЯ  далее  будет  называться такой
способ, при котором вирус дописывается  в конец файла и изменяет  у COM-
файла первые несколько байтов (JMP Loc_Virus), у EXE-файла - заголовок.


        Вирус,  после  передачи  ему  управления,  совершает   следующие
действия  (приведен  список  наиболее  общих  действий  вируса  при  его
выполнении; для  конкретного вируса  список может  быть дополнен, пункты
могут поменяться местами и значительно расшириться) :

        а) восстанавливает  программу (но  не файл)  в исходном  виде (у
           COM-программы   восстанавливаются   первые    3   байта,    у
           EXE-программы вычисляется истинный стартовый адрес);
        б) если вирус резидентный, то он проверяет оперативную память на
           наличие  своей  копии  и  инфицирует  память компьютера, если
           копия вируса не найдена;
           если  вирус нерезидентный,  то он  ищет незараженные  файлы в
           текущем  и   (или)  корневом   оглавлении,  в    оглавлениях,
           отмеченных   командой   PATH   и   т.д.,   а  затем  заражает
           обнаруженные файлы;
        в) выполняет,   если   они   есть,   дополнительные    функции :
           деструктивные действия,  графические или  звуковые эффекты  и
           т.д.  (дополнительные  функции   резидентного  вируса   могут
           вызываться  спустя  некоторое   время  после  активизации   в
           зависимости  от  текущего   времени,  конфигурации   системы,
           внутренних счетчиков вируса или других условий, в этом случае
           вирус при активизации обрабатывает состояние системных часов,
           устанавливает свои счетчики и т.д.);
        г) возвращает управление основной программе.

        Действия а)-г) далее будут упоминаться как СТАНДАРТНЫЕ.

        При  восстановлении  программы   в  первоначальном  виде   вирус
использует  информацию  о  программе,  сохраненную  в  теле  вируса  при
заражении файла. Это  может быть длина  файла, первые три  байта файла в
случае COM-файла или несколько байтов заголовка в случае EXE-файла.

        DOS  предусматривает  единственный  способ  создания резидентных
(TSR) модулей (помимо драйверов, указываемых в CONFIG.SYS) - при  помощи
функции KEEP (int  21h, ah=31 или  int 27h). Многие  файловые вирусы для
маскировки своего распространения используют другой способ - обрабатывая
системные области, управляющие распределением памяти (MCB), выделяют для
себя свободный участок памяти,  помечают его как занятый  и переписывают
туда свою копию.  Некоторые вирусы внедряют  свои TSR-копии в  свободные
участки памяти в таблице векторов  прерываний, в рабочие области DOS,  в
память, отведенную под системные буферы.

        Известны два способа проверки резидентным вирусом наличия  своей
копии в памяти компьютера.   Первый заключается в том, что  вирус вводит
новую  функцию  некоторого  прерывания,  действие  которой заключается в
возврате значения "я здесь". При  старте вирус обращается к ней  и, если
возвращенное  значение  совпадает  со  значением  "я  здесь",  то память
компьютера  уже  заражена  и  повторное  заражение  не производится. При
проверке вторым способом вирус просто сканирует память компьютера.   Оба
способа  могут  в  той  или  иной  мере  сочетаться  друг  с другом. При
инфицировании оперативной памяти  вирус ищет свободное  место в памяти и
записывает  туда  свою  копию.   Затем  вирус  переопределяет  одно  или
несколько прерываний, необходимых ему для поиска заражаемых файлов,  для
выполнения деструктивных действий или звуковых и видеоэффектов.

        При инфицировании файлов  нерезидентные и некоторые  резидентные
вирусы ищут на диске (дисках) эти файлы при помощи функций DOS FindFirst
и FindNext (int 21h, ah=11h,12h,4Eh,4Fh). Резидентные вирусы  используют
более широкий  список функций  DOS, при  обращении к  которым происходит
заражение файла. Фактически в  этом списке присутствуют все  функции, по
значениям  входных  параметров  которых  можно  определить  имя файла, к
которому  идет   обращение  (к   таким  параметрам   относятся  значения
соответствующих  регистров   или  областей   памяти).  В   результате  к
"вирусоопасным"  функциям  прерывания  21h  относятся функции выполнения
(EXEC, ax=4B00), загрузки в память (ah=4Bh), создания (Create,  ah=3Ch),
открытия (Open, ah=3Dh),  закрытия (Close, ah=3Eh),  изменения атрибутов
(ChMode,  ah=43h),  переименования  (Rename,  ah=56h) и некоторые другие
функции работы с файлами.

        При инфицировании  файла вирус  может производить  ряд действий,
маскирующих и ускоряющих его распространение. К подобным действиям можно
отнести  обработку  атрибута  read-only,  снятие  его перед заражением и
восстановление после.  Многие файловые  вирусы считывают  дату последней
модификации файла и восстанавливают  ее после заражения. Для  маскировки
своего распространения  некоторые вирусы  перехватывают прерывание  DOS,
возникающее при  обращении к  защищенному от  записи диску  (int 24h), и
самостоятельно обрабатывают его.


                        2.2. Загрузочные вирусы
                        ═══════════════════════

        Загрузочные вирусы  заражают загрузочный  (Boot) сектор  флоппи-
диска  и  Boot-сектор  или  Master  Boot  Record  (MBR)  винчестера. При
инфицировании диска вирус  переносит оригинальный Boot-сектор  (или MBR)
в  какой-либо  другой  сектор  диска  (например,  в  первый свободный) и
копирует себя в загрузочный сектор (или в MBR). Если длина вируса больше
длины сектора, то  в заражаемый сектор  помещается первая часть  вируса,
остальные  части  размещаются  в  других  секторах  (например,  в первых
свободных).   Если  продолжение  вируса  размещается  в первых свободных
секторах диска,  то они,  как правило,  помечаются как  сбойные (точнее,
секторы образуют кластер или кластеры, которые и помечаются как сбойные,
так называемые псевдосбойные кластеры).

                                                Незараженный диск
        Номер сектора:
            0     1     2      . . .
        ┌─────┬─────┬─────┬───   ──┬─────┬─────┬─────┬─────┬─────┬───
        │░░░░░│     │     │        │     │     │     │     │     │
        └─────┴─────┴─────┴───   ──┴─────┴─────┴─────┴─────┴─────┴───
           │
           └──  Boot-сектор  или  Master Boot Record

                                                Зараженный диск
            0     1     2      . . .
        ┌─────┬─────┬─────┬───   ──┬─────┬─────┬─────┬─────┬─────┬───
        │▓▓▓▓▓│     │     │        │     │░░░░░│▓▓▓▓▓│▓▓▓▓▓│▓▓▓▓▓│
        └─────┴─────┴─────┴───   ──┴─────┴─────┴─────┴─────┴─────┴───
           │                                │     │     │ ... │
           └──  Начало вируса               │ ┌───┴─────┴─────┘
                                            │ └──  Продолжение вируса
                                            │
                                            └── Сохраненный Boot-сектор
                                                или Master Boot Record

        СТАНДАРТНЫМ  СПОСОБОМ  далее   будет  называться  такой   способ
РАЗМЕЩЕНИЯ загрузочного вируса на диске, при котором продолжение  вируса
размещается в последовательных секторах диска, образующих  псевдосбойные
кластеры.

        Конечно, существуют и другие методы размещения вируса на  диске,
например,  в  свободные  секторы  между  MBR  и  первым Boot-сектором, в
последние  секторы  диска,  некоторые  вирусы  форматируют для этой цели
дополнительные треки флоппи-диска.

        Известные  мне  загрузочные   вирусы  всегда  резидентны.    Они
внедряются в память компьютера при загрузке с инфицированного диска. При
этом системный загрузчик считывает  содержимое первого сектора диска,  с
которого производится загрузка, помещает считанную информацию в память и
передает  на  нее  (т.е.  на  вирус)  управление.  После  этого начинают
выполняться инструкции вируса, который :

        а) уменьшает объем свободной памяти (слово по адресу 0040:0013);
        б) считывает с диска свое продолжение (если оно есть);
        в) переносит  себя в  другую область  памяти (например,  в самые
           старшие адреса памяти);
        г) устанавливает необходимые векторы прерываний;
        д) совершает, если они есть, дополнительные действия;
        е) копирует в память оригинальный Boot-сектор и передает на него
           управление.

        Действия а)-е) далее будут упоминаться как СТАНДАРТНЫЕ.

        В  дальнейшем  загрузочный  вирус  ведет  себя  так  же,  как  и
резидентный файловый вирус -перехватывает обращения операционной системы
к дискам и инфицирует их,  в зависимости от некоторых условий  совершает
деструктивные действия или вызывает звуковые или видеоэффекты.

