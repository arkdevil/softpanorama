
                                       (C) Д.Макаров, Москва 1991

             BOOTCHK - Diskette BootSector Checker
             _____________________________________

                           Версия 2.0

                            ВВЕДЕНИЕ

     BootChecker - специальная антивирусная программа для  борьбы
с бутовыми  вирусами на дискетах.  Это не обычный вирусный детек-
тор: BootChecker ГАРАНТИРУЕТ чистоту бутсектора дискеты при поло-
жительном результате проверки. Он одинаково успешно ловит как из-
вестные, так и неизвестные бутовые вирусы.  Кроме того, он прове-
ряет корректность  BPB (параметры дискеты) и сообщает об отклоне-
ниях от нормы.
     BootChecker рассчитан на пользователя, не искушенного в сис-
темных тонкостях.  Однако он является лишь диагностирующей  прог-
раммой и предполагает возможность обратиться к квалифицированному
системному программисту (именуемому ниже специалистом) для  уточ-
нения ситуации и устранения обнаруженных ненормальностей. На слу-
чай отсутствия такой возможности BootCheckerом  даются  некоторые
комментарии  и  рекомендации,  дополненные в ч.I настоящего руко-
водства.
     Руководство состоит из двух частей: руководства пользователя
и руководства системного программиста.  Достаточно прочитать одну
из них - ту,  которая больше Вам подходит. Плохо только ничего не
прочитать: BootChecker  - программа весьма специфическая по своим
функциям, и надо понимать,  что она умеет, а что - нет. К тому же
из-за сложностей с кодировками он общается с пользователем по-ан-
глийски (Excuse me my Non-Oxford English...).
     Никакой информации о вирусах,  кроме общепринятых  названий,
BootChecker не  сообщает  и  документация не содержит.  Подробное
описание известных бутовых вирусов предполагается подготовить от-
дельно и включить в комплект поставки будущих версий. Для получе-
ния интересующих Вас сведений рекомендуется обратиться к  извест-
ной книге Н.Н.Безрукова "Компьютерная вирусология".  Там же можно
найти информацию о других антивирусных средствах (BootChecker  не
заменяет их,  но дополняет),  а также об организационных мерах по
защите от вирусов.
     Программа распространяется свободно с обычными для  freeware
ограничениями. Условия распространения программы приведены в кон-
це документации.


                   I. РУКОВОДСТВО ПОЛЬЗОВАТЕЛЯ

                      Назначение программы
                      --------------------
     Программа тестирует бутсектор (начальный сектор) дискеты.  В
начальном секторе любой дискеты (даже не системной) записан бут -
программа-загрузчик DOS,  который может  заражаться  специальными
бутовыми вирусами. При загрузке с зараженной дискеты или жесткого
диска такой вирус закрепляется в памяти и начинает заражать  буты
всех доступных ему дисков - гибких и жестких. Для активизации ви-
руса достаточно при перезагрузке забыть дискету в дисководе A:, а
для заражения дискеты - посмотреть ее каталог. Бутовые вирусы мо-
гут успешно скрывать себя в памяти и на диске, быстро размножают-
ся и часто весьма опасны:  многие из них форматируют или затирают
диски. Уже  само заражение винчестера может иногда привести к ги-
бели информации. Из-за многочисленных разновидностей и постоянно-
го появления новых версий традиционные детекторы нередко запазды-
вают и не могут служить надежной защитой. BootChecker надежен: он
гарантирует  обнаружение любого (даже нового) бутового вируса еще
на дискете - до того, как он внедрился в систему.
     Для использования программы (т.е. обнаружения "нечистых" ди-
скет) не нужно быть специалистом.  Однако  следует  помнить,  что
BootChecker только тестирует дискеты, не принимая никаких мер для
исправления подозрительных ситуаций.  Его задача - поднять трево-
гу. Тревога может быть ложной:  нестандартная дискета - не обяза-
тельно дефект,  а незнакомый бут - не обязательно вирус. В случае
тревоги необходимо обратиться к специалисту для уточнения причин,
исправления дискеты и других действий. BootChecker дает некоторые
рекомендации (см. описание сообщений),  но им нужно следовать ос-
торожно.
     Тестирование дискет должно проводиться на чистом  (от  виру-
сов) компьютере. При неизвестном вирусе в памяти никакие гарантии
невозможны: многие вирусы умеют, когда активны, скрывать свое на-
личие на диске.  BootChecker после запуска проверяет память и об-
наруживает там любой бутовый вирус,  закрепившийся обычным спосо-
бом, но НЕ обезвреживает его.  Все известные мне бутовые (и неко-
торые файловые) вирусы используют этот способ закрепления и обна-
руживаются BootCheckerом, однако изобретательность техно-крыс не-
истощима...
     Помните: BootChecker - не панацея,  а полезное дополнение  к
обычным средствам защиты. Он не дублирует работу существующих ан-
тивирусных и инструментальных средств.  Он  НЕ  предназначен  для
тестирования  жестких дисков:  для этого есть программы-ревизоры.
Он НЕ ловит никаких файловых вирусов (даже на дискетах): для это-
го есть многочисленные детекторы и сторожа.  Он НЕ лечит заражен-
ные дискеты: для этого есть антивирусы-фаги (рекомендуется детек-
тор-фаг AIDSTEST Д.Н.Лозинского). Однако все эти программы не да-
ют гарантии чистоты незнакомого носителя от неизвестного  вируса;
BootChecker такую гарантию дает,  но лишь для одного типа вирусов
- бутовых, заражающих не файлы, а boot-секторы дискет.

                       Описание программы
                       ------------------
     Принцип работы программы основан на поиске в бутсекторе пра-
вильного бута.  Бут записывается на дискету при ее форматировании
программой-форматтером. Разные форматтеры записывают разные буты.
Однако число разных форматтеров (и,  следовательно, разных бутов)
не так уж велико и сопоставимо с количеством вирусов.
     Именно наличие правильного бута и проверяет BootChecker.  Он
имеет специальную библиотеку,  состоящую из двух частей :  одна с
правильными бутами, другая с бутовыми вирусами. BootChecker чита-
ет бутсектор дискеты и ищет его в своей библиотеке.  Если бутсек-
тор обнаружен среди правильных бутов,  выдается сообщение об  от-
сутствии вируса. Ошибка при идентификации бута практически исклю-
чена,  так что этому сообщению можно верить.  Именно оно является
нормальным и гарантирует чистоту дискеты.
     Если прочитанного бутсектора среди правильных бутов нет,  он
проверяется на наличие известных вирусов.  Некоторые вирусы иден-
тифицируются точно,  другие традиционно - с помощью  сигнатур.  К
сожалению,  многие вирусы (и их сигнатуры) известны мне только по
литературе.  Эти сигнатуры не всегда подобраны удачно, поэтому не
исключены случайные совпадения, и сообщения об экзотических виру-
сах могут быть ложной тревогой (что,  впрочем, маловероятно). На-
конец, если бутсектор вообще не найден в библиотеке, выдается со-
общение о неизвестном буте.
     Независимо от результатов поиска бута,  BootChecker анализи-
рует BPB (записанные в бутсекторе параметры дискеты) и сообщает о
результатах анализа.  При  анализе проверяются соответствие пара-
метров стандартам DOS,  а для нестандартных дискет  -  разумность
значений параметров.  Кроме  того,  проверяется соответствие этих
параметров байту FAT ID - описателю типа дискеты,  хранящемуся  в
начале FAT (таблицы распределения дискового пространства).

                       Работа с программой
                       -------------------
     Основной ошибкой при использовании антивирусных программ яв-
ляется работа с ними на зараженном компьютере (т.е.  при активном
вирусе в  памяти).  Некоторые  программы-фаги умеют обезвреживать
вирус в памяти,  но не надо на это полагаться - многие  вирусы  в
памяти умеют  обезвреживать  фагов...  Вы  можете запускать Boot-
Checker с жесткого диска, если Вы уверены в отсутствии на нем ви-
русов,  т.е. при наличии надежной программы-ревизора и соблюдении
соответствующих организационных мер,  иначе гарантии от принципи-
ально новой заразы ненадежны.  BootChecker на жестком диске может
использоваться также для периодической проверки памяти на предмет
заразы  традиционного стиля,  посетившей Ваш винчестер.  Для 100%
надежности работайте с BootCheckerом,  как со всеми антивирусными
программами:  создайте  защищенную  от записи системную дискету с
копией BootCheckerа и загружайтесь с нее перед тестированием. Для
перезагрузки  обязательно используйте кнопку "Reset" или выключе-
ние питания,  но только НЕ "Alt-Ctrl-Del"!  Многие бутовые вирусы
(в  отличие  от файловых) умеют сохраняться в памяти при перезаг-
рузке с клавиатуры.
     Для еще  большей  надежности (200%) рекомендуется вакциниро-
вать дискету с BootCheckerом Витамином B.  Это дискетная  вакцина
от бутовых  вирусов,  разработанная А.В.Сессой;  она записывает в
бутсектор дискеты свой загрузчик,  реагирующий на попытки зараже-
ния. После вакцинирования проверьте, осталась ли дискета загружа-
емой - Витамин B плохо относится к нестандартным машинам. Вакцина
поможет предохранить дискету при обновлении библиотеки.
     Не теряйте библиотеки BootCheckerа - файла BOOTCHK.LIB ! Без
нее  он работать не может.  При запуске BootChecker ищет ее в том
каталоге, где находится сам. Переименованную библиотеку он не на-
ходит.
     Для запуска программы в ответ на приглашение DOS наберите:

bootchk

     На экране появится заголовок, затем сообщение о самотестиро-
вании и  проверке памяти:

Checking myself ... OK; memory ... 640 Kb. Complete.

BootChecker проверяет  себя  после  запуска на сохранность кода и
сообщает, если он поврежден:

... My file is damaged! It may be a virus!

Повредить код может не только вирус,  но и  обычная  компьютерная
шпана. В любом случае,  это серьезный повод для беспокойства (не-
известно, что хуже).  Самоконтроль НЕ обнаруживает заражения сов-
ременными stealth-вирусами. Проверьте длину программы - это ровно
27 000 байт - ПЕРЕД первым запуском (иначе активный stealth-вирус
скроет изменение длины).
     После самоконтроля производится проверка памяти. Все сущест-
вующие бутовые  вирусы используют для закрепления в памяти один и
тот же механизм - скрывают для себя кусочек памяти от DOS.  Boot-
Checker обнаруживает этот скрытый кусочек и сообщает:

... Hidden memory 4K detected!
It may be a virus! Continue? (Y/N) [N]

Здесь предусмотрена возможность продолжить работу (при  неудачном
самоконтроле программа завершается без вопросов). Дело в том, что
описанный механизм могут использовать не только вирусы, но и дру-
гие программы,  в т.ч. некоторые резидентные сторожа. Если Вы за-
пускаете BootChecker под такой программой,  узнайте предваритель-
но, сколько памяти она себе отбирает, и сравните с размером обна-
руженного кусочка.  Если кусочек больше,  значит, Ваш друг там не
один...  Если размер кусочка совпадает с ожидаемым,  нажмите Y, и
работа будет продолжена. Так же следует поступать, если часть па-
мяти недоступна DOS по другим причинам (например, из-за отбраков-
ки стартовым тестом).  В любом случае,  лучше устранить известные
причины перед запуском BootCheckerа (и не запускать его под таки-
ми хитрыми  программами);  если  это  невозможно,  размер  hidden
memory должен определить специалист, но проверка памяти будет не-
надежна.
     Если Вы не знаете,  почему появилось такое сообщение  -  это
почти наверняка  вирус!  Немедленно обратитесь к специалисту.  НЕ
продолжайте работу - вирус заразит все просмотренные Вами  диске-
ты, а BootChecker может ничего не заметить.  Действия при обнару-
жении вируса  описаны в последнем разделе руководства пользовате-
ля. Помните также - Ваши детекторы и фаги ничего не найдут,  если
BootChecker поймал новый вирус (что не редкость).
     При нормальном  завершении проверок на экране появится крат-
кая информация  о  программе  и  сообщение о загрузке библиотеки.
После этого дискету с BootCheckerом можно вынуть и убрать - ника-
ких запчастей больше не потребуется.
     Наконец, в  нижней части экрана появится предложение выбрать
устройство для тестирования - A или B:

                    SELECT DRIVE (A or B): [A]

     Нажмите A (или "Ввод") для выбора устройства A:, B - для вы-
бора устройства B:.  Если Вы не хотите продолжать работу, нажмите
Esc для выхода из программы.
     После выбора  устройства  экран очистится и появится обычное
предложение:

Insert your diskette in drive A: and press any key.
(Вставьте Вашу дискету в устройство A: и нажмите любую клавишу.)

Последуйте этому  совету.  BootChecker прочтет бутсектор дискеты,
проанализирует его и выведет на экран сводную таблицу результатов
примерно следующего содержания:

Checking drive A: ... Analysing ... Report:

Bytes 0-2 (Class. code):  EB 34 90
                 OEM ID:  MSDOS3.3

           Bootable  id:  YES
           Hard disk id:  NO

           BPB analysis:  OK. DOS standard DS/DD diskette 360 Kb.
        FAT ID analysis:  OK. FD - standard DOS diskette.

             BOOT FOUND:  MS-DOS 3.30 format

No boot viruses at this BootSector.

     Расшифруем поля этой таблицы:

Bytes 0-2 (Class. code):  Первые три байта бутсектора (сигнатура
                          Безрукова). Полезны для специалиста.
                 OEM ID:  Маркировка программы-форматтера.
                          Многие форматтеры  ставят  сюда  метку
                          MS-DOS:  MSDOS3.3  или  метку  PC-DOS:
                          IBM  3.3 (номер версии может меняться).

               Boot  id:  Специальная метка,  которая должна сто-
                          ять в конце нормального бутсектора.
               Drive id:  Специальная метка для указания типа но-
                          сителя. Возможные значения:
                          FLOPPY  - гибкий диск (дискета);
                          HARD    - жесткий диск (винчестер);
                          UNKNOWN - неправильная метка.
                          Нормальное значение - FLOPPY.

           BPB analysis:  Результат анализа параметров дискеты.
                          Если не OK, обратитесь к специалисту.
        FAT ID analysis:  Результат анализа описателя из FAT.
                          Если не OK, обратитесь к специалисту.

             BOOT FOUND:  Имя найденного бута (или вируса).
                          BLOCKED или DAMAGED перед именем  озна-
                          чает,  что бут поврежден. UNKNOWN озна-
                          чает, что бут не опознан.

     Может быть  информация  о других метках и маркерах.  Все это
интересно в основном специалисту,  кроме последнего поля. Послед-
нее поле - BOOT FOUND - содержит имя найденного бута (или вируса)
и представляет собой основной результат работы программы. Предуп-
реждение: происхождение  некоторых  включенных в библиотеку бутов
мне неизвестно, и по мере уточнения в новых версиях библиотеки их
названия могут быть изменены.
     В конце страницы (после таблицы) находятся комментарии и ре-
комендации. Сообщения,  которые могут там появляться, рассмотрены
в следующем разделе.
     Сводная таблица  - лишь первая страница результатов анализа.
На второй странице Вы можете посмотреть проинтерпретированный BPB
(блок параметров), а на третьей - дамп (распечатку) бутсектора.
     В нижней части экрана Вы увидите меню из 6 пунктов.  Для вы-
бора одного из них достаточно нажать клавишу,  которой он обозна-
чен. Вот эти пункты:

     R-Report             Сводная таблица (стр.1)
     B-BPB                BIOS Parameter Block (стр.2)
     D-Dump               Дамп бутсектора (стр.3)
     N-Next boot          Следующий бут
     X-eXit to DOS        Выход в DOS
     C-Copy boot to file  Копирование бутсектора в файл

     Первые три  пункта позволяют Вам выбрать страницу.  Страницы
можно также листать по порядку клавишей "Пробел".  Пункт  "N"  (а
также клавиша  "Ввод") позволяют перейти к анализу следующей дис-
кеты (Вы получите уже знакомое предложение вставить дискету и на-
жать любую клавишу).  Пункт "X" заканчивает работу с программой и
возвращает Вас в DOS (Вы можете также выйти в любой момент, нажав
клавишу "Esc"  или  Ctrl-Break).  Пункт "C" позволяет скопировать
приглянувшийся Вам бут в файл для  дальнейших  исследований.  При
его выборе  будет запрошено имя файла для копии бута.  Для отказа
от копирования нажмите "Ввод" при пустой строке.
     Вот и  все.  Нажмите "Ввод" для перехода к следующей дискете
или "Esc" для окончания.
     Для перехода  к работе без заставки можно указать устройство
в командной строке:

bootchk a:

или

bootchk b:

Двоеточие может быть опущено.

                   Комментарии и рекомендации
                   --------------------------

     В этом разделе описаны сообщения, появляющиеся после сводной
таблицы и поясняющие ситуацию.

No boot viruses at this BootSector.

     Нет вирусов в бутсекторе.  Это сообщение  появляется,  когда
прочитанный бут  опознан как правильный и отсутствие бутового ви-
руса гарантируется. Имя бута - в поле BOOT FOUND.
     Это единственное  сообщение,  не требующее никаких действий.
Все остальные ситуации в той или  иной  степени  ненормальны  (не
обязательно опасны),  и  желательна  консультация специалиста для
определения причин и последствий возникновения ненормальности.

This BootSector is blank. No boots, no viruses...

     Бутсектор пуст,  т.е.  заполнен нулями (или каким-то  другим
значением). Ни бутов, ни вирусов, разумеется, нет. При загрузке с
такой дискеты компьютер зависает. Если Вы хотите иметь нормальный
бут, скопируйте с дискеты все нужные файлы и переформатируйте ее.

Be careful, you have a virus!  AIDSTEST recommended.

     Будьте осторожны, у Вас вирус! Это сообщение появляется, ес-
ли BootChecker обнаружил какой-нибудь известный вирус. Имя вируса
в поле BOOT FOUND. Желательно, чтобы лечение вируса проводил спе-
циалист,  иначе возможна потеря информации. При невозможности об-
ратиться к специалисту рекомендуется выполнить действия,  описан-
ные в следующем разделе.

Be careful, you may have a damaged virus! FORMAT recommended.

     На дискете обнаружены остатки поврежденного вируса.  Имя ви-
руса - в поле BOOT FOUND. Это могут быть последствия неграмотного
лечения дискеты.  Безопасность и сохранность информации не гаран-
тируется.  Рекомендуется  скопировать с дискеты все файлы и пере-
форматировать ее, но НЕ лечить с помощью фагов.

Boot blocked at this BootSector! Cycling when reboot.
It may be a body of killed virus. No active boot viruses.

     Это сообщение появляется, если загрузка из бутсектора надеж-
но блокирована.  Даже если там есть вирус,  он не может активизи-
роваться и остаться в памяти. Так убивают вирусов некоторые анти-
вирусы-фаги (в т.ч. AIDSTEST) при невозможности корректного лече-
ния (например,  при потере исходного бута). В смысле вирусов дис-
кета безопасна,  но блок параметров может  быть  испорчен  (Boot-
Checker сообщит об этом дополнительно). О предполагаемом содержи-
мом см.  поле BOOT FOUND. Все же полезно разобраться, кто сидит у
Вас в бутсекторе и как он туда попал.

You have unknown boot, it may be a virus ... or may be not.
Call J.McArrow, Moscow, (095) 276-14-15. Don't wait!

     Незнакомый бут!  Это сообщение означает, что прочитанный бут
в библиотеках BootCheckerа не найден. Возможны 3 случая:
     1. Бутсектор дискеты поврежден при записи или в процессе эк-
сплуатации. Это  возможно  (особенно сбой при записи на дискету в
процессе форматирования) с не совсем надежными дисководами. Такую
дискету  желательно переформатировать на хорошем дисководе и тща-
тельно протестировать ее поверхность.
     2. Дискета сформатирована нестандартной программой-форматте-
ром, бут  которой  отсутствует в библиотеке BootCheckerа.  Убеди-
тельная просьба связаться в таком случае  со мной  для  включения
этого бута в библиотеку!  Пополненная библиотека с последней вер-
сией BootCheckerа будет предоставлена Вам в кратчайший срок.
     3. BootChecker обнаружил неизвестный вирус! Этот случай наи-
более опасен.  Дальнейшие действия должен производить ТОЛЬКО спе-
циалист высокой квалификации.  До его привлечения необходимо при-
остановить работу на ВСЕХ компьютерах.  Если  такого  специалиста
нет в Вашей организации, пригласите его со стороны. При невозмож-
ности и в этом случае обратиться к специалисту Вам необходимо как
можно быстрее продать все компьютеры и не приобретать их до появ-
ления такой возможности.
     ЕСЛИ BOOTCHECKER ОБНАРУЖИЛ НЕЗНАКОМЫЙ БУТ,  СЧИТАЙТЕ, ЧТО ВЫ
ИМЕЕТЕ НЕИЗВЕСТНЫЙ ВИРУС,  ПОКА НЕ БУДЕТ ТОЧНО УСТАНОВЛЕНО ОБРАТ-
НОЕ.
     С каким  из  трех  случаев Вы столкнулись,  может определить
только квалифицированный специалист: необходимо дизассемблировать
бут и разобраться в том,  что он делает. При обнаружении незнако-
мого BootCheckerу бута и особенно неизвестного вируса убедительно
прошу связаться  со  мной по указанному в сообщении телефону - Вы
получите не только последнюю версию  BootCheckerа  с  пополненной
библиотекой,  но  (при необходимости) и помощь в выяснении ситуа-
ции.

You have unknown boot with blank starting bytes (may be damaged).
Special consultation or FORMAT recommended.

     На дискете обнаружен неизвестный бут с обнуленными начальны-
ми байтами. Нормальный бут (и нормальный вирус) так начинаться не
может. Скорее всего,  бутсектор поврежден и, вероятно, поэтому не
опознан. Это  могут  быть  последствия  безграмотного лечения или
вакцинирования дискеты.  Вопреки  распространенному  заблуждению,
обнуление начальных  байтов  не блокирует бутсектор;  последствия
загрузки с такой дискеты непредсказуемы.
     В этом  случае  весьма желательно обратиться к специалисту и
разобраться в происхождении бута, особенно, если таких дискет об-
наружено несколько. При невозможности это сделать необходимо ско-
пировать с дискеты все нужные файлы и переформатировать ее.  Если
дискета не  имеет  файловой структуры (некоторые BackUp-программы
создают такие дискеты), описанная ситуация может быть нормальной.
При этом  желательно обратиться ко мне для включения этой штуки в
библиотеку BootCheckerа.

     Наряду с вышеописанными комментариями в сообщении могут при-
сутствовать дополнительные рекомендации. Они в основном связаны с
ненормальностями, обнаруженными при анализе блока параметров, за-
писанного в бутсекторе дискеты.  Ненормальные параметры могут об-
разоваться из-за  вируса  (или недостаточно корректного его лече-
ния), из-за  использования   неаккуратной   программы-форматтера,
из-за безграмотной вакцинации дискеты, из-за обычного хулиганства
и по другим причинам.  Дискета с неправильными параметрами  может
не читаться в некоторых случаях,  поэтому лучше переформатировать
такую дискету.  Разумеется, полезно выяснить перед этим ее проис-
хождение.
     Не следует путать дискеты с  неправильными  (противоречивыми
или  недопустимыми) параметрами с нестандартными дискетами.  Нес-
тандартные дискеты создает, например, популярный дисковый драйвер
"800". Эти дискеты могут не читаться DOS, но они специально поме-
чаются как нестандартные. BootChecker отмечает эти дискеты в поле
таблицы "BPB analysis",  но форматировать не предлагает. Наконец,
некоторые программы (как PCBackUp) создают дискеты  без  файловой
структуры, у  которых  на  месте  таблицы параметров находятся их
данные. BootChecker сообщает при этом о недопустимом BPB,  однако
форматировать такие дискеты,  разумеется, не надо (если Вы не со-
бираетесь использовать их в DOS-формате).
     Предложение переформатировать дискету, конечно, предполагает
предварительное копирование с нее куда-нибудь всех нужных  файлов
(при форматировании вся информация на дискете уничтожается). Пос-
ле форматирования проверьте дискету повторно. Если сообщение поя-
вилось снова,  вероятно,  виновата некорректная программа-формат-
тер. Не пользуйтесь такими форматтерами! Если все нормально, мож-
но скопировать файлы обратно.

Starting bytes are damaged.
FORMAT recommended for system diskette.

     В найденном  (правильном)  буте  повреждены начальные байты.
Если дискета должна быть загружаемой,  необходимо  переформатиро-
вать ее или заново записать систему командой SYS.

BIOS parameter block is wrong!
FORMAT recommended for DOS diskette.

     BPB (блок параметров) содержит недопустимые  значения.  Если
это дискета  с файловой структурой,  рекомендуется переформатиро-
вать ее.

DOS 1.0 standard detected (8 sectors per track).
FORMAT recommended.

     Дискета сформатирована  в устаревшем формате DOS 1.0 (8 сек-
торов на дорожке вместо обычных 9).  Рекомендуется переформатиро-
вать ее.

FAT ID byte conflicts with BPB. FORMAT recommended.

     Описатель стандарта дискеты,  записанный в FAT, противоречит
параметрам, записанным в бутсекторе. Рекомендуется переформатиро-
вать дискету.

Bad FAT ! It may be non-DOS diskette; otherwize, don't use it.

     При чтении FAT (таблицы распределения  дискового  пространс-
тва) произошел  сбой  диска  или FAT не найден.  Любой дефект FAT
приводит к гибели информации.  Если это дискета с файловой струк-
турой, тщательно протестируйте ее поверхность.

     Действия, рекомендуемые при обнаружении бутового вируса
     -------------------------------------------------------

     0. Немедленно обратиться к специалисту и передать ему бразды
правления. Все  нижеперечисленные  действия  рекомендуются лишь в
случае невозможности выполнить этот пункт и ничего не  гарантиру-
ют.
     1. Немедленно приостановить работу на всех компьютерах в ор-
ганизации и поставить их хозяев (ответственных за эксплуатацию) в
известность о появлении вируса.
     2. Перезагрузиться  с заведомо чистой,  защищенной от записи
системной дискеты.  Такие дискеты должны быть обязательно  подго-
товлены заранее на случай появления вируса. Для перезагрузки сле-
дует использовать кнопку "RESET" или выключение  питания,  но  НЕ
"Alt-Ctrl-Del".
     Бутовые вирусы не могут (как правило) заражать файлы, поэто-
му после  перезагрузки  можно  переназначить DOS на жесткий диск,
например:
         command c:\dos\command.com /p
(чего нельзя делать при файловом вирусе), и убрать системную дис-
кету.  При  обнаружении  файлово-бутового вируса (есть и такие) с
ним нужно бороться в первую очередь как с файловым.
     3. Проверить  дискету всеми наличными антивирусными детекто-
рами. НЕ лечите дискету на этом этапе!  Детекторы-фаги запускайте
в режиме, запрещающем лечение. Не потеряйте дискету в последующей
суматохе - лечить ее придется в последнюю очередь.
     Если Ваши детекторы ничего не находят - это новый вирус! Все
дальнейшие действия  должен  производить  высококвалифицированный
специалист. Впрочем,  возможно,  у Вас устаревшие версии детекто-
ров. Попытайтесь выяснить это и найти свежие версии. Полезна про-
верка жестких дисков с помощью ревизоров - если вирус сел на вин-
честеры, он может быть обнаружен. Даже если Вы сумеете избавиться
от этого нового вируса своими силами, необходимо сохранить один -
два экземпляра и передать специалисту-вирусологу.
     4. Проверить жесткий диск (все разделы!) с помощью ревизора,
установленного на этом диске,  а также теми детекторами (не в ре-
жиме лечения!), которые обнаружили вирус в п.3. Не пытайтесь тес-
тировать жесткие диски BootCheckerом - он этого не умеет. Наличие
надежного ревизора на жестких дисках обязательно:  если его у Вас
нет,  немедленно установите. Но не доверяйте ревизорам на 100%: и
хорошие ревизоры обманываются.
     Пункты 2 и 4 необходимо выполнить на ВСЕХ компьютерах.
     5. При обнаружении заразы на жестком диске вызов специалиста
обязателен: при нестандартном формате попытка лечения может стать
гибельной. Если Вы не боитесь гибели, можете попробовать вылечить
жесткий диск сами. Перед лечением проверьте наличие в Вашем архи-
ве на дискетах копий всего программного обеспечения и  постоянной
информации,  записанных на винчестере, и сделайте на дискетах ко-
пии рабочих каталогов всех пользователей (даже  отсутствующих  на
работе).  Не забудьте сделать это для ВСЕХ разделов диска.  Попы-
тайтесь получить максимум информации о найденном вирусе, особенно
о предусмотренной в нем пакости;  если вирус может портить диски,
проверьте, не начал ли Ваш экземпляр своей разрушительной работы.
Если установленный на диске ревизор обнаружил заразу и предусмат-
ривает лечение диска, воспользуйтесь его услугами. Если нет, вос-
пользуйтесь  для  лечения  одним из фагов (полезно предварительно
проверить его, попытавшись вылечить зараженную дискету). Формати-
рование винчестера  не всегда вылечивает его (в отличие от диске-
ты). Если фаг сообщает о невозможности лечения или каких-то нару-
шениях,  исправление диска возможно только вручную. После лечения
еще раз проверьте диск с помощью детекторов и ревизора (возможно,
ревизор придется  переустановить).  Протестируйте и при необходи-
мости исправьте диск утилитой типа  Norton  Disk  Doctor  или  PC
Tools DiskFIX (на худой конец,  chkdsk). Наконец, не удивляйтесь,
если после такого лечения диск перестал читаться и даже  формати-
роваться - Вы были предупреждены!
     6. Организовать тотальную проверку всех используемых в орга-
низации и  вообще  доступных  Вам  дискет с помощью BootCheckerа;
отобрать зараженные и убедиться в идентичности вируса - иначе пе-
рейти к п.0 и т.д.
     7. Как можно скорее провести расследование и выяснить, отку-
да попала к Вам зараза.  Помните, что найти источник гораздо важ-
нее,  чем наказать его.  При его обнаружении  немедленно  поднять
тревогу в организации,  из которой произошел вирус. Полезно пере-
дать BootChecker в эту организацию, если его там нет.
     8. Если заражен жесткий диск,  или дискета использовалась на
компьютере без жесткого диска,  или  дискета  использовалась  для
загрузки (не важно, зачем), необходимо как можно скорее предупре-
дить о вирусе всех пользователей  и других потенциальных дискето-
владельцев и дискетоносителей, которые могли иметь доступ к этому
компьютеру на протяжении последних 100 лет. Чем шире масштаб этой
непростой операции,  тем меньше последующая вспышка вирусной эпи-
демии.
     9. Наконец, можно заняться зараженной дискетой (или дискета-
ми). Самый радикальный способ лечения дискеты - форматирование, и
следует прибегать к нему всегда, когда нет серьезных противопока-
заний. Если на дискете есть нужные файлы,  их  следует  предвари-
тельно скопировать. Необходимо уточнить, умеет ли найденный вирус
портить информацию, если да, то как именно, и проверить, не начал
ли он это делать на дискете (это может быть не сразу заметно).
     Если переформатирование  дискет  невозможно,  затруднительно
или нецелесообразно (например, много стандартных дискет, заражен-
ных безвредным вирусом),  можно использовать для лечения  антиви-
русную программу-фаг.  Впрочем,  некоторые  вирусы,  опознаваемые
BootCheckerом, не  лечатся (и даже не распознаются) существующими
фагами.  Перед массовым применением необходимо опробовать фаг  на
дискете  без  ценной  информации и проверить корректность лечения
BootCheckerом и утилитой типа Norton Disk Doctor.  Не используйте
фаги, которые просто обнуляют бутсектор!
     Для удаления  вируса  рекомендуется  антивирус-фаг  AIDSTEST
Д.Н.Лозинского, однако и он может лечить не все вирусы, распозна-
ваемые BootCheckerом. Если последняя версия AIDSTEST не может вы-
лечить найденный вирус,  лучше всего связаться со мной по телефо-
ну, указанному в конце документации и в заставке программы.
     ПРИМЕЧАНИЕ: иногда AIDSTEST,  сообщив о вирусе в бутсекторе,
пишет: "ИСПРАВИТЬ НЕ МОГУ". Обычно это означает потерю правильно-
го бутсектора,  сохраняемого вирусами (в этом случае консультация
специалиста особенно желательна). Рекомендуется не соглашаться на
лечение, а переписать с дискеты все нужные файлы и переформатиро-
вать ее.
     Как видите, появление вируса вызывает большой переполох. По-
этому особенно  важно  наладить  с  помощью BootCheckerа надежный
входной контроль дискет, т.е. проверять любую поступившую дискету
сразу после ее появления, перед использованием. В этом случае при
обнаружении вируса Вы будете избавлены от хлопот - достаточно ог-
раничиться пп. 7 и 9.

             II. РУКОВОДСТВО СИСТЕМНОГО ПРОГРАММИСТА

                     Организационные вопросы
                     -----------------------
     Именно Вы - тот специалист,  обращение к которому рекоменду-
ется в  руководстве пользователя в случае тревоги.  Позаботьтесь,
чтобы все,  использующие BootChecker в Вашей организации, об этом
знали и  не работали в режиме вопиющего в пустыне.  BootChecker -
прекрасное средство для ранней диагностики, но не лечения, и нуж-
но  приучать пациентов немедленно обращаться к врачу.  Не игнори-
руйте таких обращений - BootChecker не должен срабатывать по пус-
тякам.  Если BootChecker поднимает тревогу на правильных дискетах
(особенно из-за незнакомого бута),  просьба сообщить об этом  мне
по  телефону,  указанному в конце документации и в заставке прог-
раммы - Вы получите дополненную (или исправленную) версию.
     BootChecker может  быть  полезен  Вам и для личных нужд.  Не
всегда легко визуально определить содержимое бутсектора, особенно
если там записан нестандартный бут (тем более,  что многие вирусы
сохраняют OEM ID,  BPB и текстовые фрагменты).  Во всяком случае,
запустить BootChecker быстрее и удобнее, чем загружать DiskEdit и
пялить глаза на дамп.  Особенно удобен BootChecker  при  массовых
проверках дискет - он позволяет проверять до 5 дискет в минуту.

                       Описание программы
                       ------------------
     Принцип работы программы предельно прост.  Понятно,  что от-
сутствие вируса в бутсекторе может надежно гарантироваться только
наличием там правильного  бута.  Именно  это  и  проверяет  Boot-
Checker. Основная его ценность - библиотека правильных бутов, на-
ходящаяся снаружи (в файле bootchk.lib) и потому легко  пополняе-
мая. Правда, пока средства для пополнения библиотеки не поставля-
ются,  и для этого нужно обращаться ко  мне.  Причина  достаточно
очевидна,  хотя и несколько эгоистична - мне нужно быстро собрать
много бутов для минимизации ложных срабатываний. Буты проверяются
по наборам CRC (именно они хранятся в библиотеке),  что обеспечи-
вает надежную идентификацию.
     Имена бутов могут содержать неточности, ошибки и недоразуме-
ния. Многие буты попадают ко мне не из  форматтеров,  а  прямо  с
дискет, и об их происхождении мне известно только то, что написа-
но у них внутри.  Поэтому многие названия весьма условны (и могут
изменяться в будущих версиях по мере уточнения). Убедительно про-
шу всех, заметивших такие недоразумения, сообщить мне о них.
     Кроме правильных бутов,  BootChecker умеет опознавать многие
известные бутовые вирусы.  Они определяются либо также по наборам
CRC, либо  традиционным способом - с помощью сигнатур.  Не лучший
метод,  но приходится им пользоваться, поскольку многие вирусы (и
их сигнатуры) известны мне только по литературе. Эти сигнатуры не
всегда подобраны удачно,  поэтому не исключены случайные совпаде-
ния, и сообщения об экзотических вирусах могут быть ложной трево-
гой. Впрочем, на известных мне бутах такого не наблюдалось. Опре-
деление по  CRC может использоваться для тонкого различения штам-
мов (по бутсектору,  хвост не тестируется). К сожалению, работа в
этом направлении сдерживается недостаточным количеством различных
штаммов, имеющихся в моем распоряжении, поэтому убедительно прошу
всех  владельцев  поделиться интересными материалами на эту тему.
Библиотека вирусных  CRC  и  сигнатур  также  находится  в  файле
bootchk.lib  .  Не удивляйтесь наличию там текстовых фрагментов -
штаммы с измененными текстами распознаются по дополнительным сиг-
натурам, но хотелось отличать оригиналы. Список отлавливаемых ви-
русов и методы их идентификации - в файле bootchk.lst .
    Для лечения дискет рекомендуется фаг AIDSTEST  Д.Н.Лозинского
-  я  оперативно  передаю ему всю новую заразу,  так что AIDSTEST
умеет лечить большинство  распознаваемых  BootCheckerом  вирусов,
имеющих хождение в СССР.  Если последняя версия AIDSTEST не лечит
опознанный BootCheckerом вирус,  убедительная просьба  немедленно
сообщить об этом мне или Д.Н.Лозинскому.
     Если бут не найден в библиотеке,  он квалифицируется как не-
известный (UNKNOWN). Эта ситуация требует детального исследования
(как правило,  дизассемблирования) и,  вероятно, пополнения одной
из библиотек.  Будьте осторожны - именно так опознается новый ви-
рус.  При появлении неизвестного бута Вы можете обратиться ко мне
по телефону, указанному в сообщении - меня интересуют новые буты,
и я постараюсь оказать Вам содействие в выяснении ситуации.
     Библиотеки периодически обновляются.  Библиотеки более позд-
них версий  предпочтительнее предыдущих,  независимо от количест-
венных показателей.  Гарантируется  совместимость  библиотеки   с
программой той  же  версии  (цифра  перед точкой) любой подверсии
(цифра после точки). Так, BootChecker 2.0 (версия 2, подверсия 0)
будет работать с библиотекой 2.73, но не с 1.0. BootChecker сооб-
щает версию библиотеки при ее загрузке; ее можно также посмотреть
командой type bootchk.lib .
     Кроме определения бута, самостоятельную ценность представля-
ет анализ BPB. Проверяется соответствие BPB стандартам DOS, а для
дискет, помеченных как нестандартные (дескриптор F0) - разумность
значений параметров.  Кроме  того,  проверяется  соответствие BPB
байту-описателю FAT ID, записанному в начале FAT.
     BootChecker предназначен  для работы на незараженной машине.
Для поддержания винчестеров в чистоте существуют достаточно хоро-
шие средства. Перед началом работы BootChecker (на всякий случай)
тестирует память на наличие там бутовых вирусов (старых и новых),
закрепляющихся  традиционным способом - уменьшая в области данных
BIOS значение доступной DOS памяти. BootChecker читает это значе-
ние,  проверяет его корректность и сообщает о наличии скрытой па-
мяти.  При этом ловятся все известные мне  бутовые  (и  некоторые
файловые)  вирусы,  а также некоторые сторожа,  старые резиденты,
отбракованные стартовым тестом участки памяти и т.п.  Причина  не
определяется.  Вирусы,  использующие  иной  механизм  (я таких не
знаю) не ловятся,  так что тест без гарантий.  Никаких мер защиты
от этого вируса НЕ принимается. Бутсектор читается через INT 13h,
так что резидентные stealth-вирусы не видны. Не работайте при ре-
зидентных вирусах!
     Примитивный самоконтроль на  сохранность  собственного  кода
сделан скорее для очистки совести, чем для пользы дела - все-таки
антивирус бутовый...  Самоконтроль выполняется через DOS и не об-
наруживает заражения stealt-вирусами.  Получив программу, посмот-
рите длину ПЕРЕД первым запуском: длина версии 2.0 - ровно 27 000
байт.
                       Работа с программой
                       -------------------
     Работа с программой вполне  обычна.  Тестируемое  устройство
можно задать при запуске в командной строке или в ответ  на  зап-
рос. Далее  используйте  клавиши,  указанные  в последней строке.
Кроме них, можно использовать также:

     пробел - для листания страниц;
     ввод - для перехода к следующей дискете;
     Esc или Ctrl-Break - для выхода из программы.

     После запуска BootChecker грузит библиотеку и больше за зап-
частями на диск не лазит.  Библиотека должна иметь правильное имя
и находиться в том же каталоге, что и программа.
     Результат анализа представлен на трех страницах.  На  первой
представлена  сводная таблица (Report) с результатами анализа,  а
также комментарии и  рекомендации  (описание  см.  в  руководстве
пользователя).  В частности, в таблице указано имя найденного бу-
та. Ему могут предшествовать некоторые префиксы:

     VIRUS   - понятно
     800     - начальные байты модифицированы драйвером 800
     BLOCKED - начальные байты зациклены (EB  FE)  или  обнулены;
               последнее не означает фактической блокировки - это
               не ДВК!
     DAMAGED - начальные байты не соответствуют найденому буту

     На второй  странице Вы можете посмотреть BPB,  интерпретиро-
ванный a la Norton DiskEdit (в отличие от  него,  BootChecker  не
теряет расширения).  В первом столбце представлены результаты ин-
терпретации, во втором - стандартные значения соответствующих па-
раметров для байта-описателя из FAT, в третьем - стандартные зна-
чения для дескриптора, указанного в BPB. Загляните на эту страни-
цу, если  в полях сводной таблицы "BPB analysis" или "FAT ID ana-
lysis" не стоит OK - Вы сразу увидите причину.
     На третьей  странице Вы можете посмотреть дамп в hex и as is
виде. Не печатайте его PrintScreenом - там куча управляющих  сим-
волов.
     Страницы можно выбирать из меню или листать пробелом. Диске-
ту при этом можно вынуть.
     Если бут Вам особенно понравился (или,  наоборот,  не понра-
вился), Вы  можете  скопировать его в файл для дальнейшего иссле-
дования - дизассемблирования и т.п. При выборе этого пункта будет
спрошено имя файла.  Можно указать диск и путь. Если Вы передума-
ли, можно отказаться от копирования,  нажав ввод при пустой стро-
ке.
     Кроме копирования бута,  BootChecker принципиально не содер-
жит никаких операций записи - только чтение и анализ.  Не следует
давать в руки неквалифицированному пользователю программу,  кото-
рая что-то куда-то пишет в обход файловых операций DOS -  он  не-
медленно найдет дискету, которую можно испортить именно таким об-
разом, и исправит ее.  Вообще я считаю, что лечить или ремонтиро-
вать дискеты лучше всего с помощью команды FORMAT, а жесткие дис-
ки - только вручную:  Norton Disk Editor лучше,  чем Norton  Disk
Destructor...
     BootChecker НЕ  позволяет тестировать жесткие диски и обижа-
ется, если указать ему устройство, отличное от A: или B:. Дискеты
читаются через BIOS, так что не пытайтесь обмануть его переназна-
чениями типа assign - они игнорируются.
     Дополнительная возможность - анализ бутсектора, находящегося
в  файле  на  диске.  Это  может  быть  копия,  сделанная   самим
BootCheckerом или любой другой программой. В частности, так можно
анализировать файлы  с  побитовыми  копиями  дискет,  создаваемые
программами типа DARC, DFCOPY и т.п. К сожалению, нельзя анализи-
ровать файлы,  созданные TELEDISKом - он упаковывает их. Для ана-
лиза  файла  нужно  указать его имя в командной строке (используя
при необходимости путь) вместо устройства, например:

bootchk d:\diskettes\mydisk.bit

     Использование этой возможности ориентировано на квалифициро-
ванных пользователей.

                          БЛАГОДАРНОСТИ

     Я весьма признателен всем  участникам  опытной  эксплуатации
BootCheckerа, чьи  предложения  и  замечания  помогли мне довести
программу до ума,  а буты составили основу библиотек первой  вер-
сии (имевшей во многом  экспериментальный  характер).  Я  заранее
благодарен всем,  кто найдет время и возможность передать мне бу-
ты,  отсутствующие в библиотеках, интересные штаммы бутовых виру-
сов,  а также просто поделиться своими замечаниями, предложениями
и пожеланиями.
     Я благодарю  Д.Н.Лозинского,  оперативно  включающего в свой
антивирус-фаг AIDSTEST все передаваемые ему мною новые вирусы , и
Н.Н.Безрукова, чьи  таблицы из приложения к "Компьютерной вирусо-
логии" послужили  источником  некоторых  сигнатур  вирусной части
библиотеки.

                УСЛОВИЯ РАСПРОСТРАНЕНИЯ ПРОГРАММЫ

     В комплект поставки BootCheckerа 2.0 входят 4 файла:

bootchk.exe - сам BootChecker;
bootchk.doc - документация к нему;
bootchk.lib - библиотека правильных бутов и вирусов;
bootchk.lst - список распознаваемых бутов вирусов.

     Без библиотеки BootChecker работать не может. Версия библио-
теки может отличаться от версии программы, поскольку она периоди-
чески обновляется.  Библиотеки более поздних версий заведомо пол-
нее предыдущих, независимо от количества элементов, и могут заме-
щать более ранние в процессе распространения.
     Программа распространяется бесплатно и может свободно  копи-
роваться, устанавливаться и использоваться при соблюдении обычных
ограничений:
     - не вносятся изменения в программу,  документацию и библио-
теку, сохраняются имена файлов и комплектность поставки;
     - отсутствует прямая коммерческая выгода.
     Исходный текст и средства для работы с библиотекой в настоя-
щее время не поставляются. Для пополнения библиотеки имеющимися у
Вас бутами и вирусами обращайтесь непосредственно к автору по те-
лефону,  указанному в конце документации и в заставке  программы.
Предполагается периодический выпуск пополненных библиотек.
     Понятие зарегистрированного  пользователя  отсутствует.  Для
организаций возможно платное абонементное обслуживание (установка
с  первоначальным  тестированием дискет,  включение специфических
бутов,  периодическая поставка пополненных библиотек и новых вер-
сий, дополнительные услуги) за наличный и безналичный расчет.
     Для коммерческого использования программы (включая использо-
вание или установку при платном обслуживании), а также поставки в
виде бесплатного  приложения к коммерческим программным продуктам
или бесплатного распространения на платных курсах необходимо зак-
лючение соответствующего договора с автором.
     Убедительная просьба сообщать автору о всех случаях незакон-
ного коммерческого использования.

     Со всеми вопросами, предложениями и пожеланиями, включая не-
известные буты и вирусы,  обращайтесь к автору программы по теле-
фону:
                                            (095) 276-14-15
                                           _________________

                                               Д.Макаров
                                           _________________

                                           Москва, 2.09.1991
