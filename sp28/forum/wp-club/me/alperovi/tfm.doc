
         Ф О Р М А Т И Р О В А Н И Е     Т Е К С Т О В
         =============================================
                           TFM.MAC

         Макрокоманда текстового редактора Multi-Edit


                Альперович Лев Залманович, тел 386-59-36

      - Разделение сторк по правилам русского переноса.
      - Форматирование выделенного блока текста.
      - Автоматическое форматирование при наборе текста.
      - Форматирование, упавляемое левым рельефом.
      - Глобальное форматирование.
      - Диалоговая установка границ абзаца.
      - Контекстная установка границ абзаца.
      - Независимость параметров форматирования при рабо-
    те в различных окнах, с различными расширениями имени
    файла.

      Макрокоманда осуществляет редактирование текстового
    блока с оформлением его в виде  абзаца,  выравненного
    по левой и правой границе, с отступом  начала абзаца,
    с переносом, где это возможно, слов по  правилам пра-
    вописания (Английские слова не переносятся).
      Одновременно устанавливается состояние автоматичес-
    кого форматирования при  наборе  текста  (проверяется
    нажатие клавиш SPACE и ENTER).

      Работа макрокоманды управляется тремя параметрами:

       - левая граница текста
       - начало абзаца
       - правая граница текста

      Правая граница должна быть ненулевой.  Если  первые
    два параметра нулевые, то левая граница и  начало аб-
    заца определяются контекстно  по  непустым  начальным
    строкам блока.
      Параметры связываются с конкретным  окном редактора
    и с конкретным расширением имени  редактируемого фай-
    ла.

      Макрокоманда содержит основные точки входа:

       - TFM
       - TF
       - TP

      и вспомогательные:

       - TI
       - ABZ_BLO
       - ABZ_GO
       - TG
       - TU

      TFM устанавливает значения параметров в виде

      /l=/a=/r=

      где:

      l - левая граница текста,
        по умолчанию 0, т.е. контекстная установка;
      a - начало абзаца,
        по умолчанию 0, т.е. контекстная установка;
      r - правая граница текста,
        по умолчанию - системная переменная Right  Margin
        или, если она равна нулю - 72.
     (Параметры - малые буквы)
     Пример:  TFM /a=10/l=4/r=66


      - TF выполняет форматирование помеченного блока. По
    окончании курсор занимает позицию  начала  следующего
    абзаца.

      - TP приглашает ввести параметры  непосредственно с
    экрана. Пользователь подводит курсор в желаемую пози-
    цию строки и нажимает клавишу  ENTER (последовательно
    для трех границ). Нажатие на ESC  означает сохранение
    старого значения, на SPACE - ввод значения, указанно-
    го выше по умолчанию. Подсказка высвечивается  на эк-
    ране.
      Для указания границ можно  воспользоваться "мышкой"
    (левая клавиша вместо ENTER).

      - TI высвечивает информацию о параметрах  в  строке
    сообщений.

      - ABZ_BLO открывает строчный блок с  места располо-
    жения курсора и расширяет его  до  необходимых разме-
    ров. Реализуются действия, аналогичные  нажатию ключа
    F7 (при первом обращении) и последовательному нажатию
    стрелки DOWN (при  дальнейших  обращениях). Пользова-
    тель помечает все, что должно быть собрано в один аб-
    зац.

      - ABZ_GO закрывает блок и вызывает  TF,  снимая от-
    метку блока.
      Если блок не был открыт, то происходит настройка на
    текущий абзац и форматирование. При этом курсор может
    находиться в любом месте абзаца или на пустых строках
    перед абзацем. Исходный  текст  абзаца  должен  иметь
    правильный левый рельеф. Это означает,  что  все  его
    строки начинаются с одной и той же позиции,  а отступ
    начала абзаца не левее (!) этой позиции. Если это ус-
    ловие не выполненно,  то  форматировать  нужно  с ис-
    пользованием операции выделения блока.
      Итак, вход ABZ_GO  может  функционировать самостоя-
    тельно, или совместно с ABZ_BLO. В первом  случае ис-
    ходный текст должен иметь правильный левый рельеф, во
    втором - произвольный.

      - TG осуществляет форматирование текста, выделенно-
    го блоком (F7), в котором все абзацы имеют правильный
    левый рельеф (см. предыдущий пункт).
      Если при этом задать параметр /n=1, то отформатиро-
    ваны  будут  лишь  те  абзацы,  начало  которых соот-
    ветствуют позиции курсора. Перед стартом TG /n=1 кур-
    сор следует поместить в соответствующую позицию.
      Таким образом, вход  TG  позволяет  отформатировать
    и целиком весь файл.

      - TU обнуляет параметры макрокоманды.

    Для установки среды пользователя можно поступить сле-
    дующим образом:

      1. Написать и оттранслировать макрос, текст которо-
    го аналогичен предлагаемому макросу LEW:
  $macro lew;
  def_str(a,l,r);
  a := parse_str('/a=',mparm_str);
  l := parse_str('/l=',mparm_str);
  r := parse_str('/r=',mparm_str);
  load_macro_file('tfm');
  run_macro('tfm /a=' + a + '/l=' + l + '/r=' + r);
  macro_to_key(<f11>,'abz_blo',edit);     {по желанию}
  macro_to_key(<f12>,'abz_go',edit);      {по желанию}
  macro_to_key(<ctrlf11>,'tg /n=1',edit); {по желанию}
  macro_to_key(<ctrlf12>,'tp',edit);      {по желанию}
  end_macro;

      2.   Произвести   новую   инициализацию   установки
    Multi-edit:

      - войти в меню Install

      - войти в подменю Filename Extension

      - выбрать (или создать) интересующее Вас расширение
    имени файлов

      - установить параметры приблизительно так:
  Edit mode         Text
  Word wrap         Off
  Indent            Off
  Using format line - ignoring tab and margin settings
  Edit format line
  Tab spacing       0
  Right margin      0
  Language type     NONE
  Post-load macro   lew /a=7/l=5/r=72
  Default directory
  Compiler-Program
      Обращаю внимание на строку Post-load macro

      - разрешить компиляцию Init.src

      3. После этого всякая работа с файлами данного рас-
    ширения будет сопровождаться выполнением макрокоманды
    TFM и установкой ключей F11, F12, CTRLF11 и CTRLF12.

      Сообщение об ошибке возникает, если  левая  граница
    или отступ начала абзаца больше или равны правой гра-
    нице, или, если правая граница меньше трех.

      Макрос отлажен в версии 4.00a Multi-Edit.

      Автор благодарит Л.Г.Бунича  за  активное сотрудни-
    чество в выработке концепции, совершенстве  и испыта-
    нии макроса.


                     - Конец текста -

