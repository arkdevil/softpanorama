╔════════════════════╗
║      ╔═════╤═╦═══╗ ║  
║  ╔═══╩═════╧═╝   ║ ║  ┌───────────────────────────╖
║  ╚════╦════╤═╗   ║ ║  │ Библиотека фоновой музыки ║
║ KUKISH╠════╪═╣   ║ ║  │      Версия 1.00          ║
║  SOFT ╠════╪═╣   ║ ║  ╘═══════════════════════════╝
║       ╚═╦══╧═╝   ║ ║  
║    93   ╚════════╝ ║
╚════════════════════╝

               Введение: Библиотека фоновой музыки.

        Библиотека предназначена  для создания  фонового музыкального
  оформления  программ,  написанных  на   языках  C/C++,  Fortran   и
  Assembler.  В  комплект  входят  библиотека,  заголовочный файл для
  С/С++  и  музыкальный  редактор  для  облегчения  написания музыки.
  Библиотека имеет то преимущество, что, функции работают не с 08h  -
  м прерыванием,  а с  70h -  м, что  позволяет изменять частоту тона
  1024 раза  в секунду  ( без  изменения системного  времени, как это
  делают некоторые программы ).

***********************************************************************

                    1. Функции фоновой музыки.

                  void far install_music( void );

    Функция инсталлируется на INT 70h и начинает играть музыку
                       ( указатель melody ).

  Примечание:  INT  70h  вызывается  только  на  машинах  класса  AT,
     поэтому  в  библиотеке  предусмотрена  функция  test_AT ( смотри
     ниже  ).   Если  машина  не  AT  функция  не  произведет никаких
     действий, поэтому если Вы хотите обрабатывать ошибки  корректно,
     то вызывайте функцию test_AT.

-----------------------------------------------------------------------

                 void far uninstall_music( void );

        Функция  восстанавливает  вектор  прерываний  INT 70h и, если
  нужно, выключает динамик.  Эта  функция обязательно ( !!! )  должна
  быть вызвана перед выходом из  программы. Я советую для этих  целей
  использовать функцию С  atexit, которая есть  и в Microsoft  C, и в
  Borland C++.

-----------------------------------------------------------------------

                unsigned far get_music_pos( void );

        Функция  возвращает  текущую  позицию  в  мелодии,  0xffff  в
 случае ошибки ( не была вызвана install_music ) или конца мелодии.

-----------------------------------------------------------------------

         void far set_new_melody( unsigned far *melody );

        Фyнкция  включает  динамик  и  начинает играть музыку. Формат
  массива melody следующий:
         ┌──────────┬───────────────┬─────┬──────┬──────┐
         │частота[0]│длительность[0]│ ... │0xffff│0xffff│
         └──────────┴───────────────┴─────┴──────┴──────┘
        Код 0xffff,  0xffff означает  конец мелодии  и достигнув  его
  функция обработки INT 70h выключает динамик.

-----------------------------------------------------------------------

                   void far mask_music( void );

        Приостанавливает выполнение мелодии до вызова  set_new_melody
  или unmask_music.

-----------------------------------------------------------------------

                  void far unmask_music( void );

        Запускает  мелодию  с  той  позиции,  на  которой  она   была
  прервана mask_music.

-----------------------------------------------------------------------

                  Пример использования библиотеки

/*
        Функции были написаны на Ассемблере => могут быть
  использованы как в Microsoft C, так и в Borland C++.  */

     #include <conio.h>                    // для kbhit
     #include <misc.h>                     // музыка

     // внешний массив, созданный Music Editor
     extern unsigned far music[];

     void main( void )
     {
           install_music();             // установка музыки
           set_new_melody( music );        // запуск музыки

           while( !kbhit() &&            // пока не нажата клавиша
           get_music_pos() != 0xffff )   // или не кончилась мелодия
                 ;                       // делаем холостой цикл

           uninstall_music();              // выключаем музыку
     }

     Трансляция: cl module.c music.c music.lib    // Micrisoft C
                 bcc module.c music.c music.lib   // Borland C++

***********************************************************************

           2 Формат CMF ( Compact Music Format ) файла.

        Сначала  следует  метка   моего  редактора:  "Gregory   Music
  Editor.  (  1993  )",  по  которой Вы можете проверить правильность
  формата. А далее следуют ноты  в специальном формате.  Каждая  нота
  занимает 2 байта. Формат этого слова следующий:

          7654 3210  76 543 210
         ┌────┬────┐┌──┬───┬───┐
         │0000│llll││tt│nnn│ooo│
         └────┴────┘└──┴───┴───┘
          └─┬┘ └─┬┘  └┤ └┬┘ └┬┘
            │    │    │  │   └──────────── номер октавы ( на пианино
            │    │    │  │                 начиная слева ).
            │    │    │  │
            │    │    │  └──────────────── номер ноты в октаве
            │    │    │                    ( начиная  с нуля ).
            │    │    │                    Черные клавиши нумеруются
            │    │    │                    независимо от белых.
            │    │    └─────────────────── тип ноты: 0 - белая
            │    │                                   1 - черная
            │    │                                   2 - пауза
            │    │
            │    └──────────────────────── длительность: 0 - целая
            │                                            1 - 1/2 
            │                                            2 - 1/2
            │                                            3 - 1/4 
            │                                            4 - 1/4
            │                                            5 - 1/8 
            │                                            6 - 1/8
            │                                            7 - 1/16
            │                                            8 - 1/32
            │                               - нота с точкой
            │                              ( основная
            │                              длительность * 1.5 )
            └───────────────────────────── не используется

************************************************************************

                     3 Дополнительные функции.

------------------------------------------------------------------------

             void far set_time( unsigned long time );

        Установить    начальное    значение    переменной,    которая
  увеличивается  1024  раза  в  секунду  (  внутреннего  таймера   ).
  Преимущество  этой  функции  перед  любыми другими функциями опроса
  какого либо таймера  с целью сделать  задержку в том,  что она 4  -
  байтная  =>  переполняется  очень  редко  (  раз  в  48  дней  ), а
  обновляется довольно часто и в фоновом режиме.

------------------------------------------------------------------------

                unsigned long far get_time( void );

        Получить  значение  встроенного   таймера  в   миллисекундах.
    ( Перед ней должна быть вызвана install_music и set_time ).

------------------------------------------------------------------------

                void far my_sound( unsigned hetz );

                 Включает динамик с частотой herz.

------------------------------------------------------------------------

                   void far my_nosound( void );

                        Выключает динамик.

------------------------------------------------------------------------

                     unsigned test_AT( void );

              Проверяет на какой машине вы работаете:
                       0 - i8086 / i8088 / i80186
                       1 - i80286 / i80386 / i80486...

************************************************************************


                4. Утилита - музыкальный редактор.

        Музыкальный  редактор   предназначен  для   ввода  музыки   и
  перевода   ее   в   массив,   понятный   функциям  фоновой  музыки.
  Возможности редактора сильно ограничены поскольку это 1 - я  версия
  и предназначен он все же не для композиторов.
        Работа  (  за  исключением  ввода  имен  файлов ) полностью с
  помощью  мышки.   Ввод  нот  осуществляется  нажатием на клавиатуру
  пианино  внизу  экрана.   Движение  курсора  происходит при нажатии
  мышкой стрелочных кнопок тоже  внизу экрана.  Назначение  остальных
  кнопок понятно без объяснений.
        Запись  файла  на  диск  осуществляется  в  двух видах: CMF -
  формате и в виде С  - шного массива. Массив можно  потом слинковать
  с основной программой и использовать.
************************************************************************
