
                Модуль определения базовых данных и
                        операций над ними.
                         BaseData V 2.0
                      (c) 1992 Ярослав Мигач


        Модуль   определяет   три   основных   довольно    часто
    используемых типа данных.  Это тип даты,  времени и кода  по
    справочнику.  Наиболее  часто  в  базах данных и приложениях
    используются  типы  дат  и  кодов  по справочникам. В модуле
    определены несколько разновидностей указанных типов данных и
    реализованы основные операции по обработке этих типов, такие
    как  взаимные   строковые  преобразования   и  проверки   на
    вхождение  в  допустимый  диапазон  или  просто  проверки на
    допустимость значений.
        Модуль реализован на язые Turbo  Pascal V 6.0 и  требует
    для своей поддержки такие  стандартные модули как Crt  и Dos
    из   библотеки  TURBO.TPL, а  также  модуль  Def,  
    из  библиотеки поддержки  TURBO PASCAL SUPPORT  V 3.0
    ( TPS 3.0 ).



        Типы данных, определенные в интерфейсной секции модуля.


    ShortDate = LONGINT;
        -  Сокращенная  дата  в  десятичном  формате ( ГГГГММ ).
    Четыре    старшие    десятичные    позиции    отведены   под
    идентификатор   года.   Год   таким   образом   должен  быть
    представлен в виде четырех цифр  ( например 1992 а не  92 ).
    Младшие два разряда отведены под значение месяца (  диапазон
    представления от 1  до 12 ).  Так, например, дата  " февраль
    1991   года"   будет   представлена   числом   199202.  Даты
    представленные в таком формате удобно сравнивать. К  данному
    формату представления дат применимы все допустимые  операции
    сравнения - больше, меньше, равно и т. п.

    FullDate  = LONGINT;
        -  Полная  дата  в  десятичном  формате  (  ГГГГММДД  ).
    Аналогично  предыдущему   представлению,  однако   здесь   в
    младших разрядах находися значение дня месяца.

    ShortTime = WORD;
        - Определяет  тип представления  сокращенного времени  в
    формате  (  ЧЧММ  ).  Часы  находятся  в старших разрядах, а
    минуты в младших.

    FullTime  = LONGINT;
        - Определяет значение полного времени ( формат ЧЧММСС ).
    Здесь  по  аналогии  в  младших  разрядах находится значение
    секунд минуты.

        Рассмотрим  типы  данных  формата  -  "  код  словаря ".
    Во  многих  случаях  удобно  представлять  часть  данных   в
    закодированном   виде.   Где   каждому   значению   кода  из
    допустимого     диапазона     соответствует      расшифровка
    представленная  в  текстовом  или  ином  виде.  Таим образом
    удобно хранить в  памяти машины информацию  по наименованиям
    дожностей,  видам  деятельности  предприятий,  наименованиям
    типовых  элементов  и  их   стоимости  и  т.  п.   Поскольку
    пользователю  неудобно,   да  и   при  больших   количествах
    наименований  просто  невозможно  оперировать  с  кодами   в
    цифровом  виде,  вводится  понятие  словаря  (  справочника,
    классификатора  ),  по  которому  из  программы  можно очень
    быстро  сопоставить  значению  кода  конкретную расшифровку.
    Кроме всего, словари могут быть вложенными, когда некоторому
    коду   ставится    в    соответствие   имя    файла    более
    конкретизированного  словаря.  Подобные  древовидные словари
    гораздо удобнее в  использовании. Как правило  необходимость
    работы  с   такими  словарями   возникает  при    увеличении
    количества просматриваемых позиций более ста. В этом  случае
    поиск по линейному словарю становится утомительным.
        Предлагается следующий формат словаря :

                  З А Г О Л О В О К
    ----------------------------------------------------------
    Поле кода :  Поле 1   :   Поле2  :! Поле3 : Поле4  .....
    ----------------------------------------------------------
    . Имя раздела
      Код

        Первым в  словаре следует  поле кода  или имени  раздела
   Поле кода всегда начинается со второй позиции и  оканчивается
   прибелом или двоеточием.  Имя раздела обозначается  точкой во
   второй позиции.
        Если  в   первой  позиции   проставлен   восклицательный
   знак,  то  поле  является  невидимым  и  не отображаентся при
   выводе на экран. Если в первой позиции стоит значек #, то  за
   ним следует  имя файла  подчиненного словря.  Значек #  может
   применяться только в первой  строке расшифровки кода. Если  в
   первой   строке   такой   значек   не   обнаружен,   то   код
   интерпритируется как конечный код словаря.  Последняя  строка
   словаря всегда должна быть пустой.

    ShortVoc  = BYTE;
        - Тип короткого целочисленного кода по словарю.

    NumVoc    = WORD;
        - Тип обычного целочисленного кода по словарю.

    RealVoc   = REAL;
        - Тип вещественного кода по словарю.

    StringVoc = STRING [ 15 ];
        - Тип строкового кода по словарю.


        Процедуры и функции по обработке дат.

    FUNCTION GetYearInFullDate ( Num : FullDate ) : WORD;
        -  Позволяет  получить  целочисленное  значение  года из
    формата полной даты.

    FUNCTION GetYearInShortDate ( Num : ShortDate ) : WORD;
        -  Позволяет  получить  целочисленное  значение  года из
    формата сокращенной даты.

    FUNCTION GetMonthInShortDate ( Num : ShortDate ) : BYTE;
        - Позволяет получить байтовое значение месяца из формата
    сокращенной даты.

    FUNCTION GetMonthInFullDate ( Num : FullDate ) : BYTE;
        - Позволяет получить байтовое значение месяца из формата
    полной даты.

    FUNCTION GetDayInFullDate ( Num : FullDate ) : BYTE;
        -  Позволяет  получить  байтовое  значение дня месяца из
    формата полной даты.

    FUNCTION StrShortDate ( Num : ShortDate ) : STRING;
        - Производит  строковое преобразование  числа в  формате
    сокращенной  даты  в  символьную  строку  с   использованием
    разделителей. Например,   Чило 199202 будет  преобразовано в
    строку символов "02/1992".

    FUNCTION StrFullDate ( Num : FullDate ) : STRING;
        -  Аналогично  предыдущей  функции  производит строковое
    преобразование числа в формате полной даты используя  тот-же
    разделитель.

    FUNCTION ValShortDate ( Line : STRING;
                            VAR Num : ShortDate ) : BYTE;
        - Производит преобразование заданной  строки  в число  в
    формате сокращенной даты. Преобразуемая строка должна  иметь
    длину  7  символов.  В   качестве  разделителя  может   быть
    использован любой  символ. Так,  например, строка  "05/1991"
    будет  преобразована  в  число  199105.  В  качестве  своего
    значения  функция  возвращает  код  ошибки.  При  нормальном
    преобразовании возвращается нулевое значение.

    FUNCTION ValFullDate ( Line : STRING;
                            VAR Num : FullDate ) : BYTE;
    -   Аналогична    предущей   функции,    однако   производит
    преобразование  строки  в  число  в  формате  полной   даты.
    Соответсвенно  длина  преобразуемой  строки  составляет   10
    символов ( 8  цифр и два  разделителя ). Как  и в предыдущем
    случае функция возвращает код ошибки преобразования.



    PROCEDURE IncShortDate ( VAR Num : ShortDate );
        - Увеличивает число формата сокращенной даты на 1 месяц.

    PROCEDURE IncFullDate ( VAR Num : FullDate );
        - Увеличивает число полной даты на 1 день.

    FUNCTION ShortToFullDate ( Num : ShortDate ) : FullDate;
        - Преобразует число из формата сокращенной даты в формат
    полной даты. Во время  преобразования в формате полной  даты
    день определяется как первый день месяца.

    FUNCTION FullToShortDate ( Num : FullDate ) : ShortDate;
        -  Преобразует  число  из  формата  полной  даты в число
    формата   сокращенной   даты.    День   месяца   при    этом
    преобразовании теряется.

    FUNCTION CheckShortDate ( Dt, Min,
                              Max : ShortDate ) : BOOLEAN;
        -  Контролирует  вхождение  в  заданный диапазон числа в
    формате   сокращенной   даты.   Производится   проверка   на
    допустимость значений всех переданных функции параметров,  а
    также проверка на вхождение указанной даты в диапазон  между
    заданными  минимальным  и  максимальным  значениями  включая
    границы  диапазона.  В  случае  успешной  проверки   функция
    возвращает значение TRUE.

    FUNCTION CheckFullDate ( Dt, Min,
                              Max : FullDate ) : BOOLEAN;
        - Аналогична предыдущей функции, но производит  операции
    над числами в формате полной даты.

    FUNCTION GetSystemFullDate : FullDate;
        - Получает значение системной  даты и преобразует его  в
    число формата полной даты.

    PROCEDURE SetSystemFullDate ( Num : FullDate );
        -  Устанавливает  значение  системной  даты  по значению
    числа в формате полной даты.

    FUNCTION DealDays ( Num1, Num2 : FullDate ) : WORD;
        - Вычисляет количество  дней разницы между  двумя датами
    представленными в формате полной даты.

    FUNCTION DealMonthes ( Num1, Num2 : ShortDate ) : WORD;
        -  Вычисляет  количество  месяцев  разницы  между  двумя
    датами представленными в формате сокращенной даты.



        Процедуры и функции по обработке времени часов.

    FUNCTION GetHourInShortTime ( Num : ShortTime ) : WORD;
        -   Получить   значение   часов   из   числа  в  формате
    сокращенного времени.

    FUNCTION GetHourInFullTime ( Num : FullTime ) : WORD;
        - Получить  значение часов  из числа  в формате  полного
    времени.

    FUNCTION GetMinuteInShortTime ( Num : ShortTime ) : WORD;
        -   Получить   значение   минут   из   числа  в  формате
    сокращенного времени.

    FUNCTION GetMinuteInFullTime ( Num : FullTime ) : WORD;
        - Получить  значение минут  из числа  в формате  полного
    времени.

    FUNCTION GetSecondInFullTime ( Num : FullTime ) : WORD;
        - Получить  значение секунд  из числа  в формате полного
    времени.

    FUNCTION StrShortTime ( Num : ShortTime ) : STRING;
        -  Преобразование  числа  в  формате короткого времени в
    символьную  строку.  Преобразование  производится с участием
    разделителей. Например,  2359 будет  преобразовано в  строку
    "23:59".

    FUNCTION StrFullTime ( Num : FullTime ) : STRING;
        -  Преобразование  числа   формата  полного  времени   в
    символьную строку. Аналогично предыдущей функции.

    FUNCTION ValShortTime ( Line : STRING;
                        VAR Num : ShortTime ) : BYTE;
        -  Преобразование  символьной  строки  в  число  формата
    короткого времени.  Символьная строка  должна иметь  длину 5
    символов,   Причем   в   качестве   разделителя  разрешается
    использовать любой  из допустимых  символов. Так,  например,
    строка   "15:56"   будет   преобразована   в   число   1556.
    Возвращаемое функцией значение - код ошибки  преобразования.
    При возврате нулевого значения считается, что преобразование
    произведено успешно.

    FUNCTION ValFullTime ( Line : STRING;
                        VAR Num : FullTime ) : BYTE;
        -  Преобразование  символьной  строки  в  число  формата
    полного  представления   времени.  Действие   этой   функции
    аналогично   предыдущей,    за   исключением    того,    что
    преобразуемая  строка  должна  содержать  строковое значение
    полного времени часов,  минут и секунд  через разделительные
    символы.


    FUNCTION IncShortTime ( VAR Num : ShortTime ) : BYTE;
        - Увеличивает значение числа в формате короткого времени
    на 1  минуту. Функция  возвращает единичное  значение , если
    полученное время обозначает начало новых суток ( "00:00"  ),
    в остальных случаях функция возвращает нулевое значение.

    FUNCTION IncFullTime ( VAR Num : FullTime ) : BYTE;
        - Увеличивает значение  числа в формате  полного времени
    на 1 секунду.  Действие этой функции  аналогично предыдущей.
    При переходе  к новым  суткам функция   возвращает ненулевое
    значение.

    FUNCTION ShortToFullTime ( Num : ShortTime ) : FullTime;
        - Преобразует  число формата  короткого времени  в число
    формата   поного   времени.   При   этом   значение   секунд
    принмимается равным нулю.

    FUNCTION FullToShortTime ( Num : FullTime ) : ShortTime;
        -  Преобразует  число  формата  полного времени в числго
    формата  короткого  (  сокращенного  )  времени.  Во   время
    преобразования количество секунд отбрасывается.

    FUNCTION CheckShortTime ( Tm, Min,
                        Max : ShortTime ) : BOOLEAN;
        - Производит проверку  на вхождение в  заданный диапазон
    числа формата сокращенного времени. Кроме этого  проверяются
    на  допустимость  все  передаваемые  функции параметры. Если
    параметры   лежат   в   допустимом   диапазоне   значений  и
    контролируемое   время   находится   между   миниальным    и
    максимальным  заданными  значениями   включая  границы,   то
    возвращаемое  значение  TRUE,   во  всех  остальных  случаях
    возвращаемое функцией значение - FALSE.

    FUNCTION CheckFullTime ( Tm, Min,
                        Max : FullTime ) : BOOLEAN;
        -  Производит  аналогичную  проверку  только с числами в
    формате полного времени.

    FUNCTION GetSystemFullTime : FullTime;
        - Позволяет получить значение времени системных часов  в
    формате представления полного  времени. Значение сотх  долей
    секунд игнорируется.

    PROCEDURE SetSystemFullTime ( Num : FullTime );
        - Производит установку времени системных часов по  числу
    в  формате  полного  времени.  Значение  сотых  долей секунд
    устанавливается в 0.

    FUNCTION DealSecond ( Num1, Num2 : FullTime ) : WORD;
        -  Вычисляет  количество  секунд  между  двумя   числами
    представленными в формате полного времени.


           Процедуры и функции обработки кодов словарей.

    FUNCTION StrStringVoc ( Num : StringVoc ) : STRING;
        - Производит виктивное преобразование строкового кода по
    словарю в символьную строку.

    FUNCTION StrNumVoc ( Num : NumVoc ) : STRING;
        - Производит  преобразование обычного  кода по  словрю в
    символьную строку.

    FUNCTION StrShortVoc ( Num : ShortVoc ) : STRING;
        - Поизводит  преобразование короткого  кода по  словрю в
    символьную строку.

    FUNCTION StrRealVoc ( Num : RealVoc; 
                              VHi, VLo : BYTE ) : STRING;
        -  Производит  преобразование   вещественного  кода   по
    словарю в  символьную строку.  В качестве  второго параметра
    задается общее количество символов, а в качестве третьего  -
    количество символов после запятой ( точки ).

    FUNCTION CheckStringVoc ( VAR Voc : STRING; 
                        Stream : LineListPtr ) : LONGINT;
        -  Поизводит  проверку  присутствия  строкового  кода  в
    заданном потоке словаря. Строковый код представлен строковым
    значением.   В   качестве   результата   функция  возвращает
    порядковый номер строки потока, в которой обнаружен заданный
    код.  Если  такой  код  в  словаре  отсутствует,  то функция
    возвращает нулевое значение.

    FUNCTION CheckShortVoc ( VAR Voc : STRING; 
                        Stream : LineListPtr ) : LONGINT;
        -  Аналогична   по  действию   предыдущей  функции,   но
    производит    проверку    для    короткого    кода   словаря
    представленного строковым значением.

    FUNCTION CheckNumVoc ( VAR Voc : STRING; 
                        Stream : LineListPtr ) : LONGINT;
        -  Аналогична   по  действию   предыдущей  функции,   но
    производит    проверку    для    обычного    кода    словаря
    представленного строковым значением.


    FUNCTION CheckRealVoc ( VAR Voc : STRING; 
                        Stream : LineListPtr ) : LONGINT;
        -  Аналогична   по  действию   предыдущей  функции,   но
    производит   проверку   для   вещественного   кода   словаря
    представленного строковым значением.

    FUNCTION ValShortVoc ( Line : STRING; 
                        VAR Num : ShortVoc;
                        Stream : LineListPtr ) : BYTE;
        -  Производит  преобразование  из  строкового  формата в
    число  формата  короткого  кода  словаря  в том случае, если
    такой код  присутствует в  заданной потоке словаря. В случае
    успешного завершения функция возвращает нулевое значение.

    FUNCTION ValNumVoc ( Line : STRING; 
                        VAR Num : NumVoc;
                        Stream : LineListPtr ) : BYTE;
        -  Производит  преобразование  из  строкового  формата в
    число  формата  обычного  кода  словаря  в  том случае, если
    такой код  присутствует в  заданной потоке словаря. В случае
    успешного завершения функция возвращает нулевое значение.

    FUNCTION ValRealVoc ( Line : STRING; 
                        VAR Num : RealVoc;
                        Stream : LineListPtr ) : BYTE;
        -  Производит  преобразование  из  строкового  формата в
    число формата вещественного кода словаря в том случае,  если
    такой код  присутствует в  заданной потоке словаря. В случае
    успешного завершения функция возвращает нулевое значение.

