                А.А.Титов, 1989



                Динамическая эмуляция альтернативной кодировки
                русских символов на ПЭВМ "ПРАВЕЦ-16"


    Компьютер "ПРАВЕЦ-16" может работать лишь с определенным
множеством кодировок (соответствующих программам-переключателям
MIK, MSX, KOI8, IBM). Предлагаемая изготовителем кодировка MIK
сейчас (как и основная кодировка) вытесняется альтернативной,
прежде всего из-за неправильного расположения псевдографики в
таблице кодов. Если нужно работать с программой, подготовленной в
кодировке MIK, на компьютере с видеоадаптером EGA или VGA, то
достаточно перезагрузить знакогенератор (например, программой
ALFA). Если же компьютер работает в кодировке, отличной от MIK,
и не имеет средств перезагрузки знакогенератора, с программой в
MIK-кодировке работать нельзя.  Аналогичные трудности возникают
при необходимости работать на ПЭВМ "ПРАВЕЦ-16" с программой,
подготовленной в основной или альтернативной кодировке.
    Эти проблемы решаются для случая совместимости MIK с
альтернативной кодировкой с помощью предлагаемой нами программы.
Ниже приводится исходный текст программы, эмулирующей на ПЭВМ
"ПРАВЕЦ-16" основную кодировку. При этом обрабатываются даже
программы, работающие с видеопамятью помимо DOS и BIOS.
Важной особенностью нашей прогаммы является сохранение кодировки
MIK. Это значит, что могут выполняться (без каких-либо
переключений) как программы, работающие в кодировке MIK, так и
в альтернативной кодировке. На печать будут правильно выводиться
оба вида текстов.
    Принцип работы программы следующий: перекодировки вставлены в
прерывания вывода на печать и на консоль. Кроме этого, перед
любым запросом на ввод с ожиданием с консоли сканируется и
перекодируется видеопамять CGA. Это происходит с некоторым (почти
незаметным) замедлением, если отсутствует турбо-режим.
Сканирование не делается при горизонтальных м вертикальных
передвижениях курсора и при наборе текста в текстовых редакторах.
Пользователь может отключить (а потом, если нужно, включить)
сканирование одновременным нажатием левой клавиши Shift и клавиши
Home. Отсюда ясны ограничения программы: она может работать
только с адаптером CGA и только с альтернативной кодировкой. При
эмуляции основной кодировки возникают принципиальные сложности,
связанные с частичным наложением зон русских букв в основной и
MIK таблицах. Конечно, возможно победить эти сложности
программным путем, и читатель может это сделать, если пожелает.
    Для многих программистов представит интерес то, как мы
"вклиниваемся" в видеопамять и при этом не вызываем на экране
атомосферных осадков. "Снег", "дождь" и "молнии" появляются, если
менять содержимое видеопамяти во время регенерации. Мы ждем
начала регенерации, потом ее конца и сразу сканируем участок
памяти. Это надо успеть сделать за промежуток времени между двумя
регенерациями, вот почему мы ждем два раза - чтобы использовать
этот промежуток полностью.
      Если Вы работаете в турбо-режиме, смело можете
перкодировать 3 байта за промежуток - снег еще не появляется, и
замедление совсем не чувствуется.
    Наша программа постоянно совершенствуется, вот почему мы
бесстрашно предлагаем Вам ее исходный текст. Мы уверены, что она
поможет Вам работать со многими полезными программами и
документацией, подготовленными на русском языке в альтернативной
кодировке, так же, как помогает нам. Для приобретения новых
версий просим обращаться к нам.
