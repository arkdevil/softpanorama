                                ИВИНСКИХ Валерий Рудольфович
                                -------------------------------
                                Alice Software, Днепродзержинск



                   АНТИВИРУСНЫЙ  БАРЬЕР


   В этой небольшой заметке мне бы хотелось еще раз обратиться к
ставшей уже классической теме борьбы с вирусами, а точнее, борь-
бы создателей антивирусных  программ  с разработчиками вирусов и
наоборот.  В настоящее время имеется великое множество программ,
призванных защитить рядового пользователя от коварных вирусов, и
автор каждой такой программы хочет верить,  что дарит миру пана-
цею если не от всех, то от многих бед.  Собственно говоря, начи-
ная писать эту заметку,  я тоже втайне надеюсь, что мои идеи по-
трясут  всех и обратят  в крайнее уныние многих техно-крыс;  так
это или нет - читайте дальше и решайте сами.
   Мой небольшой багаж знаний,  приобретенный во время прочтения
работ  известных специалистов по компьютерным вирусам,  позволил
сделать следующие выводы.  Все антивирусные программы,  несмотря
на их  обилие и многообразие,  делятся на два  основных типа,  а
именно :

 1. Резидентные сторожа, постоянно отслеживающие факты обращения
    к  диску и  в случае  каких-либо  подозрительных действий со
    стороны работающих программ извещающие об этом пользователя.
    Смысл такого  извещения  сводится к запросу  типа "Разрешать
    запись на такую-то область диска али как ?"  После двух-трех
    сотен таких запросов доведенный  до белого каления пользова-
    тель  отстраняет  сторожа  от должности,  тем самым облегчая
    жизнь себе ( и вирусам ). Другие сторожа отслеживают измене-
    ние векторов прерываний  и вновь бросаются со своими пробле-
    мами к пользователю,  который должен либо успокоить их, либо
    насторожиться сам. Да к тому же сторожа, являясь резидентны-
    ми программами,  зачастую конфликтуют с другими резидентами.
    Так что давайте рассмотрим второй тип антивирусных программ.

 2. Программы-детекторы  и доктора ( фаги ),  которые  позволяют
    обнаружить  зараженные файлы и, по возможности, вылечить их,
    то есть, фактически, борются с последствиями вирусной атаки.
    И спасибо,  что есть такие программы - не будь их,  пришлось
    бы каждый раз  при подозрении на наличие заразы  производить
    переформатирование диска ( ладно бы дискеты,  а если заражен
    винчестер ? )  Самая популярная у нас антивирусная программа
    -  AIDSTEST  - как раз относится  к типу докторов.  Но и тут
    есть один очень неприятный момент -  доктор может обнаружить
    только те вирусы, о которых он знает, а любой новый вирус до
    того,  как попасть на операционный стол к г-ну  Д.Лозинскому
    ( позор тому, кто не знает, что это разработчик AIDSTEST'а),
    успеет натворить кучу бед, и спешащая по следам новая версия
    AIDSTEST сможет лишь предотвратить новые катастрофы.  Вспом-
    ните,  именно так получилось с вирусом  DIR-1024,  который в
    свое время у многих попил кровушки ( в том числе,  кстати, и
    у меня тоже ).

   И третий вывод,  к которому я пришел - невозможно универсаль-
ное  средство борьбы с  вирусами.  Осмыслив все это,  принялся я
соображать дальше. Вот статья, рекомендуют иметь образцовую рас-
содержимое оного. А вот такую же нехитрую процедурку рекомендуют
проводить и с главной загрузочной записью ( MBR ).  Логично, по-
думалось мне, но что будет толку, если вирус залетит в Boot-сек-
тор и компьютер  перестанет загружаться с винчестера ?  Тогда-то
уж и сверять испорченный сектор с образцом будет незачем,  и так
понятно,  что надо спасать уцелевшее.  А вот если бы  просто-на-
просто не допустить записи вируса в бутовую область... постойте,
а  почему  именно вируса - туда вообще  никто никогда ничего  не
должен  записывать !  Вы  подумайте - никто, никогда, ничего, -
тут и резидентному сторожу  ни о чем переспрашивать пользователя
не нужно,  не пущать - и все тут !  Так, допустим, сможем мы MBR
и Boot-сектор защитить от любой записи,  а что это даст ?  А то,
что теперь после вирусной атаки винчестер  не потеряет парциаль-
ную таблицу и компьютер сохранит  способность загружаться с вин-
честера. Ой, не совсем так,  ведь вирус может покромсать IO.SYS,
MSDOS.SYS или COMMAND.COM - как с ними-то быть ? Немного пошеве-
лив мозгами, я пришел к мысли, что и в ту область, где находятся
эти файлы,  тоже в обычных условиях ничего записывать  не прихо-
дится.  И тут уж совсем близко до той гениальной идеи, к которой
я в результате пришел - собрать все файлы DOS, самые необходимые
дисковые утилиты и антивирусы-фаги  на загрузочном разделе  вин-
честера ( обычно это диск C: ) и  полностью закрыть его по запи-
си !  В этом случае при вирусной атаке мы, самое худшее, потеря-
ем программы и данные  на дискетах  или других разделах жесткого
диска, но зато сможем без проблем перезагружаться, не прибегая к
помощи  заклеенной дискетки с системой,  как это обычно бывает в
подобных случаях. Опять же, можно было бы и с дискеты перезагру-
зиться,  но если вирус отформатирует 0 дорожку винчестера, то...
Врагу не пожелаю, сам такое однажды испытал. А предложенный под-
ход  позволит  уберечься от этого -  перезагружайся  и  запускай
AIDSTEST,  который либо вылечит зараженные файлы, либо ничего не
обнаружит, если это был какой-нибудь суперновый вирус типа  ZZZ-
12345 ( не ищите его в каталогах, это я так, к примеру ). Думаю,
в целом вам эта концепция ясна.
   Распираемый гордостью за себя, сел я полистать свежий номерок
Софтпанорамы  и  обнаружил,  что программ,  подобных  задуманной
мною,  предлагается предостаточно.  Фактически, это и есть рези-
дентные сторожа, о которых уже шла речь. Попробовав в деле неко-
торые из них,  я убедился, что,  во-первых, они действительно не
позволяют ничего записывать на защищаемые разделы  жесткого дис-
ка командами  DOS и Norton Commander, и, во-вторых, тот же вирус
DIR преспокойно заражает COMMAND.COM, обходя все защиты. Немного
поразбиравшись, я выяснил,  что большинство таких сторожей вклю-
чаются в цепочку обработчиков прерывания INT 13H, причем ДО про-
цедур DOS, в то время как DIR-1024 "бьет пониже", и не только он
один.  Тут уж мне пришлось немного полистать книжки по Ассембле-
ру, DOS, в результате чего и появилась программа, названная мною
" Антивирусным Барьером " - BARRIER.SYS. К основным особенностям
этой программы можно отнести :

 -- под защиту от записи берется 0 дорожка винчестера, где нахо-
    дится парциальная таблица и,  возможно,  расширенные таблицы
    DM или ADM, если они есть,  а также загрузочный раздел, гра-
    ницы которого с точностью до сектора  определяются из парци-
    альной таблицы;
 -- все  операции  записи и форматирования,  относящиеся  к этим
    областям,  завершаются  с признаком  Write Protect Error  и,
    кроме того, выдачей звукового сигнала;
 -- защищающий модуль включается,  естественно,  в цепочку обра-
    ботчиков прерывания INT 13H, но не перед DOS, а после, вкли-
    ниваясь непосредственно между DOS и ROM-BIOS;
 -- программа оформлена в виде псевдо-драйвера и запускается при
    выполнении строки DEVICE=BARRIER.SYS файла CONFIG.SYS. Жела-
    тельно, чтобы эта строчка стояла самой первой, в этом случае
    все последующие  загружаемые программы  выдадут себя с голо-
    вой жутким писком, если они заражены;
 -- BARRIER гневно пресекает  все попытки вирусов определить ад-
    рес обработчика  INT 13H в ROM-BIOS -  эта схватка может за-
    кончиться даже зависанием системы, но враг не пройдет !
 -- и при всем при этом BARRIER занимает всего  160 байт памяти,
    увеличивая продолжительность обработки  INT 13H на несколько
    десятков тактов процессора;
 -- естественно,  BARRIER не может быть обнаружен  при просмотре
    цепочки блоков памяти  и  не трогает вектор INT 13H;
 -- BARRIER  позволяет не  ставить  защиту при загрузке системы,
    но сделать это сможет только тот, кто знает, как.

   Честно говоря,  и не знаю,  чем еще похвастаться, самое глав-
ное, пожалуй, то,  что с момента установки на машину BARRIER уже
неоднократно  оповещал о вирусной атаке,  завершавшейся плачевно
для вируса и хозяина дискеты,  который приносил ее на мой компю-
тер.  Вот, собственно,  моя идея,  было бы интересно узнать мне-
ние широких масс по этому поводу. Для заинтересовавшихся описан-
ной проблемой оставляю свои координаты :

     322637, г.Днепродзержинск-37,
             а/я 1207
             Научно-производственная частная фирма "Alice",
             Alice Software
________________________________________________________________
