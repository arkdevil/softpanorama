                        Активатор  меню  АКТМЕН

                  "Южтехэнерго", ОАСОТ, 1990, Л.Романов



    Программа обеспечивает организацию активной системы окон (и оконных меню) и
    позволяет :

  - оперировать с формально неограниченным количеством окон;

  - подключать на любой стадии диалога выполнение EXE, COM, BAT файлов
    "входя" в соотетствующий пункт меню, либо нажимая "hot key" ;

  - осуществлять диалог как в текстовом, так и в графическом режимах
    работы дисплея;

    Cтруктура окон и организация диалога задаются в управляющем текстовом
файле, имя которого указывается в командной строке при запуске программы.
Каждая строка этого файла должна быть неидлиннее 80 знаков и начинаться
одним из следующих символов:

    >>   не менее двух знаков '>' являются признаком, что это именно
         файл, предназначенный для обработки АКТМЕНом;

     *   признак начала описания окна;

     #   признак комментария;

     -   дефис,- является признаком исполняемой операции;

     =   признак "hot key", обьединяющей предыдущие операции в
         исполняемую группу;

     .   точка,- является признаком пункта меню;

     +   то-же, выделенного;

     &   разделитель текстовой информации, отображаемой нормальными
         цветами;

     @   то же, выделенными цветами.


     Построение управляющего файла описывается на примере рис.1 и приведено
в таблице  1.

>>>>   Тестовый пример управляющего файла                         #номера строк
#                                                                 ########### 2
&^T1&15Нормальный текст, начиная с 5 столбца, 1 рядка &25 в окне            # 3
&^T2@1<Выделнный текст, начиная с 5 столбца, 12 рядка в окне                # 4
#                                                                           # 5
#    Нулевое окно (фиктивное) для первоначальной загрузки                   # 6
#                                                                           # 7
*0    0   0    0    0    0x000    0x0234  0x0123    0x0000     1      0     # 8
#    r0  c0   r1   c1    border   shrift    head     flags   keys   menu    # 9
#                        0xWXYZ  Y- фон, Z- шрифт, W, X- то же выделенные   #10
#                                                                           #11
&&                                              # это окно без заголовка    #12
-  a    B  &%out  zast_1  &&                    # запуск прогр. "out"       #13
-  1    1                                       # открыть окно '1'          #14
-  a    1                                       # открыть меню 'a'          #15
= FF    0                                       # "выполняется всегда"      #16
#                                                                           #17
#   Рабочее,- "обрамляющее" окно                                            #18
#                                                                           #19
*1    0   0    24   79   0x04E   0x7D7B  0x44E     0    2     0             #20
#    r0   c0   r1   c1   border  shrift  head  flags  keys  menu            #21
&Южтехэнерго  ЦАСУ ТП ОАСОТ                     # заголовок окна            #22
-  a    1                                       # активировать меню 'a' при #23
=  3C  0                                        #   нажатии 'F2'            #24
#                                                                           #25
- 2  1                                                                      #26
- 2  7     &hlp_1.txt &                                                     #27
= 3B  0                                         # чтение контекстной помощи #28
#                                                                           #29
#       Окно для выдачи контекстной подсказки                               #30
#                                                                           #31
*2  13   15    24   60     0x21E  0x7E1B 0x4E6B    0      1     0           #32
&&                                                                          #33
-  2   3                                                                    #34
=  1B  0                                                                    #35
#                                                                           #36
#      Рабочее  меню                                                        #37
#                                                                           #38
*a     1    1     0    0     0x21E  0x7E1B  0x4E6B    0   2      5   &12345 #39
#     r0   c0    r1   c1    border  shrift    head flags keys  menu hotKeys #40
& ОБОРУДОВАНИЕ                                  # заголовок окна            #41
. a 0               &&00 1. Пункт 1 пусто  &    # окно\операция\текст\пункт #42
+ 1 7      &file.dat &20 2. Чт. файла      &    # - " - (предлагается актив)#43
. 1 8           &^T1 &40 3. Норм. текст    &    # - " -                     #44
. 1 8           &^T2 &60 4. Выдел. текст   &    # - " -                     #45
. a 134             &&80 5. Конец работы   &    # - " -                     #46
#  закрываем все файлы                          #                           #47
-  a   3                                        # окно \ команда            #48
-  1   3                                        # - " -                     #49
-  0   3                                        # - " -                     #50
= 134  0                                        # "scan_code"  "shift_code" #51
#                                                                           #52
- 2  1                                                                      #53
- 2  7     &hlp_a.txt &                                                     #54
= 3B  0                                         # чтение контекстной помощи #55

                      Рис. 1. Пример управляющего файла


                                                                   Таблица 1.
+------+-------------------------------------------------------------------------+
| N стр|  Пояснение к строке управляющего файла                                  |
+------+-------------------------------------------------------------------------+
|   1  | Идентификационная строка                                                |
+------+-------------------------------------------------------------------------+
|   2  | пустой комментарий                                                      |
+------+-------------------------------------------------------------------------+
| 3,4  | Тексты, выводимые в окно:                                               |
|      |     ^T1 и ^T2  - имена текстов, выводимыч в окно;                       |
|      |      & и @  - признаки способа вывода текста (соотв. нормальный и       |
|      |              выделенный, а пара знаков, следующая за ними               |
|      |              указывают номера строки и столбца вывода (см. прил. 5)     |
+------+-------------------------------------------------------------------------+
|   8  | Описание формы окна:                                                    |
|      |       r0, c0 - координаты левого верхнего угла,                         |
|      |       r1, c1 - координаты правого нижнего угла (для меню можно r1=c1=0) |
|      |       border - шестнадцатиричное число вида 0xXYZ, где                  |
|      |                X - номер типа рамки (0 - 5), например 1 одиночная,      |
|      |                    2 двойная,                                           |
|      |                Y - номер цвета фона рамки (см. приложение)              |
|      |                Z - номер цвета полосок рамки                            |
|      |       shrift - шестнадцатиричное число вида 0xWXYZ, где                 |
|      |                W, X - номера цветов фона и букв для выделенного         |
|      |                       текста в окне,                                    |
|      |                Y, Z - то же, для нормального                            |
|      |       head   - аналогично shrift, но для заголовка окна                 |
|      |       flags  - список характеристик окна (см. приложение)               |
|      |       keys   - количество "hot keys"                                    |
|      |       menu   - количество пунктов меню                                  |
|      |         Если border=0 или shrift=0 , то соответственно отсутствуют      |
|      |    рамка и/или заголовок окна.                                          |
|      |         Первым в списке должно идти окнос номером 0, которое не         |
|      |    отображается на экран, но служит для ввода начальных команд.         |
|      |    Его размеры должны быть равны нулю.  Последующие окна могут          |
|      |    нумероваться в произвольном порядке.                                 |
+------+-------------------------------------------------------------------------+
|9,10  | Комментарий с пояснением к описанию окна                                |
+------+-------------------------------------------------------------------------+
|  12  | Текст заголовка окна (для окна 0 отсутствует)                           |
+------+-------------------------------------------------------------------------+
|  13  | Описание первой операции, содржащее:                                    |
|      |     'a'    "номер" окна , в которое направляется результат              |
|      |            операций чтения текста;                                      |
|      |     'B'    код операции (шестнадцатиричная цифра) или число,            |
|      |            большее 0xFF,- в данном случае указывается запуск            |
|      |            программы;                                                   |
|      |     '&%out zastav_1&'  аргумент операции, знаки '&' являются            |
|      |            разделителями, знак '%' требует не очищать экран             |
|      |            после отработки программы (вывода заставки).                 |
|      |            Текст может предваряться одним из следующих                  |
|      |            знаков  :                                                    |
|      |              %  запрещает восстановление предыдущего режима             |
|      |                 и очистку экрана дисплея;                               |
|      |              ?  требует нажатия какой-нибудь клавиши для                |
|      |                 возврата к системе меню;                                |
|      |              ^  признак имени текста.                                   |
|      |     Хотя к моменту операции окно 'a' еще не открыто, здесь эт           |
|      |     не имеет значения, т.к. нет ывода в окно.                           |
+------+-------------------------------------------------------------------------+
|  16  | Описание "hot key",-  клавиши, при нажатии которой выполняются          |
|      | три ранее описанные операции:  FF   скан-код клавиши (0-0x53)           |
|      |     или число 0xFF, обозначающе что команда выполняется при             |
|      |          активации окна без каких-либо нажатий                          |
|      |      0   шестнадцатиричное значение статуса управляющих клавиш          |
|      |     Значение кодов и статусов приведено в приложении 4.                 |
|      |     В качестве скан-кода может быть указано число большее 0xFF          |
|      |     в этом случае группа операций будет активироваться при              |
|      |     входе в пункт меню, содержащий такой-же код операции.               |
| 42-46| Описания пунктов меню,- номер окна, код операции и текст                |
|      | команды указываются аналогично, как в описании операции, но             |
|      | добавлен текст пункта меню, в котором первые два знака                  |
|      | указывают вирту- альные номера рядка и столбца в окне (номера           |
|      | больше 9 указываются последующими символами ASCII- см. приложение 5).   |
+------+-------------------------------------------------------------------------+

                   ПРИЛОЖЕНИЕ 1.
                Номера цветов  адаптера EGA

0  черный      4  красный              8  темно-серый    C  розовый   
1  синий       5  фиолетовый           9  ярко-синий     D  малиновый 
2  зеленый     6  коричневый           A  ярко-зеленый   E  желтый    
3  голубой     7  светло-серый         B  ярко-голубой   F  белый     


                      ПРИЛОЖЕНИЕ 2
                    Флаги состояния окон

   1    не очищать (не перекрашивать) область окна
   2    не сохранять изображение под окном, т.е. не стирать окно


                     ПРИЛОЖЕНИЕ 3
              Шестнадцатиричные коды операций

  1  открыть и активизировать окно
  3  закрыть окно и удалить с экрана
  7  вывести в окно текст из файла
  8  отобразиль текст (из управляющего файла) в окно
  B  запустить программу

                      ПРИЛОЖЕНИЕ  4
             Шестнадцатиричные коды некоторых клавиш

         скан-коды                                шифт-коды

   F1  3B       INS  52              правый Shift   1     правый Ctrl    4
   F2  3C       DEL  53              левый  Shift   2     левый  Ctrl  104
   ...          +    4E              Scroll Lock   10     Num  Lock     20
   F9  43       -    4A              Caps Lock     40     Caps Lock P 4000

                      ПРИЛОЖЕНИЕ 5
              Десятичные "эквиваленты" символов ASCII
                для указания координат вывода текста

     '0'   0        '='  13        'D'  20        'K'  27        'R'  34
     '1'   1        '>'  14        'E'  21        'L'  28        'S'  35
     ...  ...       '?'  15        'F'  22        'M'  29        'T'  36
     '9'   9        '@'  16        'G'  23        'N'  30        'U'  37
     ':'  10        'A'  17        'H'  24        'O'  31        'W'  38
     ';'  11        'B'  18        'I'  25        'P'  32        'X'  39
     '<'  12        'C'  19        'J'  26        'Q'  33        'Y'  40



     'Z'  41        'a'  48        'h'  55        'o'  62        'v'  69
     '['  42        'b'  49        'i'  56        'p'  63        'w'  70
     '\'  43        'c'  50        'j'  57        'q'  64        'x'  71
     ']'  44        'd'  51        'k'  58        'r'  65        'y'  72
     '^'  45        'e'  52        'l'  59        's'  66        'z'  73
     '_'  46        'f'  53        'm'  60        't'  67        '{'  74
     '`'  47        'g'  54        'n'  61        'u'  68        '|'  75


                      ПРИЛОЖЕНИЕ 6
                  Распечатка файла "file.dat"

&Daэто пример@Ecтекста&Faиз файла@Fkfile.dat