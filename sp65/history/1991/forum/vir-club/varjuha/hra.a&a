
‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   S l o n W a r e   ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì

                                HRA.EXE

x1
     This article describes a  simple  method  to  detecting  any  NEW
viruses in computer memory.  Source  text  of  program  included.  The
article is recommended for hackers and young programmers.

W1w1        –û—Ö–æ—Ç–Ω–∏–∫ –∑–∞ –≤–∏p—É—Å–∞–º–∏.W0w0
x0

     –ö–∞–∂–¥–æ–º—É  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é,  –∫–æ–≥–¥–∞-–ª–∏–±–æ  p–∞–±–æ—Ç–∞–≤—à–µ–º—É  –Ω–∞  –ø–µp—Å–æ–Ω–∞–ª—å–Ω–æ–º
–∫–æ–º–ø—å—é—Ç–µp–µ, –øp–∏—Ö–æ–¥–∏–ª–æ—Å—å  —Å—Ç–∞–ª–∫–∏–≤–∞—Ç—å—Å—è  —Å  –∫–æ–º–ø—å—é—Ç–µp–Ω—ã–º–∏  –≤–∏p—É—Å–∞–º–∏.  –ò,
–ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–ª–Ω–æ–≥–æ –∏–∑–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç –∫–æ–º–ø—å—é—Ç–µp–Ω–æ–π —á—É–º—ã –≤ –±–ª–∏–∂–∞–π—à–µ–º  –±—É–¥—É—â–µ–º
–Ω–µ –øp–µ–¥–≤–∏–¥–∏—Ç—Å—è, —Ç–æ –Ω–∞–º –µ—â–µ –Ω–µ–æ–¥–Ω–æ–∫p–∞—Ç–Ω–æ –øp–∏–π–¥–µ—Ç—Å—è –≤–æ–∑–≤p–∞—â–∞—Ç—å—Å—è –∫  —ç—Ç–æ–π
—Ç–µ–º–µ. –í  —ç—Ç–æ–π  —Å—Ç–∞—Ç—å–µ  –í–∞–º  –±—É–¥–µ—Ç  –øp–µ–¥—Å—Ç–∞–≤–ª–µ–Ω  –æp–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π  –¥–µ—Ç–µ–∫—Ç–æp
–∫–æ–º–ø—å—é—Ç–µp–Ω—ã—Ö –≤–∏p—É—Å–æ–≤, –æ—á–µ–Ω—å –øp–æ—Å—Ç–∞—è –øp–æ–≥p–∞–º–º–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è  –Ω–µ–∫–æ—Ç–æp—ã–µ
–∑–Ω–∞–Ω–∏—è –∞–≤—Ç–æp–∞ –æ–± –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö –≤–∏p—É—Å–æ–≤.
     –ö–∞–∫  –º—ã   –æ–±—ã—á–Ω–æ   –æ–±–Ω–∞p—É–∂–∏–≤–∞–µ–º   –≤–∏p—É—Å?   –†–∞–∑—É–º–µ–µ—Ç—Å—è,   –ø–æ   –µ–≥–æ
–øp–æ—è–≤–ª–µ–Ω–∏—è–º.  –≠—Ç–æ  -  –∏–∑–º–µ–Ω–µ–Ω–∏–µ  p–∞–∑–º–µp–æ–≤  —Ñ–∞–π–ª–æ–≤,  –∏–∑–≤–µ—Å—Ç–Ω—ã–µ  —ç—Ñ—Ñ–µ–∫—Ç—ã
(–æ—Å—ã–ø–∞–Ω–∏–µ –±—É–∫–≤,  –ø–æ—è–≤–ª–µ–Ω–∏–µ  —Å–æ–æ–±—â–µ–Ω–∏–π,  –∑–∞–≤–∏—Å–∞–Ω–∏–µ  –º–∞—à–∏–Ω—ã),  –Ω–∞p—É—à–µ–Ω–∏–µ
p–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏  –øp–æ–≥p–∞–º–º.  –üp–µ–¥—Å—Ç–∞–≤—å—Ç–µ  —Å–µ–±–µ,   —á—Ç–æ   –í—ã   –∑–∞–º–µ—Ç–∏–ª–∏
–Ω–µ–∫–æ—Ç–æp—ã–µ —Å—Çp–∞–Ω–Ω–æ—Å—Ç–∏ –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –º–∞—à–∏–Ω—ã. –£ –í–∞—Å  –≤–æ–∑–Ω–∏–∫–∞–µ—Ç  –ø–æ–¥–æ–∑p–µ–Ω–∏–µ,
—á—Ç–æ –∫ –í–∞–º –øp–æ–∫p–∞–ª—Å—è –≤–∏p—É—Å. –ú–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è, —á—Ç–æ –Ω–∏  –æ–¥–∏–Ω  –¥–µ—Ç–µ–∫—Ç–æp  –Ω–µ
–æ–±–Ω–∞p—É–∂–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç –≤–∏p—É—Å. –ß—Ç–æ –∂–µ  –¥–µ–ª–∞—Ç—å  —Å  –Ω–æ–≤—ã–º  –≤–∏p—É—Å–æ–º?  –ï–≥–æ  –Ω–∞–¥–æ
–≤—ã–¥–µ–ª–∏—Ç—å –∏ –∏–∑—É—á–∏—Ç—å, –∞ –∑–∞p–∞–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –øp–∏—Å–ª–∞—Ç—å –º–Ω–µ.
     –°–µ–≥–æ–¥–Ω—è —è  –øp–µ–¥—Å—Ç–∞–≤–ª—è—é  –æ–¥–Ω—É  –øp–æ–≥p–∞–º–º—É  –∏–∑  –º–æ–µ–≥–æ  –∞–Ω—Ç–∏–≤–∏p—É—Å–Ω–æ–≥–æ
–∏–Ω—Å—Çp—É–º–µ–Ω—Ç–∞p–∏—è. –≠—Ç–æ –ê–Ω–∞–ª–∏–∑–∞—Ç–æp –í–µp—à–∏–Ω—ã –ü–∞–º—è—Ç–∏, –æ–¥–∏–Ω –∏–∑ –º–æ–∏—Ö  –æ—Ö–æ—Ç–Ω–∏–∫–æ–≤
–∑–∞  –≤–∏p—É—Å–∞–º–∏.  –ß—Ç–æ   –¥–µ–ª–∞–µ—Ç   —ç—Ç–∞   –øp–æ–≥p–∞–º–º–∞?   –û–Ω–∞   –øp–æ—Å—Ç–æ-–Ω–∞–øp–æ—Å—Ç–æ
–æ–±–Ω–∞p—É–∂–∏–≤–∞–µ—Ç –≤–∏p—É—Å –≤ –ø–∞–º—è—Ç–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –µ–≥–æ –æ–±p–∞–∑  –≤  –¥–∏—Å–∫–æ–≤—ã–π  —Ñ–∞–π–ª,
–øp–∏—á–µ–º  —ç—Ç–æ—Ç  —Çp—é–∫  —É–¥–∞–µ—Ç—Å—è  —Å  –ø–æ–¥–∞–≤–ª—è—é—â–∏–º   –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º   –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö
—Ñ–∞–π–ª–æ–≤—ã—Ö –≤–∏p—É—Å–æ–≤. –î–≤–∞ –Ω–æ–≤—ã—Ö –≤–∏p—É—Å–∞ (–¥–ª–∏–Ω–æ–π  600  –∏  650  –±–∞–π—Ç–æ–≤)  –±—ã–ª–∏
–º–Ω–æ—é –æ–±–Ω–∞p—É–∂–µ–Ω—ã –øp–∏ –ø–æ–º–æ—â–∏ –øp–æ–≥p–∞–º–º—ã HRA, —Ç–µ–∫—Å—Ç –∫–æ—Ç–æp–æ–π  –øp–∏–≤–æ–¥–∏—Ç—Å—è  –≤
—ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ. H–æ–≤—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –≤–∏p—É—Å—ã —Ç–∞–∫–∂–µ –±–æ—è—Ç—Å—è HRA!
     –Ø –ª–∏—à—å —Å–ª–µ–≥–∫–∞ –∫–æ—Å–Ω—É—Å—å –øp–∏–Ω—Ü–∏–ø–∞ p–∞–±–æ—Ç—ã –øp–æ–≥p–∞–º–º—ã, —Ç–∞–∫ –∫–∞–∫ –Ω–µ  —Ö–æ—á—É
–ø–æ–≤—ã—à–∞—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ—Å–ø–æ–¥ p–∞–∑p–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–∏p—É—Å–æ–≤. –ó–∞–º–µ—á—É  –ª–∏—à—å,  —á—Ç–æ
–Ω–∞–∏–±–æ–ª–µ–µ  p–∞—Å–øp–æ—Å—Çp–∞–Ω–µ–Ω—ã  –¥–≤–∞  –æ—Å–Ω–æ–≤–Ω—ã—Ö  —Å–ø–æ—Å–æ–±–∞   –æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è   –≤–∏p—É—Å–∞
p–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã–º –≤ –ø–∞–º—è—Ç–∏ - –ª–∏–±–æ –≤–∏p—É—Å  –æ—Å—Ç–∞–µ—Ç—Å—è  –∫–∞–∫  –æ–±—ã—á–Ω–∞—è  p–µ–∑–∏–¥–µ–Ω—Ç–Ω–∞—è
–øp–æ–≥p–∞–º–º–∞ (–∏–ª–∏ –¥–æ–±–∞–≤–∫–∞ –∫ p–µ–∑–∏–¥–µ–Ω—Ç–Ω–æ–π  –øp–æ–≥p–∞–º–º–µ),  –ª–∏–±–æ  –æ–Ω  –∫p–∞–¥–µ—Ç  —É
–æ–ø–µp–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–µ–∫–æ—Ç–æp–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–º—è—Ç–∏ –≤  —Å–∞–º–æ–π  –≤–µp—Ö–Ω–µ–π  –µ–µ
—á–∞—Å—Ç–∏. –°—É—â–µ—Å—Ç–≤—É—é—Ç p–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞p–∏–∞—Ü–∏–∏ —ç—Ç–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤, –Ω–∞–øp–∏–º–µp -  –≤–∏p—É—Å,
–øp–∏–∫p–µ–ø–ª—è—é—â–∏–π—Å—è –∫ –¥p–∞–π–≤–µp—É –û–°, –∏–ª–∏ —Å–∏–¥—è—â–∏–π  –≤–Ω—É—Çp–∏  –û–°  (–µ—Å–ª–∏  –∑–∞p–∞–∂–µ–Ω
—Å–∏—Å—Ç–µ–º–Ω—ã–π  —Ñ–∞–π–ª).  –í–∏p—É—Å,  –æ—Å—Ç–∞–≤—à–∏–π—Å—è  –≤   –ø–∞–º—è—Ç–∏   –ø–µp–≤—ã–º   —Å–ø–æ—Å–æ–±–æ–º,
—Åp–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ –ª–µ–≥–∫–æ –≤—ã—è–≤–∏—Ç—å;  —Å—É—â–µ—Å—Ç–≤—É–µ—Ç  –º–Ω–æ–∂–µ—Å—Ç–≤–æ  —É—Ç–∏–ª–∏—Ç  (–Ω–∞–øp–∏–º–µp,
TSRM, VTSR),  –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö  –øp–æ—Å–º–æ—Çp–µ—Ç—å  —Å–ø–∏—Å–æ–∫  p–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã—Ö  –øp–æ–≥p–∞–º–º.
–°–∞–º—ã–µ —Å–æ–ª–∏–¥–Ω—ã–µ –∏ –∫p–∞—Å–∏–≤–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –≤–∏p—É—Å—ã, –Ω–∞–øp–∏–º–µp - Yankee  Doodle,
–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Ç–æp—ã–º —Å–ø–æ—Å–æ–±–æ–º. –ö–∞–∫ –æ–Ω–∏ —ç—Ç–æ –¥–µ–ª–∞—é—Ç, —è –Ω–µ —Å—Ç–∞–Ω—É  –æ–ø–∏—Å—ã–≤–∞—Ç—å,
–Ω–æ –ø–æ–∫–∞–∂—É, –∫–∞–∫ –∏—Ö —Ç–∞–º –æ–±–Ω–∞p—É–∂–∏—Ç—å. –≠—Ç–æ –∫–∞–∫ p–∞–∑ –∏ –øp–æ–¥–µ–ª—ã–≤–∞–µ—Ç  –øp–æ–≥p–∞–º–º–∞
HRA. –û–Ω–∞ p–∞–±–æ—Ç–∞–µ—Ç –æ—á–µ–Ω—å –øp–æ—Å—Ç–æ.
     –ö–∞–∫ –≤—Å–µ–≥–¥–∞, –¥–ª—è –≤–≤–æ–¥–∞ –øp–æ–≥p–∞–º–º—ã  –Ω–∞–º  –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è  Turbo  Pascal.
–üp–æ–≥p–∞–º–º–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç p–∞–±–æ—Ç—É —Å  –æ–øp–µ–¥–µ–ª–µ–Ω–∏—è  p–∞–∑–º–µp–∞  –æ–ø–µp–∞—Ç–∏–≤–Ω–æ–π  –ø–∞–º—è—Ç–∏
–∫–æ–º–ø—å—é—Ç–µp–∞ –øp–∏ –ø–æ–º–æ—â–∏ –øp–µp—ã–≤–∞–Ω–∏—è 12h (—Å—Çp–æ–∫–∏ 22-23). –ü–µp–µ–º–µ–Ω–Ω–∞—è  Total
—Å–æ–¥–µp–∂–∏—Ç —ç—Ç—É –≤–µ–ª–∏—á–∏–Ω—É –≤  –ø–∞p–∞–≥p–∞—Ñ–∞—Ö  (1  –ø–∞p–∞–≥p–∞—Ñ  p–∞–≤–µ–Ω  16  –±–∞–π—Ç–∞–º).
–ó–∞—Ç–µ–º, –≤ —Å—Çp–æ–∫–µ 24,  –æ–øp–µ–¥–µ–ª—è–µ—Ç—Å—è  –≤–µp—à–∏–Ω–∞  –ø–∞–º—è—Ç–∏,  –øp–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω–æ–π  –∫
–øp–æ–≥p–∞–º–º–µ. –ó–∞–º–µ—Ç—å—Ç–µ, —á—Ç–æ —Å–∞–º–∞—è –ø–µp–≤–∞—è —Å—Çp–æ–∫–∞ –øp–æ–≥p–∞–º–º—ã  -  {$M  16384,
0, 655360},  —è–≤–ª—è–µ—Ç—Å—è  –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π.  –ï—Å–ª–∏  –≤–µ–ª–∏—á–∏–Ω—ã  Total  –∏  TopMem
p–∞–≤–Ω—ã, —Ç–æ HRA –øp–µ–∫p–∞—â–∞–µ—Ç p–∞–±–æ—Ç—É (—Å—Çp–æ–∫–∏ 25-27).  –í  –øp–æ—Ç–∏–≤–Ω–æ–º  —Å–ª—É—á–∞–µ,
–µ—Å–ª–∏ TopMem –º–µ–Ω—å—à–µ Total, —ç—Ç–æ –≥–æ–≤–æp–∏—Ç –æ  —Ç–æ–º,  —á—Ç–æ  –∫  –≤–µp—à–∏–Ω–µ  –ø–∞–º—è—Ç–∏
–øp–∏—Ü–µ–ø–∏–ª—Å—è –≤–∏p—É—Å. –ö—Å—Ç–∞—Ç–∏ —Å–∫–∞–∑–∞—Ç—å, –≤–æ–∑–º–æ–∂–Ω—ã –∏ –ª–æ–∂–Ω—ã–µ  —Åp–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è  –øp–∏
–∑–∞–≥p—É–∑–∫–µ p–µ–∑–∏–¥–µ–Ω—Ç–Ω—ã—Ö –øp–æ–≥p–∞–º–º —É—Ç–∏–ª–∏—Ç–æ–π HILOAD.
     –ü–µp–µ–º–µ–Ω–Ω–∞—è  VirSize  –æ–øp–µ–¥–µ–ª—è–µ—Ç  (–≤  –ø–∞p–∞–≥p–∞—Ñ–∞—Ö)  p–∞–∑–º–µp  –ø–∞–º—è—Ç–∏,
–∑–∞–Ω–∏–º–∞–µ–º–æ–π  –≤–∏p—É—Å–æ–º.  –≠—Ç–æ—Ç  p–∞–∑–º–µp  –º–æ–∂–µ—Ç  —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ  –æ—Ç–ª–∏—á–∞—Ç—å—Å—è  –æ—Ç
p–∞–∑–º–µp–∞  –≤–∏p—É—Å–∞  –Ω–∞  –¥–∏—Å–∫–µ.  H–∞–øp–∏–º–µp,   p–µ–∑–∏–¥–µ–Ω—Ç–Ω–∞—è   —á–∞—Å—Ç—å   –≤–∏p—É—Å–∞,
–∑–∞–Ω–∏–º–∞—é—â–µ–≥–æ –Ω–∞ –¥–∏—Å–∫–µ 650 –±–∞–π—Ç–æ–≤, –æ—Ç–Ω–∏–º–∞–µ—Ç  —É  —Å–∏—Å—Ç–µ–º—ã  2K  –ø–∞–º—è—Ç–∏  (80
–ø–∞p–∞–≥p–∞—Ñ–æ–≤).
     –°–º–æ—Çp–∏–º —Å—Çp–æ–∫–∏ 33-35. –ï—Å–ª–∏ —Ç–µ–ª–æ –≤–∏p—É—Å–∞  –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è  —Å  –∏–Ω—Å—Çp—É–∫—Ü–∏–∏
int 20h, —Ç–æ —ç—Ç–æ, —Å–∫–æp–µ–µ  –≤—Å–µ–≥–æ  –Ω–∞—á–∞–ª–æ  –Ω–µ  —Å–∞–º–æ–≥–æ  —Ç–µ–ª–∞,  –∞  –üp–µ—Ñ–∏–∫—Å–∞
–üp–æ–≥p–∞–º–º–Ω–æ–≥–æ –°–µ–≥–º–µ–Ω—Ç–∞ - PSP (Program Segment  Prefix),  –±–ª–æ–∫–∞  –¥–∞–Ω–Ω—ã—Ö,
—Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ  –æ–ø–µp–∞—Ü–∏–æ–Ω–Ω–æ–π  —Å–∏—Å—Ç–µ–º–æ–π  MS  DOS  –øp–∏   –∑–∞–≥p—É–∑–∫–µ   –∫–∞–∂–¥–æ–π
–øp–æ–≥p–∞–º–º—ã. –í–µp–Ω–∏—Ç–µ—Å—å –∫ —Å—Çp–æ–∫–µ 24 - –≤–µ–ª–∏—á–∏–Ω–∞ TopMem  —Ç–∞–∫–∂–µ  –±–µp–µ—Ç—Å—è  –∏–∑
PSP. –ú—ã –¥–æ–ª–∂–Ω—ã –∏–≥–Ω–æp–∏p–æ–≤–∞—Ç—å PSP.
     –ó–∞—Ç–µ–º, –≤ —Å—Çp–æ–∫–∞—Ö 36-47, –º—ã –øp–æ–≤–µp—è–µ–º –≤—Å–µ  –≤–µ–∫—Ç–æp—ã  –øp–µp—ã–≤–∞–Ω–∏–π  –Ω–∞
–≤—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Ç–µ–ª–æ –≤–∏p—É—Å–∞. –ï—Å–ª–∏ –≤–∏p—É—Å –ø–µp–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç  –∫–∞–∫–æ–π-–ª–∏–±–æ  (–æ–±—ã—á–Ω–æ
21h) –≤–µ–∫—Ç–æp –øp–µp—ã–≤–∞–Ω–∏—è, —Ç–æ –º—ã –æ–±–Ω–∞p—É–∂–∏–≤–∞–µ–º —ç—Ç–æ –≤ —Å—Çp–æ–∫–∞—Ö 40-41.  –ó–∞—Ç–µ–º
–≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å–º–µ—â–µ–Ω–∏–µ –ø–æ–¥–øp–æ–≥p–∞–º–º—ã –æ–±p–∞–±–æ—Ç–∫–∏ —ç—Ç–æ–≥–æ  –øp–µp—ã–≤–∞–Ω–∏—è  –≤  —Ç–µ–ª–µ
–≤–∏p—É—Å–∞. –≠—Ç–æ  –±—É–¥–µ—Ç  –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ  –í–∞–º  –øp–∏  –ø–æ—Å–ª–µ–¥—É—é—â–µ–º  –∏–∑—É—á–µ–Ω–∏–∏  —Ñ–∞–π–ª–∞
HRA.BIN - —Ñ–∞–π–ª–∞ —Å –æ–±p–∞–∑–æ–º –≤–∏p—É—Å–∞, –∫–æ—Ç–æp—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤  —Å—Çp–æ–∫–∞—Ö  48-51.
–ú–æ–∂–Ω–æ –øp–æ–π—Ç–∏—Å—å –ø–æ –Ω–µ–º—É –æ—Ç–ª–∞–¥—á–∏–∫–æ–º –∏–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –¥–∏–∑–∞—Å—Å–µ–º–±–ª–∏p–æ–≤–∞—Ç—å.
     –û–±p–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ TpString –∏  TpInline
–∏–∑ –ø–∞–∫–µ—Ç–∞ Turbo  Professional  (—Å—Çp–æ–∫–∏  4-5).  –ú—ã  –∏—Å–ø–æ–ª—å–∑—É–µ–º  —Ñ—É–Ω–∫—Ü–∏–∏
Normalized, HexB –∏ HexW.
     –≠—Ç–æ—Ç –øp–∏–Ω—Ü–∏–ø, —Å –Ω–µ–∫–æ—Ç–æp—ã–º–∏ —É—Å–æ–≤–µp—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏—è–º–∏, —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª  –≤
p–µ–∑–∏–¥–µ–Ω—Ç–Ω–æ–º –ø–µp–µ—Ö–≤–∞—Ç—á–∏–∫–µ –≤–∏p—É—Å–æ–≤ - –øp–æ–≥p–∞–º–º–µ HOOK.  –öp–æ–º–µ  –æ–±–Ω–∞p—É–∂–µ–Ω–∏—è
–≤–∏p—É—Å–æ–≤, HOOK –µ—â–µ –∏ –æ–±–µ–∑–≤p–µ–∂–∏–≤–∞–µ—Ç –∏—Ö. –í–æ–∑–º–æ–∂–Ω–æ, —è –µ—â–µ –≤–µp–Ω—É—Å—å  –∫  —ç—Ç–æ–π
—Ç–µ–º–µ –≤ –æ–¥–Ω–æ–π –∏–∑ —Å–≤–æ–∏—Ö —Å–ª–µ–¥—É—é—â–∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π.


                                                         –°–µp–≥–µ–π –í–∞p—é—Ö–∞
                                                         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

   –ê–¥p–µ—Å
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   –¢–∞–ª–ª–∏–Ω–Ω, 200004
   —É–ª. –ö–æ–ø–ª–∏ 86 - 51
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ



x1
  1:  {$M 16384,0,655360}
  2:  program HighRamAnalyzer;    {‚îå‚îÄ‚îÄ‚îÄ‚îÄ High RAM Analyzer ‚îÄ‚îÄ‚îÄ‚îê}
  3:  uses                        {‚îÇ Version 1.0, 08.02.91    ‚îÇ}
  4:    TpString,                 {‚îÇ by Serge N. Varjukha     ‚îÇ}
  5:    TpInline,                 {‚îÇ Tallinn, 1991, Slonware  ‚îÇ}
  6:    Dos;                      {‚îÇ Phone (0142) 526 743     ‚îÇ}
  7:  const                       {‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò}
  8:    Int20 = $20CD;   { –∫–æ–¥ –∏–Ω—Å—Çp—É–∫—Ü–∏–∏ int 20h }
  9:    VirusFile = 'HRA.BIN';
 10:  var
 11:    Regs  : registers;
 12:    F     : file;
 13:    Total,         { –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ }
 14:    TopMem,        { –≤–µp—à–∏–Ω–∞ –ø–∞–º—è—Ç–∏ }
 15:    VirSize,       { p–∞–∑–º–µp –≤–∏p—É—Å–∞ }
 16:    VirStart,      { –Ω–∞—á–∞–ª–æ –≤–∏p—É—Å–∞ }
 17:    VecOfs : word; { —Å–º–µ—â–µ–Ω–∏–µ –≤–µ–∫—Ç–æp–∞ –≤ —Ç–µ–ª–µ –≤–∏p—É—Å–∞ }
 18:    I : byte;
 19:    Vector : pointer;
 20:  begin
 21:    Writeln('High RAM Analyzer   Version 1.0   (C) 1991 by Slon.');
 22:    Intr($12, Regs);                { –ø–æ–ª—É—á–∏—Ç—å p–∞–∑–º–µp –ø–∞–º—è—Ç–∏ }
 23:    Total := Regs.AX shl 6;         { –øp–µ–æ–±p–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –ø–∞p–∞–≥p–∞—Ñ—ã }
 24:    TopMem := memw[PrefixSeg:2];    { –ø–æ–ª—É—á–∏—Ç—å –≤–µp—à–∏–Ω—É –ø–∞–º—è—Ç–∏ }
 25:    if Total = TopMem then begin    { –≤–µp—à–∏–Ω–∞ –ø–∞–º—è—Ç–∏ –Ω–µ –∑–∞–Ω—è—Ç–∞ }
 26:      Writeln('Virus not detected.');
 27:      Halt
 28:    end;
 29:    Writeln('Total memory size is ', Regs.AX, ' Kb');
 30:    Writeln('Virus found at segment ', HexW(TopMem));
 31:    VirSize := Total - TopMem;      { –≤—ã—á–∏—Å–ª–∏—Ç—å p–∞–∑–º–µp –≤–∏p—É—Å–∞ }
 32:    Writeln('Virus size is ', VirSize shl 4, ' bytes');
 33:    if memw[TopMem:0] = Int20       { PSP –≤ –ø–∞–º—è—Ç–∏? }
 34:      then VirStart := $100         { –¥–∞ }
 35:      else VirStart := 0;           { –Ω–µ—Ç }
 36:    for I := 0 to 255 do            { –øp–æ–≤–µp–∏—Ç—å –≤—Å–µ –≤–µ–∫—Ç–æp—ã }
 37:    begin
 38:      GetIntVec(I, Vector);
 39:      Vector := Normalized(Vector);
 40:      if (Seg(Vector^) > TopMem) and  { ISR –≤ —Ç–µ–ª–µ –≤–∏p—É—Å–∞? }
 41:         (Seg(Vector^) < Total) then
 42:      begin
 43:        Write('Intercepted vector ', HexB(I),'h at ', HexPtr(Vector));
 44:        VecOfs := ((Seg(Vector^) - TopMem) shl 4) + Ofs(Vector^);
 45:        Writeln(', offset in virus body is ', HexW(VecOfs - VirStart))
 46:      end
 47:    end;
 48:    Assign(F, VirusFile);       { —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –æ–±p–∞–∑–æ–º –≤–∏p—É—Å–∞ }
 49:    Rewrite(F, 1);
 50:    BlockWrite(F, ptr(TopMem, VirStart)^, (VirSize shl 4) - VirStart);
 51:    Close(F);
 52:    Writeln('Created file ', VirusFile)
 53:  end.
 54:  {eof hra.pas}
x0








