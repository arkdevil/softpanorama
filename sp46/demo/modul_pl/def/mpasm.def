(****************************************************************************)
(*                        MPASM.DEF 2.00                                    *)
(*                    Modula Tools Plus 2.00                                *)
(*                  Copyright (c) Holofax 1992.                             *)
(*              All rights reserved. Ukraine. Kiev.                         *)
(****************************************************************************)

(*# module(implementation => off, init_code => off) *)
(*# call(reg_saved => (ds, si, di,st1,st2)) *)
(*# call(reg_param => () ) *)
(*$G+*)
DEFINITION MODULE MpAsm;
(*╔════════════════════════════════════════════════════════════════════════╗*)
(*║                   Ассемблерная библиотека.                             ║*)
(*╚════════════════════════════════════════════════════════════════════════╝*)


VAR
  _Logic  : SHORTCARD ;
  _Screen : POINTER TO ARRAY[0..MAX(CARDINAL)-1] OF BYTE;
  _AreaX1 : CARDINAL;
  _AreaY1 : CARDINAL;
  _AreaX2 : CARDINAL;
  _AreaY2 : CARDINAL;

  f_seg   : CARDINAL;
  f_ofs   : CARDINAL;
  f_high  : CARDINAL;

PROCEDURE SHLStr(Dest: ADDRESS; Lenght: CARDINAL; n : CARDINAL) ;

PROCEDURE SHRStr(Dest: ADDRESS; Lenght: CARDINAL; n : CARDINAL) ;

PROCEDURE LogOpStr(Sourse,Dest: ADDRESS; Lenght: CARDINAL; op,masks : CARDINAL ) ;

PROCEDURE Move(Sourse,Dest: ADDRESS; Lenght: CARDINAL) ;

PROCEDURE Seg(adr: ADDRESS) : CARDINAL ;

PROCEDURE Ofs(adr: ADDRESS) : CARDINAL ;

PROCEDURE SegNorm(adr: ADDRESS) : CARDINAL ;

PROCEDURE OfsNorm(adr: ADDRESS) : CARDINAL ;

PROCEDURE ScrOn() ;

PROCEDURE ScrOff() ;

PROCEDURE WaitForLine(nline:CARDINAL) ;

PROCEDURE WaitVerRetrace() ;

PROCEDURE IncBcd(VAR Bcd : SHORTCARD; val : SHORTCARD) : SHORTCARD;

PROCEDURE DecBcd(VAR Bcd : SHORTCARD; val : SHORTCARD) : SHORTCARD;

PROCEDURE GetReg(Regs : ADDRESS) ;
(* Предназначена для определения содержимого регистров в момент call. *)
(* По адресу a_seg:a_ofs сохраняются регистры ax,cx,dx,bx,ds,es,si,di *)
(* ------------------------------------------------------------------ *)

PROCEDURE _SetLogic(log : SHORTCARD);

PROCEDURE _SetPage(page : SHORTCARD; status : SHORTCARD);

PROCEDURE _CopyPage(x1,y1,x2,y2 : CARDINAL; sor,des : SHORTCARD);

PROCEDURE _Mode(mod : CARDINAL);

PROCEDURE _SetFont(AdrFont : ADDRESS; hi : CARDINAL);

PROCEDURE _PlotEGA(x,y : INTEGER; c : CARDINAL);

PROCEDURE _LineEGA(x1,y1,x2,y2 : INTEGER; c : CARDINAL);

PROCEDURE _OutCharEGA(x,y : INTEGER; ch : CHAR; cf,cb : CARDINAL);

PROCEDURE _LeftScanEGA(ptr : ADDRESS; border,lim : CARDINAL;
                                      left : INTEGER) : INTEGER;
(*                                                                          *)
(* ════════════════════════════════════════════════════════════════════════ *)
PROCEDURE _RightScanEGA(ptr : ADDRESS; border,lim : CARDINAL;
                                       right : INTEGER) : INTEGER;
(*                                                                          *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE _NextCharEGA(ch : CHAR; cf,cb : CARDINAL);

PROCEDURE _GetBarEGA(l,t,r,b : CARDINAL; buf : ADDRESS);

PROCEDURE _PutBarEGA(buf : ADDRESS);

PROCEDURE _ClearBarEGA(l,t,r,b,color : CARDINAL);

PROCEDURE _UpCase(Ch : CHAR) : CHAR;
(* Возвращает символ Ch в верхнем регистре *)

PROCEDURE _LoCase(Ch : CHAR) : CHAR;
(* Возвращает символ Ch в нижнем регистре *)

PROCEDURE _StrUpCase(VAR Str : ARRAY OF CHAR);
(* Изменяет в строке символы нижнего регистра на верхний *)

PROCEDURE _StrLoCase(VAR Str : ARRAY OF CHAR);
(* Изменяет в строке символы нижнего регистра на верхний *)

END MpAsm.
