(****************************************************************************)
(*                       MPLWS.DEF 2.00                                     *)
(*                    Modula Plus Tools 2.00                                *)
(*                  Copyright (c) Holofax 1992.                             *)
(*              All rights reserved. Ukraine. Kiev.                         *)
(****************************************************************************)

DEFINITION MODULE MpLWS;
(*╔════════════════════════════════════════════════════════════════════════╗*)
(*║        Низко уровневая оконная графическая система.                    ║*)
(*╚════════════════════════════════════════════════════════════════════════╝*)

(* -----------------------------------------------------------------------
    Модуль позволяет создавать 2 типа окон : постоянные и временные. Под
  "постоянными" окнами понимается окна, экранный буфер которых распре-
  делен постоянно, а под "временными" - окна, буфер которых распреде-
  ляется при выводе окна на экран. Постоянные окна позволяют вывод в
  них, даже когда их на экране нет, но занимают (под экранный буфер)
  больше памяти.
    Весь экранный вывод можно переопределить процедурой Use в любое
  окно.
    Окно представляет собой прямоугольный образ части экрана, в который
  производится весь экранный вывод .
    Окно описывается :
    - четырьмя координатами окна,
    - четырьмя координатами области вывода,
    - адресом на область сохранения,
      а также для построения стека окон :
    - указателем на следующее и
    - предыдущее окна.
      Дополнительно :
    - признак временного окна,
    - признак активности (на экране или нет),
    - цвет фона окна,
    - ширина окна в байтах,
    - число пиксельных строк окна,
    - длина одной карты окна (ширина * число_строк).
    Окно создается процедурой Make, тип окна задается параметром hiden.
------------------------------------------------------------------------ *)

TYPE (* Описатель окна *)
  pWindow = POINTER TO Window;

VAR
  ScrWin  : pWindow; (* нижнее окно - экран *)
  TopWin  : pWindow; (* верхнее окно *)
  UseWin  : pWindow; (* рабочее окно *)

VAR
  Width   : CARDINAL; (* Ширина экрана в пикселях *)
  Depth   : CARDINAL; (* Высота экрана в пикселях *)
  NMap    : CARDINAL; (* Число битовых карт *)
  HFont   : CARDINAL; (* Высота шрифта *)
  Redraw  : BOOLEAN;  (* Признак вывода символа с фоном *)

VAR
  WidthCh : CARDINAL; (* Ширина экрана в символах (байтах) *)
  DepthCh : CARDINAL; (* Высота экрана в символах *)
  NColor  : CARDINAL; (* Число цветов *)



(* ------------------------------------------------------------------------- *)
(*               Низкоуровневые графические процедуры                        *)
(* ------------------------------------------------------------------------- *)

PROCEDURE GraphMode();
(* Установить графический режим.                                            *)
(* ════════════════════════════════════════════════════════════════════════ *)
PROCEDURE TextMode();
(* Установить текстовый режим.                                              *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Plot(x,y,c : CARDINAL);
(* Вывод точки в текущее окно. Координаты - графические.                    *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE HLine(x1,y,x2,c : CARDINAL);
(* Вывод горизонтальной линии в текущее окно. Координаты - графические.     *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE OutChar(ax,ay : CARDINAL; ch : CHAR; cf,cb : CARDINAL);
(* Вывод символа в текущее окно. Координаты ax,ay - символьные.             *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE OutStr(ax,ay : CARDINAL; str : ARRAY OF CHAR; cf,cb : CARDINAL);
(* Вывод строки в текущее окно. Координаты ax,ay - символьные.              *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE SetFont(fnt : ADDRESS; hi : CARDINAL);
(* Установить текущим шрифт, загруженный по адресу fnt, c высотой hi.       *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE DefineFont();
(* Установить текущим шрифт BIOS.                                           *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE SetActivPage(p : CARDINAL);
(* Определить страницу p (0,1) на запись-чтение.                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE SetVisualPage(p : CARDINAL);
(* Отображать страницу p (0,1)                                              *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE SetFullPage(p : CARDINAL);
(* Установить страницу p (0,1) отображаемой и рабочей.                      *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE CopyPage(ps,pd : CARDINAL);
(* Скопировать страницу ps в pd (0,1).                                      *)
(* ════════════════════════════════════════════════════════════════════════ *)


(* ------------------------------------------------------------------------- *)
(*                  Процедуры манипулирования окнами                         *)
(* ------------------------------------------------------------------------- *)

PROCEDURE Make(lw,tw,rw,bw,color : CARDINAL; hiden : BOOLEAN) : pWindow;
(* Создать окно c координатами lw,tw,rw,bw, если hid=TRUE, то для окна      *)
(* распределяется буффер (это дает возможность писать в закрытое окно).     *)
(* color-цвет фона окна.                                                    *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Use(w : pWindow);
(* Переопределить весь вывод в окно w. Если окно создано c параметром       *)
(* hiden = FALSE, то вывод возможен если окно будет находится на экране.    *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE ShowTop(w : pWindow);
(* Вывести w на экран , как самое верхнее.                                  *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Show(w,wp : pWindow);
(* Вывести w на экран , над окном wp.                                       *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE HideTop();
(* Убрать верхнее окно с экрана.                                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Hide(w : pWindow);
(* Убрать окно w с экрана.                                                  *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE PutOnTop(w : pWindow);
(* Переместить окно w на верх.                                              *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Kill(VAR w : pWindow);
(* Уничтожить окно w (полностью забрать распределенную память).             *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE Change(w : pWindow; l,t,r,b : CARDINAL);
(* Изменяет положение и (или) координаты окна w.                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE CheckXY(x,y : CARDINAL) : pWindow;
(* Возвращает указатель окна, которое в точке x,y верхнее.                  *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE SetOut(w : pWindow; l,t,r,b : CARDINAL);
(* Определяет область вывода для окна w.                                    *)
(* ════════════════════════════════════════════════════════════════════════ *)



(* ------------------------------------------------------------------------- *)
(*                        Вспомогательные процедуры                          *)
(* ------------------------------------------------------------------------- *)

PROCEDURE ClearBuf(fa : ADDRESS; map,col : CARDINAL);
(* Очистка буффера окна установленным цветом.                               *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE PlotScr(x,y,c : CARDINAL);
(* Вывод точки на экран.                                                    *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE HLineScr(x,y,x2 : CARDINAL; c:CARDINAL );
(* Вывод горизонтальной линии на экран.                                     *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE OutCharScr(ax,ay : CARDINAL; ch : CHAR; ct,cb : CARDINAL);
(* Вывод символа с начала байта на экран.                                   *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE ScrToBuf(l,t,r,b : CARDINAL; buf : ADDRESS; pos,nb,map : CARDINAL);
(* Процедура копирования области экрана (l,t,r,b) в буффер, с позиции pos   *)
(* Параметры nb,map описывают буффер (nb-число байт по горизонтали, map -   *)
(* длина одной скопированной плоскости в байтах.                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE BufToScr(l,t,r,b : CARDINAL; buf : ADDRESS; pos,nb,map : CARDINAL);
(* Процедура копирования буффера в области экрана(l,t,r,b), с позиции pos   *)
(* Параметры nb,map описывают буффер (nb-число байт по горизонтали, map -   *)
(* длина одной скопированной плоскости в байтах.                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE ExchScrBuf(l,t,r,b : CARDINAL; buf : ADDRESS; pos,nb,map : CARDINAL);
(* Процедура обмена буффера с областью экрана(l,t,r,b), с позиции pos .     *)
(* Параметры nb,map описывают буффер (nb-число байт по горизонтали, map -   *)
(* длина одной скопированной плоскости в байтах.                            *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE ClearScr(l,t,r,b : CARDINAL; c : CARDINAL);
(* Процедура очистки экрана.                                                *)
(* ════════════════════════════════════════════════════════════════════════ *)

PROCEDURE CopyWin(wt,wr : pWindow; l,t,r,b : CARDINAL);
(* Копирование блока l,t,r,b окна wt в окно wr.                             *)
(* ════════════════════════════════════════════════════════════════════════ *)

END MpLWS.
