


                    П Е Ч А Т Ь    Т Е К С Т О В
                    ============================

                (Инструкция к программе PRPAGE.EXE)



               Альперович Лев Залманович, тел. 386-59-36


     Программа  печатает  текстовые файлы.  Она позволяет
    печатать тексты выборочно, просматривая их постранич-
    но на экране дисплея.

     Возможности программы:
     - Печатать с разным количеством строк на листе и по-
       зиций в строке.
     - Нумерация  страниц.
     - Выборочная печать текста с  просмотром  на  экране
       дисплея.
     - Печать нескольких колонок на листе.
     - Выборочная печать колонок для складывания  в  виде
       брошюры.
     - Печать с отступом от левого края листа для сшивки.
     - Объединение нескольких файлов в одном документе.
     - Вывод документа в файл.
     - Преобразование кодов.
     - Преобразование строчных букв в прописные.
     - Печать с увеличенным интервалом между строками.
     - Оперативная корректировка режимов печати и исправ-
       ление ошибок в параметрах.
     - Включение в  документ  дополнительных  управляющих
       последовательностей для принтера.
     - Условный и безусловный переходы на новую страницу.
     - Печать нескольких экземпляров.
     - Обработка символов табуляции.
     - Управление обработкой длинных строк.
     - Пропуск строк исходного текста.

     Внешний вид документа определяется параметрами прог-
    раммы, передаваемыми ей при запуске, а также управля-
    ющими символами, включенными непосредственно  в печа-
    таемый текст.

     Автор благодарен А.Г.Берману, Л.Г.Буничу за советы и
    замечания,  которые способствовали развитию и отладке
    программы.  Особая признательность Б.А.Летучему, пот-
    ратившему  много времени на эксперементы с программой
    и внесшему интересные идеи.

                   ПАРАМЕТРЫ ПРОГРАММЫ
                   -------------------

     Программа запускается командной строкой вида:
     PRPAGE <имя_файла> [режимы]

     Если программа вызвана без обязательного параметра -
    имени файла, она выводит на экран описание параметров
    и прекращает работу.  Если среди режимов указан режим
    с кодом @, то содержимое файла не печатается, а расс-
    матривается,  как перечень имен файлов, которые будут
    печататься.

     Режимы задаются в произвольном наборе и в  любом по-
    рядке. Они разделяются пробелами. Каждый  режим коди-
    руется латинской буквой (прописной или  строчной), за
    которой может  следовать  дополнительная  информация.
    Пробелы между буквой и дополнительной  информацией, а
    также внутри дополнительной информации недопустимы.

                      Описание режимов
                      ----------------

     Нчисло - определяет количество строк, умещающихся на
    листе бумаги при сплошной печати с  установленными до
    запуска программы межстраничными интервалами, верхни-
    ми и нижними полями. Например Н72.

     Dчисло - указывает, сколько строк в конце листа сле-
    дует оставлять свободными от текста.  Например,  если
    задано Н72 D10, то на каждом листе  будет  напечатаны
    62 строки.

     Lчисло1Wчисло2Uчисло3Cчисло4 - Параметр ширины листа
    печати с уточнениями. Число1 - ширина листа. Число2 -
    ширина колонки. Число3 - ширина межколоночного проме-
    жутка. Число4 - количество колонок. Все числа означа-
    ют количество позиций символов.
     Ведущие буквенные символы  показывают  смысл  числа.
    Допустима любая перестановка чисел и  любой  неполный
    набор их. Важно, чтобы все значения  определялись од-
    нозначно и непротиворечиво.
     Примеры:
     l65         лист=65  страница=65 промеж.= 0 кол. = 1
     w65         лист=65  страница=65 промеж.= 0 кол. = 1
     L200w65u10  лист=200 страница=65 промеж.=10 кол. = 2
     w60u4       лист=124 страница=60 промеж.= 4 кол. = 2
     c3l300      лист=300 страница=100 промеж.=0 кол. = 3
     l120w60c3 - противоречивость, будет сообщение.

     Sчисло0-число1-..-число... -  Управление  последова-
    тельностью выводимых колонок. Число0  -  период, чис-
    ло1, число2 и т.д. - номера в периоде.  Номера больше
    нуля и не больше числа0.
     Пример1: S4-1-4
     Из каждых 4 страниц будут печататься только первая и
     четвертая.
     Пример2: S4-3-2
     Из каждых 4 страниц будут печататься только третья и
     вторая.
     Пример3: S12-12-1-10-3-8-5
     Из каждых 12 страниц  "брошюры"  выводятся  страницы
    первой стороны.
     Пример4: S12-2-11-4-9-6-7
     Из каждых 12 страниц  "брошюры"  выводятся  страницы
    второй стороны.
     Эти примеры имеют смысл при двухстраничной печати. В
    принципе, режим S не зависит от L -  выбранный  текст
    последовательно заполняет колонки  выводимой информа-
    ции. Величина "Число0" ограничивается  размером памя-
    ти, доступной программе (но не более 256). Если памя-
    ти недостаточно, программа сообщает об этом  и закан-
    чивает работу.
     Для "брошюрного" варианта предусмотрена  краткая ко-
    дировка символами 'a' и 'b',  которая  иллюстрируется
    двумя примерами:
     Пример5: S12-a
     Пример6: S12-b
     Пример 5 заменяет пример 3, пример 6 заменяет 4.
     Примечание: Если не задан режим визуализации,  V, то
    в конце текста на печать будут выданы все, положенные
    для завершения периода, листы  с  пустыми  колонками.
    Для того, чтобы это сделать в режиме V,  нужно нажать
    клавишу F2 - печать до конца.

     Nчисло1-число2  - автоматическая  нумерация страниц,
    номер располагается в данной позиции строки, например
    N60  означает  отступ на 59 символов от левой границы
    колонки. Если "число1" не задано, то номер располага-
    ется  посреди  строки (длина которой задается режимом
    L).  При  автонумерации добавляются 2 строки к каждой
    странице текста: одна - с номером и одна - пустая.
     Если "число1" = 0, то отмена нумерации.
     Число2 - начальное значение  номера  при автонумена-
    ции. Например N60-23 означает начало с 23.  Можно за-
    дать и так: N-23.
     При отсутствии этого режима нумерация не производит-
    ся.

     Ечисло1-число2 - диапазон номеров страниц. На печать
    (или в файл, заданный параметром F)  выводится  часть
    текста, определенная данными границами. Режим опреде-
    ляет два числа: начальный и конечный номера выводимых
    страниц. Числа разделяются знаком "минус" (без пробе-
    ла).
     Пример: Е25-40
     Этот режим отменяет режим V.
     Для печати текста до конца нужно  второму  числу за-
    дать заведомо большое значение, например: Е25-999.

     V - визуализация печати (V0 -  отмена визуализации).
    Печать осуществляется с остановкой перед  каждым оче-
    редным листом. На экран  дисплея  выводится  фрагмент
    листа (20 строк) и подсказка  относительно  вариантов
    дальнейшей работы. Они выбираются клавишами:
     Enter - печать  листа и просмотр следующего листа.
     F10   - печать  листа без подгона следующего листа.
     Esc   - конец печати, завершение работы программы.
     PgDn  - пропуск листа.
     PgUp - возврат к предыдущему листу.
     CtrlHome - переход к первому листу.
     CtrlEnd - переход к последнему листу.
     +N    - пропуск N листов.
     -N    - возврат на N листов.
     CtrlUp - просмотр предыдущих 20 строк листа.
     CtrlDn - просмотр последующих 20 строк листа.
     CtrlLeft  - просмотр левой части листа.
     CtrRight  - просмотр  правой части листа.
     F1    - подсказка.
     F2    - печать до конца текста.
     F4    - изменение текущих режимов.

     Режим позволяет осуществить  выборочную  и  повторную
    распечатку листов текста.
     Этот режим отменяет режим E.

     Rчисло - величина проверяемого остатка страницы (см.
    далее описание управляющих символов печати). Этот ре-
    жим активизируется только совместно с управляющим сим-
    волом $.

     Fимя - Имя файла для вывода информации  на  диск.  В
    качестве имени может быть стандартное имя порта печа-
    ти (prn, lpt1, lpt2). Если в конце имени стоит "обра-
    тный  слэш" '\',  то в выходном файле сохраняются все
    управляющие  символы (см.  далее "Управляющие символы
    печати"), присутствующие в исходном файле.

     B - Преобразование малых букв в больших  в альтерна-
    тивной русской кодировке (В0 - отмена). Режим полезен
    для подготовки файла к перекачке на ЕС  и  распечатке
    на АЦПУ.

     Xчисло - количество позиций  (символов)  отступа ко-
    лонки текста от левого края листа.  Эта  величина  не
    входит  в  ширину  колонки.  Она  может  быть отрица-
    тельной.

     )Символ - символ,  по которому осуществляется переход
    на новую  страницу  (см.  ниже  описание управляющего
    символа ")").
      Если "Символ" = '0', то данный режим отменяется.

     $Символ1Символ2 - символ,  по  которому  проверяется
    величина остатка страницы (см. ниже описание управля-
    ющего символа "$").
     Если "Символ1" = '0', то данный режим отменяется.

     I - Печать через строку (I0 - отмена).

     Jтекст - Вставка текста перед номером страницы. Раз-
    мер текста не более 40 символов.  Символы подчеркива-
    ния в этом тексте заменяются пробелом.

     КСимвол1Символ2Символ3Символ4... -   замена   символа
    первого  на  второй,  третьего на четвертый и т.д.  во
    всем тексте
      Пример:КТ5У6
     В этом случае русские заглавные буквы Т и У  в тексте
     будут при печати заменены цифрами 5 и 6.

     YСимвол1Символ2Символ3Символ4... -  замена  символов,
    аналогичная предыдущей,  но в шестнадцатиричном предс-
    тавлении.  Символы  рассматриваются парами:  Символ1 и
    символ2 - шестнадцатиричный код  замещаемого элемента,
    символ3 и символ4 - код его заместителя и т.д.
      Пример1: Y92359336
     В этом случае также,  как и выше, заглавные буквы Т и
     У в тексте будут при печати заменены цифрами  5  и  6.
      Пример2: y0с20
     Здесь признак начала  страницы  (код  0С)  заменяется
     пробелом (код 20).

     Z - Печать имени файла, даты и  времени  (вывода  на
    печать) в первой строке первого листа. Z0  -  отмена.
    Z1 - печать имени перед каждым файлом в группе файлов.

     Pkiiii... - фрагмент вставки в выводимый  текст (см.
    далее).

     Qkiiii... - фрагмент 16-ичной  вставки  в  выводимый
    текст (см. далее).

     Tчисло - Печатать  "число"  экземпляров.  Отменяется
    режим визуализации. T0 - отмена режима T.

     Aчисло - обработка символов табуляции с  шагом "чис-
    ло"-1. Если "число" отсутствует, то -  пропуск симво-
    ла. A0 - отмена режима A.

     Gтекст - управление обработкой длинных  строк, выхо-
    дящих за правую границу колонки. Эти строки могут ли-
    бо обрубаться, либо продолжаться  на  новой (дополни-
    тельной) строке печати. При  этом  вставляется специ-
    альный символ индикации в место "перелома" строки.
     Форматы режима:
     G-X обрубка строки, X - символ  индикации, вставляе-
    мый в позицию правой границы колонки.
     G-YYY обрубка строки, YYY - трехразрядный код симво-
    ла индикации, вставляемый в  позицию  правой  границы
    колонки.
     G+X перенос строки, X - символ  индикации, вставляе-
    мый в первую позицию перенесенного хвоста строки.
     G+YYY перенос строки, YYY - трехразрядный код симво-
    ла индикации, вставляемого в  первую  позицию перене-
    сенного хвоста строки.
     Если символ X и код YYY не задавать, то по умолчанию
    будет использован символ кода 254 (черный квадрат).
     Если YYY=000, то символ индикации не вставляется.  В
    частности, g-000 задает обрубку строк без вставки си-
    мвола  индикации,  что  соответствует старой редакции
    prpage.

     @Символ - Печать группы файлов,  список имен которой
    содержит  исходный  файл,  заданный первым параметром
    <имя_файла>.  Вся  группа печатается,  как сцепленный
    единый текст.
     Если Символ = 0, то отмена групповой печати, печата-
    ется сам исходный файл.
     Если  Символ = 1,  то каждый файл начинается с новой
    колонки.
     Если  Символ = 2,  то каждый файл начинается с новой
    колонки нечетного номера.
     Если  Символ = 2,  то каждый файл начинается с новой
    первой колонки цикла колонок (режим S).

     *Символ - Пропуск при печати строк исходного текста.
    Символ - это символ в тексте, по которому обнаружива-
    ется строка,  игнорируемая в процессе печати.  Символ
    должен находиться в первой позиции строки. *0 - отме-
    на режима.
     Если Символ не указан, предполагается '*'.

     ^  - Вставка  стандартного символа перехода на новый
    лист  (код  12) в конец листа.  ^0 - переход по числу
    строк на листе, равному значению режима H.

              Значения режимов по умолчанию
              -----------------------------
     Вызов программы без задания режимов эквивалентен вы-
    зову: prpage <имя_файла> H72 D10 L80 Fprn A9 G+254 V0
    N0 R8 B0 X0 )) $$ I0 Z0 T0 @0 *0 ^0

     Рекомендуется обращение  к  программе   осуществлять
    через (bat) пакетный файл. Например, файл Prt.bat:

     prpage %1 h88 L160u10 v x3 %2 %3 %4 %5

     При этом печать осуществляется по команде:
     prt имя_файла


                  ПЕЧАТЬ ГРУППЫ ФАЙЛОВ
                  --------------------

     Программа позволяет печатать группу файлов, как один
    сплошной текст. Пример использования: распечатка всех
    командных (.bat) файлов.
     Перед каждым файлом в распечатке можно поместить его
    имя в виде << имя >>. Для этого  нужно  задать  режим
    z1.
     Для того, чтобы каждый файл в группе файлов начинал-
    ся с новой строки, нужно заканчивать  текстовые файлы
    символами 'новая_строка' и 'перевод_каретки'.
     Файл имен группы файлов можно легко получить, напри-
    мер, в среде Norton Commander, воспользовавшись прог-
    раммой Ncsfp.com А.В.Полякова. В  операционной  среде
    Dos 5.0 для этой цели можно  воспользоваться командой
    Dir c параметром /B.



               УПРАВЛЯЮЩИЕ СИМВОЛЫ ПЕЧАТИ
               --------------------------

     Программа осуществляет разбивку  на страницы по мере
    заполнения их строками текста в соответствии со  зна-
    чением параметра Н. При этом она вставляет строки ну-
    мерации, если задан режим N.

     Если в  тексте  обнаруживается  управляющий   символ
    печати, то в этом месте осуществляется  условный  или
    безусловный переход к  новой странице.

     Управляющий символ должен находиться в первой  пози-
    ции строки текста. Эта строка не печатается.

     Используются два  символа,  определяемые  режимами -
    ')' и '$' ("закрывающая скобка" и  "доллар").  Первый
    означает безусловный, второй - условный переходы.
     Далее при описании логики работы с управляющими сим-
    волами будем предполагать,  что их значение соответс-
    твенно равно ")", "$".

     Вслед за символом ")" может следовать необязательный
    текст числа или еще один или два таких же символа ")".
     Число, означает новый текущий номер колонки.
     Второй  символ ")" означает переход на колонку с не-
    четным номером.
     Третий  символ ")" означает переход на первую колонку
    цикла колонок (режим S).
     В последних двух случаях "Число" игнорируется.
     Примеры:
     )15
     )
     ))
     )))

     Символ '$' означает проверку числа строк, остающихся
    до конца страницы. Если задано '$' без  параметра, то
    число сравнивается со значением, задаваемым режимом R
    (см. выше). Если оно меньше указанного  значения,  то
    переход осуществляется. Если нет, -  продолжается за-
    полнение страницы текстом.

     Вслед за символом "$" может следовать необязательный
    текст, изображающий:
     - число
     - символ [
     - символ ].
     В первом случае  сравнение  величины остатка страницы
    осуществляется с данным числом.
     Остальные два случая помечают  соответственно начало
    и конец фрагмента, который должен быть размещен цели-
    ком без перехода на новую страницу.  Указателем конца
    фрагмента служит так же любой код,  содержащий символ
    $ в первой позиции строки. Таким образом,  если  весь
    текст состоит из неделимых фрагментов,  то достаточно
    расставить между ними управляющие строки вида $[.
     Однако, если в параметре $, задаваемом  в  командной
    строке при вызове задан "Символ2", равный '1', то иг-
    норируется печать помеченных  вышеуказанным  способом
    фрагментов, содержащих одни лишь пустые  строки, если
    эти фрагменты попадают в начало страницы.
     Примеры:
     $12
     $
     $[
     $]

           РЕДАКТИРОВАНИЕ РЕЖИМОВ
           ----------------------
     Режимы отображаются в первой строке экрана.
     Вход в редактирование осуществляется нажатием клави-
    ши F4 в режиме визуализации (V).
     Для редактирования доступны все  клавиши  управления
    курсором. Кроме того:
     Enter - конец редактирования
     Esc   - отмена редактирования
     Del   - удаление символа
     Bkcsp - затирание символа
     F1    - подсказка режимов
     Если вносятся изменения в режимы,  то осуществляется
    переход к началу исходного текста.


          ВСТАВКА УПРАВЛЯЮЩИХ ESC-ПОСЛЕДОВАТЕЛЬНОСТЕЙ
          -------------------------------------------

     В режиме визуализации можно оперативно вставлять уп-
    равляющую информацию для принтера  непосредственно  в
    выводимый текст.
     Вставке подлежат фрагменты, заданные режимами P или Q.

     Формат режима P:
     Pkiiiiii...
     Здесь к - произвольный символ, играющий  роль  шифра
    текстовой последовательности iiii...
     iiii - "тело" ESC-последовательности, т.е. управляю-
    щая последовательность без самого кода ESC (27).
     Пример: PaW1 PbW0
     В примере шифр 'a' присвоен команде  начала  широкой
    печати, 'b' - команде отмены широкой печати.

     Формат режима Q:
     Qkxxyyzz...
     Все аналогично, за исключением того,  что последова-
    тельность задается в  шестнадцатиричном  изображении.
    На каждый символ - два знака.
     Пример:
     Qa5731 Qb5730

     Необходимо курсор подвести к желаемой позиции встав-
    ки и ввести односимвольный код  последовательности. В
    данном примере - 'a' или'b'.

     Символ шифра 'k' произволен, но есть исключения:
     Если k = '*' (звездочка), то тело  фрагмента (iii..)
    - это имя файла подсказки. Подсказки  -  произвольный
    текст, предназначенный, в основном, для описания шиф-
    ров ESC - последовательностей.  Подсказка  вызывается
    нажатием '*'.
     Если k = ']', то  данный  фрагмент  рассматривается,
    как второй член пары фрагментов и заносится  в  конец
    ближайшего справа слова.
     Пример: P1W1 P]W0
     В примере: если нажать клавишу '1', то в  месте рас-
    положения курсора вставится  команда  начала  широкой
    печати, а в конец ближайшего слова -  команда  отмены
    широкой печати.
     Если k = '.' (точка), то данный  фрагмент рассматри-
    вается, как продолжение предыдущего.
     Если k = '!'(восклицательный знак),  то  фрагмент  с
    шифром '!' автоматически заносится в начало  текста в
    начале печати.
     Пример:  p!(1004X  p.&l0O  p.&k10H p.&l8C
     В начало текста будет автоматически занесен код:
     E(1004XE&l0OE&k10HE&l8C, где Е обозначает символ ESC.


     Замечания
     ---------
     Стандартный символ перехода на лист (код 12) обраба-
    тывается, как ")", вне зависимости от его положения в
    строке.

     При использовании  режима  автонумерации управляющие
    символы рекомендуется размещать  лишь  в  тех  местах
    текста, которые обязательно должны печататься с нача-
    ла страницы (например, в начале разделов документа) и
    проверяться на вмещаемость в страницу (например, таб-
    лицы).

     Программа при старте анализирует свои  режимы после-
    довательно в порядке их задания в  командной  строке.
    Если дважды задан один и тот же режим, то активизиру-
    ется последнее его значение. При многократном задании
    режимов К и Y происходит  "накопление"  информации  о
    преобразованиях. Это нужно учесть при  разработке ко-
    мандного (bat) файла.



               ОГРАНИЧЕНИЯ
               ===========

     Размер листа не более 200 строк
     Ширина листа не более 320 символов.
     Размер межстраничного промежутка не  больше  размера
       листа минус 5.
     Размер отступа номера страницы не более ширины стра-
       ницы минус 5.
     Размер отступа от левого края листа не более 78 и не
       менее отрицательной величины ширины колонки.
     Число страниц выводимого документа не более 2000.
     Длина строки режимов - не более 160 символов.
     Размер текста подсказки пользователя - не более 2000
       символов.
     Размер периода в режиме S не более 256.
     Размер  списка имен файлов в группе (режим @) не бо-
    лее 8000 символов.


                  КОД ЗАВЕРШЕНИЯ
                  ==============
     0 - нормальное окончание
     1 - ошибка в режимах
     2 - выходной файл не создан
     3 - входной  файл не найден


                 - Конец текста -
