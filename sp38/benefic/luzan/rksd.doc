                                                      Фирма MODDEM
                           343933, г. Краматорск, Донецкая область
                                            ул. Ленина, 57, а/я 33
                                         Лузан Сергей Владимирович
                                          телефон (062-64) 3-11-42

  ****************************************************************

             ДРАЙВЕР РУСИФИКАЦИИ КЛАВИАТУРЫ И ДИСПЛЕЯ
                       IBM-СОВМЕСТИМЫХ ПЭВМ

                      Версия 3.4 от 05/08/91

  ****************************************************************

                        В комплект входят:
                        ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

               RKSD.COM    - собственно драйвер
               08X08.FNT   - дополнительный шрифт 8х8
               08X14.FNT   -  -----""-----  шрифт 8х14
               08X16.FNT   -  -----""-----  шрифт 8х16
               RKSD.DOC    - этот файл документации

  Термин "русификация" применен чисто фигурально, так  как имеется
  возможность подгружать файлы с описанием шрифтов любого алфавита.

                 Несколько особенностей драйвера
                 ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

  1) при переключении режимов клавиатуры комбинацией  клавиш поря-
  док их нажатия и отпускания не имеет значения.  Для переключения
  режимов необходимо нажать и тут же отпустить  выбранную комбина-
  цию клавиш-переключателей (или одиночную клавишу-переключатель),
  не производя при этом каких-либо промежуточных нажатий, в проти-
  вном случае переключения  не произойдет, так как будет выполнено
  действие, предписанное нажатой комбинации  клавиш текущей испол-
  няемой программой. Устанавливаемый драйвером обработчик прерыва-
  ний  от клавиатуры реагирует не на нажатие, а на отпускание кла-
  виш-переключателей, что является своеобразной защитой от случай-
  ного нажатия на переключатели

  2) при работе с пользовательскими раскладами  клавиатуры имеется
  возможность посредством клавиши NUM LOCK  инвертировать  верхний
  ряд основной клавиатуры таким образом, что знаки препинания (ес-
  ли включена кириллица) будут доступны без  дополнительного нажа-
  тия на SHIFT, что соответствует стандарту пишущей машинки

  3) драйвер без проблем выгружается из ОЗУ программой  RELEASE  и
  ей подобными

  4) при запуске драйвер тестирует свое тело на  наличие заражения
  файловыми вирусами и при необходимости выдает  предупреждение  о
  заражении. Размер нормального,  не  зараженного  вирусами  файла
  RKSD.COM (описываемой версии) составляет 27750 байт

  5) драйвер при запуске автоматически настраивается на тип клави-
  атуры и дисплея (EGA/VGA), подключенных к Вашему компьютеру, и в
  зависимости от этого оставляет резидентно лишь  характерные  для
  данного типа дисплея шрифты. В связи с этим  размеры резидентных
  частей драйвера составляют:

                для EGA -  7232 байта (452 параграфа)
                для VGA - 11328 байт (708 параграфов)

  6) резидентная часть драйвера использует при своей работе только
  средства  BIOS, не "затрагивая" недокументированные области сис-
  темной памяти

  8) драйвер написан на языке  Ассемблера,  реализован  с  помощью
  транслятора Turbo Assembler  V2.0.  Резидентная  часть  драйвера
  тщательно оптимизирована по скорости  выполнения  и  занимаемому
  объему ОЗУ. Несмотря на то, что вышеназванные  факторы  зачастую
  противоречат друг другу, был найден разумный компромисс. В част-
  ности, использована техника самомодифицирующегося кода, применен
  прием переноса части данных, используемых драйвером  в  процессе
  работы, в необязательную для TSR-программ область PSP. Кроме то-
  го, при инсталляции драйвер освобождает также  и  неиспользуемую
  им область Environment

  9) в настоящей версии драйвера исправлены четыре ошибки, обнару-
  женные в предыдущей версии:

      - пропадание рамки экрана при переключении видеорежимов
        средствами BIOS

      - задержка реакции драйвера на переустановку цвета рам-
        ки дисплея до переключения режима клавиатуры

      - задержка реакции драйвера на запрет/разрешение рамки
        экрана до переключения видеорежима

      - не совсем корректная работа с 83/84-key клавиатурой

   Кроме того, добавлена возможность запрета/разрешения использо-
  вания любого из переключателей режимов клавиатуры и рамки экра-
  на (см. ниже).

  10) памятуя о проблеме, связанной с  использованием  программных
  средств, лишенных какой-либо  эксплуатационной  документации,  а
  также  о  том,  что  при  практикуемом  ныне  в  стране  способе
  распространения программных продуктов  совместное  "путешествие"
  программного файла и файла  документации  несколько  затруднено,
  автор сделал попытку ликвидировать означенную проблему  и облег-
  чить жизнь потенциальным пользователям драйвера RKSD.COM: описы-
  ваемая версия драйвера "умеет"  создавать  неограниченное  число
  копий изучаемого Вами в настоящий момент файла RKSD.DOC, который
  хранится в упакованном виде в теле самого драйвера (см. ниже).


      Командная строка для запуска драйвера может иметь вид:
      ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

       RKSD  [-h] [-i] [-r] [-w] [-b:###|ON|OFF] [-t:ON|OFF]\
             [-k:<file>] [-f:<file>] [-s]\
             [-l:key[key]...|ON|OFF] [-c:key[key]...|ON|OFF]\
             [-p:key[key]...|ON|OFF] [-u:key[key]...|ON|OFF]\
             [-a:key[key]...|ON|OFF]\
             [-v:CGA|EGA|VGA]


                         Описание опций:
                         ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

    -h               - краткая подсказка по запуску драйвера

    -i               - формирование файла RKSD.DOC

    -r               - установка "быстрой" клавиатуры:
                           30 символов в секунду
                         0.25 секунд задержки автоповтора
                       Эта опция работает только с PC AT и PS/2

    -w               - вывод текущей конфигурации (шрифты и
                       расклад клавиатуры) в файлы:
                          08Х08.RKS - шрифт 8х8
                          08X14.RKS - шрифт 8х14
                          08X16.RKS - шрифт 8х16
                            KBD.RKS - расклад клавиатуры

    -s               - сохранить выбранную конфигурацию в теле
                       RKSD.COM для последующего использования
                       по умолчанию (работает совместно с опци-
                       ями -b,-t,-k,-f,-l,-c,-p,-u,-a)

    -b:###|ON|OFF    - установка цвета рамки экрана для каждого
       │││             из режимов клавиатуры:
       ││└────────────── псевдографика
       │└─────────────── кириллица
       └──────────────── стандартная клавиатура (латиница)
                     Цвет задается одной HEX-цифрой.
                     OFF - запрещает использование рамки
                      ON - разрешает использование рамки

    -k:<file>        - установка  нового расклада клавиатуры,
                       описанного в файле <file>. Файл должен
                       быть такого же формата, как  KBD.RKS и
                       иметь размер 219 байт

    -t:ON|OFF        - выбор варианта работы переключателей
                       раскладов клавиатуры:
                            ON - режим "триггер"
                           OFF - только включатель
                       (подробности - далее по тексту)

    -f:<file>        - установка нового экранного  шрифта, опи-
                       сание которого содержится  в  <file>.  В
                       командной строке  может  быть  несколько
                       опций -f для каждого из используемых ти-
                       пов шрифтов. Драйвер автоматически опре-
                       деляет указанный тип шрифта  по  размеру
                       файла, который должен быть:

                          - для шрифта 8х8   2048 байт
                          - для шрифта 8х14  3584 байта
                          - для шрифта 8х16  4096 байт

    -l:KEY[KEY[...]] - установка переключателя клавиатуры в
                       стандартный латинский режим

    -c:KEY[KEY[...]] -  ---"---  режим кириллицы

    -p:KEY[KEY[...]] -  ---"---  режим псевдографики

    -u:KEY[KEY[...]] - установка переключателя  между загружен-
                       ным RKSD-шрифтом  и шрифтом, "зашитым" в
                       ПЗУ дисплея

   ╒═══════════════════════ ВНИМАНИЕ ! ════════════════════════╕
   │     Возможность переключения ROM/user шрифтов доступна    │
   │            только в текстовых режимах экрана.             │
   └───────────────────────────────────────────────────────────┘

    -a:KEY[KEY[...]] - установка переключателя  работы  клавиши
                       ALT (left ALT) в  пользовательских режи-
                       мах клавиатуры (см.ниже)

                        Для  установки  переключателей  режимов
                       клавиатуры пользователю даны  в распоря-
                       жение:
                         1) шесть значений KEY для 101/102-key:
                                  LS - левый SHIFT
                                  RS - правый SHIFT
                                  LA - левый ALT
                                  RA - правый ALT
                                  LC - левый CTRL
                                  RC - правый CTRL

                         2) четыре значения KEY для 83/84-key:
                                  LS - левый SHIFT
                                  RS - правый SHIFT
                                  ~A - ALT
                                  ~С - CTRL

                       Драйвер следит за тем, чтобы в командной
                       строке указывались  лишь допустимые  для
                       установленного типа клавиатуры идентифи-
                       каторы клавиш.

                       Допускается использование  как одиночной
                       клавиши, так и их  всевозможных комбина-
                       ций. Например, для  переключения  режима
                       кириллицы путем  одновременного  нажатия
                       левого SHIFT'a, правого CTRL'a и правого
                       ALT'a необходимо в командной строке ука-
                       зать:
                                  RKSD -c:lsrcra

                       Порядок указания  идентификаторов клавиш
                       в командной строке не имеет значения.

                       Кроме того, имеется  возможность запрета
                       переключателя  любого  из  режимов.  Для
                       этого  вместо  указания   идентификатора
                       клавиши в  командной  строке  необходимо
                       указать опцию "OFF". Например, для того,
                       чтобы убрать возможность включения режи-
                       ма псевдографики, необходимо указать:

                                    RKSD -p:off

                       Восстановить работоспособность запрещен-
                       ного ранее  переключателя  можно, указав
                       в командной строке  для требуемого пере-
                       ключателя параметр "ON".

   ╒═══════════════════════ ВНИМАНИЕ ! ════════════════════════╕
   │ Драйвер  не отслеживает  конфликтные ситуации, когда раз- │
   │ личным режимам клавиатуры назначаются одинаковые клавиши- │
   │ переключатели.  Следует помнить, что  переключатели имеют │
   │ приоритеты в соответствии с приведенной ниже таблицей:    │
   │ ----------------------------------------------------------│
   │          1) стандартная клавиатура (латиница) (-l)        │
   │          2) кириллица (-с)                                │
   │          3) псевдографика (-p)                            │
   │          4) переключатель ROM/user шрифтов (-u)           │
   │          5) переключатель режима левого ALT'а (-а)        │
   └───────────────────────────────────────────────────────────┘

    -v:CGA|EGA|VGA   - установка режима эмуляции соответствующе-
                       го видеоадаптера (работает только с VGA)


               Особенности командной строки драйвера
               ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

  1) алгоритм сканирования командной строки драйвера  построен та-
  ким образом, что каждая из  допустимых  опций  будет  обработана
  только один раз, поэтому повторным заданием  опции  в  командной
  строке пользователь не достигнет желаемого  результата (исключе-
  ние - опция -f, которая может встречаться трижды, для каждого из
  трех возможных типов шрифтов)

  2) порядок задания опций в командной строке не имеет значения

  3) неверно указанные опции игнорируются

  4) в качестве  разделителей опций  могут использоваться  символы
  "-" и/или "/"

  5) при наличии в командной строке опций -h и/или  -i  отработают
  только эти опции, остальные игнорируются, причем опция  -i имеет
  более высокий приоритет

  6) файлы описания шрифтов и расклада клавиатуры, указанные в ко-
  мандной строке и имеющие размеры, отличные от  допустимых, драй-
  вером игнорируются

  7) если драйвер уже инсталлирован в ОЗУ, то при повторном запус-
  ке все опции (кроме -w,-r,-h,-v и -s) в командной строке работа-
  ют с резидентной частью драйвера, размер которой при любых мани-
  пуляциях не изменяется


         Несколько слов для желающих использовать RKSD.COM
         ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

  1) редактирование файла описания расклада клавиатуры:

  - формат файла с описанием расклада  клавиатуры  можно "подсмот-
    реть", запустив драйвер RKSD с опцией -w. В текущей директории
    появятся несколько файлов с расширением *.RKS, и среди  них  -
    файл KBD.RKS размером 219 байт. Это простой текстовый  файл, в
    котором позиции, содержащие символ с ASCII-кодом  255, обозна-
    чают, что при нажатии на соответствующую клавишу  (а назначае-
    мые  клавишам  символы  расположены  в   порядке   возрастания
    SCAN-кодов клавиш) символ не будет транслироваться, т.е. в бу-
    фере клавиатуры  останется  первоначальное  значение  SCAN-  и
    ASCII-кода введенного символа. Позиции с кодом  ASCII,  равным
    0, обозначают, что при нажатии на  соответствующую  клавишу  в
    буфер клавиатуры символы заноситься не будут, т.е.  нажатие на
    клавишу драйвером игнорируется.

        ПРИМЕЧАНИЕ
            Сказанное  выше относится  только  к пользовательским
            режимам  клавиатуры. В  латинском  регистре  работает
            стандартная клавиатура, которую  невозможно переопре-
            делить.

  2) два  режима  работы переключателей раскладов  клавиатуры (оп-
  ция -t):

  - переключатель только включает свой расклад. Для выбора другого
    расклада клавиатуры необходимо  нажимать  соответствующий  ему
    переключатель (параметр "OFF")

  - переключатель работает в режиме триггера, т.е. его однократное
    нажатие включает новый расклад, а повторное  нажатие выключает
    (параметр "ON")

        ПРИМЕЧАНИЕ (для режима "триггер")
            Второй пользовательский расклад клавиатуры (3-я и 4-я
            строки файла KBD.RKS) имеет более  высокий приоритет,
            поэтому при включении "перекрывает" текущий режим.

   ╒═══════════════════════ ВНИМАНИЕ ! ════════════════════════╕
   │   Переключатели  ROM/user шрифтов и режима левого ALT'а   │
   │            ВСЕГДА работают в режиме "триггер".            │
   └───────────────────────────────────────────────────────────┘

3) два режима работы клавиши ALT (left ALT для 101/102-key):

  - использование этой особенности драйвера  в  некоторых  случаях
    может быть очень удобно. Речь идет о том, чтобы при  работе  в
    пользовательских режимах клавиатуры иметь возможность временно
    включать стандартный латинский регистр,  обеспечивающий доступ
    к символам, отсутствующим в текущем раскладе  клавиатуры, при-
    чем переключатель регистров должен быть удобным и, кроме того,
    легко "отключаться", что очень существенно  для  пользователей
    83/84-key клавиатуры. Драйвер предоставляет такую возможность:
    путем нажатия клавиши ALT (left  ALT  для  101/102-key)  можно
    временно включить латинский регистр, который будет  активен до
    отпускания клавиши ALT. Возможно одновременное нажатие ALT'a и
    любого из SHIFT'ов: что при этом произойдет - легко догадаться
    самому. Следует, однако, помнить, что при  ALT-наборе символов
    на дополнительной цифровой клавиатуре клавиша ALT  ведет  себя
    стандартным образом.

    Теперь о возможности управления  режимами  левого  ALT: разре-
    шить/запретить использование ALT'a в качестве временного вклю-
    чателя латинского регистра можно нажатием  заданной комбинации
    клавиш, аналогично запрету/разрешению  использования ROM-шриф-
    та. Стандартно для этой цели зарезервировано  совместное нажа-
    тие клавиш L_ALT, L_CTRL и L_SHIFT (CTRL, ALT  и  L_SHIFT  для
    83/84-key), но пользователь может определить любое удобное для
    него сочетание клавиш, руководствуясь теми же правилами, что и
    при определении прочих переключателей драйвера.  Для  этого  в
    командной строке используется опция -а.

    Следует помнить, что  при  запуске  драйвера  описанный  режим
    всегда выключен.


                 Пример командной строки драйвера:
                 ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀

     RKSD  -c:LSRS-k:NEW.KBD-f:FONT.8-b:247-f:MY.FNT-t-s-r-p:OFF

  При запуске драйвер выполнит следующие действия в соответствии с
  приоритетом опций:

    1) установит "быструю" клавиатуру, выдающую 30 символов в се-
    кунду с задержкой между автоповтором символа  в  0.25 секунды
    (опция r)

    2) установит новые цвета рамок экрана для всех режимов клави-
    атуры (опция -b)

    3) установит  новый расклад клавиатуры  из файла NEW.KBD (оп-
    ция -k)

    4) установит режим переключателей  раскладов клавиатуры в ва-
    риант "триггер" (опция -t)

    5) предпишет комбинации клавиш left SHIFT  и right SHIFT роль
    переключателя первого  пользовательского расклада  клавиатуры
    (кириллицы) (опция -c)

    6) запретит  использование  переключателя  псевдографики (оп-
    ция -p)

    6) установит новый шрифт из файла FONT.8 (опция -f)

    7) установит новый шрифт из файла MY.FNT (опция -f)

    8) "зашьет" новую конфигурацию в тело  RKSD.COM для последую-
    щего использования по умолчанию (опция -s)

  И, наконец, если драйвер еще не был  инсталлирован  в  ОЗУ, осу-
  ществит его инсталляцию. В противном случае изменит конфигурацию
  уже загруженного драйвера. При этом  размер  памяти,  занимаемой
  резидентной частью драйвера, не изменится.


  ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

  Предложенный в описываемом драйвере набор опций и функциональных
  возможностей отражает собственную точку зрения автора  на решае-
  мую проблему, поэтому драйвер  никоим образом  не претендует  на
  универсальность (а тем паче на эталон). Идеи, заложенные в "фун-
  дамент" разработки, большей частью позаимствованы  из популярных
  аналогов  (UNI Бунича, RK Страхова, KBDRUS Гуртяка  и  т.п.). Но
  ТОЛЬКО идеи! Их реализация оригинальна и не повторяет ни одну из
  вышеперечисленных разработок. В связи с этим необходимо отметить
  и  несколько недостатков системы  RKSD, хотя для  ее автора оные
  недостаками не являются: это нюансы, заведомо оставленные в "те-
  ни", дабы не допустить неоправданной перегруженности системы.

  ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀


               Несколько слов о недостатках RKSD.COM
               ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀
               
  1) отсутствуют механизмы  выгрузки драйвера  из ОЗУ, так как, по
  мнению автора, это во-первых, противоречит самой идее "драйвера",
  во-вторых, возможность эта крайне редко используется  на практи-
  ке, в-третьих, для этой цели имеется широкий выбор программ типа
  RELEASE, INSTALL/REMOVE  и т.п., и  в-четвертых, RKSD можно сде-
  лать  полностью  "прозрачным"  для остальных  программ, отключив
  пользовательские режимы клавиатуры и переключившись на стандарт-
  ные ROM-шрифты (благо конфликтов RKSD с другими программами, да-
  же устанавливающими свои собственные обработчики прерываний 09h,
  10h, 1fh и 43h, на практике отмечено пока еще не было)
  
  2) отсутствует доступ к программному управлению режимами драйве-
  ра, так как автору пока неизвестны случаи практического примене-
  ния подобных возможностей (пользователю - непрофессионалу это не
  по плечу, а профессионал вряд ли будет привязывать свои разрабо-
  тки  к какому-либо драйверу в силу абсурдности самой этой идеи).
  Возможно, неплохо было бы выработать единый для всех отечествен-
  ных "драйверостроителей" стандарт (но кто это сделает ?), откры-
  вающий доступ  к программному  управлению  различными драйверами
  через какую-либо функцию прерывания  INT 16h, предварительно до-
  полнив такой функцией стандартный обработчик

  3) режимы, использующие шрифт 8х10 (например, текстовые 35 строк
  для EGA и 40 строк для VGA), не русифицированы. В  принципе, нет
  проблем для русификации и этих режимов, но придется пожертвовать
  еще почти тремя килобайтами ОЗУ. К тому же  вышеназванные режимы
  не поддерживаются стандартным  BIOS и используются крайне редко,
  поэтому автор не видит целесообразности в их русификации

  4) как уже упоминалось, драйвер не отслеживает  ситуации,  когда
  различным режимам клавиатуры назначаются  одинаковые клавиши-пе-
  реключатели. Автор не считает необходимым вводить  такую провер-
  ку, так как драйвер полностью сохраняет  свою  работоспособность
  при подобных манипуляциях и  всегда  допускает  возможность кор-
  ректной установки переключателей

  5) если какая-либо  прикладная программа  осуществляет установку
  видеорежима, обращаясь напрямую  к регистрам видеоадаптера  (что
  делают, к  примеру, некоторые библиотечные функции  компиляторов
  Microsoft C  и Turbo C), то возможно исчезновение  рамки экрана,
  индицирующей текущий  режим клавиатуры. Считать ошибкой это, по-
  видимому, нельзя, так как драйвер не в состоянии отслеживать все
  обращения  к системным ресурсам. К тому же любое следующее пере-
  ключение режима клавиатуры восстановит рамку

  Возможно, в системе RKSD имеются еще ошибки. Серъезным их "отло-
  вом"  никто  не занимался. Буду благодарен  каждому, кто сообщит
  мне о наличии таких ошибок в драйвере. При этом:

  - если Вы заинтересованы в дальнейшем развитии  и совершенство-
    вании драйвера, гарантирую предоставление Вам  распечаток ис-
    ходных текстов;

  - если Вы просто желаете использовать драйвер  RKSD.COM, гаран-
    тирую Вам бесплатную поставку  исправленной  версии  в  самые
    кратчайшие сроки (естественно, на Вашей дискете и при условии
    оплаты Вами почтовых расходов).

  ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄

  ╔═══════════════════════════════════════════════════════════╗
  ║   Разработчик не имеет возражений против свободного рас-  ║
  ║   пространения  и использования представляемого драйвера  ║
  ║   в некоммерческих целях и в неизмененном виде.           ║
  ╚═══════════════════════════════════════════════════════════╝

  ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀
