                                       А.В.Сесса (MasterSoft)

     ПРОГРАММА ФОРМАТИРОВАНИЯ ДИСКЕТ С ЗАЩИТОЙ ОТ БУТОВЫХ ВИРУСОВ
__________________________________________________________________________

     Название программы - VFORMAT.EXE,
     Версия 1.6 ( Август 1991г.)

     Назначение программы - форматирование дискет в произвольном формате
с записью вакцинированного загрузчика, предотвращающего работу бутовых
вирусов.

     Вызов -  VFORMAT <диск>: [опции],

где опции -

Tnn   : форматирование nn дорожек
Snn   : форматирование nn секторов в дорожке
Hn    : форматирование n сторон
P     : специальная опция для компьютеров PS/2
V     : отказ от верификации дискеты (и экономия 33% времени)
Gnnn  : установка GAP-Length = nnn (*)
Inn   : установка Interleave Factor = nn (*)
Bnnn  : установка BIOS-Disk-Descriptor Byte = nnn (не на XT) (*)
Cn    : установка n секторов в кластере (1 или 2) (*)
Dnnn  : установка размера корневого каталога = nnn (*)
Fnn   : относительное смещение секторов на смежных дорожках на nn секторов (*)

Опции с (*) автоматически устанавливаются в оптимальные значения, но Вы
можете с ними немного поэкспериментировать:
- снижение GAP-Length может повысить скорость работы с дискетой;
- уменьшение размера корневого каталога позволит увеличить полезную емкость
дискеты.

Следующая таблица показывает, как пользоваться основными опциями:

Опции         Емкость диска    Может использоватся с дисководами
-----         -------------    ---------------------------------
T40 S9         360 КБайт       360 kB, 720 kB, 1.2 MB, 1.44 MB
T41 S10        410 КБайт       360 kB, 720 kB, 1.2 MB, 1.44 MB
T80 S9         720 КБайт       720 kB, 1.2 MB, 1.44 MB
T82 S10        820 КБайт       720 kB, 1.2 MB, 1.44 MB
T82 S15       1.2  MБайт       1.2 MB, 1.44 MB
T80 S18       1.44 MБайт       1.2 MB(далеко не со всеми!), 1.44 MB
T82 S18       1.46 MБайт       1.2 MB(-//-), 1.44 MB
T82 S21       1.76 MБайт       1.44 MB

     Ограничения и противопоказания:

    - возможно зависание некоторых "неполноценных" ПЭВМ (в частности
"Amstrad PC 1640", "Искра 1030.11" и первых версий "Нейрона" с ROM-
BIOS версии 3.21) в момент загрузки с зараженной вакцинированной
дискеты, при этом вирус с дискеты не удаляется, но пользователь все
же успеет получить сообщение о наличии вируса.

     Взаимодействие вакцины с вирусом:

     Процесс заражения вакцинированного диска бутовым вирусом
ничем не отличается от заражения обычных дисков - вирус переносит
содержимое BOOT-сектора в свободное место диска, а на место
загрузчика помещает свое тело.
     При загрузке зараженной системы первой получает управление
находящаяся в BOOT-секторе программа инсталляции вируса, при этом
будет перехвачено прерывание Int13 и,возможно, некоторые другие
прерывания. После этого считывается спрятанный вирусом BOOT-сектор
и следует нормальная загрузка ДОС, первой фазой которой будет запуск
вакцинированного загрузчика. Вакцина первым делом нейтрализует вирус,
восстанавливая важнейшие вектора прерываний. При обнаружении следов
работы вируса на экран выводится значение векторов захваченных
прерываний, после чего на экране появится предупреждающее сообщение
с предложеним о восстановлении загрузчика:

              Virus sterilized. Cure BOOT?

     При желании провести исследование вируса пользователь может
отказаться от удаления вируса и продолжить загрузку, нажав клавишу
[n]. В этом случае и в памяти и на диске останутся безобидные копии
"стерилизованного" вируса. При загрузке с зараженной вакцинированной
дискеты на машине с жестким диском после нейтрализации вируса в памяти
и отказе удаления вируса из загрузчика блокируется доступ к "винчестеру".
Для возобновления возможности работы с жестким диском следует загрузиться
с жесткого диска или здоровой дискеты.

     СЛЕДУЕТ ОБРАТИТЬ ВНИМАНИЕ НА ТО, ЧТО МНОГИЕ БУТОВЫЕ ВИРУСЫ ЗАРАЖАЮТ
MBR ЖЕСТКОГО ДИСКА В ФАЗЕ ИНСТАЛЛЯЦИИ, ТО ЕСТЬ ДО ИХ НЕЙТРАЛИЗАЦИИ
ВАКЦИНОЙ - ЗАЩИТУ "ВИНЧЕСТЕРА" ОТ ТАКИХ ВИРУСОВ ОБЕСПЕЧИТ ЕГО ОБРАБОТКА
УТИЛИТОЙ VITAMINB.EXE.

     Выводимые на экран адреса захваченных вирусом прерываний
можно использовать для идентификации вирусов:

Int08-ХХХ0:0887 - LIBERTY (кроме указанных векторов этот файлово-бутовый
Int17-ХХХ0:0BF2   вирус перехватывает Int10-XXX0:0B2C и Int14-XXX0:0B7A;
Int1C-ХХХ0:0A44   ВИТАМИН-Б эти вектора не исправляет, но и с ними
Int13-ХХХ0:07EF   LIBERTY оказывается надежно стерилизованным)

Int08-ХХХ0:01CE - JOSHI
Int09-ХХХ0:010A
Int13-ХХХ0:04FA

Int08-ХХХ0:0F75 - INVADER (файлово-бутовый)
Int09-ХХХ0:0373
Int13-ХХХ0:04F0

Int08-ХХХ0:027B - DISK KILLER
Int13-ХХХ0:028F

Int09-ХХХ0:04D9 - DEN ZUK
Int13-ХХХ0:0526

Int09-ХХХ0:035D * FORM (Int09 перехватывает только 18 числа
Int13-ХХХ0:0346 	каждого месяца!)

Int1C-ХХХ0:051A * KEYDROP (Int1C перехватывает только при
Int13-ХХХ0:0592 	теплой перезагрузке!)

Int13-ХХХ0:0015 * STONED (Marijuana) и его многочисленные переделки

Int13-ХХХ0:001F * BLOODY

Int13-ХХХ0:0095 - PRINT SCREEN (Abs-1)

Int13-ХХХ0:0276 - BRAIN/ASHAR

Int13-ХХХ0:0346 * FORM (см. выше)

Int13-XXX0:03A0 - FILL

Int1С-ХХХ0:03A8 - FLIP (файлово-бутовый вирус при загрузке заводит
		        собственное прерывание Int9F-XXX0:04F8;
		        для нейтрализации вируса при загрузке
		        ДОС достаточно исправить вектор Int1C)

Int13-ХХХ0:04B0 - STARSHIP (файлово-бутовый)

Int13-ХХХ0:0592 * KEYDROP (см. выше)

Int13-ХХХ0:7CD0 - BALL (Italian)
                - TYPO-boot

Int13-ХХХ0:7D38 * LOVECHILD b3

здесь ХХХ0 - обозначает сегмент вируса, который может различаться
на разных машинах в зависимости от объема доступной ДОСу памяти.
Звездочкой отмечены вирусы, "ускользающие" на жесткий диск до
передачи управления вакцинированному загрузчику.

     Отличия новой версии от предыдущих:

Версия 1.6 - несколько изменен загрузчик;
           - выполнены следующие изменения текста оригинальной программы
             (да простит меня ее автор!):
    a) исправлена ошибка, приводившая к неправильной работе на РС ХТ с
80-дорожечными дисководами;
    б) добавлена обработка нажатия Ctrl-Break - ранее после этого терялся
блок параметров диска, в результате чего переставали читаться дискеты;
    в) при обнаружении сбоя отбраковывается один кластер, а не вся сторона
дорожки;
    г) устранен вопрос "Abort, Retry, Ignore ?" при обнаружении плохого
сектора.

Версия 1.5 - первая версия VFORMAT - номер версии выбран в соответствии
с текущей версией утилиты VITAMINB.EXE, использующей идентичный загрузчик.
VFORMAT 1.5 создан на основе свободно распространяемого исходного текста
программы FDFORMAT Ver. 1.20 (автор Christoph H. Hochstätter из ФРГ),
пpи этом в VFORMAT были внесены некотоpые улучшения, в частности,
испpавлен алгоpитм вычисления размера FAT.

     Права распространения программы:

     Эта программа и ее исходный текст может свободно распространяться
в некоммерческих целях (желательно при этом не терять ее описание).
Но если VFORMAT так понравится Вам, что Вы захотите вознаградить автора,
Вы можете воспользоваться приведенным ниже адресом.
Автор будет очень рад, если VFORMAT сможет поймать новый вирус
(не упомянутый в этом описании) - в этом случае Вы можете переслать
дискету с вирусом и стать зарегистрированным пользователем этой программы
и программы VITAMINB.

Вирусы и замечания направлять по адресу:

           320130 Днепропетровск
           пер.Фестивальный 12, кв.54
           Сессе Александру Владимировичу
