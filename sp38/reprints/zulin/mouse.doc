

                        Описание работы драйвера

                       -------------------------
                        Использывание регистров.

         Обращение к функциям драйвера "мыши" осуществляют анало-
    гично  обычным  обращениям  к  функциям   DOS.   В   регистры
    центрального процессора заносятся необходимые значения, и да-
    лее производится вызов прерывания 33h  (прерывания обслужива-
    ния драйвера "мыши" ). Программа обслуживания  прерываний вы-
    полняет требуемые действия и,если это предусмотренно, возвра-
    щает значения полученных результатов.  Драйвер  "мыши"  фирмы
    Microsoft также "перехватывает" вектор  прерывания  10h  BIOS
    (базовой системы ввода-вывода )  и  отслеживает  переключение
    режимов экрана. Драйвер автоматически настраивается  на любой
    из поддерживаемых BIOS видеорежимов. Фирма  Microsoft предла-
    гает драйвер, поддерживающий 35 прикладных функций ,у драйве-
    ров других фирм количество  выполняемых  функций  может  быть
    иным .Драйвер "мыши" не производит проверки  правильности на-
    чальных значений ,вводимых в функцию, об этом должна заботит-
    ся прикладная программа. В случае обращения к непредусмотрен-
    ной функции большинство драйверов просто игнорируют вызов. По
    общепринятому соглашению номера функций драйвера "мыши" дают-
    ся в десятичных числах, в отличии от обычно используемого для
    таких целей шестнадцатиричного формата.


                    Графические и текстовые курсоры

         Драйвер "мыши" поддерживает работы с  тремя разновиднос-
    тями курсора - жестким (аппаратным) текстовым  курсором, мяг-
    ким (программируемым) текстовым курсором и графическим курсо-
    ром. Жесткий текстовый курсор - это мигающий  курсор, поддер-
    живаемый видеоадаптером, который может только перемещаться по
    символьным клеткам на экране. Этот курсор может  иметь  форму
    прямоугольного блока или подчеркивающей линии. Мягкий тексто-
    вый курсор поддерживается  программными  средствами драйвера.
    Драйвер изменяет в экранной памяти атрибуты текущего символа,
    меняя таким образом цвет фона, цвет символа или и то и другое
    одновременно. Такой курсор также перемещается только  по сим-
    вольным клеткам экрана. Графический курсор имеет  вид некото-
    рого графического объекта, перемещающегося поверх изображения
    на экране.
         Вы можете выбрать любой из трех перечисленных типов кур-
    сора для использования в соответствующем режиме экрана, одна-
    ко только один курсор может присутствовать на экране  в теку-
    щий момент времени. Внутри вашей прикладной программы  вы мо-
    жете также производить переключение между  различными  типами
    курсора.


                   Формирование графического курсора

         Графический курсор может появляются на экране  или исче-
    зать с экрана при помощи вызова соответствующих функций. Этот
    курсор определяется некоторыми блоками пикселов, имеющим пря-
    моугольную форму. Когда такой такой блок перемещается  по эк-
    рану и взаимодействует с пикселами  изображения, находящегося
    "под" ним, происходит формирование фона изображения графичес-
    кого курсора. Результаты  этого  взаимодействия  определяются
    содержимым двух массивов, размером 16 на 16 бит  каждый, один
    из которых являются маской экрана, а другой - маской курсора.
    Маска экрана определяет, какая  часть  пикселов  графического
    блока курсора будет формировать образ курсора, а  какая часть
    будет фоном курсора. Маска курсора определяет те пикселы, ко-
    торые будут участвовать в формирование цвета  курсора.  Перед
    тем как произвести какие - либо изменения изображения на этом
    участке экрана, который находится непосредственно  под курсо-
    ром, курсор необходимо спрятать (восстановить  изображения на
    месте курсора), для  того,  чтобы  впоследствии,  перемещении
    курсора, на новое изображение не наложилась часть старого.
         Необходимо иметь в виду, что в режиме  высокого разреше-
    ния (EGA, VGA) графический блок курсора имеет размеры  16  на
    16 пикселов; в режиме среднего разрешения (CGA, 4 цвета)  - 8
    на 16 пикселов;  в  режиме  среднего  разрешения  (EGA,  VGA,
    640*200, 16 цветов) - 4 на 16 пикселов.

         При формировании графического курсора драйвер использует
    данные, содержащиеся в экранной памяти компьютера и определя-
    ющие цвета каждого пиксела на  экране.  Для  каждого  пиксела
    графического блока курсор драйвера выполняет  следующие поби-
    товые логические операции: логическое умножение  (AND)  маски
    экрана на поле экрана, лежащее за курсором, и  далее логичес-
    кую операцию исключающего ИЛИ (XOR) маски экрана и результата
    предыдущей операции.

          В таблице представляет варианты возможны сочетания:

  ------------------------------------------------------------------------
   Бит маски экрана    Бит маски курсора    Результирующий бит на экране
  ------------------------------------------------------------------------

          0                   0                       0
          0                   1                       1
          1                   0                не изменяются
          1                   1                инвертируются

  ------------------------------------------------------------------------

         Для каждой поддерживаемой драйвером функции  "мыши"  под
    положением графического курсора на экране подразумеваются ко-
    ординаты некоторой точки экрана, находящейся под  блоком кур-
    сора и носящей название "горячего пятна" курсора.  Обычно (по
    умолчанию) "горячим пятном" курсора  является  левый  верхний
    угол графического блока курсора с относительными координатами
    (0, 0), но по желанию в качестве "горячего пятна"  можно выб-
    рать любую другую точку курсора.


                        Мягкий текстовый курсор

         Этот текстовый курсор вы можете  использовать  во  время
    работы вашего компьютера в одном из текстовых  режимов. Изме-
    няя атрибуты символа под курсором, можно  получать  различные
    сочетания цветов этого символа и его фона, выделяя  таким об-
    разом нужную текстовую клетку.
         Желаемый результат достигается путем  задания  некоторых
    значений для двух 16-ти битных масок - маски экрана  и  маски
    курсора (аналогично  графическому  курсору)  -  которые впос-
    ледствии будут переданы драйверу. Каждая из этих масок содер-
    жит в себе следующие битовые поля: бит 15  устанавливает сос-
    тояние мигающего (1) или немигающего (0) символа;  биты 12-14
    определяют цвет фона данной текстовой клетки; биты 8-10 опре-
    деляют цвет символа; биты 0-7 содержат ASCII-код символа.
         Значения маски экрана и маски курсора  определяют  новые
    атрибуты символа находящегося под курсором. Маска  экрана оп-
    ределяет, каким образом изменяются эти атрибуты.
         Драйвер обращается непосредственно  к  текстовой  памяти
    экрана, выбирая из нее данные по интересующему символу. Далее
    производится логическое умножение (AND)  выбранных  с  экрана
    данных на маску экрана, и затем операция ИЛИ (XOR)  между ре-
    зультатом предыдущей операции и маской курсора.
         Под положением текстового курсора на экране драйвер под-
    разумевает координаты символа, находящегося под курсором.


                        Жесткий текстовый курсор

         Этот курсор, поддерживаемый аппаратными средствами виде-
    оадаптера, также может быть использован при работе компьютера
    в одном из текстовых режимов. Ширина курсора равна ширине од-
    ной текстовой клетки, а его высота  регулируется программными
    средствами в пределах высоты текстовой клетки. Высота курсора
    определяется количеством скан-линий (отрезком  строк горизон-
    тальной развертки), которые будут участвовать  в формировании
    курсора. Количество скан-линий, составляющих  одну  текстовую
    клетку экрана, зависит от типа используемого дисплея и от ре-
    жима экрана. Верхняя скан-линия текстовой клетки  имеет номер
    0.


                             Клавиши "мыши"

         Функции драйвера  "мыши"  позволяют  определять  текущее
    состояние клавиш "мыши", а также  подсчитывать,  сколько  раз
    определенная клавиша была нажата или  отпущена  за  известный
    промежуток времени Текущее состояние клавиш определяется бай-
    том состояния, возвращаемой соответствующей функцией, где:

           Бит 0 - Состояние левой клавиши
           Бит 1 - Состояние правой клавиши
           Бит 2 - состояние средней клавиши (для "мышей" фирмы
                Mouse Systems)

         Если соответствующий бит установлен (1),  то  клавиша  в
    данный момент нажата; если бит сброшен (0) - то клавиша отпу-
    щена. Каждое нажатие и отпускание  клавиши  регистрируется  в
    специальном счетчике.  Драйвер  каждый  раз  сбрасывает  этот
    счетчик в 0 после того, как его показания будут прочитаны со-
    ответствующей функцией,а также при начальной установке.


                       Внутренний флажок курсора

         Драйвер "мыши"  постоянно  поддерживает  так  называемый
    "внутренний флажок курсора". Этот  флажок  определяет,  когда
    курсор должен появится на экране. Если  флажок  равен  0,  то
    курсор становится видимым; если флажок отличен от  нуля (при-
    нимает любое другое значение ), курсор исчезает с экрана.
         Вы можете производить вызов функций 1 и 2 сколько угодно
    раз, однако каждый вызов  функции  2  (запрещающей  появление
    курсора), требует последующего вызова функции  1 (разрешающей
    появление курсора). Это необходимо для  восстановления преды-
    дущего состояния флажка курсора, так как он накапливает коли-
    чество вызовов функций.


        Вызов функций драйвера "мыши" из ассемблерной программы

          Пример:

             ; установить графический курсор в точку
        ; с координатами (150,100)
            mov         ax,4    ; вызов функции 4
            mov         cx,150  ; горизонтальная координата 150
            mov         dx,100  ; вертикальная координата 100
            int         33h     ; обращение к прерыванию 33h

         Важно иметь в виду, что перед первым обращением к преры-
    ванию 33h нужно проверить наличие драйвера  "мыши"  в  памяти
    вашего компьютера. Если драйвер не загружен,  выполнение пре-
    рывания 33h приведет к непредсказуемым результатам. Удостове-
    риться в наличии загруженного драйвера "мыши" можно по следу-
    ющим признакам:
         1) вектор прерывания 33h не равен 0;
         2) вектор прерывания 33h не указывает на инструкцию IRET.

    Пример вызова драйвера "мыши" из программы на языке BASIC:


          10 DEF SEG = 0
          15 ' Определяем адрес вызова
          16 ' Сегмент -
          20 GMSEG   = PEEK( 51*4 + 2 ) + 256 * PEEK( 51*4 + 3 )
          25 ' Смещение -
          30 GMOUSE  = 2 + PEEK( 51*4 ) + 256 * PEEK( 51*4 + 1 )
          45 ' Устанавливаем сегмент регистра как сегмент драйвера
          40 DEF SEG = GMSEG
          50  ' Определяем активный режим "мышки"
          60  G1% = 0 : G2% = 0
          70  CALL GMOUSE ( G1%, G2%, G3%, G4% )
          80  IF G2% AND 2 THEN PRINT "Найдена 2-х кнопочная мышь"
          90  IF G2% AND 3 THEN PRINT "Найдена 3-х кнопочная мышь"
          100 IF NOT G1%   THEN PRINT "Драйвер мыши не обнаружен !"


                        Функции драйвера "мыши"

         Функция 0: начальная установка драйвера и чтение текуще-
         ---------- го состояния
         Функция 0 производит начальную  установку  и  возвращает
    информацию  о  текущем  состоянии  аппаратных  и  программных
    средств "мыши".Функция определяет текущий режим  экрана, пря-
    чет курсор и помещает его в центр экрана, а также  задает на-
    чальные значения внутренним переменным драйвера  в соответст-
    вии со следующей таблицей:

    --------------------------------------------------------------------
           Переменная                          Значение

    внутренний флажок курсора           0FFFFh(-1),курсор спрятан
    форма графического курсора          горизонтальный овал
    текстовый курсор                    обращенное видеоизображе-
                                        ние символа
    маски определяемые пользователем    все нули
    режим эмуляции                      включен
    вертикальное соотношение
    микки/пиксел                        16/8
    горизонтальное соотношение
    микки/пиксел                        8/8
    минимальные координаты курсора
    по вертикали и горизонтали          0,0
    максимальные координаты курсора
    по вертикали и  горизонтали         соответствующие  макси-
                                         мальные значения
                                        координат экрана в теку-
                                        щем режиме минус единица
    --------------------------------------------------------------------

                             Регистры 80i86

 ---------------------------------------------------------------------------
 Входные значения             AX         0000h
 Возвращаемые значения        AX         состояние драйвера 0000h драйвер или
                                         аппаратная поддержка  не установлены
                                         FFFFh(-1) начальная установка прошла
                                         успешно
                              BX         количество клавиш "мыши"

                              0000h      не две клавиши

                              0002h      две клавиши

                              0003h      три клавиши (мышь Mouse Systems)
  -------------------------------------------------------------------------

    Turbo Professional : см. p. InitializeMouse.

    BASIC:
      Вводится:  G1% = 0
      Возвращается: G1% = состояние мыши (-1 - установлена, 0 - нет)
        G2% = количество кнопок (2 кнопки, 3 кнопки)

    Пример:
          50  ' Определяем активный режим "мышки"
          60  G1% = 0 : G2% = 0
          70  CALL GMOUSE ( G1%, G2%, G3%, G4% )
          80  IF G2% AND 2 THEN PRINT "Найдена 2-х кнопочная мышь"
          90  IF G2% AND 3 THEN PRINT "Найдена 3-х кнопочная мышь"
          100 IF NOT G1%   THEN PRINT "Драйвер мыши не обнаружен !"



         Функция 1: Сделать курсор видимым
         --------
         Функция 1 увеличивает на 1 значение счетчика внутреннего
    флажка курсора. Если флажок равен 0, курсор  становится види-
    мым и появляется на экране. Начальное значение  флажка  равно
    -1, что соответствует  спрятанному  курсору.  В  случае  если
    внутренний флажок уже равен 0, вызов функции 1 не приводит ни
    к каким результатам.

                             Регистры 80i86

    ---------------------------------------------------------------------
         Входные значения             AX         0001h
         Возвращаемые значения       нет
    ---------------------------------------------------------------------

         Turbo Professional : см. p. ShowMouse.

         BASIC
          Вводится:  G1% = 1
          Возвращается: ничего

         Пример:

         110  ' Сделать курсор Мыши видимым
         120  G1% = 1
         130 CALL GMOUSE ( G1%, G2%, G3%, G4% )


         Функция 2: Сделать курсор невидимым
         ---------
         Функция 2 делает курсор невидимым и уменьшает на  1 зна-
    чение внутреннего флажка курсора. Несмотря на то,  что курсор
    не виден на экране, он продолжает  отслеживать  движение "мы-
    ши".
         Эту функцию рекомендуется вызывать каждый раз перед тем,
    как произвести какие-либо изменения на  том  участке  экрана,
    где находится курсор. этим вы избежите  проблем,  возникающих
    из-за взаимодействия курсора с данными на экране.
         Нужно иметь в виду, что на каждый вызов функции  2 впос-
    ледствии должен быть произведен вызов  функции  1,  для  того
    чтобы восстановить внутреннее значение флажка  курсора. Кроме
    того, при каждом переключении режима экрана функция 2 вызыва-
    ется автоматически.
         Произведите вызов функции 2 в конце вашей программы,что-
    бы спрятать курсор. Это позволит вам быть  уверенным  в  том,
    что ничего лишнего не останется на  экране  после  завершения
    программы.

                             Регистры 80i86

     ---------------------------------------------------------
         Входные значения             AX         0002h
         Возвращаемые значения       нет
     ---------------------------------------------------------

         Turbo Professional : см. p. HideMouse.

         BASIC
          Вводится:  G1% = 2
          Возвращается: ничего

         Пример:

         110  ' Сделать курсор Мыши невидимым
         120  G1% = 2
         130 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 3: Определяет местоположение курсора и состояние
           ---------  клавиш "мыши"
         Функция 3 возвращает данные по текущему состоянию клавиш
    "мыши" и положения курсора на экране.

                             Регистры 80i86

 --------------------------------------------------------------------------
 Входные значения             AX         0003h
 Возвращаемые значения        BX         байт состояния клавиш (BL)
                              Бит 0      левая клавиша
                              Бит 1      правая клавиша
                              Бит 2      средняя клавиша(мышь Mouse Systems)
                              Биты 3-7   не используются
                              SX         горизонтальная координата курсора
                              DX         вертикальная координата курсора
 --------------------------------------------------------------------------
         Если бит установлен (1), то клавиша нажата, если сброшен
    (0) - клавиша отпущена.

      Turbo Professional : см. f. MouseWhereXY,MouseWhereX,
                                  MouseWhereY,MouseInWindow.

      BASIC
    Вводится: G1% = 3
    Возвращается: G2% = статус кнопок
                  G3% = координата курсора по горизонтали
                  G4% = координата курсора по вертикали
     Пример:

      110  ' Читаем место положения Мыши и статус кнопок
      120  G1% = 3
      130 CALL GMOUSE ( G1%, G2%, G3%, G4% )
      140 PRINT "Позиция Мышки : X =" G3% ", Y =" G4%
      150 IF G2% AND 1 THEN PRINT "Левая кнопка";
      160 IF G2% AND 2 THEN PRINT "Правая кнопка";
      170 IF G2% AND 4 THEN PRINT "Средняя кнопка";
      180 PRINT "нажата"


          Функция 4: Установить курсор на экране в заданную позицию
          ----------
         Функция 4 Устанавливает курсор на экране в  заданную по-
    зицию. Входные значения координат должны быть в пределах диа-
    пазона, установленного драйвером  для  текущего  виртуального
    экрана "мыши".
         Некоторые драйверы "мыши"  округляют  значение  счетчика
    микки для получения действительной координаты пикселa, другие
    просто отбрасывают остаток  при  масштабировании.  Это  может
    приводить к некоторой разнице в позиционировании  курсора при
    использовании разных драйверов "мыши", что становится особен-
    но заметным при сочетании новых "мышей" высокого разрешения с
    дисплеями высокого разрешения.

                             Регистры 80i86

        ------------------------------------------------------------
         Входные значения             AX         0004h
                                              CX      горизонтальная коор-
                                               дината курсора

                                      DX      вертикальная коорди
                                              -ната курсора
         Возвращаемые значения       нет
        -------------------------------------------------------------

          Режим    Адаптер     Виртуальный   Размер    Бит/Пиксель
          Экрана   дисплея     экран (XxY)    цели   Графический режим
         ------  ------------  -----------  -------  -----------------
           0      C, E, 3270   640 x 200    16 x 8          -
           1      C, E, 3270   640 x 200    16 x 8          -
           2      C, E, 3270   640 x 200     8 x 8          -
           3      C, E, 3270   640 x 200     8 x 8          -
           4      C, E, 3270   640 x 200     2 x 1          2
           5      C, E, 3270   640 x 200     2 x 1          2
           6      C, E, 3270   640 x 200     1 x 1          1
           7      M, E, 3270   640 x 200     8 x 8          -
           D      E            640 x 200    16 x 8          2
           E      E            640 x 200     1 x 1          1
           F      E            640 x 350     1 x 1          1
          10      E            640 x 350     1 x 1          1
          30      3270         720 x 350     1 x 1          1
                  H            720 x 348     1 x 1          1

         Адаптер дисплея:
           M = IBM Монохромный дисплей/принтер адаптер
           C = IBM CGA
           E = IBM EGA
        3270 = IBM 3270 PC
           H = Геркулес монохромная графическая карта

        Turbo Professional : см. p. MouseGotoXY.

           BASIC
         Вводится:  G1% = 4
                    G3% = новая координата курсора по горизонтали
                    G4% = новая координата курсора по вертикали
        Возвращается: ничего

         Пример:

        110  ' Помещаем курсор в верхний-левый угол экрана
        120 G1% = 4
        130 G3% = 0 : G4% = 0
        140 CALL GMOUSE ( G1%, G2%, G3%, G4% )

            Функция 5: Получить информацию о количестве нажатий
            ---------  на одну клавишу
         Функция 5 возвращает информацию о текущем состоянии кла-
    виш, количестве нажатий на указанную клавишу  с  момента пос-
    леднего вызова данной функции, а также о  позиции  курсора  в
    момент последнего нажатия указанной клавиши.
         Диапазон счетчика нажатий колеблется от 0 до 0EFFFh. Ин-
    дикатор переполнения отсутствует. После вызова данной функции
    счетчик обнуляется.

                             Регистры 80i86

 --------------------------------------------------------------------------
 Входные значения             AX         0005h
                              BX         байт индентификации клавиш (BL)
                              Бит 0      левая клавиша
                              Бит 1      правая клавиша
                              Бит 2      средняя клавиша
                                         ("мышь" Mouse Systems)
 Возвращаемые значения        AX         байт состояния клавиш (AL)
                                          Бит 0      левая клавиша
                                          Бит 1      правая клавиша
                                          Бит 2      средняя клавиша
                                         ("мышь" Mouse Systems)
                              BX         число нажатий указанной клавиши с
                                         момента последнего вызова
                                         функции
                              CX         горизонтальная координата курсора
                                         в момент нажатия указанной
                                         клавиши
                              DX         вертикальная координата курсора
                                         в момент нажатия указанной клавиши
 --------------------------------------------------------------------------

         Если бит установлен (1), то клавиша нажата, если сброшен
    (0)-клавиша отпущена.

        Turbo Professional : см. f. MouseButtonPressed.

        BASIC
      Вводится:  G1% = 5
                 G2% = статус кнопок (левая = 0,
                       правая = 1, средняя = 2)
      Возвращается: G1% = статус кнопок
                    G2% = количество нажатий клавиши
                    G3% = координата курсора по горизонтали при
                          последнем нажатии
                    G4% =  ---- по вертикали ----

      Пример:

         110 ' Читаем статус нажатия левой кнопки Мыши
         120 G1% = 5 : G2% = 1
         130 CALL GMOUSE ( G1%, G2%, G3%, G4% )
         140 IF G1% AND 2 THEN PRINT "Левая кнопка нажата в столбце ";G3%


            Функция 6: Получить информацию о количестве отпусканий
            ---------  клавиши
         Функция 6 аналогично функции 5 возвращает  информацию  о
    текущем состоянии  клавиш,  количестве  отпусканий  указанной
    клавиши с момента последнего вызова данной функции, а также о
    позиции курсора в момент последнего отпускания указанной кла-
    виши.
         Диапазон счетчика отпусканий колеблется от 0  до 0EFFFh.
    Индикатор  переполнения  отсутствует.  После  вызова   данной
    функции счетчик обнуляется.

                             Регистры 80i86

 -----------------------------------------------------------------------------
 Входные значения             AX         0006h
                              BX         байт индентификации клавиш (BL)
                              Бит 0      левая клавиша
                              Бит 1      правая клавиша
                              Бит 2      средняя клавиша
                                         ("мышь" Mouse Systems)
 Возвращаемые значения        AX         байт состояния клавиш (AL)
                                          Бит 0      левая клавиша
                                          Бит 1      правая клавиша
                                          Бит 2      средняя клавиша
                                         ("мышь" Mouse Systems)
                              BX         число отпусканий указанной клавиши
                                         c момента последнего вызова
                                         функции
                              CX         горизонтальная координата курсора
                                         в момент отпускания указанной
                                         клавиши
                              DX         вертикальная координата курсора
                                         в момент отпускания указанной клавиши
 -----------------------------------------------------------------------------

         Если бит установлен (1), то клавиша нажата, если сброшен
    (0)-клавиша отпущена.

        Turbo Professional : см. f. MouseButtonReleased.

        BASIC
      Вводится:  G1% = 5
                 G2% = статус кнопок (левая = 0,
                       правая = 1, средняя = 2)
      Возвращается: G1% = статус кнопок
                    G2% = количество отпусканий клавиши
                    G3% = координата курсора по горизонтали при
                          освобождении кнопки
                    G4% =  ---- по вертикали ----

      Пример:

         110 ' Читаем статус отпускания левой кнопки Мыши
         120 G1% = 5 : G2% = 1
         130 CALL GMOUSE ( G1%, G2%, G3%, G4% )
         140 IF G1% AND 2 THEN PRINT "Левая кнопка отжата, X = ";G3%


           Функция 7: Установить диапазон перемещения курсора
           ---------  по горизонтали (X)
         Функция 7 устанавливает горизонтальный  диапазон переме-
    щения курсора на экране. В результате текущая  координата го-
    ризонтальная курсора приводит к новому масштабу.Если в момент
    вызова горизонтальная координата курсора находилась  вне ука-
    занного диапазона курсор помещается  в  соответствующий  край
    диапазона.

                             Регистры 80i86

      --------------------------------------------------------------
      Входные значения      AX      0007h
                            CX      минимальная горизонтальная
                                    координата курсора
                            DX      максимальная горизонтальная
                                    координата курсора
      Возвращаемые значения  нет
      --------------------------------------------------------------

         Если минимальное значение больше  максимального, функция
    производит обмен значений.

        Turbo Professional : см. p. MouseWindow.

        BASIC
        Вводится:  G1% = 7
                   G3% = минимальная гоpизонтальная кооpдината куpсоpа
                   G4% = максимальная гоpизонтальная кооpдината куpсоpа
        Возвpащается: ничего

        Пpимеp:

        110 ' Pазpешаем куpсоp в гоpизонтальном диапазоне между 100 и 200
        120 G1% = 7
        130 G2% = 100 : G3% = 200
        140 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 8: Установить диапазон перемещения курсора
           ---------  по вертикали (Y)
         Функция 8 устанавливает вертикальный  диапазон перемеще-
    ния курсора на экране. В результате текущая  вертикальная ко-
    ордината курсора приводит к новому масштабу.  Если  в  момент
    вызова вертикальная координата курсора находилась вне указан-
    ного диапазона курсор помещается в соответствующий  край диа-
    пазона.

                             Регистры 80i86

      ------------------------------------------------------------
      Входные значения             AX     0008h
                                   CX     минимальная вертикальная
                                          координата курсора
                                   DX     максимальная вертикальная
                                          координата курсора
      Возвращаемые значения        нет
      ------------------------------------------------------------

         Если минимальное значение больше  максимального, функция
    производит обмен значений.

        Turbo Professional : см. p. MouseWindow.

        BASIC
        Вводится:  G1% = 8
                   G3% = минимальная веpтикальная кооpдината куpсоpа
                   G4% = максимальная веpтикальная кооpдината куpсоpа
        Возвpащается: ничего

        Пpимеp:

        110 ' Pазpешаем куpсоp в веpтикальном диапазоне между 100 и 200
        120 G1% = 8
        130 G2% = 100 : G3% = 200
        140 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 9: Задает параметры графического курсора
           ---------
         Функция 9 устанавливает цвет, форму и  задает координаты
    "горячего пятна" графического курсора. Как уже  было  сказано
    выше (см. примечание ф.9), этот курсор формируется  из графи-
    ческого блока размером 16 на 16 пикселов и определяется двумя
    массивами 16 на 16 бит каждый (маской экрана и  маской курсо-
    ра). Координаты горячего пятна курсора должны находится в ди-
    апазоне от 0 до 16.

                             Регистры 80i86

            ------------------------------------------------------
            Входные значения      AX     0009h
                                  BX     горизонтальная координата
                                         горячего пятна курсора
                                         в маске курсора
                                  DX     вертикальная координата
                                         горячего пятна курсора
                                         в маске курсора
                                  ES:DX  указатель на массив масок
                                  16 слов - маска экрана
                                  16 слов - маска курсора

            Возвращаемые значения       нет
            ------------------------------------------------------

         Каждое слово задается  значениями  16  пикселов  в соот-
    ветствующем ряду. Младший бит соответствует  крайнему правому
    пикселу.

        BASIC
        Вводится:  G1% = 9
                   G2% = гоpизонтальная кооpдината коpячего пятна
                   G3% = веpтикальная  кооpдината коpячего пятна
                   G4% = указатель на маски экpана и куpсоpа
        Возвpащается: ничего

        Пpимеp:

        10  ' Опpеделяем маску экpана
        20  '
        30    cursor (0,0)  = &HFFFF       '1111111111111111
        40    cursor (1,0)  = &HFFFF       '1111111111111111
        50    cursor (2,0)  = &HFFFF       '1111111111111111
        60    cursor (3,0)  = &HFFFF       '1111111111111111
        70    cursor (4,0)  = &HFFFF       '1111111111111111
        80    cursor (5,0)  = &HF00F       '1111000000001111
        90    cursor (6,0)  = &H0000       '0000000000000000
        100   cursor (7,0)  = &H0000       '0000000000000000
        110   cursor (8,0)  = &H0000       '0000000000000000
        120   cursor (9,0)  = &H0000       '0000000000000000
        130   cursor (10,0) = &HF00F       '1111000000001111
        140   cursor (11,0) = &HFFFF       '1111111111111111
        150   cursor (12,0) = &HFFFF       '1111111111111111
        160   cursor (13,0) = &HFFFF       '1111111111111111
        170   cursor (14,0) = &HFFFF       '1111111111111111
        180   cursor (15,0) = &HFFFF       '1111111111111111
        190 '
        200 ' Опpеделяем маску куpсоpа
        210 '
        220   cursor (0,1)  = &H0000       '0000000000000000
        230   cursor (1,1)  = &H0000       '0000000000000000
        240   cursor (2,1)  = &H0000       '0000000000000000
        250   cursor (3,1)  = &H0000       '0000000000000000
        260   cursor (4,1)  = &H0000       '0000000000000000
        270   cursor (5,1)  = &H0000       '0000000000000000
        280   cursor (6,1)  = &H07E0       '0000011111100000
        290   cursor (7,1)  = &H7FFE       '0111111111111110
        300   cursor (8,1)  = &H7FFE       '0111111111111110
        310   cursor (9,1)  = &H07E0       '0000011111100000
        320   cursor (10,1) = &H0000       '0000000000000000
        330   cursor (11,1) = &H0000       '0000000000000000
        340   cursor (12,1) = &H0000       '0000000000000000
        350   cursor (13,1) = &H0000       '0000000000000000
        360   cursor (14,1) = &H0000       '0000000000000000
        370   cursor (15,1) = &H0000       '0000000000000000
        380 '
        390 ' Устанавливаем стиль куpсоpа и гоpячее пятно "мыши"
        400 '
        410 '
        420   G1% = 9
        430   G2% = 6 ' гоpизонтальная кооpдината коpячего пятна
        440   G3% = 5 ' веpтикальная  кооpдината коpячего пятна
        450   CALL GMOUSE ( G1%, G2%, G3%, cursor (0,0))



           Функция 10: Задать параметры текстового курсора
           -----------
         Функция  10  осуществляет  выбор  жесткого  или  мягкого
    текстового курсора. Для жесткого текстового  курсора задаются
    первая и последняя скан-линии, принимающие участие в формиро-
    вании курсора. Для мягкого текстового курсора  задаются маски
    экрана и курсора.

                             Регистры 80i86

          ----------------------------------------------------------
          Входные значения      AX          000Ah
                                     BX      выбор типа курсора
                                     00h     мягкий текстовый курсор
                                     01h     жесткий текстовый курсор
                                     CX      маска экрана или номер
                                             первой скан-линии
                                     DX      маска куpсоpа или номер
                                             последней скан-линии

          Возвращаемые значения    нет
          ----------------------------------------------------------

        Turbo Professional : см. p. SoftMouseCursor, HardMouseCursor,
                                 c. DefaultScreenMask, DefaultCursorMask,
                                 p. NormalMouseCursor, FatMouseCursor,
                                    BlockMouseCursor, HiddenMouseCursor.

        BASIC
        Вводится:  G1% = 10
                   G2% = выбpать тип куpсоpа (0: мягкий, 1: жесткий)
                   G3% = маска экрана или номер первой скан-линии
                   G4% = маска куpсоpа или номер последней скан-линии
        Возвpащается: ничего

        Пpимеp:
        110 ' Pазpешить инвеpтиpующий куpсоp
        120 G1% = 10
        130 G2% = 0
        140 G3% = &HFFFF  :  G4% = &H7700
        150 CALL GMOUSE ( G1%, G2%, G3%, G4% )

           Функция 11: Прочитать значение счетчика сигналов микки
           ----------
         Функция 11 возвращает число сигналов  микки (минимальных
    приращений  перемещения  "мыши",  регистрируемых  аппаратными
    средствами), накопленное счетчиком с  момента  вызова  данной
    функции. Положительные значения соответствуют движению "мыши"
    вправо и вверх. Значения счетчика расположены в  интервале от
    -32768 до 32767. Индикатор  переполнения  отсутствует.  после
    вызова функции микки обнуляется.

                             Регистры 80i86

---------------------------------------------------------------------------
Входные значения             AX         000Bh

Возвращаемые значения        CX         число микки по горизонтали
                             DX         число микки по вертикали
---------------------------------------------------------------------------

        Turbo Professional : см. p. GetMickeyCount.

       BASIC
       Вводится:  G1% = 11
       Возвpащается: G3% = число микки по горизонтали
                     G4% = число микки по вертикали

       Пpимеp:

       110 ' Читаем значение счетчика микки
       120 G1% = 11
       130 CALL GMOUSE ( G1%, G2%, G3%, G4% )
       140 IF G3% > 0 THEN PRINT "мышка пеpеместилась впpаво"
       150 IF G4% > 0 THEN PRINT "мышка пеpеместилась вниз"


           Функция 12: Задает адрес подпрограммы обработки прерываний
           ----------
         Функция 12 передает драйверу адрес входа  в подпрограмму
    обработки прерывания, вызванного некоторым событием. В случае
    возникновения такого события выполнение  прикладной программы
    временно прерывается, и управление передается  по установлен-
    ному адресу.  После  завершения  работы  подпрограммы  работа
    прикладной программы возобновляется в  той  точке,  где  была
    прервана.
         Битовая маска определяет условия, вызывающие прерывание.
    Установленный бит (1) разрешает прерывание, сброшенный (0) --
    запрещает.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения          AX          000Ch
                                    CX      маска вызова
                                        бит 0 изменение позиции курсора~
                                        бит 1 нажата левая клавиша
                                        бит 2 отпущена левая клавиша
                                        бит 3 нажата правая клавиша
                                        бит 4 отпущена правая клавиша
                                        бит 5 нажата средняя клавиша
                                        (Mouse Systems)
                                        бит 6 отпущена средняя клавиша
                                        (Mouse Systems)
                                        7 - 15 не используются
                             ES:DX FAR  адрес подпрограммы
                                        обработки прерываний

          Возвращаемые значения        не определены
          ------------------------------------------------------
         ~ Драйвер фирмы Misrosoft  следит  за  позицией  "мыши".
    Драйверы фирм Logitech и Mouse  Systems  следят  за  позицией
    курсора.

         Во время вызова подпрограммы обработки  прерываний драй-
    вер передает ей следующие параметры:

   ----------------------------------------------------------------------

         AH     маска условия (биты установлены также, как и в маске вызова)
         BX     состояние клавиш
         CX     горизонтальная координата курсора
         DX     вертикальная координата курсора
         DI     значение вертикального счетчика микки
         SI     значение горизонтального счетчика микки

   ----------------------------------------------------------------------
         При завершении работы вашей прикладной программы устано-
    вите все биты маски вызова равными 0 и  вызовите  функцию 12.
    (При выходе из программы оставляйте систему в том  же состоя-
    нии, что и при входе.)

      Turbo Profesiional : см. p. SetMouseEventHandler, c. MouseRoutine.

      BASIC
      Вводится:  G1% = 12
                 G3% = маска вызова
                 G4% = указатель на пpоцедуpу обpаботки пpеpываний
      Возвpащается: ничего

      Пpимеp:

      110 ' Активиpует пpоцедуpу обpаботки пpеpываний BUTTDOWN,
      120 ' когда нажимается одна или больше клавиш
      130 G1% = 12
      140 G3% = &H002A  :  G4% = BUTTDOWN%
      150 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 13: Включение режима эмуляции светового пера
           ----------
         Функция 13 позволяет работать "мыши" в  режиме светового
    пера. В этом случае обращение к функции светового  пера будет
    возвращать координаты курсора на момент  последнего состояния
    "перо опущено".
         Состояния "перо опущено" и "перо  поднято"  определяются
    клавишами "мыши": все клавиши отпущены -- "перо поднято"; од-
    на клавиша нажата -- "перо опущено".
         При начальной установке драйвера режим эмуляции светово-
    го пера включается по умолчанию. Если в  системе присутствует
    настоящее световое перо, должна быть вызвана функция  14  для
    запрещения эмуляции.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения             AX         000Dh
          Возвращаемые значения        нет
          ------------------------------------------------------

          BASIC
          Вводится:  G1% = 13
          Возвpащается: ничего

          Пpимеp:

          110 ' Pазpешить эмуляцию светового пеpа
          120 G1% = 13
          130 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 14: Запрещение режима эмуляции светового пера
           ----------
         Функция 14 запрещение режим эмуляции светового пера. При
    этом любое последующее обращение к функции светового пера бу-
    дет возвращать информацию только о состоянии  настоящего све-
    тового пера.


                             Регистры 80i86

          ------------------------------------------------------
          Входные значения             AX         000Eh
          Возвращаемые значения        нет
          ------------------------------------------------------

          BASIC
          Вводится:  G1% = 14
          Выводится: ничего

          Пpимеp:

          110 ' Запpетить эмуляцию светового пеpа
          120 G1% = 14
          130 CALL GMOUSE ( G1%, G2%, G3%, G4% )


          Функция 15: Установить соотношение микки/пиксел
          ----------
         Соотношение определяется числом микки, приходящемся на 8
    пикселов экрана. Значения микки должны быть в пределах  от  1
    до 0EFFFh. При начальной установке драйвера по  умолчанию вы-
    бираются следующие соотношения микки/пиксел: по горизонтали -
    8/8; по вертикали - 16/8.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения     AX     000Fh
                               CX     число микки на 8 пикселов
                                      по горизонтали
                               DX     число микки на 8 пикселов
                                      по вертикали
          Возвращаемые значения  нет
          ------------------------------------------------------

          Turbo Professional: см. p. SetMickeyToPixelRatio.

         BASIC
         Input:  G1% = 15
                 G3% = отношение микки/пиксел по гоpизонтали
                 G4% = отношение микки/пиксел по веpтикали
         Return: none

         Example:

         110 ' Опpеделяем чувствительность по гоpизонтали - 8
         120 ' Опpеделяем чувствительность по веpтикали - 16
         130 G1% = 15
         140 G3% =  8
         150 G4% = 16
         160 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 16: Запретить появление курсора в специальной
           ----------  области

         Функция 16 создает на  экране  условную  специальную об-
    ласть. Если курсор попадает в эту область,  то  он  исчезает.
    Для отмены действия специальной области необходимо произвести
    вызов функции 1.

          ------------------------------------------------------
          Входные значения      AX      0010h
                               ES:DX    указатель на массив
                                        определяющий
                                        специальную область
          Возвращаемые значения  нет
          ------------------------------------------------------

         Формат массива:

          ------------------------------------------------------
            Смещение             Параметр
             0000h                левая горизонтальная координата
             0002h                верхняя вертикальная координата
             0004h                правая горизонтальная координата
             0006h                нижняя вертикальная координата
          ------------------------------------------------------

          BASIC
          Вводится:  G1% = 16
                     G4% = указатель на массив опpеделения области
          Возвpащается: ничего

          Пpимеp:

          110 ' Запpещаем показывать куpсоp в области (0,0)-(100,100)
          120 G1% = 16
          130 RANGE%(1) = 0   : RANGE%(2) = 0
          140 RANGE%(3) = 100 : RANGE%(4) = 100
          150 CALL GMOUSE ( G1%, G2%, G3%, RANGE%(0) )
           .
           .
           .

          500 ' Снова pазpешаем показывать куpсоp
          510 G1% = 1
          520 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 17: Задать параметры большого блока графического
           ----------  курсора
            Примечание:
         Функция  определена  для  драйвера   PC   Mouse.   Фирма
    Microsoft не дает документации по по этой функции.
         Действие функции 17 аналогично действию функции 9. Отли-
    чие состоит в том что функция 17 задается  размером массивов,
    определяющих маски экрана и курсора.

                             Регистры 80i86

          --------------------------------------------------------------
          Входные значения       AX     0011h
                                 BH     ширина курсора в словах (2 байта)
                                 CH     количество рядов в курсоре по
                                        вертикали
                                 BL     горизонтальная координата
                                        горячего пятна курсора в
                                        маске курсора (от -16 до 16)
                               ES:DX    указатель на массивы масок
                             (BH 'CH)   слов - маска экрана
                             (BH 'CH)   слов - маска курсора

          Возвращаемые значения  AH     0FFFFh (-1) функция выполнена
                                        успешно
          --------------------------------------------------------------


            Функция 18:
            ----------
          НЕ используется.


           Функция 19: Установить порог удвоенной скорости
           ----------
         Функция 19 Устанавливает значение порога  удвоенной ско-
    рости движения "мыши" (измеряемой микки в секунду),  при пре-
    вышении которого скорость движения курсора на экране удваива-
    ются. По умолчанию величина порога удвоенной скорости состав-
    ляет 64 микки в секунду.

                             Регистры 80i86
          ------------------------------------------------------
          Входные значения        AX    0013h
                                  DX    порог скорости в микки в
                                        секунду
          Возвращаемые значения   нет
          ------------------------------------------------------

          BASIC
          Вводится:  G1% = 19
                     G4% = поpог скоpости в пеpемещениях мыши в секунду
          Возвpащается: ничего

          Пpимеp:

          110 ' Устанавливаем двойной поpог скоpости 20 пеpемещений 
          120 ' мыши в секунду
          120 G1% = 19
          130 G4% = 20
          140 CALL GMOUSE ( G1%, G2%, G3%, G4% )
          .
          .
          .

          500 ' Запpещаем удваивание скоpости
          510 G1% = 19
          520 G4% = 256 'максимальное значение
          530 CALL GMOUSE ( G1%, G2%, G3%, G4% )


           Функция 20: Установить временную подпрограмму обработки
           ----------  прерывания
         Функция 20 Позволяет вам временно установить подпрограм-
    му обработки прерываний, поступающих от "мыши",  либо  просто
    изменить  маску  вызова  (см.ф.12).  Адрес  входа  в   старую
    подпрограмму должен быть обязательно восстановлен  перед тем,
    как ваша прикладная программа закончила работу.

                             Регистры 80i86

          -----------------------------------------------------------
          Входные значения      AX      0014h
                             BX:DX FAR  указатель на новую программу
                                CX      новая маска вызова
                                        (см.ф.12)
                                        бит 0 изменение позиции курсора
                                        бит 1 нажата левая клавиша
                                        бит 2 отпущена левая клавиша
                                        бит 3 нажата правая клавиша
                                        бит 4 отпущена правая клавиша
                                        бит 5 нажата средняя клавиша
                                        (Mouse Systems)
                                        бит 6 отпущена средняя клавиша
                                        (Mouse Systems)
                                        7 - 15 не используются

          Возвращаемые значения BX:DX FAR адрес старой подпрограммы
                                        обработки прерываний
                                 CX     маска вызова старой подпрограммы
          -----------------------------------------------------------
         Эта функция в своей работе использует регистры AX,BX,CX,
    DX,SI,DI,DS и ES.

       BASIC
       Вводится:  G1% = 20
                  G3% = маска вызова
                  G4% = указатель на вызываемую пpоцедуpу
       Возвpащается: G3% = стаpая маска вызова
                     G4% = стаpый указатель

       Пpимеp:

       100 ' Заменяем пpоцедуpу обpаботки пpеpываний
       110 ' Пpоцедуpа обpаботки BUTTDOWN активиpуется,
       120 ' когда одна или более клавиш мыши нажаты.
       130 G1% = 20
       140 G3% = &H002A  :  G4% = BUTTDOWN%
       150 CALL MOUSE ( G1%, G2%, G3%, G4% )

         Следующие три функции (21,22 и 23) служат для сохранения
    и последующего восстановления  параметров  состояния драйвера
    "мыши". Это необходимо в случае запуска  изнутри  вашей прик-
    ладной программы другой программы, тоже использующей "мышь".


          Функция 21: Получить данные о размере буфера для записи
          ----------  состояния драйвера
         Функция 21 возвращает данные о размере  необходимого бу-
    фера, в который будут записаны параметры  текущего  состояния
    драйвера "мыши", с целью их последующего восстановления.

                             Регистры 80i86
          ------------------------------------------------------
          Входные значения      AX   0015h
          Возвращаемые значения BX   размер буфера,
                                     необходимого для записи
                                     текущего состояния драйвера
                                     (байт)
          ------------------------------------------------------

          Turbo Professional: см. f. MouseStateBufferSize.

          BASIC
          Вводится:  G1% = 21
          Возвpащается: G2% = pазмеp буфеpа для записи состояния

          Пpимеp:

          110 ' Опpеделяем pазмеp буфеpа сохpанения состояния мыши
          120 G1% = 21
          130 CALL MOUSE ( G1%, G2%, G3%, G4% )
          140 STATESIZE% = G2%


           Функция 22: Записать параметры текущего состояния драйве-
           ----------  ра в буфер
         Функция 22 записывает параметры текущего состояния драй-
    вера "мыши" в буфер, с целью их  последующего восстановления.
    Размер необходимого буфера определяется с помощью функции 21.

                             Регистры 80i86
          ------------------------------------------------------
          Входные значения        AX      0016h
                                 ES:DX    указатель в буфер
          Возвращаемые значения   нет
          ------------------------------------------------------

          Turbo Professional: см. p. SaveMouseState.

          BASIC
          Вводится:  G1% = 22
                     G4% = указатель на буфеp
          Возвpащается: ничего

          Пpимеp:

          110 ' Сохpаняем статус дpайвеpа мыши
          120 G1% = 22
          130 G4% =  BUFPTR
          140 ' Пpисваиваем BUFPTR, содеpжащий адpес на буфеp
          150 CALL MOUSE ( G1%, G2%, G3%, G4% )


           Функция 23: восстановить параметры состояния драйвера из
           ----------  буфера
         Функция 23 позволяет восстановить  параметры предыдущего
    состояния драйвера "мыши", записанные в буфер (см.фф.21,22).

                             Регистры 80i86
          ------------------------------------------------------
          Входные значения           AX       0017h
                                   ES:DX      указатель на буфер
            Возвращаемые значения      нет
          ------------------------------------------------------

          Turbo Professional: см. p. RestoreMouseState.

          BASIC
          Вводится:  G1% = 23
                     G4% = указатель на буфеp
          Возвpащается: ничего

          Пpимеp:

          110 ' Восстанавливаем состояние дpайвеpа мыши
          120 G1% = 23
          130 G4% =  BUFPTR
          140 ' Пpисваиваем BUFPTR, содеpжащий адpес на буфеp
          150 CALL MOUSE ( G1%, G2%, G3%, G4% )


          Функция 24: Установить альтернативную подпрограмму обра-
          ----------  ботки прерываний
         Функция 24 работает аналогично функции 12. Она позволяет
    установить альтернативную подпрограмму обработки тех прерыва-
    ний "мыши", которые не были включены в подпрограмму, установ-
    ленную функцией 12. Вы можете установить  до  трех  различных
    подпрограмм обработки прерываний, путем  последовательных об-
    ращений к функции 24.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  0018h
                                 CX  маска вызова
                                     бит 0 изменение позиции курсора
                                     бит 1 нажата левая клавиша
                                     бит 2 отпущена левая клавиша
                                     бит 3 нажата правая клавиша
                                     бит 4 отпущена правая клавиша
                                     бит 5 клавиша Shift
                                     была нажата в
                                     момент прерывания
                                     бит 6 клавиша Ctrl
                                     была нажата в
                                     момент прерывания
                                     бит 7 клавиша Alt
                                     была нажата в
                                     момент прерывания
                                     8 - 15 не используются
                         ES:DX FAR   Указатель на подпрограммы
                                     обработки прерываний
          Возвращаемые значения  AX  0FFFFh - ошибка
          ------------------------------------------------------
         Установленный бит (1) разрешает  прерывание,  сброшенный
    бит (0) - запрещает. Во время вызова  подпрограммы  обработки
    прерывания драйвер передает ей следующие параметры:

     -----------------------------------------------------------
         AH     маска условия (биты установлены также как,
               и в маске вызова)
        BX     состояние клавиш
         CX     горизонтальная координата курсора
         DX     вертикальная координата курсора
         DI     значение вертикального счетчика микки
         SI     значение горизонтального счетчика микки
     -----------------------------------------------------------

     Пpимеp см. в ф. 20.


           Функция 25: Получить вектор прерывания, указывающий на устано-
           ----------  вленную пользователем подпрограмму обработки

         Функция  25  осуществляет  попытку  найти  установленную
    пользователем подпрограмму обработки прерывания (определенную
    функцией 12), маска вызова которой  соответствует  маске, со-
    держащей в CX.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения      AX  0019h
                                     CX  маска вызова
                                    (аналогично функции 24)
          Возвращаемые значения AX  0FFFFh вектор или маска
                                    не найдены
                             BX:DX  указатель на вектор прерывания
                                    пользователя (0 если AX = 0FFFFh)
                                CX  маска вызова (0 если AX = 0FFFFh)
          ------------------------------------------------------


           Функция 26: Установить порог чувствительности "мыши"
           ----------
         Функция 26 позволяет  установить  порог чувствительности
    "мыши" по горизонтальной скорости движения, вертикальной ско-
    рости движения, а также порог ускоренной скорости "мыши".

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  001Ah
                                 BX  горизонтальная скорость
                                 CX  вертикальная скорость
                                 DX  порог удвоенной скорости
                                     микки в секунду 0000h
                                     устанавливает стандартный
                                     порог 64/сек
          Возвращаемые значения  нет
          ------------------------------------------------------


           Функция 27: Получить данные о чувствительности "мыши"
           ----------
          Функция 27 возвращает параметры, установленные функцией 26.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  001Bh
          Возвращаемые значения  BX  горизонтальная скорость
                                 CX  вертикальная скорость
                                     микки в секунду 0000h
                                     порог 64/сек
          ------------------------------------------------------


           Функция 28: Установить частоту прерываний "мыши"
           ----------
         Функция 28 позволяет установить частоту  прерываний, вы-
    рабатываемой аппаратными средствами "мыши" для передачи драй-
    веру информации о своем состоянии и накоплении числа сигналов
    микки.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  001Ch
                                 BX  желаемая частота прерываний (BL)

                                       00h  прерывания запрещены
                                       01h  30 прерываний в секунду
                                       02h  50 прерываний в секунду
                                       03h  100 прерываний в секунду
                                       04h  200 прерываний в секунду
                                   05h-FFh  не определено

          Возвращаемые значения   нет
          ------------------------------------------------------
         Если функция передает значение большее 04h (BL), драйвер
    аппаратной поддержки Microsoft InPort может  вести  себя  не-
    предсказуемо.


           Функция 29: Установить страницу дисплея
           ----------
         Функция 29 переключает экран на указанную страницу (кур-
    сор при этом становится видимым).

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения      AX   001Dh
                                BX   номер страницы дисплея (0 - 7)

          Возвращаемые значения нет
          ------------------------------------------------------

          Turbo Professional: см. p. SetMousePage.

          BASIC
          Вводится:  G1% = 29
                     G2% = CRT стpаница для индикации куpсоpа мыши
          Возвpащается: ничего

          Пpимеp:

          110 ; Установить 2 CRT стpаницу для показа куpсоpа мыши
          120 G1% = 29
          130 G2% = 2
          140 CALL MOUSE ( G1%, G2%, G3%, G4% )
           .
           .
           .

          500 ; Pазpешить показ куpсоpа опять
          510 G1% = 1
          520 CALL MOUSE ( G1%, G2%, G3%, G4% )


           Функция 30: Получить номер текущей страницы дисплея
           ----------

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения        AX    001Eh
          Возвращаемые значения   BX    номер текущей
                                        страницы дисплея (0 - 7)
          ------------------------------------------------------

          Turbo Professional: см. p. GetMousePage.

          BASIC
          Вводится:  G1% = 30

          Возвpащается: G2% = текущий номеp CRT стpаницы куpсоpа

          Пpимеp:

          110 ' Читаем номеp CRT стpаницы
          120 G1% = 30
          130 CALL MOUSE ( G1%, G2%, G3%, G4% )


          Функция 31: Запретить работу драйвера "мыши"
          ----------
         Функция 31 запрещает работу драйвера  "мыши", восстанав-
    ливая значения векторов прерываний 33h, 10h и  71h  (для про-
    цессора 8086) или 74h  (для  процессора  80286/386).  Функция
    возвращает значение старого вектора прерываний 33h, указываю-
    щего либо на интерфейс "мыши" более высокого  уровня (BX:CX),
    либо первоначальное значение этого вектора (ES:BX). В послед-
    нем случае работа драйвера "мыши" будет полностью запрещена.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  001Fh

          Возвращаемые значения  AX  001Fh функция выполнена успешно
                                     0FFFFh ошибка
                              BX:CX  старый вектор прерывания 33h,
                                     указывающий на интерфейс "мыши"
                                     более высокого уровня
                              ES:BX  первоначальное значение вектора
                                     прерывания 33h
          ------------------------------------------------------


          Функция 32: восстановить работу драйвера "мыши"
          ----------
         Функция 32  восстанавливает  прежнее  значение  векторов
    прерываний 10h и 71h (8086) или 74h  (80286/386),  измененные
    функцией 31.

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения             AX         0020h
          Возвращаемые значения        нет
          ------------------------------------------------------


          Функция 33: Произвести начальную установку программного
          ----------  обеспечения "мыши"
         Действие функции 33 аналогично действию функции 0  с той
    разницей, что функция 33 не  производит  начальной  установки
    аппаратных средств "мыши".

          ------------------------------------------------------
          Входные значения        AX  0021h
          Возвращаемые значения   AX  0021h  драйвер "мыши" не установлен
                                      0FFFFh драйвер "мыши" установлен
                                  BX  0002h  начальная установка
                                             произведена
          ------------------------------------------------------


          Функция 34: Выбрать язык для выдачи диагностических
          ----------  сообщений

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения     AX       0022h
                               BX       код языка (BL)

                                        00h  Английский
                                        01h  Французский
                                        02h  Голландский
                                        03h  Немецкий
                                        04h  Шведский
                                        05h  Финский
                                        06h  Испанский
                                        07h  Португальский
                                        08h  Итальянский

                                        другие значения
                                        не используются

          Возвращаемые значения    нет
          ------------------------------------------------------
         Значения, отличные от 00h, не  могут  быть  использованы
    только для драйвера Microsoft International Mouse.


           Функция 35: Получить информацию об используемом языке
           ----------

                             Регистры 80i86

          ------------------------------------------------------
        Входные значения        AX      0023h

        Возвращаемые значения   BX      код языка (BL)

                                        00h  Английский
                                        01h  Французский
                                        02h  Голландский
                                        03h  Немецкий
                                        04h  Шведский
                                        05h  Финский
                                        06h  Испанский
                                        07h  Португальский
                                        08h  Итальянский

                                        другие значения
                                        не используются
          ------------------------------------------------------


           Функция 35: Получить дополнительную информацию о "мыши"
           ----------

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения       AX  0024h

          Возвращаемые значения  AX  0FFFh ошибка, иначе BH:BL
                                     номер версии драйвера
                                 CH  тип интерфейса "мыши"
                                     01h "мышь", подключаемая к
                                     общей шине
                                     02h "мышь", подключаемая к
                                     последовательному порту
                                     03h "мышь", подключаемая к
                                     Microsoft InPort
                                     04h "мышь", подключаемая к
                                     IBM PS/2 Pointing Device Port
                                     05h "мышь" Hewelett-Packard
                                 CL  номер запроса прерывания (IRQ)
                                     00h PS/2 позиционирующее устройство
                                     01h не определено
                                     02h IRQ2
                                     03h IRQ3
                                     ... ...
                                     07h IRQ7
          ------------------------------------------------------

         Следующие 9 функций добавлены к прерыванию 10h BIOS (ба-
    зовой системы ввода вывода) для поддержки  работы  библиотеки
    регистрового интерфейса  EGA.  Эти  функции  позволяют  вашей
    программе производить запись и чтение из регистров видеоадап-
    тера EGA, первоначально предназначенных только для записи.

    240   0F0h    Прочитать данные из отдельного регистра
    241   0F1h    Записать данные в отдельный регистр
    242   0F2h    Прочитать данные из последовательной группы регистров
    243   0F3h    Записать данные в последовательную группу регистров
    244   0F4h    Прочитать данные из группы отдельных регистров
    245   0F5h    Записать данные в группу отдельных регистров
    246   0F6h    Установить все регистры в их начальные значения
    247   0F7h    Задать начальные значения для регистров
    248,249       не используются
    250   0FAh    Получить информацию о состоянии RIL

         В качестве входных данных для функций  RIL  используются
    следующие номера и адреса портов ввода - вывода  и  регистров
    EGA:
    -------------------------------------------------------------
    Номер          Название   Количество     Индексы      Регистр
    порта          регистров   регистров                   адреса
    -------------------------------------------------------------
     00h Контролер электронно-    25          0 - 24       3x4h
         лучевой трубки
     08h Распределитель            5          0 -  4       3C4h
         (Sequencer)
     10h Графический контролер     9          0 -  8       3CEh
     18h Контролер атрибутов      20          0 - 19       3C0h

     Одиночные регистры                                   Адрес
     ------------------                                   -----
     20h  Комплексный регистр      1           не исп.     3C2h
          ввода
     28h  Регистр управления       1           не исп.     3xAh
          признаками
     30h  Регистр 1 графической    1           не исп.     3CCh
          позиции
     38h  Регистр 2 графической    1           не исп.     3CAh
          позиции
     ------------------------------------------------------------
         Примечание x = B или D в зависимости от  базового адреса
    ввода - вывода, определяемого битом 0  Комплексного  регистра
    вывода (B для монохромного режима, D для цветного режима).


            Функция 240: Прочитать данные из отдельного регистра EGA
            -----------

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения      AH         0F0h
                                BX         индекс регистра
                                DX         номер порта

          Возвращаемые значения BL         данные
             значения остальных регистров восстанавливаются
          ------------------------------------------------------

          Пpимеp:

          FUN_F0     EQU     0f0H         ; Function F0
          ;
          GR_CONTR   EQU     010H         ; Graphics Controller
          MODE_REG   EQU     005H         ; Mode Regisiter
          ;
          GR1_PORT   EQU     030H         ; Graphics 1 Position Register
          GR2_PORT   EQU     038H         ; Graphics 2 Position Register
          ;
          VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                     ; Retrieve the Mode Register in Graphics Controller
          MODE_REG   DB      00
                     ;
                     MOV     DX, GR_CONTR
                     MOV     BX, MODE_REG
                     MOV     AH, FUN_F0
                     INT     VIDEO
                     MOV     MODE_REG, BL


                     ; Retrieve Graphics 1 Position Data
          GR1_POS    DB      00
                     ;
                     MOV     DX, GR1_POS
                     MOV     AH, FUN_F0
                     INT     VIDEO
                     MOV     GR1_POS, NL


           Функция  241:  Записать данные в отдельный регистр EGA
           ------------

                             Регистры 80i86

          ------------------------------------------------------
          Входные значения      AH  0F1h
                                BL  индекс регистра
                                    (для неодиночных регистров)
                                     данные
                                    (для одиночных регистров)
                                BH  данные
                                    (для неодиночных регистров)
                                    игнорируется
                                    (для одиночных регистров)
                                DX  номер порта

          Возвращаемые значения регистры BH и DX не восстанавливаются,
                   значения остальных регистров восстанавливаются
          ------------------------------------------------------

          Пpимеp:

          FUN_F1     EQU     0f1H         ; Function F1
          ;
          SEQUENCE   EQU     008H         ; Sequencer
          MASK_REG   EQU     002H         ; Map Mask Register
          ;
          FEAT_PORT  EQU     028H         ; Feature Control Register
          ;
          VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                     ; Save Map Mask Register of Sequencer
          MAP_MASK   EQU     03H
                     ;
                     MOV     DX, SEQUENCE
                     MOV     BL, MASK_REG
                     MOV     BH, MAP_MASK
                     MOV     AH, FUN_F1
                     INT     VIDEO
                     MOV     MAP_MASK, BL


                     ; Save Feature Control Register
          FEATURE    DB      02H
                     ;
                     MOV     DX, FEAT_PORT
                     MOV     BL, FEATURE
                     MOV     AH, FUN_F1
                     INT     VIDEO
                     MOV     FEATURE, BL


   	Функция 242: Прочитать данные из последовательной группы          
   	-----------  регистров  указанного порта EGA

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения      AH  0F2h
                                CH  номер стартового индекса
                                CL  количество регистров
                                    (должно быть > 1)
                                DX  номер порта
                             ES:BX  указатель на буфер - приемник
                                    (CL байт)
	  Возвращаемые значения     данные в буфере
                значение регистра CX не восстанавливается,
                значения остальных регистров восстанавливаются
          ------------------------------------------------------

        Пpимеp:

        FUN_F2     EQU     0f2H         ; Function F2
        ;
        GR_CONTR   EQU     010H         ; Graphics Controller
        ;
        VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                   ; Retrieve Four Registers Data from Graphics Controller
        GRAPH_POOL DB      04   DUP (0)
                   ;
                   MOV     DX, DS
                   MOV     ES, DX
                   ;
                   MOV     DX, GR_CONTR
                   MOV     BX, OFFSET GRAPH_POOL
                   MOV     CX, 04H
                   MOV     AH, FUN_F2
                   INT     VIDEO

   	Функция 243: Записать данные в последовательную группу          
   	-----------  регистров указанного порта EGA

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения      AH  0F3h
                                CH  номер стартового индекса
                                CL  количество регистров
                                    (должно быть > 1)
                                DX  номер порта
                             ES:BX  указатель на буфер - источник
                                    данных (CL байт)
	  Возвращаемые значения   
            значения регистров BX,CX,DX не восстанавливаются,
            значения остальных регистров восстанавливаются
          ------------------------------------------------------

          Пpимеp:

          FUN_F3     EQU     0f3H         ; Function F3
          ;
          ATTR_CONTR EQU     018H         ; Attribute Controller
          ;
          VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry


                     ; Save Four Registers Data into Attribute Controller
          PALET_DATA DB      1, 2, 4, 3
                     ;
                     MOV     DX, DS
                     MOV     ES, DX
                     ;
                     MOV     DX, ATTR_CONTR
                     MOV     BX, OFFSET PALET_DATA
                     MOV     CX, 08
                     MOV     AH, FUN_F3
                     INT     VIDEO


   	Функция 244: Прочитать данные из группы отдельных регистров
   	-----------

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения     AH  0F4h
                               CX  количество регистров
                                   (должно быть > 1)
                            ES:BX  указатель на таблицу описания
                                   (CL' 4 байт)
                                   каждая запись в таблице
                                   состоит из 4 байт:
                                   байты 0 - 1  номер порта
                                   байт 2 номер индекса регистра
                                   байт 3 заполняется прочитанными
                                   данными

	  Возвращаемые значения    данные в байте 3 соответствующей 
                                   записи таблицы описания;
                значение регистра CX не восстанавливается,
                значения остальных регистров восстанавливаются
          ------------------------------------------------------
          Пpимеp:

          FUN_F4     EQU     0f4H         ; Function F4
          ;
          VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                      ; Retrieve Follow  Registers Data
          TABLE       DW     030H         ; Graphics 1 Position Register
                      DB      00          ; Single Register
                      DB      00          ; Retrieved Data
                      ;
                      DW     010H         ; Graphics Controller
                      DB      05          ; Mode Register
                      DB      00          ; Retrieved Data
                      ;
                      ;
                      MOV    DX, DS
                      MOV    ES, DX
                      ;
                      MOV    BX, OFFSET TABLE
                      MOV    CX, 02
                      MOV    AH, FUN_F4
                      INT    VIDEO


  	Функция 245: Записать данные в группы отдельных регистров
  	-----------

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения      AH  0F5h
                                CX  количество регистров
                                    (должно быть > 1)
                             ES:BX  указатель на таблицу описания
                                    (CL' 4 байт)
                                    каждая запись в таблице
                                    состоит из 4 байт:
                                    байты 0 - 1  номер порта
                                    байт 2 номер индекса регистра
                                    байт 3 данные для вывода в регистр

	  Возвращаемые значения   
               значение регистра CX не восстанавливается,
               значения остальных регистров восстанавливаются
          ------------------------------------------------------

          Example:

          FUN_F5     EQU     0f5H         ; Function F5
          ;
          VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                      ; Save Follow Registers Data
          TABLE       DW      20H         ; Miscellaneous
                      DB      00          ; Single Register
                      DB      01          ; Data
                      ;
                      DW      18H         ; Attribute Controller
                      DB      12H         ; Color Plane Enable
                      DB      07H         ; Data
                      ;
                      ;
                      MOV    DX, DS
                      MOV    ES, DX
                      ;
                      MOV    BX, OFFSET TABLE
                      MOV    CX, 02
                      MOV    AH, FUN_F5
                      INT    VIDEO


  	Функция 246: Установить все регистры в их начальные значения
  	-----------
         Функция 246 устанавливает  все  регистры  EGA  в  их на-
    чальные значения, определяемые функцией 247.

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения             AH         0F6h
	  Возвращаемые значения        значения остальных реги-                       
				       стров восстанавливаются 
          ------------------------------------------------------

         Пpимеp:

         FUN_F6     EQU     0f6H         ; Function F6h
         ;
         VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                    MOV     AH, FUN_F6
                    INT     VIDEO


   	Функция 247: Задать начальные значения для регистров
   	-----------
         Функция 247 передает драйверу начальные значения регист-
    ров EGA, которые в дальнейшем будут  использоваться  функцией
    246 по умолчанию.

                             Регистры 80i86

          ------------------------------------------------------
	  Входные значения   AH  0F7h
                             CX  флаг выбора цвета EGA
                                 5448h позволяет EGA RIL считать
                                 байт со смещением 14h в таблице на
                                 которую указывает ES:BX, как значение
                                 для Регистра выбора цвета Контроллера
                                 атрибутов VGA
                             DX  номер порта
                          ES:BX  таблица начальных значений регистров
                                 каждый байт таблицы последовательно
                                 задает значение соответствующему
                                 регистру порта
                                 (значения всех  регистров порта
                                 должны быть определены)
	  Возвращаемые значения   
            значения регистров BX и DX не восстанавливаются,
            значения остальных регистров восстанавливаются
          ------------------------------------------------------

         Пpимеp:

         FUN_F7     EQU     0f7H         ; Function F7
         ;
         ATTR_CONTR EQU     018H         ; Attribute Controller
         ;
         VIDEO      EQU     010H         ; BIOS ROM Video Routine Entry

                    ; Setting Initial Values for the Attribute Controller
         ATTR_DATA  DB      1,  2,  4,  3,  5,  6,  0,  7
                    DB      0,  0,  0,  0,  0,  0,  0,  0
                    DB      0,  0, 0fh, 0
                    ;
                    MOV     DX, DS
                    MOV     ES, DX
                    ;
                    MOV     DX, ATTR_CONTR
                    MOV     BX, OFFSET ATTR_DATA
                    MOV     AH, FUN_F7
                    INT     VIDEO


   	Функции 248,249 не используются.
        -------------------------------


   	Функция 250: Получить информацию о состоянии RIL
   	-----------
         Функция 250 позволяет пользователю определить установле-
    на библиотека RIL EGA или нет. При вызове функции значение BX
    должно быть равно 0. Если по возвращении из  функции значение
    BX осталось равным 0, то RIL не установлена.

          ------------------------------------------------------
	  Входные значения       AH  0FAh
                                 BX  0000h
	  Возвращаемые значения  AX  восстанавливается
                                 BX  0000h если RIL не установлена
                              ES:BX  указатель на номер версии             
                                     программного обеспечения RIL EGA
          ------------------------------------------------------

