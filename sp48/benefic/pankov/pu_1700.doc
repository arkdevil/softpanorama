                                "Я, например,
                                на  свете лучшей книгой
                                считаю кодекс уголовный наш.
                                ...............................
                                Открою кодекс на любой странице
                                и не могу - читаю до конца !"

                                              Владимир Высоцкий





       Резидентная программа - расширитель возможностей
                   работы с гибкими дисками.
             ┌───────────────────────────────────┐
             │ P U _ 1 7 0 0 . C O M  Beta V 3.0 │
             └───────────────────────────────────┘

                           а также:

            5 небольших программ-"примочек" к PU_1700:

    - PU_tmFD.COM - программа тестирования временных характерик
                    носителя - его производительности, на физи-
                    ческом уровне. V 1.1 от 19.11.91.
   - PU_tmFDm.COM - программа тестирования временных характерик
                    носителя - его производительности, на логи-
                    ческом уровне. V 1.1 от 19.11.91.
   - PU_optFD.COM - программа,   позволяющая   оптимизацировать
                    производительность гибких носителей.
                                   V 1.2 от 29.05.92.
   - PU_copFD.COM - программа,  позволяющая скопировать дискету
                    любого формата  в сжатый файл  ее образа  и
                    получить копию дискеты по ее сжатому образу.
                                   V 2.2 от 28.05.92.
   - PU_edpFD.COM - программа,  позволяющая отредактировать си-
                    стемную область отформатированного  гибкого
                    носителя (BOOT+FAT+ROOT) с целью увеличения
                    полезного объема дискеты на 5-15 килобайт.
                                   V 1.4 от 28.05.92.


                  программист:    Панков Ю.И.
                дата cоздания:    1991-1992 г.


     PU_1700.COM - это русский аналог широко известного в нашей
стране драйвера 800.COM,  с расширенными, чем у последнего воз-
можностями.
     PU_1700 позволяет использовать Вам все старые форматы дис-
кет и много новых, сохраняя при этом полную совместимость с DOS
(и полную замену драйвера 800.COM). Новые форматы поддерживают-
ся на уровне BIOSа, поэтому они полностью совместимы с DOS и со
многими ее утилитами: FORMAT, DISKCOPY, DISKCOMP и другими.

  ┌────────────────────────────────────────────────────────┐
  │ Не выбрасывайте дискеты, у которых безнадежно запорчен │
  │                      0 трек !                          │
  └────────────────────────────────────────────────────────┘
     PU_1700 позволяет их  безболезнено  отформатировать  любой
имеющейся  у  Вас  утилитой,  на  любой поддерживаемый формат и
обеспечит работу с ними!

     PU_1700 резидентно  занимает  1.2 kb  оперативной памяти и
работает под управлением DOS 3.30 и выше.

     PU_1700 значительно расширяет возможности стандартной ути-
литы FORMAT:

     FORMAT drv:[/T:tt][/N:nn][и другие опции]           где:

     drv - имя форматируемого драйвера (A или B)
     tt  - число форматируемых цилиндров
     nn  - число секторов на треке

     Ниже приведена  таблица значений объемов отформатированной
дискеты в зависимости от типа дисковода,  типа дискеты и  пара-
метров форматирования (tt и nn):

  ┌────────────┬────────────────────┬───────────────────────┐
  │   Опции    │     Допустимый     │ Объем отформатирован- │
  │  FORMATа   │   тип дисковода    │ ной дискеты в байтах  │
  ├───────┬────┼────┬────┬────┬─────┼───────────────────────┤
  │   tt  │ nn │360к│720к│1.2м│1.44м│   норма   - максимум  │
  ├───────┼────┼────┼────┼────┼─────┼───────────────────────┤
  │ 40-41 │  9 │ +  │ +  │ +  │  +  │   362.496 -   371.712 │
  │ 40-41 │ 10 │ +  │ +  │ +  │  +  │   398.848 -   409.086 │
  │ 80-83 │  9 │    │ +  │ +  │  +  │   724.480 -   752.168 │
  │ 80-83 │ 10 │    │ +  │ +  │  +  │   806.460 -   837.120 │
  │ 80-83 │ 15 │    │    │ +  │  +  │ 1.212.928 - 1.259.008 │
  │ 80-83 │ 16 │    │    │ +  │  +  │ 1.294.848 - 1.344.000 │
  │ 80-83 │ 17 │    │    │ +  │  +  │ 1.376.768 - 1.427.968 │
  │ 80-83 │ 18 │    │    │ +  │  +  │ 1.457.664 - 1.512.960 │
  │ 80-83 │ 19 │    │    │    │  +  │ 1.539.584 - 1.596.928 │
  │ 80-83 │ 20 │    │    │    │  +  │ 1.620.480 - 1.681.920 │
  │ 80-83 │ 21 │    │    │    │  +  │ 1.702.400 - 1.765.888 │
  └───────┴────┴────┴────┴──────────┴───────────────────────┘
     Примечание: объем отформатированной дискеты можно еще без-
болезнено увеличить  программой - "примочкой" PU_edpFD  на 5-15
килобайт:
                   83x10 - до 0.847.872 байт
                   83x18 - до 1.527.872 байт
                   83x21 - до 1.781.760 байт

     Как это делается? - описано ниже.

     PU_1700, в отличие от драйвера 800, имеет два дополнитель-
ных формата большого объема:
     - 1.44 MB  для  HD 5" (1.2 MB)
     - 1.68 MB  для  HD 3" (1.44 MB)

     Пример задания  на  форматирование дискеты HD на дисководе
1.44 MB (3") на объем 1.702.400 байт:

     FORMAT a:/t:80/n:21         /u  - для MS/DOS выше 5.0 Beta

     PU_1700 допускает  форматирование  до 83 цилиндров.  Такую
дискету нетрудно отформатировать.  Задание /t:41 и /t:81  безо-
пасны.  Дополнительные  цилиндры 82 и 83 (42 для DD) могут хуже
читаться или вовсе отсутсвовать на  Вашем  дисководе.  В  любом
случае при работе с дополнительными цилиндрами Вы должны внима-
тельно слушать,  не ударяется ли головка дисковода о вал двига-
теля.  И даже если Вы ничего не услышали подозрительного,  про-
верьте отформатированную Вами дискету с дополнительными треками
какой-либо тестирующей утилитой, на предмет присутствия послед-
них (Pctools и др.).

     Большинство форматов  (даже  большие !) могут быть сделаны
загрузочными заданием ключа /s команды FORMAT.
           ┌──────────────────────────────────────┐
           │ HD 5" (1.44) может быть загрузочной! │
           └──────────────────────────────────────┘
     Однако, если Вы загружаетесь с "нестандартной" загрузочной
дискеты, Вы должны вызвать PU_1700 из Вашего AUTOEXEC.BAT. Ина-
че все нестандартные дискеты, в том числе и загрузочная, перес-
танут читаться после любой смены гибкого носителя! Для изготов-
ления загрузочных дискет DD 5" формата 720 KB, не забывайте ус-
тановить параметр "/b720=Y".

     PU_1700 поддерживает работу стандартных утилит  DISKCOPY и
DISKCOMP значительно расширяя их возможности.  Вы можете приме-
нять указанные утилиты между различными типами  дисководов, при
условии поддержки их одинакового формата (см.  таблицу). Вы мо-
жете запустить DISKCOPY/DISKCOMP между 5" и 3"  дисководами. Вы
можете безопасно  скопировать  стандартную  дискету HD 3" на HD
5" и наоборот!  Заметим,  что драйвер 800 не позволит Вам этого
сделать.

     ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
     ║ HD 3" (1.44 MB) ║<═══════════>│ HD 5" (1.44 MB) │
     ╚═════════════════╝  DISKCOMP   └─────────────────┘

     ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
     ║ HD 3" ( 720 KB) ║<═══════════>│ HD 5" ( 720 KB) │
     ╚═════════════════╝  DISKCOMP   └─────────────────┘


     PU_1700 позволяет повысить производительность ваших диско-
водов до 70%  !. Стандартные утилиты FORMAT, DISKCOPY, DISKCOMP
и другие могут работать соместно с PU_1700 значительно быстрее.
Например:
               B                              A
      ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
      ║ HD 3" (1.44 MB) ║════════════>│ HD 5" (1.44 MB) │
      ╚═════════════════╝             └─────────────────┘
             ┌───────────────────────────────────┐
             │ может быть ускорено на 1 минуту ! │
             └───────────────────────────────────┘

     Драйвер 800 не позволит Вам и этого сделать, он только мо-
жет ухудшить хорошие временные характеристики Вашего дисковода.

     Работайте с форматами большого объема. Они не менее надеж-
ны,  чем стандартные. Специально принятые меры (только для фор-
матов большого объема) обеспечивают высокую  надежность  работы
даже  на  низкоскоростных  (старых моделях) контроллеров гибких
дисков.  И еще раз отметим,  что задание /t:81 (или меньше) при
форматировании безопасны.

     Итак, задания на безопасное форматирование дискет на  дис-
ководах:
                      A - 360  KB (5"),
                      A - 1.2  MB (5") и
                      B - 1.44 MB (3"):

    ╔════════════════════════════════════════════════════╗
    ║  FORMAT a:/t:81/n:10  -  на объем  .816.640 байт   ║
    ║  FORMAT a:/t:81/n:18  -  на объем 1.476.096 байт   ║
    ║  FORMAT b:/t:81/n:21  -  на объем 1.723.904 байт   ║
    ║  ---"---"---"---"-/u  -  для версий MS/DOS > 5.0 B ║
    ╚════════════════════════════════════════════════════╝


                      Запуск PU_1700.COM.
                    ───────────────────────
     Производится запуском  програмы  PU_1700.COM  из файла на-
чальной автозагрузки в формате:

     PU_1700 [/параметр]
       или
     PU_1700 [/параметр ... /параметр]

     Где параметр[ы]:

            1) допустимы в только командах 1 запуска:
          ────────────────────────────────────────────
     /ke    - сохранить блок среды (ENV).
     /psp   - сохранить префикс программного сегмента (PSP).
              Увеличивает длину резидента на 256 байт.
     /cfat  - контроль  FAT  при  форматировании (необходим для
              корректной работы утилиты FORMAT комерческой вер-
              сии MS DOS 5.0 ,  да и для других систем не поме-
              шает. Увеличивает длину резидента на 224 байта.

        2) допустимы в командах 1 запуска и перезапуска:
       ──────────────────────────────────────────────────
     /off   - отключение драйвера
     /on    - активизация отключенного драйвера
     /A=off - дисковод A не обслуживается (не установлен)
     /B=off - дисковод B не обслуживается (не установлен)
     /A=360 - 360  KB, 5" (DD)
     /B=360 - 360  KB, 5" (DD)
     /A=1.2 - 1.2  MB, 5" (HD)
     /B=1.2 - 1.2  MB, 5" (HD)
     /A=720 - 720  KB, 3" (DD)
     /B=720 - 720  KB, 3" (DD)
     /A=1.44- 1.44 MB, 3" (HD)
     /B=1.44- 1.44 MB, 3" (HD)
     /?     - вызов подсказки
     /sm=1  - 1 оптимальное расположение секторов при формати-
              ровании для увеличения производительности диско-
              вода.
     /sm=2  - 2 оптимальное расположение секторов при формати-
              ровании для увеличения производительности диско-
              вода.
    /sm=off - отключение оптимизации расположения секторов при
              форматировании.
    /B720=Y - подключение редактирования BOOT сектора для носи-
              телей формата  720 KB 5".
    /B720=N - отключение редактирования BOOT сектора для  носи-
              телей формата 720 KB 5".
  /BootA=nn - задает номер цилиндра  носителя,  где  расположен
              (или надо расположить)  его заголовок (BOOT + FAT
               + ROOT), установленного в дисковод A. По умолча-
              нию - 0 цилиндр. Пределы перемещения: 2 - 38.
  /BootB=nn - задает номер цилиндра  носителя,  где  расположен
              (или надо расположить)  его заголовок (BOOT + FAT
               + ROOT), установленного в дисковод B. По умолча-
              нию - 0 цилиндр. Пределы перемещения: 2 - 38.


       3) допустимы в командах 1 запуска и перезапуска и
      ───────────────────────────────────────────────────
                 работающие как переключатели.
                ──────────────────────────────

     /co    - включение / выключение режима совместимости  для
              дисководов 720 KB.
     /if    - включение / выключение режима "чередования секто-
              ров" при форматировании больших форматов  (inter-
              leave factor = 2 - включен / 1 - выключен).



                         Рекомендации.
                        ──────────────

     1. Не  изменяйте  имена  стандартных  утилит  DISKCOPY   и
DISKCOMP. Утилита PU_copFD работает гораздо быстрее  и надежнее
стандартной - DISKCOPY даже не с DOS форматами носителей.

     2. Если у Вас возникают какие-либо трудности при работе со
специфическими программами (различными копировщиками), Вы може-
те отключить PU_1700,  задав "PU_1700/off" в командной  строке.
Задание "PU_1700/on" активизирует работу отключенного драйвера.

     3. Если у Вас  возникают  странные  сообщения  об  ошибках
распределения памяти после задания FORMAT, попробуйте параметры
/ke и /psp при запуске PU_1700.

     4. Функции  DISKCOPY  и  DISKCOMP  в некоторых оболочках и
утилитах могут не работать с новыми форматами - используйте со-
ответствующие команды DOS - это надежнее.

     5. Запуск  драйвера  PU_1700  можно  производить из любого
места файла AUTOEXEC.BAT.  Если Вы работаете  с  нестандартными
дискетами БЕЗ драйвера PU_1700,  возможен незамеченным непредс-
казуемый и искаженный обмен файлов!  Пользователи PU_1700 сооб-
щают, что как правило, происходит абсолютно незамеченным запись
только половины файла (часто на носители HD  5"  1.44  MB)  без
драйвера PU_1700 ! Я на своей машине ничего подобного не наблю-
дал !

     6. Работа с форматами большой емкости:  720 KB 5",1.44  MB
5" и 1.68 MB 3" несколько замедляется при работе с некачествен-
ными носителями.

     7. PU_1700 при каждом запуске автоматически распознает ти-
пы  установленных  дисководов  гибких дисков и показывает их во
время старта для для всех версий PU_1700 выше 1.2. Тип дисково-
да можно задать и в командной строке, например:

    "PU_1700 /A=1.2"   задает: A - дисковод 1.2 MB, 5" (HD).

     8. Форматы до 81 цилиндров (/t:81) безопасны. А вот надеж-
ную работу с количеством цилиндров большим  81  не  гарантируют
даже изготовители дискет. Практика показывает, что 82 и 83 тре-
ки можно использовать для временного хранения информации.

     9. Если на Вашей машине PU_1700 не обслуживает гибкие дис-
ки формата 720 KB,  попробуйте параметр /co  при  запуске.  Все
последующие  перезапуски PU_1700 с параметром "/co" переключают
этот режим.  PU_1700 в режиме /B720=Y всегда корректирует  BOOT
сектор  носителей 5" DD формата 720 KB - это необходимо для из-
готовления универсальных загрузочных дискет.  Вы можете  отклю-
чить редактирование BOOT сектора параметром /B720=N при запуске
или любом перезапуске PU_1700. Параметр /B720=Y необходим толь-
ко при  формировании загрузочных дискет 5" DD формата 720 KB! В
остальных случаях его можно и нужно отключить.

     10. Если на Вашей машине установлен старый  (низкоскорост-
ной) контроллер гибких дисков,  не поддерживающий работу с дис-
кетами больших форматов,  попробуйте параметр /IF при  запуске.
Все последующие перезапуски PU_1700 c параметром "/if" переклю-
чают этот режим. Параметр "/if" может изменить режим форматиро-
вания только больших форматов. Самые большие форматы форматиру-
ются независимо от задания параметра c IF=2. Не пользуйтесь без
надобности IF=2,  т. к. при этом заметно замедляется работа Ва-
шего дисковода,  незначительно увеличить которую можно парамет-
ром "/sm=".

     10. PU_1700 обслуживает все дискеты форматированные  прог-
раммой  FDFORMAT или системной утилтой FORMAT c драйвером 800.

     11. Если при форматировании дискеты выдается сообщение:

        invalid media or Track 0 bad - disk unisable
        Format failure
        Format another (Y/N)

     ответьте Y,  после чего повторите форматирование. Если это
не поможет, то Ваша дискета действительно запорчена.
     Как известно,  DOS не может использовать носители с испор-
ченным нулевым цилиндром.  "За бугром" такие дискетки,  видимо,
просто выбрасывают.  В условиях нашей действительности нам  та-
кое, пока, не по карману. Поэтому попробуйте:
     Параметром "/BootA=nn"  или "/BootB=nn" подобрать местопо-
ложение системной области дискеты (BOOT+FAT+ROOT - по умолчанию
располагается на 0 цилиндре),  при котором она будет форматиро-
ваться на нужный Вам формат. После удачного форматированиия за-
пишите  значение  перемещения системной области носителя на его
этикетке!  Для работы с такой дискетой необходимо перенастроить
драйвер  PU_1700  простым перезапуском с параметром перемещения
системной области.  Для работы с любой другой дискетой  драйвер
опять придется подстроить перезапуском.  Я надеюсь, что это Вам
придется не так уж и часто делать.  Учтите, что PU_1700 поддер-
живает раздельно значения параметров для каждого из дисководов.
     Практика работы с такими  дискетами  показала,  что  после
операции  перемещения  системной области дискеты,  некоторые из
них полностью восстанавливали свою работоспособность  сразу или
через  некоторое время,  если это было следствием загрязнения 0
трека.  В таких случаях дискету можно переформатировать уже с 0
перемещением системной области.
     Возможность перемещения системной области дискеты Вы може-
те использовать и как некое средство разграничения доступа.
     Производительность работы с дискетами можно увеличить при-
мерно  вдвое,  если  расположить системную область дискеты в ее
середине!  При этом сократится суммарная  величина  перемещения
головки при работе с файлами,  а значит и время.  В тоже время,
ее (призводительность) можно уже в свою очередь  еще  увеличить
за счет оптимального расположения секторов на каждом из треков.
Об этом и пойдет разговор ниже.

     12. Для  повышения  производительности Ваших дисководов до
70% форматируйте дискеты с параметрами "/sm=1" или "/sm=2"! Это
достигается оптимальным расположением секторов на треке гибкого
носителя . Попробую это объяснить. Вы можете просто представить
последовательное чтение информации с дискеты:

     - позиционирование на 1 трек
     - чтение трека
     - позиционирование на следующий трек
     - чтение трека
     - и т. д..

     При этом  во время позиционирования Ваша дискета не перес-
тает вращаться,  и без оптимального  расположения  секторов  на
треке, дискетта позиционирует на 2-ой или 3-ий сектор следующе-
го трека,  когда пошаговое премещение головки окончено. Поэтому
чтение этого трека произойдет за 2 оборота дискеты (поиск 1-ого
сектора + чтение трека).  При оптимальном расположении секторов
на треке, после выполнения позиционирования, дискета устанавли-
вается точно на 1-ый сектор (или перед  ним)  для  последующего
чтения, которое происходит уже за 1 оборот дискеты.
     DOS-Format программы  всегда  форматируют  с неоптимальным
расположением секторов на треке.  PU_1700 предоставляет два па-
раметра оптимального форматирования.  Какой из них Вам выбрать?
Нужно поэкспериментировать и подобрать оптимальный.  Для оценки
повышения  производительности гибих носителей форматированных с
различным расположением секторов на  треках,  можно  воспользо-
ваться "примочками" к PU_1700: PU_tmFD.COM и PU_tmFDm.COM, тес-
тирующие абсолютное чтение гибкого диска на физическом и  логи-
ческом  уровнях.  Часть  результатов  тестирования всевозможных
форматов дискет на моей PC приведена ниже и,  возможно  поможет
Вам выбрать оптимальный параметр:

┌────────┬────────┬───────┬────────────────┬──────────────────┐
│Носитель│ Формат │ Объем │   Параметры    │ Абсолютное время │
│        │        │       │ форматирования │   чтения диска   │
│        │        │  KB   │   /sm=1/2      │      в сек       │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=0ff     │     19.8         │
│ 360 KB │ 40:9   │ 360   │    /sm=1       │     15.5   !     │
│        │        │       │    /sm=2       │     17.0         │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │     53.0         │
│ 360 KB │ 80:10  │ 800   │    /sm=1       │     31.9   !     │
│        │        │       │    /sm=2       │     33.2         │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=0ff     │     39.0         │
│ 1.2 MB │ 80:15  │ 1200  │    /sm=1       │     30.1   !     │
│        │        │       │    /sm=2       │     31.0         │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │     79.5         │
│ 1.2 MB │ 80:18  │ 1440  │    /sm=1       │     57.2         │
│        │        │       │    /sm=2       │     56.8   !     │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │     63.7         │
│1.44 MB │ 80:18  │ 1440  │    /sm=1       │     35.5   !     │
│        │        │       │    /sm=2       │     36.4         │
├────────┼────────┼───────┼────────────────┼──────────────────┤
│        │        │       │    /sm=off     │     79.6         │
│1.44 MB │ 80:21  │ 1740  │    /sm=1       │     66.9   !     │
│        │        │       │    /sm=2       │     67.6         │
└────────┴────────┴───────┴────────────────┴──────────────────┘
     Выигрыш производительности носителей отформатированных оп-
тимально может достигать 70% по сравнению со стандартным.
     PU_1700 корретно поддерживает значения  параметров  "/sm="
при работе  со многими утилитами:  FORMAT,  DISKCOPY,  SFORMAT,
PCTOOLS, FDFORMAT и другими!

     PU_optFD.COM -
     ──────────────
     только при установленном драйвере PU_1700, позволяет опти-
мизировать (или "переоптимизировать") любой носитель под задан-
ное Вами значение параметра "/  sm  =".  Прерывая  работу  этой
программы в различных местах,  можно изготовить дискету с пере-
менным параметром оптимизации.
     PU_optFD.COM совместно с драйвером PU_1700 дают  Вам также
возможность быстрого  реформатирования  "старых" дискет с целью
их обновления (с сохранением информации).

     PU_copFD.COM -
     ──────────────
     только при установленном драйвере PU_1700,  позволяет про-
извести быстрое копирование дискет любого формата (даже не Dos-
формата!)в сжатый файл образа дискеты и обратно с  любым  пара-
метром  оптимизации.  PU_copFD  имеет необходимую подсказку при
запуске.

     PU_edpFD.COM -
     ──────────────
     может работать как при установленном драйвере PU_1700, так
и без него и позволяет произвести редактирование системной  об-
ласти  дискеты (BOOT + FAT + ROOT) с ее очисткой в широких пре-
делах.  Программа позволяет увеличивать полезный объем  дискеты
уменьшением ее системной области,  вплоть до короткой, содержа-
щей только одну копию FAT.
     К сожалению, MS DOS всех версий, включая и 5.0, имеют одну
общую ошибку при разборе параметров носителя - безусловно уста-
навливают число FAT = 2, несмотря на то, что в блоке параметров
дискеты BOOT проставлена 1 ! У меня уже целая куча вопросов ти-
па:  "Для  чего  разработчики операционной системы вводят в нее
глобальные параметры,  с которыми не умеют работать!" к мальчи-
кам  фирмы  Microsoft.  PU_edpFD умеет [пере]настраивать MS DOS
для работы с такими дискетами. Кстати, DR DOS 6.0 правильно по-
нимает дискеты с любыми системными областями, но работает с ни-
ми раз в 5 медленнее, особенно фаза инициализации носителя!
     Системная область отформатированной дискеты вкючает в себя
3 области: BOOT, FAT и ROOT:


        ┌───────────────────────────────┐──────
        │                               │
        │           B O O T             │     B
        │                               │
        │        (один сектор)          │     O
        ├───────────────────────────────┤
        │                               │     O
        │         Р Е З Е Р В           │
        │                               │     T
        │     (обычно 0 секторов)       │
        ╞═══════════════════════════════╡──────
        │                               │
        │           F A T  1            │
        │                               │    F
        │     (минимум один сектор)     │
        ├───────────────────────────────┤    A
        │                               │
        │           F A T  2            │    T
        │                               │
        │     (может отсутствовать)     │
        ╞═══════════════════════════════╡──────
        │                               │    R
        │           R O O T             │    O
        │                               │    O
        │(минимум один сектор = 16 огл.)│    T
        ╞═══════════════════════════════╡───────
        │                               │
        │         Д А Н Н Ы Е           │    D
        │                               │
        │    (все оставшееся дисковое)  │    A
        │    (    пространство       )  │
        │                               │    T
        │                               │
        │                               │    A


     PU_edpFD имеет 6 параметров при запуске из командной стро-
ки:
     /с= - определяет  количество секторов в кластере,  и может
           быть задан в пределах 1 - 8. Чем больше кластер, тем
           меньше область FAT.
     /f= - определяет число FAT 1 или 2. Системная область счи-
           тается короткой, если число FAT = 1.
     /r= - определяет число секторов выделяемое под ROOT. Заме-
           чу, что в одном секторе можно разместить 16 оглавле-
           ний.
     /s -  если задан, то призводится настройка DOS на работу с
           Вашим носителем.  (MS DOS сама не в состоянии  этого
           сделать !).  Настройку надо производить всегда, если
           Вы работаете с носителем, имеющим короткую системную
           область.
     /x -  если задан, то  призводится  принудительная  очистка
           системной области - "очистка" дискеты.
     /w -  если задан, то не производится останов на подтвержде-
           ние исполнения команды.

     После работы  с  дискетой,  имеющей короткую системную об-
ласть,  не забывайте перенастроить MS DOS (параметр "/s"),  при
переходе на работу со стандарним дискетами.  Будьте внимательны
- это позволит Вам безопасно увеличить объем носителя на 5 - 15
килобайт.
     Работайте с дискетами,  имеющими длинную системную область
(число FAT = 2) - они правильно понимаются всеми  версиями DOS.
Длину системной области можно уменьшить параметром "/c=nn" и "/
r=n". Все DOS правильно понимают и эти параметры, за исключени-
ем системных утилит PCTOOLS, NDD и других. Область с "/c=1" или
"/c = 2" безопасна,  "/c=4" и выше может  потребовать  перенас-
торйки DOS или вообще не восприниматься на уровне DOS!

     PU_edpFD версии 1.4 не обслуживает гибкие носители,  имею-
щие запорченые треки, информация о которых хранится в FAT (пос-
ледний всегда очищается при формировании новой системной облас-
ти). Очистку  системной  области  часто  называют  коротким или
быстрым форматированием.

     PU_edpFD имеет необходимую подсказку при запуске.


     При форматировании  дискет с целью их оптимизации утилитой
FORMAT, не забывайте установить параметр "/u" в командной стро-
ке команды FORMAT для DOS версий старше 5.0 Beta

     13. Если  на  Вашей машине установлена коммерческая версия
MS DOS 5.0 и PU_1700 некорректно работает с утилитой  FORMAT на
больших  форматах,  попробуйте параметр /cfat при запуске.  При
этом резидентная часть драйвера увеличится на 224 байта.

     14. Программы PU_tmFD,  PU_tmFDm и PU_optFD имеют одинако-
вый формат командной строки при запуске:

     PU_????? [drv] [N]  или  PU_????? [N] [drv]  где:

     drv - имя драйвера (по умолчанию: A)
     N   - если указан, то производится прямой вывод информации
           на экран Вашего дисплея,  в противном случае, запись
           на экран производится только во время обратного хода
           луча строчной развертки.

     Пример запуска программы PU_optFD:     PU_optFD B N

     15. PU_1700 реализует алгоритм TSR программ без PSP. Рабо-
ту  с  такими  программами не поддерживают самодельные драйверы
типа RELEASE и некоторые типы вирусов ! Это может быть одной из
причин  "зависания"  Вашей ПЭВМ при установке PU_1700.  В таких
случаях попробуйте параметр "/psp" при запуске (при этом  рези-
дентная  часть  драйвера увеличится на 256 байт) - возможно это
поможет Вам.  А если это "зависание" - есть воздействие вируса?

     16. Широко известные в нашей  стране  утилиты  П.  Нортона
DISKEDIT,  NDD  и другие работают корректно только с избранными
форматами гибких носителей! Это для меня вообще непонятно, чего
проще - считал блок параметров носителя и работай.  Но оказыва-
ется, что там, "за бугром", успехом пользуется широко известный
у нас алгоритм "я хозяин вся страна" - параметры избранных фор-
матов описаны в теле самой программы, а считанные корректируют-
ся или игнорируются.  Поэтому дискета формата 1.7 MB может быть
"вылечена" в формат 1.44 MB утилитой NDD, а носители с короткой
системной областью распознаются утилитами, как запорченые, и т.
д..
     Будьте особо  внимательны  при работе утилит П.  Нортона с
гибкими носителями  нестандартных  форматов!  Утилиты  в  целом
прекрасные,  работают только с т.н.  стандартными форматами, но
их не мешало бы и доработать (утилиты).  От этого они  хуже  не
станут.




                          Изменения.
                         ────────────

     V 1.2 - разблокировано управление параметром "/ke".

     V 1.3 - изменены управляющие ключи командной строки, изме-
             нен "Help", введено "Info", изменена настоящая ин-
             струкция.

     V 1.4 - поддерживает  работу  утилит   DISKCOPY / DISKCOMP
             с дискетами всех форматов!

     V 1.5 - устранено "нежелание форматироваться после началь-
             ной загрузки системы".
             Изменена настоящая инструкция.

     V 1.6 - изменен алгоритм работы драйвера. (В худшую сторо-
             ну - бывает и такое.)
             Изменена настоящая инструкция.

     V 1.7 - изменен алгоритм работы драйвера. Работает с неко-
             торыми старыми "странными" версиями BIOS.
             Изменена настоящая инструкция.

     V 1.9 - изменен алгоритм работы драйвера. Введены дополни-
             тельные параметры   командной  строки:  "/cfat"  и
             "/if" - корректная работа под управлением  коммер-
             ческой версии MS DOS 5.0 и возможность  переключе-
             ния режима  форматирования (interleave factor) со-
             ответственно. Оптимизировано время ожидания  пози-
             ционирования головки  -  все  операции с дискетами
             стали работать заметно быстрее (только не со  ста-
             рыми контроллерами дисководов).
             Версия 1.9 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.0   изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки: "/sm" - возмож-
             ность оптимального расположения секторов при  фор-
             матировании - увеличение производительности Ваших
             дисководов до 70%.
             Версия 2.0 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.1   изменен алгоритм работы драйвера.  Драйвер коррек-
             тно работает с утилитой SFORMAT и другими.
             Версия 2.1 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.2   изменен алгоритм работы драйвера. Введены дополни-
             тельные параметры командной строки:
              "/sm=1", "/sm=2" и "/sm=off" взамен "/sm"
             для дополнительного увеличения производительности
             Ваших дисководов.  Драйвер  корректно работает со
             многими утилитами  и "форматерами" гибких  дисков,
             поддерживая заданные параметры: "/if" и "/sm=".
             Версия 2.2 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.3   Драйвер корректно работает с PU_optFD.COM -  опти-
             мизатором производительности гибких носителей.
             Версия 2.3 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.4   Драйвер     корректно   работает   под  упрвлением
             DR DOS v6.0  (драйвер 800 под ней не работает !)
             Версия 2.4 опытная (Beta).
             Настоящая инструкция дополнена Приложением.

     V 2.5  Улучшен алгоритм распознавания активных дисководов.
             Версия 2.5 опытная (Beta).

     V 2.6   Изменен алгоритм работы драйвера.  Драйвер коррек-
             тно работает с утилитой NCACHE.EXE и ей подобных.
             Версия 2.6 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.7   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки:  /B720=, позво-
             ляющий отключать/подключать   редактирование  BOOT
             сектора носителей 720 KB 5"(DD).
             Версия 2.7 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.8   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки:  "/psp", позво-
             ляющий не использовать PSP драйвером.
             Версия 2.8 опытная (Beta).
             Изменена настоящая инструкция.

     V 2.9   Технологическая версия программы.

     V 3.0   Изменен  алгоритм работы драйвера. Введен дополни-
             тельный параметр командной строки: "/BootX=", поз-
             воляющий работать с дискетами, у которых безнадеж-
             но запорчен 0 трек.
             Версия 3.0 опытная (Beta).
             Изменена настоящая инструкция.





                Право распостранения программы.
                   (жулики за компьютерами)
               ────────────────────────────────

     В СНГ нет защиты авторских прав.  У нас в стране воровство
называют  нелегальным  копированием программных продуктов.  И в
уголовном кодексе,  например России,  есть целый  букет  статей
посвященных воровству и ни одной - "нелегальному копированию" -
такому же воровству - фантастика да и только  !  Посмотрите  на
математическое обеспечение Вашего персонального компьютера. Там
ПОЧТИ вся математика сворована - Ваша организация, где Вы рабо-
таете,  не заплатила за нее ни копейки. Да она и не знает кому,
на каком основании,  чем и за что надо платить. Попробуйте зап-
латить Веселову Е.Н. за украденный Вами LEXICON, через Вашу ор-
ганизацию - Вас просто не поймут, а если и поймут, то ... . Мне
бы  не  хотелось  увеличивать число сворованных Вами прграммных
продуктов. Поэтому:
     PU_1700.COM вместе  с настоящей инструкцией и "примочками"
может свободно распостраняться ТОЛЬКО в  некоммерческих  целях,
ТОЛЬКО  БЕСПЛАТНО  и без всяких ограничений.  Работайте на здо-
ровье!




           Желаю успехов!            Панков Ю.И.    25.03.92 г.
           г. Сергиев Посад          тел. в Москве: 252-43-94
             (Загорск)                              (рабочий)










                          Приложение.
                         ─────────────


        А. О максимально возможных форматах носителей.
        ──────────────────────────────────────────────

     Для носителей HD 5" (1.2 MB),  неформатированный объём ко-
торых на 80x2 треках равен 1.6 MB (1.638.400 байт),  максималь-
ный формат, работу с которым поддерживает MS DOS достигнут:

     80x2 треков по 18 секторов в 512 байт - 1.474.560 байт
                                              (1.44 MB)

     При этом за вычетом системных областей:  BOOT,  FAT и ROOT
полезный объем дискеты составляет 1.457.664 байт или 1.4235 MB.

     По 1 KB на треке (всего 163.840 байт ) ушло на  межсектор-
ные  промежутки,  уменьшить которые уже некуда.  Это предельный
формат для HD 5" с которым можно работать на уровне MS DOS.


     Для носителей HD 3" (1.44 MB), неформатированный объём ко-
торых на 80x2 треках равен 2.0 MB (2.048.000 байт),  максималь-
ный формат, работу с которым поддерживает MS DOS сейчас состав-
ляет:

     80x2 треков по 21 сектор в 512 байт - 1.720.320 байт
                                            (1.68 MB)

     При этом за вычетом системных областей:  BOOT,  FAT и ROOT
полезный объем дискеты составляет 1.702.400 байт или 1.6625 MB.

     По 2 KB на треке (всего 327.680 байт) ушло на межсекторные
промежутки, это многовато. Поэтому это не предельный формат для
HD 5" с которым можно работать на уровне MS DOS.  Я,  например,
уже  сейчас  умею  форматировать  HD 3" дискеты на максимальный
объем 1.76 MB (1.802.240 байт - 80x2 треков по 11 секторов  в 1
KB - это предел). Но с ними пока не работает MS DOS.
                          Примечание:
                         ────────────
     1. Увеличение  максимального  объема  дискеты  увеличением
числа отформатированных треков, на сколько это позволяет диско-
вод (например до 83),  я не рассматриваю в контексте предельных
форматов носителей,  т.к. это уже предельные возможности диско-
вода и носителя.
     2. Можно увеличить полезный объем отформатированной диске-
ты  уменьшением размеров ее системных областей,  отредактировав
последние "примочкой" PU_edpFD.  Например если  сделать  размер
кластера  равным  1  KB  (2 сектора),  то размер FAT уменьшится
вдвое. При этом полезный объем дискеты несколько увеличится, но
это кажущееся увеличение оборачивается уменьшением, если на та-
кую дискету записать больше 9 файлов.


        Б. О "чередовании секторов" при форматировании.
      ──────────────────────────────────────────────────

     При форматировании  трека  носителя  немаловажное значение
имеет так называемый "Interleave Factor",  определяющий порядок
следования секторов на треке ( в дальнейшем IF).
     Если IF = 1, то порядок следования секторов последователь-
ный: 1-ый, 2-ой, ... . При IF = 2 сектора располагаются в чере-
дующемся кольцевом порядке. Например, если на треке расположить
10 секторов с IF = 2,  то они должны быть расположены следующим
образом:
              1, 6, 2, 7, 3, 8, 4, 9, 5, 10
     Таким образом  увеличивается межсекторный промежуток между
последовательными номерами секторов.  Прямое чтение, запись или
форматирование такого трека производится контроллером за 2 обо-
рота двигателя.  А при IF = 3 - за 3. Таким образом можно попы-
таться  обойти скоростные ограничения контроллера,  существенно
понизив производительность Вашего дисковода !.
     Форматирование дискет на высшие форматы,  без IF >= 2  не-
возможно, иначе  контроллер не успевает обрабатывать межсектор-
ные промежутки,  где хранятся угловые метки и  другая  полезная
информация.


     В. Особенности работы  утилиты FORMAT "коммерческой"
    ──────────────────────────────────────────────────────
              версии  MS DOS 5.0 совместно с 800.
             ────────────────────────────────────

     "Улучшенная" утилита  FORMAT  только и только этой версии
не очищает FAT длиною больше 9 секторов.  Она прекрасно форма-
тирует дискеты большого формата.  Но если размер FAT превышает
9 секторов,  то весь конец FAT прописывает  каким-то  мусором.
После  такого  "форматирования"  часть  диска  оказывается уже
"распределенной".  Привести в порядок такую дискету  нетрудно:
надо  очистить  конец 1-ой и 2-ой FAT после 9 их сектора любой
имеющейся у Вас под руками утилитой:  PCTOOLS,  NDD,  CHKDSK и
др.
     Описанный эффект может иметь место на форматах  более 1.44
MB.  Ответить на вопрос - кто же тут неправ: утилита FORMAT или
драйвер 800 затруднительно, на мой взгляд обе программы работа-
ют некорректно. Драйвер 800 на больших форматах безусловно выс-
тавляет размер FAT в 9 секторов утилите FORMAT, даже если нужно
больше или меньше.  Старые утилиты FORMAT "молча" пересчитывали
этот параметр после форматирования  и  формировали  "очищенный"
FAT нужной длины. Утилита FORMAT коммерческой версии MS DOS 5.0
тоже пересчитывает длину FAT,  а очищает ровно столько, сколько
выставил драйвер 800 - не более 9 секторов.
     Запуск PU_1700 с параметром "/cfat"  позволяет  произвести
корретное форматирование дискет любого формата. При этом размер
резидентной части драйвера увеличивается на 224 байта.

     Поклонники драйвера 800 !
     Утилита FORMAT  Beta версии MS DOS 5.0 работает по старому
"корректно" под коммерческой версией MS DOS 5.0  независимо  от
установленного драйвера 800 или PU_1700 !
     Утилита FORMAT версии DR DOS 6.0 содержит, на  мой  взгляд
ошибку, которой  вполне хватило, чтоб совместно с драйвером 800
отказаться форматировать  все большие форматы дискет !  PU_1700
начиная с версии 2.4 корретно работает с этой утилитой.



        Г. О "заглушках" в PU_1700 или "почему я выпус-
     ─────────────────────────────────────────────────────
                       каю Beta версии".
                      ──────────────────

     PU_1700 уже почти не развивается. Он уже успешно "обкатал-
ся" на многих машинах и на многих прикладных пакетах, для боль-
шинства из которых пришлось в драйвере предусмотреть  специаль-
ные  "заглушки".  Я  все  еще жду,  и заранее благодарен Вам за
сообщения типа:  "Ваш  с...й  драйвер не работает  с программой
... ."


                                                    25.03.92 г

   P.S.
     Я с удовольствием выпущу коммерческую версию PU_1700, если
найдется  меценат,  поддерживающий эту работу и взявший на себя
труд редактирования и перевода подобной инструкции на  английс-
кий язык.


   P.S.
     С другой стороны,  я ясно себе представляю, что по крайней
мере в России,  таких людей пока нет и быть не может, они могут
появиться не раньше,  чем через 70 - 100 лет. И попробуйте меня
в этом переубедить!  Тогда я с удовольствием уберу эти строки и
эпиграф.
