                                              'Доктор'  Е. Касперский
                                              ───────────────────────

   -D.COM  -  детектор вирусов, логических бомб и "троянских коней"
   ════════════════════════════════════════════════════════════════

	Детектор -D  - это  резидентно находящаяся  в памяти  программа,
которая  позволяет  выявлять  все  "подозрительные" действия компьютера:
изменение и переименование  выполняемых программ (.COM-  и .EXE-файлов),
запись на диск  по абсолютному адресу,  форматирование диска и  создание
резидентных программ.

	Включена  возможность  блокирования  отладчика,  что   позволяет
перехватить размножение "болгарских" вирусов  семейства "TP".  При  этом
блокируется  только  системный   отладчик,  а  большинство   отладчиков,
входящих в  интегрированные пакеты  (Turbo Debugger,  Code View  и др.),
работают нормально.

	Возможно восстановление всех векторов прерываний после окончания
работы программы.  Это блокирует распространение большинства резидентных
вирусов, а некоторые вирусы оказываются просто уничтоженными.

	Детектор  может   быть  полезен   при  работе   с   программами,
подозрительными на наличие вируса или "троянского коня", при  разработке
резидентных программ и программ, работающих с диском посредством  записи
информации на диск по абсолютным адресам.  Детектор позволяет следить за
распределением  оперативной  памяти  компьютера  (окно  "Карта памяти" в
основном  меню  детектора)  и,  таким образом, своевременно обнаруживать
резидентные вирусы.  При помощи  меню детектора можно выбрать, на  какие
из возможных "подозрительных" ситуаций должен реагировать детектор.

	При   "подозрительном"    поведении   компьютера    -D    выдает
предупреждение (на  экране появляется  окно с  подробной информацией)  и
ждет  указания  на  разрешение  или  запрещение  данного  действия. Ниже
приводится полный список выдаваемых сообщений.


		   Список сообщений детектора -D.COM
                   ─────────────────────────────────

               1. Запись на диск по абсолютному адресу,
     форматирование секторов на диске (прерывания 13h, 40h и 26h)

┌──────────────────────────────────────────────────────────────────┐
│ program_name  (CS:IP=xxxx:xxxx)                                  │
│ ЗАПИСЫВАЕТ (int xx,f.xx, ES:BX=xxxx:xxxx) на диск X: nnn секторов│
│ начиная с трека tttt, сектора ssss, головки hhhh                 │
├──────────────────────────────────────────────────────────────────┤
│ program_name  (CS:IP=xxxx:xxxx)                                  │
│ ФОРМАТИРУЕТ (int xx,f.xx) на диске X: nnn секторов               │
│ начиная с трека tttt, сектора ssss, головки hhhh                 │
├──────────────────────────────────────────────────────────────────┤
│ program_name  (CS:IP=xxxx:xxxx)                                  │
│ ЗАПИСЫВАЕТ (int 26) на диск X:                                   │
│ nnnn секторов начиная с mmmm-ого                                 │
└──────────────────────────────────────────────────────────────────┘

	Данные   сообщения   сигнализируют   о   том,   что    программа
"program_name" пытается  записать на  диск один  или несколько секторов,
используя  абсолютную  адресацию  секторов  на диске или отформатировать
один  или  несколько  секторов  на  диске.   Эти  функции практически не
используются обычными программами (за исключением утилит форматирования,
оптимизации  и  восстановления  диска),  зато  используются   некоторыми
вирусами. Использование прерываний 13h, 40h, 26h является одним из самых
эффективных  способов  уничтожения  информации  на  диске,  в частности,
таблиц Disk Partition Table и File Allocation Table.

Внимание!  При сообщении о записи или форматировании секторов на диске с
	   использованием  прерываний  13h   и  40h  указывается   номер
	   физического  диска  ('A:'  -  первый,  'B:' - второй и т.д.).
	   Если винчестер  разбит на  несколько логических  дисков, то в
	   сообщении  указывается  номер  ФИЗИЧЕСКОГО  диска: 'C:', если
	   идет обращение к первому винчестеру, 'D:' - если ко  второму.
	   Для того,  чтобы выяснить,  на какой  ЛОГИЧЕСКИЙ диск ведется
	   запись, необходимо  проанализировать таблицы  разбиения диска
	   (Disk Partition Table) на всех логических дисках.


	  2. Изменение и переименование выполняемых программ
			 (.COM- и .EXE-файлов)

       ┌──────────────────────────────────────────────────────┐
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается ОТКРЫТЬ (FCB,int 21,f.0F) файл             │
       │  file_name                                           │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается ОТКРЫТЬ для ЗАПИСИ (int 21,f.3D) файл      │
       │  file_name                                           │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается СОЗДАТЬ (FCB,int 21,f.16) файл             │
       │  file_name                                           │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается СОЗДАТЬ (int 21,f.3C) файл                 │
       │  file_name                                           │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается ПЕРЕИМЕНОВАТЬ (FCB,int 21,f.17) файл       │
       │  file_name                                           │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается ПЕРЕИМЕНОВАТЬ (int 21,f.56) файл           │
       │  file_name                                           │
       └──────────────────────────────────────────────────────┘

	Эти сообщения  будут появляться  при любом  действии, ведущем  к
изменению  .COM-  или  .EXE-файлов   (открытие  для  записи,   создание,
изменение имени).   Подобные действия предпринимаются  практически всеми
вирусами (за  исключением вирусов,  распространяющихся по  BOOT-сектору)
при  инфицировании  файлов.   С  помощью  детектора  -D можно остановить
распространение компьютерного вируса на самой ранней стадии.


	   3. Попытка программы остаться резидентно в памяти

       ┌──────────────────────────────────────────────────────┐
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается остаться РЕЗИДЕНТНО в памяти (int 21,f.31) │
       ├──────────────────────────────────────────────────────┤
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  пытается остаться РЕЗИДЕНТНО в памяти (int 27)      │
       └──────────────────────────────────────────────────────┘

	Многие  вирусы  оставляют  в  памяти компьютера свою резидентную
часть, некоторые  из них  используют для  этого прерывания  DOS.  В этом
случае будет выдано сообщение о попытке программы остаться резидентно  в
памяти.  Остальные вирусы при создании в памяти своей резидентной  части
оперируют с таблицами  распределения памяти, в  этом случае детектор  не
сможет предотвратить инфицирование памяти (не файлов!) компьютера. Но  в
большинстве  случаев  вирус  будет  отражен  на карте памяти (см. "Карта
памяти").


		    4. Вызов 'опасных' функций DOS

       ┌──────────────────────────────────────────────────────┐
       │  program_name  (CS:IP=xxxx:xxxx)                     │
       │  Опасный вызов DOS (int 2F,f.13)                     │
       └──────────────────────────────────────────────────────┘

	Подобные сообщения  сигнализируют о  том, что  идет обращение  к
DOS,  не  свойственное  прикладным  программам.  При  этом использование
перехваченной  функции   DOS  может   быть  использовано   вирусом   при
размножении.

		     Управление детектором  -D.COM
                     ─────────────────────────────

	После выдачи любого из описанных выше сообщений необходимо  либо
разрешить, либо запретить операцию, вызвавшую сообщение.  При разрешении
операции компьютер  продолжит выполнение  этой операции.  При запрещении
операции устанавливаются соответствующие указатели об ошибке  (например,
"файл не найден", "диск защищен от записи" и пр.) и происходит возврат в
программу, вызвавшую "подозрительную" операцию. Если при этом вызывающая
программа не проверяет правильность выполнения операции, то результат ее
дальнейшей работы непредсказуем.

	Некоторые  операции  выполняются   многократно  (например,   при
форматировани  или  оптимизации  диска).  В  этом случае удобно временно
отключить соответствующий режим, при этом не будут выдаваться  сообщения
об  отключенной  операции  (например,  при  форматировании  диска  нужно
отключить  режим   проверки  на   форматирование).  Отключение   режимов
производится  либо  вызовом  основного  меню,  либо  повторным  запуском
детектора.

	Вызов  основного  меню  осуществляется  одновременным   нажатием
клавиш Alt  и '-',  выход -  нажатием клавиши  ESC.   При вызове меню на
экране появляются два окна:  окно установки режимов и окно карты памяти.
Если по некоторым причинам войти  в меню невозможно, то детектор  подаст
звуковой сигнал.

	В  меню  установки  режимов  выводится  информация об активности
(включено - 'ДА', выключено  - 'НЕТ') режимов выявления  соответствующих
"подозрительных" операций.

                 ┌───────────────────────────────────┐
                 │  Изменение .COM-файлов        ДА  │
                 │  Изменение .EXE-файлов       НЕТ  │
                 │  Переименование .COM-файлов  НЕТ  │
                 │  Переименование .EXE-файлов   ДА  │
                 │  Создание резидент            ДА  │
                 │  Форматирование сектора       ДА  │
                 │  Прямая запись сектора        ДА  │
                 │  Вызов опасных функций DOS    ДА  │
                 ├───────────────────────────────────┤
                 │   Дополнительные возможности:     │
                 ├───────────────────────────────────┤
                 │  Блокировка отладчика        НЕТ  │
                 │  Восстановление векторов      ДА  │
                 └───────────────────────────────────┘

	Перемещение  курсора  в  меню  осуществляется  при помощи клавиш
HOME,  END,  UP,  DOWN.  Необходимая настройка детектора устанавливается
клавишей RETURN (ENTER) .

	Отключить или включить режимы  можно также и повторным  запуском
детектора.   При этом  детектор находит  в памяти  компьютера свою ранее
загруженную копию и передает ей параметры, указанные в командной строке:

	C:>-D  [список параметров]

	Все параметры должны быть разделены пробелами и состоять из двух
частей:  первая  -  символ  '-'   (выключить  режим),  вторая  -   номер
выключаемого режима (от '1' до '10', соответственно  строке в окне  меню
режимов).  Все режимы, не указанные в командной строке, будут  включены.
Например, при запуске детектора строкой

	C:>-D  -1  -4

будут включены все режимы, кроме 1-ого и 4-ого (изменение .COM-файлов  и
переименование .EXE-файлов).


			     Карта памяти
                             ────────────

	Карта памяти  состоит из  пяти колонок.  Первая колонка является
сегментным  адресом  Блока  Распределения  Памяти  (MCB - Memory Control
Block), вторая - сегментным адресом Префикса Программного Сегмента  (PSP
-  Programm  Segment  Prefix),  третья  -  размер блока в параграфах (16
байт) или килобайтах, четвертая - имя программы, занимающей блок памяти,
или знаки  '?'   или '*'  если имя  не определено,  пятая - используемые
вектора прерываний.

	Указывается также:

количество свободной памяти    ────────────────────────────┐
количество оперативной памяти, указываемое BIOS  ───────┐  │
количество оперативной памяти ──────────────────────┐   │  │
                                                    │   │  │
Несовпадение значений полного размера памяти        │   │  │
("Всего") и размера, указываемого BIOS ("Указано"), │   │  │
часто служит сигналом о наличии вируса в системе.   │   │  │
Но следует учитывать, что в некоторых случаях       │   │  │
(например, при использовании некоторых              │   │  │
разновидностей адаптера VGA) это несовпадение       │   │  │
вполне законно.                                     │   │  │
                                                    │   │  │
╦══════════════════════════╦═══════════════════════ │   │  │ ╤════════╦
║Изменение .COM-файлов     ║Всего/Указано/Свободно 640/633/0K│        ║
║Изменение .EXE-файлов     ║────┬────┬────┬─────────┬────────┘Использ.║
║Переименование .COM-файлов║MCB │PSP │    │Программа│вектора прерыван.║
║Переименование .EXE-файлов║────┼────┼────┼─────────┼─────────────────╢
║Создание резидент         ║0D16│0D17│3,2K│COMMAND. │22 24 2E         ║
║Форматирование сектора    ║0DEA│0E00│,04K│-D.COM   │                 ║
║Прямая запись сектора     ║0DEE│0D17│,25K│COMMAND. │                 ║
║Вызов опасных функций DOS ║0DFF│0E00│ 23K│-D.COM   │09 10 13 1B 1C 23║
╩══════════════════════════║    │    │    │         │26 28 2F 40 EC F1║
Дополнительные возможности:║    │    │    │         │FF               ║
╦══════════════════════════║13C0│13C6│ 64K│SS.COM   │00 05 ED EF FB   ║
║Блокировка отладчика      ║23C6│23CC│,06K│     *   │           ──┐   ║
║Восстановление векторов   ║23CB│0D17│486K│COMMAND. │30 F3 F8 FE  │   ║ 
║Удаление детектора        ║9D58│0000│3,6K│     ?   │21 27    ───┐│   ║ 
╚══════════════════════════╝9E41│0000│7,0K│     ?   │         ──┐││   ║ 
                           ╚════╧════╧════╧═════════╧═════════  │││  ═╝
                                                                │││
                               Вирус 'Den-Zuk' (загрузочный)  ──┘││
                               Вирус 'Eddie' (файловый)       ───┘│
                               Вирус '1701'  (файловый)       ────┘


	   Детектор  -D3.COM  -  дополнительные возможности
           ════════════════════════════════════════════════

	В  детектор  -D3,  кроме  вышеперечисленных, включены   функции:
просмотра  значений   векторов   прерываний,   просмотра  дампа  памяти,
дизассемблер.

			 1. Вектора прерываний
                         ─────────────────────

	В  окно  векторов  прерываний  выводится  информация  о векторах
прерываний:   номер    прерывания,    значение   вектора    в    формате
"сегмент:смещение"  и  имя  программы  или  системной области памяти, на
которую указывает вектор прерывания.

	Перемещение в окне осуществляется  при помощи клавиш   UP, DOWN,
PGUP, PGDN, HOME, END.  Выход из окна - ESC.


			    2. Дамп памяти
                            ──────────────

	В окно дампа памяти выводится в текстовом или  шестнадцатиричном
виде  информация  о  содержании  оперативной  памяти  компьютера.  Выбор
необходимого  участка  осуществляется   либо  перемещением  в   пределах
текущего сегмента  при помощи  клавиш UP,  DOWN, PGUP,  PGDN, HOME, END,
либо указанием начального адреса участка при помощи клавиш LEFT,  RIGHT,
'0'-'9', 'A'-'F'.

	Смена  режима  просмотра  памяти   "текстовой/шестнадцатиричный"
производится нажатием клавиши F3.

	Поиск строки по  шаблону осуществляется из  меню поиска (вход  в
меню  -  F7).  В  меню  задается  строка-шаблон  в шестнадцатиричном или
текстовом виде,  адрес начала  и конца  участка памяти,  в котором будет
производиться поиск. Если строка не обнаружена, то на экран будет выдано
сообщение "строка не найдена".

	Выход из окна дампа памяти - ESC.


			    3. Дизассемблер
			    ───────────────

	Дизассемблер позволяет просмотреть текст программ, загруженных в
память,  и  очень  удобен  при  отладке или анализе резидентных программ
(например, резидентных вирусов).

	Дизассемблер вызывается из основного меню. Выбор участка  памяти
для дизассемблирования производится либо клавишами UP, DOWN, PGUP,  PGDN
в пределах  сегмента, либо  указанием адреса  участка при  помощи клавиш
LEFT,  RIGHT,  '0'-'9',  'A'-'F'.  Выход из дизассемблера осуществляется
нажатием клавиши ESC.


                       Благодарю за использование детектора -D3.COM !
		                             'Доктор'  E. Касперский.
					      10 октября 1990 г.

