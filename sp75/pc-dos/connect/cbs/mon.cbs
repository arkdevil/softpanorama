Start:
  if InitRS("COM2,9600,8,2,N") <> 1 then goto ErrIn Rem –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞
  DTR(1);RTS(1)
  PrintS("[2JMONITOR =>",1);
MainLoop:
  sChars==0
  if (Char = KeyPrs())==0 then GoTo Receive else GoTo KBD
Receive:
  if ChkRS() == 0 then GoTo MainLoop
  if (Code = Receiv(Char,1,1)) <> 0 then goto NotOK Rem –ü—Ä–∏–µ–º
  if Char == 1 then GoTo SendFile
  if Char == 2 then GoTo ReceiveFile
  PrintV(Char,1,"c")
  if Char == $73 then sChars = sChars+1
  if sChars == 50 then GoTo MainLoop
  GoTo Receive
KBD:
  if Char == 5 then if (Code = Send($415b1b,3)) <> 0 then goto NotOK  rem Up    [A
  if Char == 24 then if (Code = Send($425b1b,3)) <> 0 then goto NotOK rem Down  [B
  if Char == 4 then if (Code = Send($435b1b,3)) <> 0 then goto NotOK  rem Right [C
  if Char == 19 then if (Code = Send($445b1b,3)) <> 0 then goto NotOK rem Left  [D
  if (Code = Send(Char,1)) <> 0 then goto NotOK
  GoTo MainLoop
SendFile:
  if (Code = Send(Char,1)) <> 0 then goto NotOK Rem Echo
  PrintS("");PrintS("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞");
  PrintS("–ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª ",1)
  Size = 0 Rem –†–µ–∂–∏–º —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞
  PrintS(Open(File,"",Size)) Rem –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
  if Size <> 0 then goto L3
    Prints("–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª")
    GoTo MainLoop
  L3:
  GetBuf(Buff,Size) Rem –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
  RDBlk(File,Buff,Size)Rem –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
  Close(File) Rem –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
  PrintS("–ü–µ—Ä–µ–¥–∞—á–∞ ... ",1)
  IndBar(1,Size)
  if (Code = Send(Size,2)) <> 0 then goto NotOK Rem –ü–µ—Ä–µ–¥–∞—á–∞ –¥–ª–∏–Ω—ã
  if (Code = SndBlk(Buff,Size)) <> 0 then goto NotOk Rem  –ü–µ—Ä–µ–¥–∞—á–∞ –§–∞–π–ª–∞
  PrintS("–ö–æ–Ω–µ—Ü –ø–µ—Ä–µ–¥–∞—á–∏",0,1)
  IndBar(0)
  DisBuf(Buff) Rem –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
  GoTo MainLoop Rem –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–µ—Ä–µ–¥–∞—á–∏
ReceiveFile:
  if (Code = Send(Char,1)) <> 0 then goto NotOK Rem Echo
  PrintS("");Prints("–ü—Ä–∏–µ–º ... ",1)
  if (Code = Receiv(Size,2,1)) <> 0 then goto NotOK Rem –ü—Ä–∏–µ–º –¥–ª–∏–Ω—ã —Ñ–∞–π–ª–∞
  if Size == 0 then GoTo MainLoop
  IndBar(1,Size)
  GetBuf(Buff,Size) Rem –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –ø—Ä–∏–Ω–∏–º–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
  if (Code = RecBlk(Buff,Size,1)) <> 0 then goto NotOK Rem –ü—Ä–∏–µ–º —Ñ–∞–π–ª–∞ –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –±—É—Ñ–µ—Ä
  PrintS("–ö–æ–Ω–µ—Ü –ø—Ä–∏–µ–º–∞")
  IndBar(0)
  PrintS("–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö")
  PrintS("–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª ",1)
  PrintS(Open(File,"",1)) Rem –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  WrBlk(File,Buff,Size) Rem –ó–∞–ø–∏—Å—å –ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª
  Close(File) Rem –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞ –ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  DisBuf(Buff) Rem –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
  GoTo MainLoop Rem –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –ø—Ä–∏–µ–º–∞
Rem ----------------------------------------------------------------------
ErrIn:
 PrintS("");PrintS("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏")
 Stop()
NotOK:
 if Code == 1 then goto Esc else goto Error
Esc:
 PrintS("");PrintS("–ù–∞–∂–∞—Ç–∞ Esc");
 stop()
ErrorEcho:
 PrintS("–≠—Ö–æ ",1)
 PrintV(Echo)
Error:
 Send($2E2E2E2E,4);
 PrintS("–û—à–∏–±–∫–∞ –æ–±–º–µ–Ω–∞ ",1);
 PrintV(Code)
 GoTo Start
Quit:

