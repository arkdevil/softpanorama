                                                 Шеховцов Александр



                     Новая концепция антивирусов?


  Опять про антивирусы? Да, опять. Если Вы  считаете тему  устаревшей,
просто сотрите этот файл с диска и забудьте  про  него.  Имеется  уйма
антивирусных средств и еще больше советов, как от вирусов  защищаться.
Их так много, что просто странно, как эти  вирусы  еще  не  вымерли  и
появляются вновь и  вновь.  Именно  этот  странный  факт  я  хотел  бы
обсудить в данной заметке с теми, кто дочитал до этих строк.

  В  сентябрьской   Софтпанораме   среди   прочих   утилит   незаметно
проскочила  моя  программка  RLock,   предназначенная   для   усиления
атрибута ReadOnly на файле в MS-DOS 4.01. Она  не  резидентна,  просто
меняет часть кодов внутри загруженного в память компьютера MSDOS.SYS.
  При ее использовании невозможно снять  с  файла  данный  атрибут  и,
следовательно, что-то записать в файл (в том числе  инфицировать  его)
с  помощью  DOS  -  функций.  Несмотря  на  то,  что  такая  программа
обезвреживает около 90% файловых  вирусов,  она  получила  только  два
отзыва: "У кого же есть DOS 4.01?" и  "RLock  использует  некорректный
способ модификации DOS".
  На первый отзыв ответ прост: в декабрьскую Софтпанораму я  предложил
RLock и для MS-DOS 5.0. Ну а по второму отзыву  я  задам  контрвопрос:
"Почему те,  кто  аналогичным  способом  "курочит"  Norton  Commander,
ходят чуть ли не в героях, а чуть тронешь DOS  -  и  уже  некорректный
способ...".

  Но дело не в этом. Никто не заметил, что RLock  по  сути  -  первая,
хотя во многом школьническая попытка создания антивируса нового  типа.
Все  предыдущие  антивирусы  объективно  запаздывали  по  отношению  к
вирусам. Сначала появлялся вирус с новой  идеей,  например  получением
входа в DOS методом всплытия, затем  -  антивирус,  заимствующий  этот
метод. В  результате  производители  антивирусов  разленились  и  чаще
всего пассивно ждут, пока появится новый вирус, способный  сломать  их
защиту.
  Кроме того антивирусы, в том числе класса сторожей,  пишутся  как  и
вирусы в рассчете на  все  версии  DOS.  Поэтому  если  вирус  сломает
защиту на одной из  DOS,  он  это  сделает  автоматически  и  на  всех
остальных.
  И, наконец, все антивирусы относятся к  DOS  как  к  святой  корове,
которую следует оберегать, но не дай Бог хоть пальцем тронуть.

  Возникает вопрос: а почему бы не  сделать  сторож  или  антивирусный
монитор, нарушающий эти традиции, что  явится  большой  неожиданностью
для вирусов. То есть написать его как часть самой DOS,  ее  кодов.  И,
разумется, такой монитор будет привязан к конкретной версии DOS.

  А в результате: как бы близко вирус не подбирался ко  входу  в  DOS,
сторож находится ближе, то есть является частью DOS, и не  может  быть
отключен или обойден стороной. Если вирус научится  все  же  отключать
сторож, скажем, в MS-DOS 4.01, то с появлением DOS 5.0  и  встроенного
сторожа для него этот вирус быстро отомрет. Прекрасным  примером  тому
служит группа болгарских  вирусов,  ориентированных  на  DOS  3.30,  о
которых с появлением DOS 4.0 ничего больше не слышно.
  В отличие от автора вируса, которому тяжеловато распространять  свои
детища при появлении каждого  нового  DOS-а,  авторам  антивирусов  не
составляет проблем обеспечить пользователей своей продукцией, так  как
к их  услугам  все  формы  рекламы  и  прочих  преимуществ  легального
бизнеса,  таких  как  зарегистрированные  пользователи.  Следовательно
узкое место для вируса не будет таким для антивирусов.

  Что бы хотелось видеть в таком стороже как составной части DOS?

  1. Проверку запускаемых на выполнение программ на  вирусное  старье,
причем только то, которое дышит в данной  версии  DOS.  Таким  образом
специализация  сторожа  упрощает  его  жизнь  -  не  нужно  заниматься
барахлом, которое живет только в DOS 3.30.

  2. Запрет опасных действий, таких как любая запись в Partition Table,
Boot Record на винчестере, а также его форматирование.

  3. Контроль попыток пользовательских программ  что-то  прямо  писать
на диск. Большинство программ работают с диском не непосредственно,  а
через DOS-функции, то есть INT 21H. Так  что  прямая  запись  на  диск
может служить сигналом  опасности  и  должна  пресекаться  по  желанию
пользователя.

  4. Усиление атрибута ReadOnly так, чтобы  при  желании  пользователя
ни одна программа не  могла  снять  его  и,  следовательно,  не  могла
инфицировать файлы. Что же касается заражения  файлов  прямой  записью
на диск или снятие ReadOnly через махинации с записями  каталогов,  то
они будут пресекаться мерами из пункта 3.

  5.  Трассировка  (при  желании)   опасных   действий   программы   с
сохранением сценария ее работы на диске и НЕ  выполнением  запрошенных
ею действий. То есть программа (вирус?) пытается  отформатировать  или
заполнить мусором несколько  секторов  диска,  получает  сообщение  от
DOS, что якобы все сделано успешно, а на самом-то деле  диск  остается
нетронутым.  Такой  режим  полезен  для  опытных   пользователей   при
исследовании  сомнительных  программных  продуктов,  и  не  только   с
вирусами, но и с троянскими процедурами внутри.

  6. И так далее, в зависимости от воображения и знаний разработчика...


  Что, просто? Да, но представьте, что так делает  не  кто  иной,  как
сама DOS и попробуйте обойти это. В результате вирусы если и не  будут
ликвидированы целиком, то их  написание  потеряет  интерес,  поскольку
размножаться они будут медленно, а вреда причинять немного. Не то  что
сейчас : и все файлы независимо от атрибутов можно позаражать, и  весь
диск в момент мусором прописать.


  Тогда почему же в заголовке вопросительный знак? Да потому, что  все
это не станет реальностью, пока не будет сделано. А  для  этого  нужно
несколько человек, знающих ассемблер и  DOS  в  такой  степени,  чтобы
суметь   разобраться   в   дизассемблированных   системных     файлах,
модифицировать их и успешно скомпилировать.  Конечно,  им  потребуется
больше знаний и трудолюбия, чем для обнаружения ошибок в том же  DOS-e
(кстати, вот и прекрасный способ заодно  эти  ошибочки  исправить),  и
больше тщательности, чем для написания программ  размером  в  7  байт,
содержащих по 3 некорректности.

  Одним словом, это  работенка  для  умных  ребят,  которые  не  прочь
заработать. Ведь антивирус как составная часть DOS - это еще никем  не
занятая экологическая ниша и тем,  кто  ее  займет  первым,  обеспечен
стабильный кусок хлеба, пока DOS не отомрет окончательно.

  Желаю вам успеха, ребята.
