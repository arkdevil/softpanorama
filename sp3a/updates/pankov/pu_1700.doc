         Резидентная программа - расширитель форматов
                        гибких дисков.
             ┌───────────────────────────────────┐
             │ P U _ 1 7 0 0 . C O M  Beta V 1.8 │
             └───────────────────────────────────┘
                  программист:    Панков Ю.И.
                дата cоздания:   VII-X 1991 г.


     PU_1700.COM - это русский аналог широко известного в нашей
стране драйвера 800.COM, несколько меньших размеров чем послед-
ний, но  с  немного  расширенными возможностями и меньшим коли-
чеством неточностей в работе.
     PU_1700 позволяет использовать Вам все старые форматы дис-
кет и много новых, сохраняя при этом полную совместимость с DOS
(и полную замену драйвера 800.COM). Новые форматы поддерживают-
ся на уровне BIOSа, поэтому они полностью совместимы с DOS и со
многими ее утилитами: FORMAT, DISKCOPY, DISKCOMP и другими.
     PU_1700 резидентно занимает 880 байт оперативной  памяти и
работает под управлением DOS 3.30 и выше.

     PU_1700 значительно расширяет возможности стандартной ути-
литы FORMAT:

     FORMAT drv:[/T:tt][/N:nn][и другие опции]           где:

     drv - имя форматируемого драйвера (A или B)
     tt  - число форматируемых цилиндров
     nn  - число секторов на треке

     Ниже приведена  таблица значений объемов отформатированной
дискеты в зависимости от типа дисковода,  типа дискеты и  пара-
метров форматирования (tt и nn):

  ┌────────────┬────────────────────┬───────────────────────┐
  │   Опции    │     Допустимый     │ Объем отформатирован- │
  │  FORMATа   │   тип дисковода    │ ной дискеты в байтах  │
  ├───────┬────┼────┬────┬────┬─────┼───────────────────────┤
  │   tt  │ nn │360к│720к│1.2м│1.44м│   норма   - максимум  │
  ├───────┼────┼────┼────┼────┼─────┼───────────────────────┤
  │ 40-41 │  9 │ +  │ +  │ +  │  +  │   362.496 -   371.712 │
  │ 40-41 │ 10 │ +  │ +  │ +  │  +  │   398.848 -   409.086 │
  │ 80-83 │  9 │    │ +  │ +  │  +  │   724.480 -   752.168 │
  │ 80-83 │ 10 │    │ +  │ +  │  +  │   806.460 -   837.120 │
  │ 80-83 │ 15 │    │    │ +  │  +  │ 1.212.928 - 1.259.008 │
  │ 80-83 │ 16 │    │    │ +  │  +  │ 1.294.848 - 1.344.000 │
  │ 80-83 │ 17 │    │    │ +  │  +  │ 1.376.768 - 1.427.968 │
  │ 80-83 │ 18 │    │    │ +  │  +  │ 1.457.664 - 1.512.960 │
  │ 80-83 │ 19 │    │    │    │  +  │ 1.539.584 - 1.596.928 │
  │ 80-83 │ 20 │    │    │    │  +  │ 1.620.480 - 1.681.920 │
  │ 80-83 │ 21 │    │    │    │  +  │ 1.702.400 - 1.765.888 │
  └───────┴────┴────┴────┴──────────┴───────────────────────┘

     PU_1700, в отличие от драйвера 800, имеет два дополнитель-
ных формата большого объема:
     - 1.5 MB  для  HD 5" (1.2 MB)
     - 1.7 MB  для  HD 3" (1.44 MB)

     Пример задания  на  форматирование дискеты HD на дисководе
1.44 MB (3") на объем 1.702.400 байт:

     FORMAT a:/t:80/n:21

     PU_1700 допускает  форматирование  до 83 цилиндров.  Такую
дискету нетрудно отформатировать.  Задание /t:41 и /t:81  безо-
пасны.  Дополнительные  цилиндры 82 и 83 (42 для DD) могут хуже
читаться или вовсе отсутсвовать на  Вашем  дисководе.  В  любом
случае при работе с дополнительными цилиндрами Вы должны внима-
тельно слушать,  не ударяется ли головка дисковода о вал двига-
теля.  И даже если Вы ничего не услышали подозрительного,  про-
верьте отформатированную Вами дискету с дополнительными треками
какой-либо тестирующей утилитой, на предмет присутствия послед-
них (Pctools и др.).
     Большинство форматов  (кроме  больших)  могут быть сделаны
загрузочными заданием ключа /s команды FORMAT.  Однако, если Вы
загружаетесь  с  дискеты  5"  720 KB и выше,  Вы должны вызвать
PU_1700 из Вашего AUTOEXEC.BAT.  Иначе дискеты 5" 720 KB и выше
перестанут  читаться после смены диска.  Аналогично надо посту-
пать при загрузке с других нестандартных загрузочных дискет.

     PU_1700 поддерживает работу стандартных утилит  DISKCOPY и
DISKCOMP значительно расширяя их возможности.  Вы можете приме-
нять указанные утилиты между различными типами  дисководов, при
условии поддержки их одинакового формата (см.  таблицу). Вы мо-
жете запустить DISKCOPY/DISKCOMP между 5" и 3"  дисководами. Вы
можете безопасно  скопировать  стандартную  дискету HD 3" на HD
5" и наоборот!  Заметим,  что драйвер 800 не позволит Вам этого
сделать.

     ╔═════════════════╗  DISKCOPY   ┌─────────────────┐
     ║ HD 3" (1.44 MB) ║═══════════│ HD 5" (1.44 MB) │
     ╚═════════════════╝  DISKCOMP   └─────────────────┘


     Работайте с форматами большого объема. Они не менее надеж-
ны,  чем стандартные. Специально принятые меры (только для фор-
матов большого объема) обеспечивают высокую  надежность  работы
даже  на  низкоскоростных  (старых моделях) контроллеров гибких
дисков.  И еще раз отметим,  что задание /t:81 (или меньше) при
форматировании безопасны.

     Итак, задания на безопасное форматирование дискет на  дис-
ководах:
                      A - 360  KB (5"),
                      A - 1.2  MB (5") и
                      B - 1.44 MB (3"):

    ╔════════════════════════════════════════════════════╗
    ║  FORMAT a:/t:81/n:10  -  на объем  .816.640 байт   ║
    ║  FORMAT a:/t:81/n:18  -  на объем 1.476.096 байт   ║
    ║  FORMAT b:/t:81/n:21  -  на объем 1.723.904 байт   ║
    ╚════════════════════════════════════════════════════╝


                      Запуск PU_1700.COM.
                    ───────────────────────
     Производится запуском  програмы  PU_1700.COM  из файла на-
чальной автозагрузки в формате:

     PU_1700 [/параметр]
       или
     PU_1700 [/параметр ... /параметр]

     Где параметр[ы]:

            1) допустимы в только командах запуска:
          ──────────────────────────────────────────
     /ke    - сохранить блок среды.
     /cfat  - контроль  FAT  при  форматировании (необходим для
              корректной работы утилиты FORMAT комерческой вер-
              сии MS DOS 5.0 ,  да и для других систем не поме-
              шает.

        2) допустимы в командах запуска и перезапуска:
       ─────────────────────────────────────────────────
     /off   - отключение драйвера
     /on    - активизация отключенного драйвера
     /A=off - дисковод A не обслуживается (не установлен)
     /B=off - дисковод B не обслуживается (не установлен)
     /A=360 - 360 KB, 5" (DD)
     /B=360 - 360 KB, 5" (DD)
     /A=1.2 - 1.2 MB, 5" (HD)
     /B=1.2 - 1.2 MB, 5" (HD)
     /A=720 - 720 KB, 3" (DD)
     /B=720 - 720 KB, 3" (DD)
     /A=1.44- 1.44 MB, 3" (HD)
     /B=1.44- 1.44 MB, 3" (HD)
     /?     - вызов подсказки

  3) допустимы в командах запуска и перезапуска и работающие
 ────────────────────────────────────────────────────────────
                      как переключатели.
                   ─────────────────────────

     /co    - включение / выключение режима совместимости  для
              дисководов 720 KB.
     /if    - включение / выключение режима "чередования секто-
              ров" при форматировании больших форматов  (inter-
              leave factor =2 / 1).



                         Рекомендации.
                        ──────────────

     1. Не  изменяйте  имена  стандартных  утилит  DISKCOPY   и
DISKCOMP.
     2. Если у Вас возникают какие-либо трудности при работе со
специфическими программами (различными копировщиками), Вы може-
те отключить PU_1700,  задав "PU_1700/off" в командной  строке.
Задание "PU_1700/on" активизирует работу отключенного драйвера.
     3. Если у Вас  возникают  странные  сообщения  об  ошибках
распределения памяти после задания FORMAT,  попробуйте параметр
/ke при запуске PU_1700.
     4. Функции  DISKCOPY  и  DISKCOMP  в некоторых оболочках и
утилитах могут не работать с новыми форматами - используйте со-
ответствующие команды DOS - это надежнее.
     5. Желательно производить запуск драйвера PU_1700 одним из
первых из файла AUTOEXEC.BAT.
     6. Работа  с  форматами большой емкости:  800 KB 5",1.5 MB
5" и 1.7 MB 3" несколько замедляется при работе с  некачествен-
ными носителями.
     7. PU_1700 при каждом запуске автоматически распознает ти-
пы  установленных  дисководов  гибких дисков и показывает их во
время старта для для всех версий PU_1700 выше 1.2. Тип дисково-
да    можно    задать   и   в   командной   строке,   например:
"PU_1700/A=1.2" задает: A - дисковод 1.2 MB, 5" (HD).
     8. Форматы до 81 цилиндров (/t:81) безопасны. А вот надеж-
ную работу с количеством цилиндров большим  81  не  гарантируют
даже изготовители дискет. Практика показывает, что 82 и 83 тре-
ки можно использовать для временного хранения информации.
     9. Если на Вашей машине PU_1700 не обслуживает гибкие дис-
ки  формата  720 KB,  попробуйте параметр /co при запуске.  Все
последующие перезапуски PU_1700 с параметром  "/co" переключают
этот режим.
     10. Если на Вашей машине установлен старый  (низкоскорост-
ной) контроллер гибких дисков,  не поддерживающий работу с дис-
кетами больших форматов,  попробуйте параметр /IF при  запуске.
Все последующие перезапуски PU_1700 c параметром "/if" переклю-
чают этот режим. Параметр "/if" может изменить режим форматиро-
вания только больших форматов. Самые большие форматы форматиру-
ются независимо от задания параметра  c IF=2.
     10. PU_1700 обслуживает все дискеты форматированные  прог-
раммой  FDFORMAT или системной утилтой FORMAT c драйвером 800.
     11. Если при форматировании дискеты выдается сообщение:

        invalid media or Track 0 bad - disk unisable
        Format failure
        Format another (Y/N)

     ответьте Y,  после чего повторите форматирование. Если это
не поможет, то Ваша дискета действительно запорчена.


                          Изменения.
                         ────────────

     V 1.2 - разблокировано управление параметром "/ke".

     V 1.3 - изменены управляющие ключи командной строки, изме-
             нен "Help", введено "Info", изменена настоящая ин-
             струкция.
     V 1.4 - поддерживает  работу  утилит   DISKCOPY / DISKCOMP
             с дискетами всех форматов!
     V 1.5 - устранено "нежелание форматироваться после началь-
             ной загрузки системы" (имеется у драйвера "800" )!
             Изменена настоящая инструкция.
     V 1.6 - изменен алгоритм работы драйвера. (В худшую сторо-
             ну - бывает и такое.)
             Изменена настоящая инструкция.
     V 1.7 - изменен алгоритм работы драйвера. Работает с неко-
             торыми старыми "странными" версиями BIOS.
             Изменена настоящая инструкция.
     V 1.9 - изменен алгоритм работы драйвера. Введены дополни-
             тельные параметры   командной  строки:  "/cfat"  и
             "/if" - корректная работа под управлением  коммер-
             ческой версии MS DOS 5.0 и возможность  переключе-
             ния режима  форматирования (interleave factor) со-
             ответственно. Оптимизировано время ожидания  пози-
             ционирования головки  -  все  операции с дискетами
             стали работать заметно быстрее (только не со  ста-
             рыми контроллерами дисководов).
             Версия 1.9 опытная (Beta).
             Изменена настоящая инструкция.



       Особенности работы  утилиты FORMAT "коммерческой"
      ──────────────────────────────────────────────────
              версии  MS DOS 5.0 совместно с 800.
            ───────────────────────────────────────

     "Улучшенная" утилита  FORMAT  только и только этой версии
не очищает FAT длиною больше 9 секторов.  Она прекрасно форма-
тирует дискеты большого формата.  Но если размер FAT превышает
9 секторов,  то весь конец FAT прописывает  каким-то  мусором.
После  такого  "форматирования"  часть  диска  оказывается уже
"распределенной".  Привести в порядок такую дискету  нетрудно:
надо  очистить  конец 1-ой и 2-ой FAT после 9 их сектора любой
имеющейся у Вас под руками утилитой:  PCTOOLS,  NDD,  CHKDSK и
др.
     Описанный эффект  может иметь место на форматах более 1.44
MB.  Ответить на вопрос - кто же тут неправ: утилита FORMAT или
драйвер 800 затруднительно, на мой взгляд обе программы работа-
ют некорректно. Драйвер 800 на больших форматах безусловно выс-
тавляет размер FAT в 9 секторов утилите FORMAT, даже если нужно
больше или меньше.  Старые утилиты FORMAT "молча" пересчитывали
этот  параметр после форматирования,  если он оказывался меньше
заданного, и формировали "очищенный" FAT. Утилита FORMAT коммер-
ческой версии MS DOS 5.0 тоже пересчитывает длину FAT, и опять
в случае если он меньше заданного,  но очищает  ровно  столько,
сколько выставил драйвер 800.
     Запуск PU_1700 с параметром "/cfat"  позволяет  произвести
корретное форматирование дискет любого формата. При этом размер
резидентной части драйвера увеличивается на 200 байт.

     Поклонники драйвера 800!
     Утилита FORMAT  Beta версии MS DOS 5.0 работает по старому
"корректно" под коммерческой версией MS DOS 5.0  независимо  от
установленного драйвера 800 или PU_1700!




                Право распостранения программы.
                    (жулики за компьютерами)
               ────────────────────────────────


     В СССР нет защиты авторских прав.  Посмотрите на математи-
ческое обеспечение Вашего персонального компьютера.  Там  ПОЧТИ
вся математика сворована - Ваша организация,  где Вы работаете,
не заплатила за нее ни копейки.  Да она и не знает кому, на ка-
ком основании,  чем и за что надо платить. Попробуйте заплатить
Веселову Е.Н.  за украденный Вами LEXICON, через Вашу организа-
цию - Вас просто не поймут, а если и поймут, то ... . Мне бы не
хотелось увеличивать число сворованных Вами прграммных  продук-
тов. Поэтому:
     PU_1700.COM вместе с настоящей инструкцией  может свободно
распостраняться в некоммерческих целях,  БЕСПЛАТНО и без всяких
ограничений. Работайте на здоровье!




           Желаю успехов!             Панков Ю.И.    04.11.91г.
           г. Сергиев Посад           тел. в Москве: 252-43-94
             (Загорск)                               252-63-23

