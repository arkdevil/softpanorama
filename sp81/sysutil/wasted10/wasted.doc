
              █▀█   █   █▀█    ▄█▀▀▀▄ ▀▀█▀█▀▀ █▀█▀▀▀█ ██▀█▀▀▄   ▄██▄
              █ █   █   █ █   █ █       █ █   █ █     ▀█ █   █  █  █
              █ █ █ █  █ █▀█   ▀▀▄▄▄    █ █   █ █▄▄▄█  █ █   █  █  █
              ▀█ ██▄▀ ▄▀▄▀ ▀▄     █ █   █ █   █ █   ▀  █ █   █   ██
               █ █ █  █ █▄▄▄█ ▄   █ █   █ █   █ █   ▄ ██ █  ▄▀   ▄▄
               ▀▀▀ ▀  ▀▀▀   ▀  ▀▀▀▀▀    ▀▀▀   ▀▀▀▀▀▀▀ ▀▀▀▀▀▀     ▀▀

                                  William Luitje
                                 14 October 1994

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Introduction ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        This program will show you how much space is WASTED on your  hard 
        disk.   No,  I  am not referring to all of those third rate  GIFs 
        cluttering up some obscure directory.  I'm not even talking about 
        why  every Windows application seems to take up anywhere from  10 
        to  100   times more disk space than the equivalent DOS  program.  
        I'm talking about space that isn't usable but could be usable and 
        isn't storing anything at all. 

        For example,  take a look at your CONFIG.SYS file.   Chances  are 
        that  even if you have a complicated setup of  your machine  that 
        it's only  a couple of hundred bytes long.  Do a directory to see 
        how much space DOS says it uses.   Most likely  it's under   five 
        hundred, right?   But in reality,  the smallest size any file can 
        be on a hard disk is 2048 and if you have a big hard drive it may 
        be as much as 16384!  The difference between how much information 
        is in a file and what DOS allocates is pure waste. 

        The  reason for this is that DOS doesn't store files in units  of 
        bytes or even sectors (which are 512  byes long and are the basic 
        unit  of  storage of a disk).   It stores them in  chunks  called 
        clusters (also known as allocation units)  which are  an integral 
        number  of sectors in size.   (In fact the cluster size must be a 
        power of  2.)   If you have a hard drive which is under 240 mega-
        bytes, then your cluster size is most likely either 2048  or 4096 
        bytes. One cluster is the minimum size which a file occupies on a 
        disk regardless of how many  bytes  are actually meaningful.   So 
        let's say your CONFIG.SYS is 500 bytes long and your cluster size 
        is 4096 bytes.  That means that 3596 bytes are reserved and never 
        used;  in  short,   wasted.  This unused but allocated  space  is 
        sometimes  called "slack".   There is always a  piece  of  unused 
        storage  at  the end of every  file unless its size is  an  exact 
        multiple of the cluster size.   If the file is large (compared to 
        the cluster size) then percentage-wise not  much  is wasted.   On 
        the  other hand,  if you have a large number of small files  then 
        quite a bit of storage can be wasted.  How bad is this problem on 
        your system?  I'm glad you asked! 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Using The Program ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        The command line syntax is pretty simple: just invoke the program 
        with a list of the drive letters (separated by spaces) you'd like 
        to  check.   If you have several partitions  you're  thinking  of 
        combining  into  one  or  several  drives  you  are  thinking  of 
        replacing with a bigger one,  include all of their drive letters.  
        You can check a Stacker or Doublespace disk for wasted space  but 
        be aware that the host drive for a Stacker  or  Doublespace  disk 
        will  have one or  more  huge  files which you should ignore when 
        evaluating the results.
        
        For  example on my system,  I  have only one big partition and no 
        disk   compression   software  so  the   following   command   is 
        appropriate: 

        wasted c

        This produces the following report:

Drive  Cluster Size  FAT Type  Total Used  Total Wasted  Total Size
═════  ════════════  ════════  ══════════  ════════════  ══════════
  C        4096       FAT-16    202.0 Meg    12.4 Meg     233.5 Meg

Cluster    Largest   Wasted in   Wasted in   Total Wasted  Per Cent   Existing
  Size    Partition    Files    Directories     Space       Wasted   Partitions
═══════  ══════════  ═════════  ═══════════  ════════════  ════════  ══════════
  2048    128.0 Meg    5.7 Meg     0.3 Meg       6.0 Meg      3.0
  4096    255.9 Meg   11.8 Meg     0.6 Meg      12.4 Meg      6.1 <= C
  8192    511.9 Meg   25.1 Meg     1.4 Meg      26.5 Meg     13.1
 16384   1023.8 Meg   54.6 Meg     2.8 Meg      57.4 Meg     28.5
 32768   2047.5 Meg  119.8 Meg     5.8 Meg     125.6 Meg     62.2

        There are two sections to this report.   The first section  shows 
        the  status of each of the partitions/drives.   The "Total  Used" 
        column   is  the  sum  of  the  sizes  of  individual  files  and 
        directories  as  would be shown by a DIR command.   This  is  the 
        minimum  number  of  bytes  that the files could  occupy  without 
        losing  information.   "Wasted" space is what is allocated by DOS 
        but doesn't store any information.  
        
        The  second  part  of the report shows  the effect  of  different 
        cluster   sizes  on  wasted  space  for  all  of  the  files  and 
        directories in all  of the partitions specified. This information 
        can help  you decide which cluster size is  best  to use on  your 
        system.  The data in this section are computed assuming a 16  bit 
        FAT which is by far the most common type for hard drives. 

        This  report  shows  that  my hard  disk  is  fairly  efficiently 
        organized.   I could, for example,  possibly get 3 more Megabytes 
        of usable space by reorganizing it into 2 partitions smaller than 
        128 Megabytes.  But that's not a very big percentage of the space 
        used and currently I am not short of space so it certainly  would 
        not  be  worth the effort to do  the  reorganization.    Besides, 
        having one big chunk of disk space is more convenient than having 
        to worry about which partition has enough space  to hold some new 
        program I want to install. 

             [Caveat:   In the following paragraphs I'll be  drawing 
             conclusions  based  on  the data shown above.   This is 
             fairly  representative data  based  on the systems I've 
             looked at, but then all  of the systems  I've looked at 
             have  been configured  similarly.    Your situation may 
             differ, so look at the results of the  program  on your 
             system before making any decisions.] 

             [Nomenclatural Sidebar:  The figures above use the term 
             "Megabytes".   This is defined to be the total  storage 
             space of the disk, in bytes,  divided by 2 to the 20th.  
             Many  times,   especially  in  advertising,   the  term 
             megabyte  is  used to mean "million bytes".    In  this 
             document  I use the term "Megabyte"  to mean  1,048,576 
             bytes and the term "megabyte"  to mean 1,000,000 bytes.  
             There is only 5% difference between them but, as you'll 
             see below, it is important to  know the difference when 
             investigating your storage efficiency.] 

        An  interesting  situation  would  arise if  my  hard  disk  were 
        slightly larger,  for example, 270 megabytes in size (that is 258 
        Megabytes).   In this case, with a single partition,  the cluster 
        size would be increased from 4096  to 8192  and the wasted  space 
        would more than double from 12  Meg to 25  Meg.   If I wanted  to 
        retain one large partition,  I'd actually gain 13   Megabytes  of 
        otherwise wasted space by  throwing  away 2 Megabytes so that the 
        partition size was less than 256 Megabytes. 
        
        Since  the size of new hard disks is steadily increasing and  the 
        price  steadily dropping you may be thinking of buying  a  bigger 
        hard disk.   At this writing, 540  megabyte drives can be had for 
        about  $300   so it's tempting to think of upgrading.   When  you 
        prepare a new hard disk, the default action of DOS SETUP or FDISK 
        is to create one big partition.   Is this a good idea for such  a 
        drive?   Probably not,  since 540  megabytes is equivalent to 515 
        Megabytes.   That means  that the smallest effective file size is 
        16384  and according to the results shown above, you'd be wasting 
        nearly a third of your new space! 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Controlling Partition Size ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        As  noted before,  if you let the DOS 5 (or later)  setup program 
        choose a partition  size  for  you it will make one big partition 
        which  covers  all  of the hard disk.   You can  make  a  smaller 
        partition by answering  "no"   when the setup program asks you if 
        you want  to allocate all of the disk for DOS.   Then you have to 
        specify  what  percentage of the disk to reserve  for  DOS.    By 
        knowing  the  size of the disk and the desired cluster size  (and 
        hence partition size)  you can specify  what percent  of the disk 
        will yield a partition of  the desired  size.   After DOS is done 
        loading,  you will have to use FDISK and FORMAT  to  prepare  the 
        rest of the partitions for use.   See your DOS manual for details 
        on using these programs. 

        If  you  want to reduce the cluster size for a disk  that  you've 
        already  set  up,  you have a lot of work in front of you.    The 
        safest thing to do is to backup all of your files,   twice,   and 
        repartition and reformat your hard disk.   Better make real  sure 
        that the backup is complete and correct,  tho.  Then, restore all 
        of your files onto the new partitions.  

        An alternative is to use a program named presizer.exe ("Partition 
        Resizer")  which claims to be able to shrink and grow  partitions 
        without destroying the data on them, thus eliminating the need to 
        make a backup.   I haven't tried it so I can't recommend it.   If 
        you'd  like  to  experiment with it,  the current version can  be 
        found in the file presz110.zip in the msdos/diskutil directory of 
        the SimTel internet archive sites or CD-ROM. 

        But you're not done yet.  At the very least, you'll probably have 
        to change your path and some environment variables.  In addition, 
        many  programs,   especially Windows programs and Windows itself, 
        have initialization files which contain information about how the 
        program  is  stored  on  disk.   These  files  are  often  poorly 
        documented or not documented at all.  Sometimes, like the Program 
        Manager group files,  they  are binary files which you can't edit 
        easily.   You'll have to hunt all of these down and  modify them, 
        if you can.   You may be better off just reinstalling all of your 
        applications. 

        Things  are  somewhat  easier if you want change the  size  of  a 
        Stacker or Doublespace volume.    These  disk compression systems 
        have utilities for shrinking and growing compressed volumes.  You 
        still  are faced with the problem of reorganizing your  software, 
        tho. 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Theory & Details ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        Why should DOS allocate file space in clusters and why should the 
        cluster size have to increase with larger disks?  It's because of 
        the way DOS handles file storage. 
        
        There is a table at the beginning of every disk,  be it floppy or 
        hard disk,  called the File  Allocation Table (FAT).   This table 
        keeps track of which sectors of the disk belong to which file and 
        which are  free or unusable.  Each table entry contains a pointer 
        to a region of the disk which is being used.   These pointers are 
        16 bits long (actually the pointers are 12 bits long for floppies 
        and hard disks which were formatted by some old versions  of DOS) 
        but some of the pointer values have special meanings so that  the 
        maximum number of pointers is 65520 rather than 65536.   If these 
        numbers were used to point to disk sectors (512  bytes)  then the 
        largest disk could only be 33.5 Megabytes.  So for DOS to be able 
        to  use  larger disks  it  must group disk sectors when  creating 
        files.  These groups are called clusters.  The cluster size for a 
        partition  is chosen to be the smallest size which will still  be 
        able to cover the entire partition.   Basically, 65520  * cluster 
        size should be the smallest number which is still larger than the 
        size of the partition, where cluster size must be a power of two. 

        There is another source of wasted space which I didn't mention in 
        the introduction.  If you look at the results above you'll notice 
        that there is a column called "Wasted in Directories".   This has 
        a much  smaller  effect  than the amount of space wasted in files 
        since there are  usually many fewer directories than files but it 
        may be proportionately larger.  It is also caused by unused space 
        in clusters.  The root directory of a disk occupies some reserved 
        sectors  at the beginning of the disk.    This is why there is  a 
        limit on the number of files you can  have in the root  directory 
        of a disk.   Eg,  for a 1.4   meg floppy  this limit is 224.   In 
        subdirectories, on the other hand, there is no such limit.   That 
        is because a subdirectory is essentially a special  kind of  file 
        where information about other files is stored and like any normal 
        file it can be expanded  by adding  clusters,  if need be.   Each 
        file  in  a  subdirectory occupies 32  bytes of space;  so if you 
        don't have very many files in  a  subdirectory  you are wasting a 
        large percentage of  the allocated  space.   For example,  if you 
        have 10 files in a subdirectory they would occupy 320  bytes of a 
        cluster.   If the cluster size is 4096, then you are wasting over 
        90 percent of the space allocated for the directory!  (I wouldn't 
        let this prevent you from using subdirectories,  tho.  They are a 
        very useful organizational tool.) 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Limitations ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        This  program  has been checked on only a small fraction  of  the 
        huge   number  of  possible  PC  system  hardware  and   software 
        combinations.    It is a read-only program so it shouldn't  cause 
        any  damage  if used in an incompatible environment;  it'll  just 
        give strange results.   Here are some notes about what might work 
        and what might not. 

        ■  This program has been  checked with MS-DOS 3.3,  5.0  and 6.2. 
           Other versions in between these should work.   Versions 3.0  - 
           3.2 might work and versions earlier than 3.0 probably will not 
           work but I haven't tried any of them.   I  have also not tried 
           this  program with Novell DOS (AKA DR-DOS)   but it might work 
           with some of the later versions.   If you try it,  let me know 
           how it works. 

        ■  This  program will ignore any disk which  has a  cluster  size 
           less than 2048  or greater than 32768.  This means it can't be 
           used with a floppy disk as a target.  But no matter, you can't 
           change the cluster size of a floppy anyway. 

        ■  I  only used double word unsigned arithmetic in the program so 
           some of the variables could overflow if they try to deal  with 
           disks  bigger  than  4 Gigabytes.   That would  give  rise  to 
           strange looking results.  I am amazed that I am worrying about 
           disks that large but I know that they are out there. 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Acknowledgements ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        Thanks to Jeff Kendall for the original idea for this program. 

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Warranty & Copyright ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        This  software is designed to be harmless but I haven't tested it 
        on   your  system.    The  information  and  procedures  in  this 
        documentation are believed to be accurate but you are responsible 
        for  determining  their  correctness and applicability  for  your 
        intended use. 

        The  software  and documentation in this package are  copyrighted 
        works  of  William  Luitje.   You are free to copy  and  use this 
        material if the following conditions are met: 

        ■ The program and documentation are distributed together.

        ■ The program and documentation are unmodified.

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ Registration ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        Send  no  money;   I'd just like to know that you're  using  this 
        program.   I have several other pieces of Freeware out travelling 
        thru  cyberspace  and  how else am I supposed to know which  ones 
        people find useful so that I can work to improve them?   A  short 
        e-mail to the address shown below will be sufficient but if you'd 
        like to do more, you can send me . . . 

                             A  P O S T C A R D ! ! !

        Yep,  I'm starting to get some good ones as my software makes its 
        way  around the globe.   There is probably some object  of  civic 
        pride or bad  taste  in your town memorialized on a postcard that 
        would make a fine addition to my collection if you'd care to send 
        it! 

        William Luitje
        2677 Wayside Drive
        Ann Arbor, MI 48103
        USA

        Internet:  luitje@m-net.arbornet.org  <= vastly preferred, or
                   luitje@cyberspace.org

       ┌─────────────────────────────────────────────────────────────────┐
       │▒▒▒ History ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│
       └─────────────────────────────────────────────────────────────────┘
        1.0 21 Dec 94 Original release

        Copyright 1994 by William Luitje

